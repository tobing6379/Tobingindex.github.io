<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>CompletableFuture 实践</title>
      <link href="2021/06/22/completablefuture-practice/"/>
      <url>2021/06/22/completablefuture-practice/</url>
      
        <content type="html"><![CDATA[<p>有时候，合适的异步编排可以大大提高数据获取的效率，本文介绍在项目中如何使用 CompletableFuture 实现异步编排，进而加速订单数据的获取。</p><a id="more"></a><h1 id="CompletableFuture-实践"><a href="#CompletableFuture-实践" class="headerlink" title="CompletableFuture 实践"></a>CompletableFuture 实践</h1><h3 id="一、简介"><a href="#一、简介" class="headerlink" title="一、简介"></a>一、简介</h3><p>在 JDK1.5 中引入了 Future 接口来描述异步运算的结果。可以通过方法 isDone 方法来检查计算是否完成，或者使用 get 阻塞调用线程，直到计算完成返回结果，或者通过 cancel 方法停止任务的执行。</p><p>虽然 Future 接口提供了异步执行任务的能力，但是对于结果的获取却不是很方便，只能通过阻塞或轮询方式得到任务的结果。阻塞方式显然和异步编程的初衷背离，轮询的方式有会浪费无谓的CPU资源，而且也不能及时的计算结果。</p><p>很多语言， 比如 Node.js， 采用回调的方式实现异步编程。 Java 的一些框架， 比如 Netty， 自己扩展了 Java 的 <code>Future</code>接口， 提供了<code>addListener</code>等多个扩展方法； Google guava 也提供了通用的扩展 Future； Scala 也提供了简单易用且功能强大的 Future/Promise 异步编程模式。  但Future并不可以将其他运行组合或则进行异常处理的方法。</p><p>同样地，在 Java 8 中, 新增加了一个包含 50 个方法左右的类: CompletableFuture， 提供了非常强大的Future 的扩展功能， 可以帮助我们简化异步编程的复杂性， 提供了函数式编程的能力， 可以通过回调的方式处理计算结果， 并且提供了转换和组合 CompletableFuture 的方法。CompletableFuture 类实现了 Future 接口， 所以你还是可以像以前一样通过<code>get</code>方法阻塞或者轮询的方式获得结果， 但是这种方式不推荐使用 。</p><p>CompletableFuture 和 FutureTask 同属于 Future 接口的实现类， 都可以获取线程的执行结果。  </p><p><img src="https://gitee.com/tobing/imagebed/raw/master/image-20210622184727953.png" class="lazyload" data-srcset="https://gitee.com/tobing/imagebed/raw/master/image-20210622184727953.png" srcset="data:image/png;base64,666" alt="image-20210622184727953"></p><p>有了对 CompletableFuture 的基本了解，下面来简单介绍 Completeable 的一些 API 。</p><h4 id="创建异步对象"><a href="#创建异步对象" class="headerlink" title="创建异步对象"></a>创建异步对象</h4><p>CompletableFuture 提供了四个静态方法来创建一个异步操作。</p><p><img src="https://gitee.com/tobing/imagebed/raw/master/image-20210622194843007.png" class="lazyload" data-srcset="https://gitee.com/tobing/imagebed/raw/master/image-20210622194843007.png" srcset="data:image/png;base64,666" alt="image-20210622194843007"></p><ul><li>runXxxx 都是没有返回结果的， supplyXxx 都是可以获取返回结果的 ；</li><li>可以传入自定义的线程池， 否则就用默认的线程池；  </li></ul><h4 id="计算完成回调方法"><a href="#计算完成回调方法" class="headerlink" title="计算完成回调方法"></a>计算完成回调方法</h4><p><img src="https://gitee.com/tobing/imagebed/raw/master/image-20210622194800177.png" class="lazyload" data-srcset="https://gitee.com/tobing/imagebed/raw/master/image-20210622194800177.png" srcset="data:image/png;base64,666" alt="image-20210622194800177"></p><ul><li>whenComplete 可以处理正常和异常的计算结果，exceptionally 处理异常情况；</li><li>whenCompleteAsync 把任务交给线程池异步执行，whenComplete 是执行当前任务的线程继续执行；</li></ul><h4 id="handle-方法"><a href="#handle-方法" class="headerlink" title="handle 方法"></a>handle 方法</h4><p><img src="https://gitee.com/tobing/imagebed/raw/master/image-20210622194630102.png" class="lazyload" data-srcset="https://gitee.com/tobing/imagebed/raw/master/image-20210622194630102.png" srcset="data:image/png;base64,666" alt="image-20210622194630102"></p><ul><li>和 complete 类似，可以对结果做最后处理（可处理异常），可改变返回值。</li></ul><h4 id="线程串行化方法"><a href="#线程串行化方法" class="headerlink" title="线程串行化方法"></a>线程串行化方法</h4><p><img src="https://gitee.com/tobing/imagebed/raw/master/image-20210622194544713.png" class="lazyload" data-srcset="https://gitee.com/tobing/imagebed/raw/master/image-20210622194544713.png" srcset="data:image/png;base64,666" alt="image-20210622194544713"></p><ul><li>thenApply  方法：当一个线程依赖另一个线程时，获取上一个任务返回的结果，并返回当前任务的返回值；</li><li>thenAccept 方法：接收任务的处理结果，并消费处理，无返回结果；</li><li>thenRun 方法：只要上面任务完成，就开始执行 thenRun，只是处理完任务后，执行 thenRun 的后继操作。</li></ul><h4 id="两任务组合-都完成"><a href="#两任务组合-都完成" class="headerlink" title="两任务组合-都完成"></a>两任务组合-都完成</h4><p><img src="https://gitee.com/tobing/imagebed/raw/master/image-20210622194451406.png" class="lazyload" data-srcset="https://gitee.com/tobing/imagebed/raw/master/image-20210622194451406.png" srcset="data:image/png;base64,666" alt="image-20210622194451406"></p><p>两个任务都必须完成，才触发该任务。</p><ul><li><p>thenCombine： 组合两个 future， 获取两个 future 的返回结果，并返回当前任务的返回值</p></li><li><p>thenAcceptBoth： 组合两个 future， 获取两个 future 任务的返回结果， 然后处理任务，没有返回值。</p></li><li><p>runAfterBoth： 组合两个 future， 不需要获取 future 的结果， 只需两个 future 处理完任务后，处理该任务。  </p><h4 id="两任务完成-完成其一"><a href="#两任务完成-完成其一" class="headerlink" title="两任务完成-完成其一"></a>两任务完成-完成其一</h4></li></ul><p><img src="https://gitee.com/tobing/imagebed/raw/master/image-20210622194935711.png" class="lazyload" data-srcset="https://gitee.com/tobing/imagebed/raw/master/image-20210622194935711.png" srcset="data:image/png;base64,666" alt="image-20210622194935711"></p><p>当两任务中，任意一个Future任务完成是，执行任务。</p><ul><li><p>applyToEither： 两个任务有一个执行完成， 获取它的返回值， 处理任务并有新的返回值。</p></li><li><p>acceptEither： 两个任务有一个执行完成， 获取它的返回值， 处理任务， 没有新的返回值。</p></li><li><p>runAfterEither： 两个任务有一个执行完成， 不需要获取 future 的结果， 处理任务， 也没有返回值。  </p></li></ul><h4 id="多任务组合"><a href="#多任务组合" class="headerlink" title="多任务组合"></a>多任务组合</h4><p><img src="https://gitee.com/tobing/imagebed/raw/master/image-20210622195045142.png" class="lazyload" data-srcset="https://gitee.com/tobing/imagebed/raw/master/image-20210622195045142.png" srcset="data:image/png;base64,666" alt="image-20210622195045142"></p><ul><li>allOf：等待所有任务完成</li><li>anyOf：只要一个任务完成</li></ul><h3 id="二、CompletableFuture-在项目的运用"><a href="#二、CompletableFuture-在项目的运用" class="headerlink" title="二、CompletableFuture 在项目的运用"></a>二、CompletableFuture 在项目的运用</h3><p>在查询商品详情页时，需要调用多个模块的接口获取多种数据（如会员模块的用户数据、库存模块的库存数据、优惠模块的优惠卷数据等等）。</p><p>由于这些数据分布在不同的服务中，这些数据的时候需要通过远程调用来获取，如常见的OpenFeign。</p><p>由于部分数据不存在依赖性限制，即一些数据查询是可以相对独立的，此时可以考虑使用异步编排来同时获取数据，优化查询效率。</p><p> 如在项目<a href="https://github.com/Tobingindex/platform/blob/master/platform-order/src/main/java/top/tobing/platform/order/service/impl/OrderServiceImpl.java#L91-L140">platform-order#toTrade</a>查询创建订单时，需要调用三个服务：</p><ul><li>调用【用户服务】查询购物车地址；（假设100ms完成）</li><li>调用【用户服务】查询用户优惠信息；（假设101ms完成）</li><li>调用【购物车服务】查询购物车选中项；（假设102ms完成）</li><li>调用【库存服务】查询商品库存；（假设103ms完成）</li></ul><img src="https://gitee.com/tobing/imagebed/raw/master/Precursor_figure.jpg" class="lazyload" data-srcset="https://gitee.com/tobing/imagebed/raw/master/Precursor_figure.jpg" srcset="data:image/png;base64,666" alt="Precursor_figure" style="zoom:67%;" /><p>如果采用串行执行，则需要花费：100ms+101ms+102ms+103ms=405ms（串行执行，依次查询）</p><p>如果采用异步编排，则需要花费：102ms+103ms=205ms（只需要考虑最长路径）</p><p>从分析可以得到，如果不考虑线程上下文切换等因素，异步编排将能够大大提高商品详情页的数据。</p><blockquote><p>简化代码如下：CompletableFuture + ThreadPoolExecutor</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> OrderConfirmVo <span class="title">toTrade</span><span class="params">()</span> <span class="keyword">throws</span> ExecutionException, InterruptedException </span>&#123;</span><br><span class="line">    OrderConfirmVo confirmVo = <span class="keyword">new</span> OrderConfirmVo();</span><br><span class="line">    MemberRespVo memberRespVo = UserContextHolder.getCurrentUser();</span><br><span class="line"></span><br><span class="line">    CompletableFuture&lt;Void&gt; getAddress = CompletableFuture.runAsync(() -&gt; &#123;</span><br><span class="line">        <span class="comment">// 1、查询所有的收货地址【用户服务】</span></span><br><span class="line">        List&lt;MemberAddressVo&gt; address = memberFeignService.addressList(memberRespVo.getId());</span><br><span class="line">        confirmVo.setAddressList(address);</span><br><span class="line">    &#125;, poolExecutor);</span><br><span class="line"></span><br><span class="line">    CompletableFuture&lt;Void&gt; getItems = CompletableFuture.supplyAsync(() -&gt; &#123;</span><br><span class="line">        <span class="comment">// 2、查询购物车选中的商品【购物车服务】</span></span><br><span class="line">        List&lt;OrderItemVo&gt; items = cartFeignService.listOwnCheckItem();</span><br><span class="line">        confirmVo.setItemVoList(items);</span><br><span class="line">        <span class="keyword">return</span> items;</span><br><span class="line">    &#125;, poolExecutor).thenAcceptAsync((items) -&gt; &#123;</span><br><span class="line">        <span class="comment">// 3、查询远程是否存在库存【库存服务】</span></span><br><span class="line">        List&lt;SkuStockSearchVo&gt; stockStatus = wareFeignService.batchSkuStock(skuIds);</span><br><span class="line">        <span class="keyword">if</span> (stockStatus != <span class="keyword">null</span>) &#123;</span><br><span class="line">            Map&lt;Long, Boolean&gt; map = stockStatus.stream().collect(Collectors.toMap(SkuStockSearchVo::getSkuId, SkuStockSearchVo::getStock));</span><br><span class="line">            confirmVo.setHasStockMap(map);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;, poolExecutor);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 4、查询用户优惠信息【用户服务】（简化处理）</span></span><br><span class="line">    Integer integration = memberRespVo.getIntegration();</span><br><span class="line">    confirmVo.setIntegration(integration);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 5、生成防重令牌，分别保存在Redis与返回页面，这样就可以在页面提交的时候直接校验（保重接口幂等性）</span></span><br><span class="line">    String orderToken = UUID.randomUUID().toString().replace(<span class="string">&quot;-&quot;</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line">    confirmVo.setOrderToken(orderToken);</span><br><span class="line">    redisTemplate.opsForValue().set(PlatformOrderConstant.USER_ORDER_TOKEN_PREFIX + memberRespVo.getId(), orderToken);</span><br><span class="line"></span><br><span class="line">    CompletableFuture.allOf(getAddress, getItems).get();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> confirmVo;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="三、用户信息丢失"><a href="#三、用户信息丢失" class="headerlink" title="三、用户信息丢失"></a>三、用户信息丢失</h3><p>在使用异步编排的时候，需要特别注意一个问题，就是<strong>异步化是否会对原有的逻辑造成影响</strong>。</p><p>在本项目中，由于采用的是 Cookie 进行身份识别，如果直接采用上述代码而不是使用添加额外措施，将会导致在远程调用的时候身份信息丢失，进而导致查询远程接口失败。下面我们就来观察直接异步化存在的问题。</p><blockquote><p>首先，将异步化的程序运行一遍，查看是否能够正常获取数据（串行时是正常的）</p></blockquote><div class="gallery ">              <p><img src="https://gitee.com/tobing/imagebed/raw/master/image-20210621221155986.png" class="lazyload" data-srcset="https://gitee.com/tobing/imagebed/raw/master/image-20210621221155986.png" srcset="data:image/png;base64,666" alt="image-20210621221155986"></p>            </div><p>调用【购物车服务】时报错，查看报错信息发现用户信息尚未认证。</p><blockquote><p>在购物车服务，在拦截器中会根据 Cookie 信息获取验证用户，如果授权成功则会将信息存放到ThreadLocal中</p></blockquote><div class="gallery ">              <p><img src="https://gitee.com/tobing/imagebed/raw/master/image-20210621221455094.png" class="lazyload" data-srcset="https://gitee.com/tobing/imagebed/raw/master/image-20210621221455094.png" srcset="data:image/png;base64,666" alt="image-20210621221455094"></p>            </div><blockquote><p>分析：为什么在串行编程时通过openfeign调用第三方就可以？而异步编排就会丢失信息呢？</p></blockquote><p>默认情况下，使用OpenFeign的时候会丢失header信息的，其中丢失的信息就包含了Cookie信息。</p><p>为了解决OpenFeign构造请求丢失header信息问题，考虑配置一个请求拦截器RequestInterceptor，统一拦截请求来完成设置header等相关请求。</p><p>下面代码中，配置了一个RequestInterceptor，当OpenFeign都会经过该拦截器，而该拦截器会为每个请求添加上原请求的header信息（其中包含了用于身份认证的Cookie信息）。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FeignConfig</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> RequestInterceptor <span class="title">requestInterceptor</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> RequestInterceptor() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">apply</span><span class="params">(RequestTemplate template)</span> </span>&#123;</span><br><span class="line">                <span class="comment">// 1、获取到进入该请求的上下文保持器</span></span><br><span class="line">                ServletRequestAttributes requestAttributes = (ServletRequestAttributes) RequestContextHolder.getRequestAttributes();</span><br><span class="line">                <span class="keyword">if</span> (requestAttributes != <span class="keyword">null</span>) &#123;</span><br><span class="line">                    <span class="comment">// 2、从中获取Request对象</span></span><br><span class="line">                    HttpServletRequest request = requestAttributes.getRequest();</span><br><span class="line">                    <span class="comment">// 3、从请求头中获取Cookie</span></span><br><span class="line">                    String cookies = request.getHeader(<span class="string">&quot;Cookie&quot;</span>);</span><br><span class="line">                    <span class="comment">// 4、将Cookie放到Feign的远程调用的请求中</span></span><br><span class="line">                    template.header(<span class="string">&quot;Cookie&quot;</span>, cookies);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>那么问题来了，原请求的信息是如何获取到的呢？那就是通过<a href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/web/context/request/RequestContextHolder.html">RequestContextHolder</a>，通过RequestContextHolder可以获取到当前请求的信息，其中就包含了当前请求中的header信息。</p><p>而RequestContextHolder内部是通过“thread-bound”方式来共享请求信息的。当一个请求来临，Web容器会为其分配一个用于该请求的线程。由于每个请求都会有一个与之对应的线程进行处理，于是人们就考虑将请求的信息保存在ThreadLocal中，实现请求信息与线程绑定。这样就可以实现，在当前请求的任意位置，只要属于当前线程，就可以获取到请求信息，这也是RequestContextHolder的基本原理。</p><div class="gallery ">              <p><img src="https://gitee.com/tobing/imagebed/raw/master/image-20210622170719206.png" class="lazyload" data-srcset="https://gitee.com/tobing/imagebed/raw/master/image-20210622170719206.png" srcset="data:image/png;base64,666" alt="image-20210622170719206"></p>            </div><p>现在回到一开始的疑问，为啥在串行执行时OpenFeign过载的请求就能成功获取到数据，而异步编排就不行呢？</p><p>通过上面的分析，原因就很明了了，在串行执行中OpenFeign构造请求时始终是在一个请求中，通过该请求可获取到当前的信息；但是在异步编排时，是在线程池获取的线程中构造请求，自然就没办法拿到数据，自然就没办法获取到请求头数据了。</p><p>那么是不是使用了OpenFeign就没办法使用异步编排了呢？显然不是，我们只需要在异步编排内部重新设置当前的请求属性即可了，详情看代码：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> OrderConfirmVo <span class="title">toTrade</span><span class="params">()</span> <span class="keyword">throws</span> ExecutionException, InterruptedException </span>&#123;</span><br><span class="line">    OrderConfirmVo confirmVo = <span class="keyword">new</span> OrderConfirmVo();</span><br><span class="line">    MemberRespVo memberRespVo = UserContextHolder.getCurrentUser();</span><br><span class="line">    <span class="comment">// 在异步编排外部获取当前请求的信息。【主处理线程】</span></span><br><span class="line">    RequestAttributes requestAttributes = RequestContextHolder.getRequestAttributes();</span><br><span class="line"></span><br><span class="line">    CompletableFuture&lt;Void&gt; getAddress = CompletableFuture.runAsync(() -&gt; &#123;</span><br><span class="line">        <span class="comment">// 在异步编排内部重新设置主处理线程的请求信息，使OpenFeign在构造请求时可以顺利获取到相应的信息。</span></span><br><span class="line">        RequestContextHolder.setRequestAttributes(requestAttributes);</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;, poolExecutor);</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>自此，在OpenFeign下使用CompletableFutrue的问题总算是解决完毕。</p><p>如果需要查看更加详细的代码，通过去访问Github中<a href="https://github.com/Tobingindex/platform/blob/master/platform-order/src/main/java/top/tobing/platform/order/service/impl/OrderServiceImpl.java#L91-L140">Platform仓库</a>进行查看。</p><h3 id="四、参考文献"><a href="#四、参考文献" class="headerlink" title="四、参考文献"></a>四、参考文献</h3><ul><li><p><a href="https://www.baeldung.com/java-completablefuture">Guide To CompletableFuture</a></p></li><li><p><a href="https://github.com/Tobingindex/platform/blob/master/platform-order/src/main/java/top/tobing/platform/order/service/impl/OrderServiceImpl.java#L91-L140">platform-order#toTrade</a></p></li><li><p><a href="https://github.com/Tobingindex/platform/blob/master/platform-order/src/main/java/top/tobing/platform/order/config/FeignConfig.java">platform-order#FeignConfig</a></p></li><li><p><a href="https://github.com/OpenFeign/feign/issues/214">Better support for request-specific headers</a></p></li><li><p><a href="https://www.baeldung.com/spring-cloud-openfeign#interceptors">Introduction to Spring Cloud OpenFeign</a></p></li><li><p><a href="https://cloud.tencent.com/developer/article/1600718">Feign的拦截器RequestInterceptor</a></p></li><li><p><a href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/web/context/request/RequestContextHolder.html">Class RequestContextHolder</a></p></li></ul>]]></content>
      
      
      <categories>
          
          <category> 技术应用 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> CompletableFuture </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Redis-数据结构</title>
      <link href="2021/06/20/Redis-Datastruct/"/>
      <url>2021/06/20/Redis-Datastruct/</url>
      
        <content type="html"><![CDATA[<p>Redis 是非常常见的中间件，本文将介绍 Redis 的数据结构。</p><a id="more"></a><h1 id="Redis-数据结构与对象"><a href="#Redis-数据结构与对象" class="headerlink" title="Redis-数据结构与对象"></a>Redis-数据结构与对象</h1><h2 id="一、常用数据结构"><a href="#一、常用数据结构" class="headerlink" title="一、常用数据结构"></a>一、常用数据结构</h2><h4 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h4><p>Redis 底层的数据结构一共有 6 种，分别是：简单动态字符串（SDS）、双向链表、压缩列表、哈希表、跳表和整数数组。</p><p>Redis 的基础数据类型主要有 5 种，分别是：String、List、Hash、Sorted Set和Set。</p><p>其中，5 种基础数据类型通过底层 6 种数据结构实现，它们之间的对应关系如下图所示：</p><p><img src="https://gitee.com/tobing/imagebed/raw/master/image-20210521220651124.png" class="lazyload" data-srcset="https://gitee.com/tobing/imagebed/raw/master/image-20210521220651124.png" srcset="data:image/png;base64,666" alt="image-20210521220651124"></p><ul><li>上图中，String的实现方式只有一种为SDS，而其他类型都由两种底层数据结构实现。</li></ul><p>接下来我们分别学习这 6 种底层数据结构。</p><h4 id="简单动态字符串"><a href="#简单动态字符串" class="headerlink" title="简单动态字符串"></a>简单动态字符串</h4><p>简单动态字符串，Simple Dynamic String，简称 SDS。顾名思义，SDS 类似于 ArrayList 是可以动态增长的。</p><p>SDS的结构如下：</p><p><img src="https://gitee.com/tobing/imagebed/raw/master/image-20210524223843654.png" class="lazyload" data-srcset="https://gitee.com/tobing/imagebed/raw/master/image-20210524223843654.png" srcset="data:image/png;base64,666" alt="image-20210524223843654"></p><ul><li>free ：记录buf数组中已使用的字节数量，等于 SDS 保存字符串的长度</li><li>len ：记录buf数组中未使用的字节数量</li><li>buf 数组：字节数组，用于保存字符串</li></ul><p>SDS 遵循 C 语言规范，保存空字符串的一个字节不会计算到 SDS 的 len 属性中。</p><p>由于 Redis 对 String 进行了一层封装，因此 SDS 与原生的 C 语言中的字符串有所区别：</p><table><thead><tr><th>C字符串</th><th>SDS</th></tr></thead><tbody><tr><td>获取字符串长度复杂度为O(n)</td><td>获取字符串长度复杂度为O(1)</td></tr><tr><td>API是不安全的，可能造成缓冲区溢出</td><td>API是安全的，不会造成缓冲区溢出</td></tr><tr><td>修改字符串长度N次必须重新分配N次内存</td><td>修改字符串长度N次最多需要重新分配N次内存</td></tr><tr><td>只能保存文本数据</td><td>可以保存文本或者二进制数据</td></tr><tr><td>可以使用所有&lt;string.h&gt;库中的函数</td><td>可以使用部分&lt;string.h&gt;库中的函数</td></tr></tbody></table><ul><li>此处一个较为重大的区别就是 SDS 是二进制安全的，因此 SDS 还被用来实现位数组。</li></ul><p>Redis 中，SDS的使用场景较为广泛：</p><ul><li>作为字符串对象的底层实现</li><li>作为二进制位数组的底层实现</li><li>作为AOF缓冲区和客户端状态的输入缓冲区</li></ul><h4 id="双向链表"><a href="#双向链表" class="headerlink" title="双向链表"></a>双向链表</h4><p>双向链表提供了高效的重排能力，以及顺序性的节点访问方式，可以通过增删节点灵活调整链表长度。</p><p>双向链表的结构如下：</p><p><img src="https://gitee.com/tobing/imagebed/raw/master/image-20210525211851539.png" class="lazyload" data-srcset="https://gitee.com/tobing/imagebed/raw/master/image-20210525211851539.png" srcset="data:image/png;base64,666" alt="image-20210525211851539"></p><p>双向链表的特征如下：</p><ul><li><strong>双端</strong>：链表节点带prev和next指针，可以获取节点的前置和后置节点。</li><li><strong>无环</strong>：表头的prev指针和表为的next都为null，对链表的访问以null为结尾。</li><li><strong>带表头和表尾元素</strong>：通过list结构的head和list指针获取表头节点和表尾元素，时间复杂度为O(1)。</li><li><strong>带链表长度计数器</strong>：通过维护len来记录链表持有的节点。</li></ul><p>同样地，双向链表的使用场景也很多：</p><ul><li>作为List的底层实现</li><li>发布于订阅、慢查询、监视器等功能也用到链表</li><li>Redis服务器本身还使用链表来保存多个客户端的状态信息</li><li>Redis使用链表来构建客户端输出缓冲区</li></ul><h4 id="字典"><a href="#字典" class="headerlink" title="字典"></a>字典</h4><p>字典，又称为符号表、关联数组或映射，是一种用来保存键值对的抽象数据结构。</p><p>Redis使用的C语言没有内置这种数据结构，因此Redis构建了自己的字典实现，结构如下：</p><p><img src="https://gitee.com/tobing/imagebed/raw/master/image-20210527221333060.png" class="lazyload" data-srcset="https://gitee.com/tobing/imagebed/raw/master/image-20210527221333060.png" srcset="data:image/png;base64,666" alt="image-20210527221333060"></p><ul><li>【dict】：Redis中的字典通过dict结构管理<ul><li>type和privdata是为储存不同类型键值对而存在</li><li>type是一个dictType指针，dictType结构保存了一簇用于操作特定类型键值对的函数，Redis会为用途不同的字典设置不同的类型特定函数；</li><li>privdata属性保存了需要特定传给那些类型特定函数的可选参数；</li><li>ht是一个长度为2的dicth数组，字典只使用ht[0]哈希表，ht[1]哈希表只在对ht[0]哈希表进行rehash时使用；</li><li>rehashindx属性记录rehash进度，如果当前没有进行rehash，值为-1。</li></ul></li><li>【dictht】：Redis字典中使用的哈希表dictht实现<ul><li>table是一个数组，数组每个元素执行一个dictEntry结构的指针，每个dictEntry结构保存着一个键值对；</li><li>size属性记录了哈希表的大小，即table数组的大小；</li><li>used属性记录了哈希表目前已有的节点数量；</li><li>sizemask属性的值总是等于size-1，这个属性结合哈希值一起决定一个键应该被放到table数组的哪个索引上。</li></ul></li><li>【dictEntry】：哈希表节点使用dictEntry结构表示，每个dictEntry结构都保存着一个键值对<ul><li>key属性保存键值对中的键；</li><li>v属性保存键值对中的值，值可以一个指针，或一个uint64整数，有或者是一个int64_t整数;</li><li>next属性是执行另一个哈希表节点的指针，Redis通过链地址法来解决哈希冲突。</li></ul></li></ul><p>提到字典，不得不提到<strong>哈希冲突</strong>、<strong>rehash</strong>。</p><p>Redis 中字典采用链地址法连解决哈希冲突问题， 即每个哈希节点都有一个next指针，哈希索引相同的多个节点可以通过next构成一个单向链表，依次来解决哈希冲突。</p><p>随着操作不断执行，哈希表保存的键值对会逐渐增加或减少，为了让哈希表的负载因子（load factor）维持在一个合理的范围，哈希表保存的键值数量太多或太少时，需要对哈希表的大小进行相应的扩展或收缩。</p><p>哈希表的扩展或收缩需要通过rehash（重新散列）来完成，主要步骤如下：</p><ol><li>为字典ht[1]哈希表分配空间，这个<strong>哈希表的空间大小取决于要执行的操作，以及ht[0]当前包含的键值对数量</strong>。<ul><li>当执行的是扩展操作，ht[1]大小为第一个大于等于ht[0].used*2的<strong>2的n次方幂</strong></li><li>当执行的是收缩操作，ht[1]大小为第一个大于等于ht[0].used的<strong>2的n次方幂</strong>（始终保证哈希表大小为2的n次幂）</li></ul></li><li>将保持在ht[0]中的所有键值对rehash到ht[1]上面：rehash是指重新计算键的哈希值和索引值，然后将键值对放置到ht[1]哈希表指定的位置上。</li><li>当ht[0]包含的所有键值对都迁移到ht[1]之后，释放ht[0]，将ht[1]设置为ht[0]，并在ht[1]新创建空白哈希表，为下次rehash准备。</li></ol><p>考虑到服务器性能的影响，在收缩或扩展哈希表时，将ht[0]的数据复制到ht[1]这个动作并不是一次性完成的，是分多次，渐进式完成的，详细步骤如下：</p><ol><li>为ht[1]分配空间，字典同时持有ht[0]和ht[1]两个哈希表；</li><li>在字典中维持一个索引计数器变量rehashidx，将它设置为0，表示rehash工作正式开始</li><li>在rehash进行期间，每次对字典执行添加、删除、查找或更新操作时，程序除了完成指定操作，还会顺带将会ht[0]哈希表在rehashidx索引上的所有键值对rehash到ht[1]，当一次rehash工作完成，rehashidx属性值增一</li><li>随着字典操作不断执行，最终某个时间点上，ht[0]的所有键值都会被rehash到ht[1]，这是程序将rehashidx设置为-1，表示rehash操作已经完成。</li></ol><p>上面过程体现了分而治之、均摊的思想，可以用于避免集中式rehash带来的庞大计算量。</p><p>在进行渐进式rehash过程中，字典会同时使用ht[0]和ht[1]两个哈希表，因此在rehash期间，字典的删除、查找、更新等操作会在两个哈希表上进行。如果要在字典中查找一个键时，会先到ht[0]中查找，没有则会到ht[1]中查找。</p><p>另外，渐进式rehash执行期间，新添加到字典的键值对一律会被保存到ht[1]中，ht[0]不再进行任何添加按操作，这一措施保证ht[0]包含的键值对数量只减不增，而随着rehash操作的进行而最终变为空表。</p><p>注意：rehash的发生除了与负载因子有关，还需要考虑当前是否执行bgsave或bgrewrite命令。或者的目的都是为了降低服务器阻塞的可能。</p><h4 id="跳跃表"><a href="#跳跃表" class="headerlink" title="跳跃表"></a>跳跃表</h4><p>跳跃表是一种有序的数据结构，通过维持多个指向其他节点的指针，从而达到快速访问节点的目的。</p><p>跳跃表支持平均O(logN)、最坏O(N)复杂度的节点查找，还可以通过顺序性操作来批量处理节点。大部分情况下，跳跃表的效率和平衡树媲美，而且跳表实现比平衡树简单。</p><p>Redis使用跳跃表作为Sorted Set 的底层实现之一，如果Sorted Set的元素较多，或者其中元素是较长的字符串时，Redis会使用跳跃表作为Sorted Set的底层实现。</p><p>跳跃表的结构如下：</p><p><img src="https://gitee.com/tobing/imagebed/raw/master/image-20210528092838914.png" class="lazyload" data-srcset="https://gitee.com/tobing/imagebed/raw/master/image-20210528092838914.png" srcset="data:image/png;base64,666" alt="image-20210528092838914"></p><ul><li>【zskiplist】：保存跳跃表节点的相关信息<ul><li>header：指向跳跃表的表头节点，可以以O(1)时间复杂度访问头节点</li><li>tail：指向跳跃表的表尾节点，可以以O(1)时间复杂度访问尾节点</li><li>level：记录当前跳跃表层数最大的节点层数（表头层数不计算在内）</li><li>length：记录跳跃表的长度，跳跃表目前包含节点的数量（表头节点不计）</li></ul></li><li>【zskiplistNode】：用于表示跳跃表节点<ul><li>level：层，节点中用L1、L2、L3等字样标记节点的各个层，L1表示第一层，L2表示第二层，以此类推。每个层都带有两个属性：前进指针和跨度。<ul><li>前进指针用于访问位于表尾方向的其他节点</li><li>跨度记录了前进指针所指向节点和当前节点的距离，两个节点之间跨度很大，它们相距越远，指向null的所有前进指针的跨度为0</li><li>跨度是用来计算排位（rank）：在查找某个节点的过程中，将沿途访问过的所有层的跨度累计，得到的结果就是目标节点在跳跃表的排位。</li><li>当程序从表头向表尾进行遍历时，访问会沿着层的前进指针进行</li></ul></li><li>backward：后退指针，节点中用BW字样标记节点后退指针，它指向位于当前节点的前一个节点。后退指针在程序从表尾先表头遍历时使用。</li><li>score：分值，各个节点中的1.0、2.0是节点所保存的分值。跳跃表中节点按各自保存的分值从小到大排列。</li><li>obj：成员对象，各个节点的o1、o2是节点所保存的成员对象。</li></ul></li></ul><p>需要注意的是，表头节点和其他节点构造不一样，表头节点也有后退指针、分值和成员对象，不过表头节点的这些属性不会被用到，因此在图中省略了这些部分。</p><h4 id="整数数组"><a href="#整数数组" class="headerlink" title="整数数组"></a>整数数组</h4><p>当一个集合只包含整数元素并且这个集合的元素数量不多时，Redis 会使用整数数组作为 Set 的底层实现。</p><p>整数数组的结构如下：</p><p><img src="https://gitee.com/tobing/imagebed/raw/master/image-20210528130231842.png" class="lazyload" data-srcset="https://gitee.com/tobing/imagebed/raw/master/image-20210528130231842.png" srcset="data:image/png;base64,666" alt="image-20210528130231842"></p><ul><li>contents数组是集合的底层实现，整数集合的每个元素都是contents数组的每个数组项，各个项在数组中按值的大小从小到大有序排列，且数组中不会出现重复项。</li><li>length记录了整数集合包含的元素数量，即contents数组的长度。</li><li>虽然contents声明为int8_t，但实际上储存取决于encoding的值<ul><li>encoding=INTSET_ENC_INT16，contents为int16_t类型的数组；（-32768，32767）</li><li>encoding=INTSET_ENC_INT32，contents为int32_t类型的数组；（-2147483648，2147483647）</li><li>encoding=INTSET_ENC_INT64，contents为int64_t类型的数组；（- 9223372036854775808，9223372036854775807）</li></ul></li></ul><p>每当一个新元素添加当整数数组的时候，并且新元素的类型比这整数数组的所有元素的了类型都要长，整数数组需要先升级，然后才能将元素添加到整数数组中。</p><ol><li>根据新元素的类型，扩展整数数组底层数组的空间大小，并为新元素分配空间。</li><li>将底层数据现有的所有元素转换为与新元素相同的类型，并将类型转换后的元素放到正确的位置上，而且在放置元素的过程中，需要维持底层数组的有序性质不变。</li><li>将新元素添加到底层数组中。</li></ol><p>每次向整数集合中添加新元素都可能引起升级，而每次升级都需要对底层数据已有的所有元素进行类型转换，所以先整数集合添加新元素的时间复杂度为O(N)。</p><p>需要注意的是，升级之后新元素的摆放位置：</p><p>因为引发升级的新元素的长度总是要比整数集合现有的所有数据要大，因此这个新元素的值要么“大于”所有现有元素，要么就“小于”所有现有元素。</p><ul><li>新元素“小于”所有现有元素的情况下，新元素会被放置到底层数组的最开头位置【负数】</li><li>新元素“大于”所有现有元素的情况下，新元素会被放置到底层数组的最末尾位置【正数】</li></ul><p>通过升级策略，整数集合具有两个好处，一是提高整数集合的灵活性，另一个是尽可能地节省内存。</p><ul><li>灵活性：可以随意将int16_t、int32_t或者int64_t类型的数据添加到集合中，而不用担心出现类型错误</li><li>节约内存：如果不考虑内存占用，可以直接用int64_t保存所有的数据，但是这不符合Redis的节约风格，因此采用上面方式</li></ul><p>需要注意：整数集合不支持降级操作，一旦对数组进行了升级，编码就会一直保持升级的状态。</p><h4 id="压缩表"><a href="#压缩表" class="headerlink" title="压缩表"></a>压缩表</h4><p>压缩列表是列表键和哈希键的底层实现之一。</p><p>当一个List只包含少量列表项，并且每个列表项要么就是小整数值，要么就是长度较短的字符串，那么Redis就会使用压缩列表来做列表键的底层实现。</p><p>当一个Hash只包含少量键值对，并且每个键值对的键和值要么就是小整数值，要么就是长度较短的字符串，那么Redis就会使用压缩列表来做哈希键的底层实现。</p><p>压缩列表是Redis为了节约内存开发的，是由一系列特殊编码的连续内存块组成的<strong>顺序型数据结构</strong>。一个压缩列表可以包含任意多节点（entry），每个节点可以保存一个字节数组或一个整数值。压缩表的结构如下：</p><p><img src="https://gitee.com/tobing/imagebed/raw/master/image-20210528165256106.png" class="lazyload" data-srcset="https://gitee.com/tobing/imagebed/raw/master/image-20210528165256106.png" srcset="data:image/png;base64,666" alt="image-20210528165256106"></p><table><thead><tr><th>属性</th><th>类型</th><th>长度</th><th>用途</th></tr></thead><tbody><tr><td>zlbytes</td><td>uint32_t</td><td>4字节</td><td>记录ziplist占用的内存字节，在对ziplist进行内存重新分配或减少zlend的位置时使用</td></tr><tr><td>zltail</td><td>uint32_t</td><td>4字节</td><td>记录ziplist尾节点距离压缩列表的起始地址有多少字节，通过偏移量无需变量整个ziplist可以确定表尾节点地址</td></tr><tr><td>zllen</td><td>uint16_t</td><td>2字节</td><td>记录ziplist节点数，当属性小于65535，这个属性值就是压缩列表包含节点的数量，等于65536时需要遍历计算</td></tr><tr><td>entryN</td><td>列表节点</td><td>不定</td><td>压缩列表包含的各个节点，节点的长度由节点保存的内容决定</td></tr><tr><td>zlend</td><td>uint8_t</td><td>1字节</td><td>特殊值0xFF，用来标记压缩列表末端</td></tr></tbody></table><p>对于压缩表的每个节点，结构如下：</p><p><img src="https://gitee.com/tobing/imagebed/raw/master/image-20210528170328489.png" class="lazyload" data-srcset="https://gitee.com/tobing/imagebed/raw/master/image-20210528170328489.png" srcset="data:image/png;base64,666" alt="image-20210528170328489"></p><ul><li><strong>pervious_entry_length：</strong>字节为单位，记录压缩列表中前一个字节长度。这个属性长度可以是1字节或5字节<ul><li>如果长度小于254，pervious_entry_length长度为1字节，前一个节点长度就保存在这一个字节</li><li>如果长度大于等于254，pervious_entry_length长度为5字节，其中第一个字节设置为0XFF，之后四个字节保存前一节点长度</li><li>通过pervious_entry_length属性记录前一个节点长度，程序可以通过指针运算，根据当前节点的起始地址计算出前一个节点的起始地址</li><li>压缩列表从表尾到表头的变量使用找一个原理实现，只有拥有执行某个节点的起始地址的指针，通过这个指针和pervious_entry_length属性即可往前一个节点回溯，最终到达表头节点。</li></ul></li><li><strong>encoding：</strong>记录了节点的content属性保存数据的类型以及长度<ul><li>一字节、两字节或五字节长，值的最高位为00、01或10的是字节数组编码：这种编码表示节点的content属性保存字节数组，数组长度由编码的最高两位去除之后的其他为的记录</li><li>一字节长，值的最高位以11开头的整数编码：这种编码表示节点的content属性保存整数值，整数值的类型和长度由编码除去除最高两位之后的其他位记录</li></ul></li><li><strong>content：</strong>负责保存节点的值，节点的值可以是一个字节数组或者整数，值的类型和长度由节点encoding属性决定</li></ul><p>在使用压缩表的时候，需要注意<strong>连锁更新</strong>问题：假如在一个列表中，有多个连续的、长度介于250字节到253字节的元素e1到eN。</p><p>此时由于长度介于250字节到253字节之间，因此这些元素的pervious_entry_length的属性只需要占用一个字节。</p><p>但是这时，在e1前面插入了一个新的元素，其大小大于等于254。这时e1的pervious_entry_length将会占用5个字节，此时e1的长度将要大于等于254，导致在扩展的过程中，e1的长度也需要额外增加。以此类推，由于e1之后的大量元素都会存在同样的情况，所以程序不断对压缩列表执行空间重分配，直到eN为止。</p><p>Redis将这种特殊情况产生的连续多次空间控制操作称之为“连锁更新”（casacde update）。</p><p>但实际上，出现这种的概率很低，因此压缩表的push平均时间复杂度为O(N)。</p><h2 id="二、对象"><a href="#二、对象" class="headerlink" title="二、对象"></a>二、对象</h2><h4 id="概述-1"><a href="#概述-1" class="headerlink" title="概述"></a>概述</h4><p>前面主要介绍了 Redis 中底层的数据结构。Redis 并未直接使用这些底层的数据结构来实现键值对数据库，而是基于这些键值对创建一个对象系统，包含了 <strong>String 对象、List 对象、Hash 对象、Set 对象和 Sorted Set 对象</strong>。这五种对象中至少使用了一种数据结构作为其底层实现。</p><p>通过上述提到的五种对象，可以给 Redis 带来诸多好处：</p><ul><li><p>可以在执行命令前根据对象类型判断一个对象是否可以执行给定的命令。（如 Hash 对象才允许HSET命令）</p></li><li><p>可以针对不同场景为对象设置不同的数据结构实现，从而优化不同场景下的效率。（如除了 String 对象，其他对象都有两种底层实现）</p></li><li><p>可以使用基于引用计数算法判断某个对象是否可以进行内存回收。</p></li><li><p>对象可以保存额外的信息，如访问时间等，利用这些信息可以进行一些的操作。（如利用访问时间计算数据库键的空转时长，在服务器启用了maxmemory的时候，空转时长较大的键可能会优先被服务器删除。）</p></li></ul><p>为了表示不同对象的不同底层实现，Redis 中使用 redisObject 结构保存表示两者的关系：</p><p><img src="https://gitee.com/tobing/imagebed/raw/master/image-20210530114714443.png" class="lazyload" data-srcset="https://gitee.com/tobing/imagebed/raw/master/image-20210530114714443.png" srcset="data:image/png;base64,666" alt="image-20210530114714443"></p><h4 id="String-对象"><a href="#String-对象" class="headerlink" title="String 对象"></a>String 对象</h4><p>字符串编码可以是int、raw和embstr。</p><p>*<em>当一个字符串对象保存的是整数值，并且这个整数值可以用long来表示，此时字符串对象会将整数值保存在字符串结构的ptr属性（将void</em>转换为long），并将字符串对象的编码设置为int。**</p><p><img src="https://gitee.com/tobing/imagebed/raw/master/image-20210530120044561.png" class="lazyload" data-srcset="https://gitee.com/tobing/imagebed/raw/master/image-20210530120044561.png" srcset="data:image/png;base64,666" alt="image-20210530120044561"></p><p><strong>当一个字符串对象保存的是一个字符串值，并且这个字符串值长度大于32字节，那么整个字符    串将使用SDS来保存字符串值，并将对象编码设置为raw。</strong></p><p><img src="https://tobing-markdown.oss-cn-shenzhen.aliyuncs.com/image-20210530120159431.png" class="lazyload" data-srcset="https://tobing-markdown.oss-cn-shenzhen.aliyuncs.com/image-20210530120159431.png" srcset="data:image/png;base64,666" alt="image-20210530120159431"></p><p><strong>当一个字符串对象保存的是一个字符串值，并且字符串值长度小于等于32字节，那么字符串对象将使用embstr编码方式保存这个字符串。</strong></p><p><img src="https://tobing-markdown.oss-cn-shenzhen.aliyuncs.com/image-20210530120253880.png" class="lazyload" data-srcset="https://tobing-markdown.oss-cn-shenzhen.aliyuncs.com/image-20210530120253880.png" srcset="data:image/png;base64,666" alt="image-20210530120253880"></p><p>embstr是专门用于保存短字符串的一种优化编码方式，和raw一样，都是用redisObject结果和sdshdr结构来表示字符串对象。但raw编码会调用两次内存分配函数分别创建redisObject和sdshdr，而embstr通过调用一次内存分配函数分配一块连续内存。</p><p>embstr编码保存短字符串有以下好处：</p><ul><li>embstr内存分配raw的两次变为一次</li><li>释放embstr编码的字符串对象只需要调用一次内存释放，而raw需要两次</li><li>embstr字符串对象保存在连续内存，比raw编码的字符串对象<strong>更好利用缓存</strong></li></ul><p>除此之外，字符串可保存long double类型浮点数。这时，程序会先将浮点数转成字符串值，再保存转换得到的字符串。</p><p>int和embstr类型的字符串可能会在某些情况下被转换为raw类型。如在int类型的字符串执行了APPEND命令之后会被转换为raw。</p><p>同时Redis没有为embstr（嵌入式字符串，嵌入到redisObject）编写任何修改程序，因此embstr实际上是只读的。因此对embstr执行修改会先转换为raw。</p><h4 id="List-对象"><a href="#List-对象" class="headerlink" title="List 对象"></a>List 对象</h4><p>列表的编码可以是ziplist或者linkedlist。</p><p><strong>ziplist编码方式使用压缩列表来作为底层实现，每个压缩列表节点保存一个列表元素。</strong></p><p><img src="https://gitee.com/tobing/imagebed/raw/master/image-20210530122109584.png" class="lazyload" data-srcset="https://gitee.com/tobing/imagebed/raw/master/image-20210530122109584.png" srcset="data:image/png;base64,666" alt="image-20210530122109584"></p><p><strong>linkedlist编码方式使用双端链表作为底层实现，每个节点保存了一个字符串对象，每个字符串对象都保存了一个列表元素。</strong></p><p><img src="https://tobing-markdown.oss-cn-shenzhen.aliyuncs.com/image-20210530122227676.png" class="lazyload" data-srcset="https://tobing-markdown.oss-cn-shenzhen.aliyuncs.com/image-20210530122227676.png" srcset="data:image/png;base64,666" alt="image-20210530122227676"></p><p>注意，linkedlist编码的列表对象在底层的双端链表中包含了多个字符串对象。字符串对象是Redis五种类型中唯一一种会被其他四种类型对象嵌套的对象。</p><p>当列表满足一下两个条件时，列表对象使用ziplist编码：</p><ul><li>列表对象保存的所有字符串长度小于<a href="list-max-ziplist-value">64</a>；</li><li>列表对象保存的元素数量小于<a href="list-max-ziplist-entries">512</a>个；</li><li>除此之外列表对象需要使用linkedlist编码。</li></ul><h4 id="Hash-对象"><a href="#Hash-对象" class="headerlink" title="Hash 对象"></a>Hash 对象</h4><p>哈希对象的编码可以使用ziplist或者hashtable。</p><p><strong>ziplist编码方式的哈希对象底层使用压缩列表作为实现。</strong></p><p>每当有新的键值对要加入到哈希对象时，程序会分别将键和值的压缩列表节点推入到压缩列表表尾，因此，保存同一键值对的连个节点总是紧挨着，键前值后。同时可以知道，先添加到的哈希对象键值对在前面，后添加的在后面。</p><p><img src="https://gitee.com/tobing/imagebed/raw/master/image-20210530123617211.png" class="lazyload" data-srcset="https://gitee.com/tobing/imagebed/raw/master/image-20210530123617211.png" srcset="data:image/png;base64,666" alt="image-20210530123617211"></p><p><img src="https://tobing-markdown.oss-cn-shenzhen.aliyuncs.com/image-20210530123633305.png" class="lazyload" data-srcset="https://tobing-markdown.oss-cn-shenzhen.aliyuncs.com/image-20210530123633305.png" srcset="data:image/png;base64,666" alt="image-20210530123633305"></p><p><strong>hashtable编码方式的哈希对象底层使用字典作为实现。</strong></p><p>哈希对象的每个键值对都使用一个字典键值对来保存。</p><p><img src="https://tobing-markdown.oss-cn-shenzhen.aliyuncs.com/image-20210530123848268.png" class="lazyload" data-srcset="https://tobing-markdown.oss-cn-shenzhen.aliyuncs.com/image-20210530123848268.png" srcset="data:image/png;base64,666" alt="image-20210530123848268"></p><p> 当满足以下条件，哈希对象使用ziplist编码：</p><ul><li>哈希对象保存的所有键值对的键和值的字符串长度都小于64字节</li><li>哈希对象保存的键值对数量小于512个</li><li>其他情况使用hashtable编码</li></ul><h4 id="Set-对象"><a href="#Set-对象" class="headerlink" title="Set 对象"></a>Set 对象</h4><p>集合对象的编码可以是inset或hashtable。</p><p><strong>intset编码的集合对象使用整数集合作为底层实现，集合对象包含私有元素都被保存在整数集合中。</strong></p><p><img src="https://tobing-markdown.oss-cn-shenzhen.aliyuncs.com/image-20210530124454845.png" class="lazyload" data-srcset="https://tobing-markdown.oss-cn-shenzhen.aliyuncs.com/image-20210530124454845.png" srcset="data:image/png;base64,666" alt="image-20210530124454845"></p><p>hashtable编码的集合对象使用字典作为底层实现，字典中每一个键都是一个字符串对象，每个字符串对象包含了一个集合元素，而字符串的值全部被设置为NULL。</p><p><img src="https://gitee.com/tobing/imagebed/raw/master/image-20210530124523993.png" class="lazyload" data-srcset="https://gitee.com/tobing/imagebed/raw/master/image-20210530124523993.png" srcset="data:image/png;base64,666" alt="image-20210530124523993"></p><p>集合元素满足以下条件是，对象使用intset</p><ul><li>集合对象保存的所有元素都是整数值</li><li>集合对象保存的元素个数不超过512</li><li>不满足以上条件使用hashtable</li></ul><h4 id="Sorted-Set-对象"><a href="#Sorted-Set-对象" class="headerlink" title="Sorted Set 对象"></a>Sorted Set 对象</h4><p>有序集合对象可以是ziplist或skiplist。</p><p><strong>ziplist编码的有序集合对象使用压缩列表作为底层实现。</strong></p><p>此时每个集合元素使用紧挨着列表节点保存，一个保存元素成员（member），另一个保存元素的分值（score）。</p><p><img src="https://tobing-markdown.oss-cn-shenzhen.aliyuncs.com/image-20210530125029479.png" class="lazyload" data-srcset="https://tobing-markdown.oss-cn-shenzhen.aliyuncs.com/image-20210530125029479.png" srcset="data:image/png;base64,666" alt="image-20210530125029479"></p><p><img src="https://tobing-markdown.oss-cn-shenzhen.aliyuncs.com/image-20210530125047702.png" class="lazyload" data-srcset="https://tobing-markdown.oss-cn-shenzhen.aliyuncs.com/image-20210530125047702.png" srcset="data:image/png;base64,666" alt="image-20210530125047702"></p><p>压缩列表中集合元素按分值从小到大排序，分值较小的处于表头。</p><p><strong>skiplist编码的有序集合对象使用zset结构作为底层实现。</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">zset</span> &#123;</span></span><br><span class="line">    zskiplist *zsl;</span><br><span class="line">    dict *dict;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>zset结构中的zsl跳跃表按分值大小从小到大保存所有集合元素，每个跳跃表节点都保存了一个集合元素（object保存元素，score保存元素分值）。ZRANGE和ZRANK通过跳跃表API实现。</p><p>除此之外，zset的dict字典为有序集合创建一个从成员到分值的银蛇，字典的每个键值对都保存一个集合元素（键为元素，值为分数）。ZSCORE通过字典实现O(1)复杂度查找指定成员分值。</p><p>有序集合每个元素的成员都是一个字符串对象，每个元素的分值都是一个double类型浮点数。</p><p>虽然zset结构同时使用跳跃表和字典来保存有序集合，但是两种数据结构通过共享指针来共享相同的元素和分值。</p><p>总的来说，zset结构同时使用跳跃表和字典是兼顾了两种数据结构的特性：字典无序但取值很快，skiplist需要遍历查找取值，但是使用与范围查找。</p><p><img src="https://gitee.com/tobing/imagebed/raw/master/image-20210530130015295.png" class="lazyload" data-srcset="https://gitee.com/tobing/imagebed/raw/master/image-20210530130015295.png" srcset="data:image/png;base64,666" alt="image-20210530130015295"></p><p><img src="https://tobing-markdown.oss-cn-shenzhen.aliyuncs.com/image-20210530130033435.png" class="lazyload" data-srcset="https://tobing-markdown.oss-cn-shenzhen.aliyuncs.com/image-20210530130033435.png" srcset="data:image/png;base64,666" alt="image-20210530130033435"></p><p>有序集合满足一下条件，ziplist编码：</p><ul><li>有序集合保存的所有元素成员的长度都小于64字节</li><li>有序集合保存的元素小于128</li><li>不满足以上条件使用skiplist编码</li></ul><h2 id="三、总结"><a href="#三、总结" class="headerlink" title="三、总结"></a>三、总结</h2><blockquote><p>五大对象</p></blockquote><p><img src="https://gitee.com/tobing/imagebed/raw/master/image-20210620224118167.png" class="lazyload" data-srcset="https://gitee.com/tobing/imagebed/raw/master/image-20210620224118167.png" srcset="data:image/png;base64,666" alt="image-20210620224118167"></p><h2 id="四、参考文献"><a href="#四、参考文献" class="headerlink" title="四、参考文献"></a>四、参考文献</h2><ul><li><a href="http://redisbook.com/">Redis 设计与实现</a></li><li><a href="https://time.geekbang.org/column/intro/329">Redis 核心技术与实战</a></li><li><a href="https://redis.io/topics/data-types">Data types</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> 理论学习 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 中间件 - Redis </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ThreadLocal</title>
      <link href="2021/06/19/ThreadLocal/"/>
      <url>2021/06/19/ThreadLocal/</url>
      
        <content type="html"><![CDATA[<p>ThreadLocal 是一个用来处理高并发场景的重要工具。本文将从使用和原理两个方面来介绍ThreadLocal。</p><a id="more"></a><h1 id="ThreadLocal"><a href="#ThreadLocal" class="headerlink" title="ThreadLocal"></a>ThreadLocal</h1><p><a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/ThreadLocal.html">java.lang.ThreadLocal</a>提供了线程内变量。通过ThreadLocal可以将一个变量与当前运行的线程绑定，只有通过该线程才能获取到对应的变量。</p><h3 id="一、实践篇"><a href="#一、实践篇" class="headerlink" title="一、实践篇"></a>一、实践篇</h3><h4 id="ThreadLocal简单使用"><a href="#ThreadLocal简单使用" class="headerlink" title="ThreadLocal简单使用"></a>ThreadLocal简单使用</h4><p>此处不再介绍ThreadLocal的API，下面通过用户信息管理来展示ThreadLocal的使用。</p><p>在Web系统中，每个请求都在一个线程内完成。对于每个线程，可以使用ThreadLocal来管理当前用户信息。（每个用户请求对于其他用户是隔离的）</p><p><img src="https://gitee.com/tobing/imagebed/raw/master/image-20210618222605706.png" class="lazyload" data-srcset="https://gitee.com/tobing/imagebed/raw/master/image-20210618222605706.png" srcset="data:image/png;base64,666" alt="image-20210618222605706"></p><p>上图中，当一个请求到达首先会经过UserInterceptor来获取用户信息，并将信息保存到UserContextHolder上下文中，之后在Controller、Service和Dao层都可以获取到UserContextHolder中保存的用户信息。</p><p>当多个用户访问Web系统的时候，每个请求都会对一个拿到线程进行处理，每个线程都有对应的ThreadLocal变量。由于变量是线程私有的，而线程与每个用户是一一对应的，因此最终变量属于用户私有的，不存在并发问题。</p><blockquote><p>封装用户上下文对象</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserContextHolder</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> ThreadLocal&lt;MemberRespVo&gt; memberRespVoContext = <span class="keyword">new</span> ThreadLocal&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Set the user information if it not null.</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">setCurrentUser</span><span class="params">(MemberRespVo memberRespVo)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// ThreadLocal is thread-local variable, therefore it hasn&#x27;t concurrent problem.</span></span><br><span class="line">        <span class="comment">// Each thread call the threadLocal.get is get different result.</span></span><br><span class="line">        <span class="keyword">if</span> (memberRespVoContext.get() == <span class="keyword">null</span>) &#123;</span><br><span class="line">            memberRespVoContext.set(memberRespVo);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Get current user information.</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> MemberRespVo <span class="title">getCurrentUser</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> memberRespVoContext.get();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Remove current user information from ThreadLocal.</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">removeCurrentUser</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        memberRespVoContext.remove();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>在拦截器中对用户上下文对象赋值/清除、</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LoginUserInterceptor</span> <span class="keyword">implements</span> <span class="title">HandlerInterceptor</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">        MemberRespVo memberRespVo = (MemberRespVo) request.getSession().getAttribute(PlatformAuthConstant.LOGIN_USER);</span><br><span class="line">        <span class="keyword">if</span> (memberRespVo == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="comment">// hasn&#x27;t login, redirect to login page.</span></span><br><span class="line">            response.sendRedirect(<span class="string">&quot;http://auth.platform.com/login.html&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            UserContextHolder.setCurrentUser(memberRespVo);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">postHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler, ModelAndView modelAndView)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">// threadLocal.remove();</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Remove ther user infomation in ThreadLocal when complete of request processing and view rendering.</span></span><br><span class="line"><span class="comment">     * Why not remove in postHandle ?</span></span><br><span class="line"><span class="comment">     * https://stackoverflow.com/questions/37358426/remove-threadlocal-object-within-a-spring-mvc-website</span></span><br><span class="line"><span class="comment">     * The postHandle method looks like a good place, but afterCompletion is better because it&#x27;s called</span></span><br><span class="line"><span class="comment">     * even when the handler fails to process the request correctly (aka an exception occurred).</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterCompletion</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        UserContextHolder.removeCurrentUser();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>此处使用的时候需要注意，由于项目中普遍使用ThreadPool，一个用户可能会在不同时间获取到其他用户获得过的线程。如果这个线程中对应的ThreadLocal没有被清除，那么可能会造成不正确的结果。因此必须要在线程使用完毕之后，对线程的ThreadLocal进行清除，确保逻辑的正确性。</p><p>对ThreadPool中获取的线程可以采用两种方式进行清除：</p><ul><li>在Interceptor中清除</li><li>继承ThreadPoolExecutor，在其中的钩子函数中（beforeExecute、afterExecute）进行清除</li></ul><p>对于第一种方式，已经在代码中进行展示，下面展示了第二种方式：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThreadLocalAwareThreadPool</span> <span class="keyword">extends</span> <span class="title">ThreadPoolExecutor</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">afterExecute</span><span class="params">(Runnable r, Throwable t)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// Call remove on each ThreadLocal</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="ThreadPool在Spring运用"><a href="#ThreadPool在Spring运用" class="headerlink" title="ThreadPool在Spring运用"></a>ThreadPool在Spring运用</h4><p>Spring中的<code>org.springframework.web.context.request.RequestContextHolder</code>类中使用ThreadLocal来记录请求的上下文信息。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">RequestContextHolder</span>  </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">boolean</span> jsfPresent =</span><br><span class="line">ClassUtils.isPresent(<span class="string">&quot;javax.faces.context.FacesContext&quot;</span>, RequestContextHolder.class.getClassLoader());</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> ThreadLocal&lt;RequestAttributes&gt; requestAttributesHolder =</span><br><span class="line"><span class="keyword">new</span> NamedThreadLocal&lt;&gt;(<span class="string">&quot;Request attributes&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> ThreadLocal&lt;RequestAttributes&gt; inheritableRequestAttributesHolder =</span><br><span class="line"><span class="keyword">new</span> NamedInheritableThreadLocal&lt;&gt;(<span class="string">&quot;Request context&quot;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Reset the RequestAttributes for the current thread.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">resetRequestAttributes</span><span class="params">()</span> </span>&#123;</span><br><span class="line">requestAttributesHolder.remove();</span><br><span class="line">inheritableRequestAttributesHolder.remove();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Bind the given RequestAttributes to the current thread,</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">setRequestAttributes</span><span class="params">(<span class="meta">@Nullable</span> RequestAttributes attributes)</span> </span>&#123;</span><br><span class="line">setRequestAttributes(attributes, <span class="keyword">false</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Bind the given RequestAttributes to the current thread.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">setRequestAttributes</span><span class="params">(<span class="meta">@Nullable</span> RequestAttributes attributes, <span class="keyword">boolean</span> inheritable)</span> </span>&#123;</span><br><span class="line"><span class="keyword">if</span> (attributes == <span class="keyword">null</span>) &#123;</span><br><span class="line">resetRequestAttributes();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line"><span class="keyword">if</span> (inheritable) &#123;</span><br><span class="line">inheritableRequestAttributesHolder.set(attributes);</span><br><span class="line">requestAttributesHolder.remove();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line">requestAttributesHolder.set(attributes);</span><br><span class="line">inheritableRequestAttributesHolder.remove();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Return the RequestAttributes currently bound to the thread.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Nullable</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> RequestAttributes <span class="title">getRequestAttributes</span><span class="params">()</span> </span>&#123;</span><br><span class="line">RequestAttributes attributes = requestAttributesHolder.get();</span><br><span class="line"><span class="keyword">if</span> (attributes == <span class="keyword">null</span>) &#123;</span><br><span class="line">attributes = inheritableRequestAttributesHolder.get();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> attributes;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Return the RequestAttributes currently bound to the thread.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> RequestAttributes <span class="title">currentRequestAttributes</span><span class="params">()</span> <span class="keyword">throws</span> IllegalStateException </span>&#123;</span><br><span class="line">RequestAttributes attributes = getRequestAttributes();</span><br><span class="line"><span class="keyword">if</span> (attributes == <span class="keyword">null</span>) &#123;</span><br><span class="line"><span class="keyword">if</span> (jsfPresent) &#123;</span><br><span class="line">attributes = FacesRequestAttributesFactory.getFacesRequestAttributes();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (attributes == <span class="keyword">null</span>) &#123;</span><br><span class="line"><span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(<span class="string">&quot;No thread-bound request found...&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> attributes;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>需要注意，Spring使用了NamedThreadLocal和NamedInheritableThreadLocal两个类来分别保存请求的属性以及内容。对于内容使用NamedInheritableThreadLocal可以运行在当前线程创建的子线程可以获取，而NamedThreadLocal只允许在当前线程中获取。</p><h4 id="阿里巴巴开发手中的ThreadLocal"><a href="#阿里巴巴开发手中的ThreadLocal" class="headerlink" title="阿里巴巴开发手中的ThreadLocal"></a>阿里巴巴开发手中的ThreadLocal</h4><blockquote><p>使用ThreadLocal实现SimpleDateFormat线程安全使用</p></blockquote><p><img src="https://gitee.com/tobing/imagebed/raw/master/image-20210619093415554.png" class="lazyload" data-srcset="https://gitee.com/tobing/imagebed/raw/master/image-20210619093415554.png" srcset="data:image/png;base64,666" alt="image-20210619093415554"></p><p><img src="https://gitee.com/tobing/imagebed/raw/master/image-20210619093516563.png" class="lazyload" data-srcset="https://gitee.com/tobing/imagebed/raw/master/image-20210619093516563.png" srcset="data:image/png;base64,666" alt="image-20210619093516563"></p><blockquote><p>ThreadLocal的使用注意</p></blockquote><p><img src="https://gitee.com/tobing/imagebed/raw/master/image-20210619093721402.png" class="lazyload" data-srcset="https://gitee.com/tobing/imagebed/raw/master/image-20210619093721402.png" srcset="data:image/png;base64,666" alt="image-20210619093721402"></p><blockquote><p>ThreadLocal使用注意</p></blockquote><p><img src="https://gitee.com/tobing/imagebed/raw/master/image-20210619093923364.png" class="lazyload" data-srcset="https://gitee.com/tobing/imagebed/raw/master/image-20210619093923364.png" srcset="data:image/png;base64,666" alt="image-20210619093923364"></p><h3 id="二、原理篇"><a href="#二、原理篇" class="headerlink" title="二、原理篇"></a>二、原理篇</h3><h4 id="ThreadLocal的一些重要属性"><a href="#ThreadLocal的一些重要属性" class="headerlink" title="ThreadLocal的一些重要属性"></a>ThreadLocal的一些重要属性</h4><p>首先，先观察ThreadLocal中重要的属性：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 当前ThreadLocal的hashCode，通过 nextHashCode()运算得到，被用来计算当前ThreadLocal在ThreadLocalMap中的位置</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> threadLocalHashCode = nextHashCode();</span><br><span class="line"><span class="comment">// 哈希魔数，主要与斐波那契哈希和黄金分割有关</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> HASH_INCREMENT = <span class="number">0x61c88647</span>;</span><br><span class="line"><span class="comment">// 返回计算得到的下一个哈希值, i * HASH_INCREMENT, i 代表调用的次数</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">nextHashCode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> nextHashCode.getAndAdd(HASH_INCREMENT);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 确保同一台机器中的不同ThreadLocal的threadLocalHashCode具有唯一性</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> AtomicInteger nextHashCode = <span class="keyword">new</span> AtomicInteger();</span><br></pre></td></tr></table></figure><ul><li><p>HASH_INCREMENT并不是随意给定的，将其转换为十进制为16405315272654435769，等于(√ 5-1) / 2 乘以2的32次幂，(√ 5-1) / 2 是黄金分割数，约为 0.618。这就意味着 0x61c88647 可以理解为黄金分割数乘以2的32次幂。它能确保通过nextHashCode 生成的hash值在2的幂上均匀分布，并且小于2的32次幂。</p></li><li><p>下面是Java专家对这个值的介绍</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">This number represents the golden ratio (sqrt(5)-1) times two to the power of 31 ((sqrt(5)-1) * (2^31)). The result is then a golden number, either 2654435769 or -1640531527.</span><br></pre></td></tr></table></figure></li></ul><h4 id="ThreadLocalMap"><a href="#ThreadLocalMap" class="headerlink" title="ThreadLocalMap"></a>ThreadLocalMap</h4><p>接下来观察ThreadLocalMap</p><p>处理上面提到的属性，还有一个重要的属性，那就是ThreadLocalMap。ThreadLocalMap是ThreadLocal的静态内部类。当一个线程拥有多个ThreadLocal，需用一个容器来管理它们。ThreadLocalMap的功能就是用来管理同一个线程中的ThreadLocal。源码如下：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">ThreadLocalMap</span> </span>&#123;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Storage structure of key value to entity</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Entry</span> <span class="keyword">extends</span> <span class="title">WeakReference</span>&lt;<span class="title">ThreadLocal</span>&lt;?&gt;&gt; </span>&#123;</span><br><span class="line"><span class="comment">// value与当前线程对应,不被弱引用追踪</span></span><br><span class="line">Object value;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 键值对构造器</span></span><br><span class="line"><span class="comment"> * key，ThreadLocal中的key被包装为弱引用</span></span><br><span class="line"><span class="comment"> * v，值</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">Entry(ThreadLocal&lt;?&gt; k, Object v) &#123;</span><br><span class="line"><span class="keyword">super</span>(k);</span><br><span class="line">value = v;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 初始容量，一定为2的n次幂</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> INITIAL_CAPACITY = <span class="number">16</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 保存实体键值对的数组，长度一定为2的次幂</span></span><br><span class="line"><span class="keyword">private</span> Entry[] table;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ThreadLocalMap中元素个数</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> size = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 扩展临界值, 默认为数组长度的2/3</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> threshold;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>从上面可以看出ThreadLocalMap实际上是一个简单的Map结构，底层是一个数组。数组中元素类型为Entry，Entry中的key是ThreadLocal的引用，value是ThreadLocal中的值。ThreadLocal使用线性探索来解决哈希冲突，如果发生冲突，继续查找下一个非空位置。</p><p>这样一来，将有可能发送内存泄漏。</p><h4 id="ThreadLocal内存泄漏"><a href="#ThreadLocal内存泄漏" class="headerlink" title="ThreadLocal内存泄漏"></a>ThreadLocal内存泄漏</h4><p>当ThreadLocal没有外部的强引用，当GC发生是它将会被回收。ThreadLocalMap中保存的key将会变成null，Entry被threadMapLocal对象引用，threadMapLocal被Thread对象引用。如果Thread一直不被中断（如在线程池中维护），value的对象将会一直保存在内存中，直到线程被销毁。</p><p>为了避免内存泄漏，在使用完毕ThreadLocal变量之后，需要将其中对应的Entry进行手动移除，这样一来可以保证Entry中的value可以被回收。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 清理与当前ThreadLocal保存的的键值对</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">remove</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    ThreadLocalMap m = getMap(Thread.currentThread());</span><br><span class="line">    <span class="keyword">if</span> (m != <span class="keyword">null</span>)</span><br><span class="line">        m.remove(<span class="keyword">this</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>remove实现获得当前线程Thread持有的ThreadLocalMap，调用ThreadLocalMap的remove方法删除Map中与当前ThreadLocal关联的键值对。这样一来在GC发生时就可以将Entry中强引用value进行回收了。</li></ul><p>下面探究ThreadLocal如何实现线程隔离。</p><h4 id="ThreadLocal的set方法"><a href="#ThreadLocal的set方法" class="headerlink" title="ThreadLocal的set方法"></a>ThreadLocal的set方法</h4><p>源码如下：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">set</span><span class="params">(T value)</span> </span>&#123;      <span class="comment">// 设置一个值</span></span><br><span class="line">    Thread t = Thread.currentThread();  <span class="comment">// 获取当前线程</span></span><br><span class="line">    ThreadLocalMap map = getMap(t);     <span class="comment">// 通过线程获取到线程绑定的ThreadLocalMap</span></span><br><span class="line">    <span class="keyword">if</span> (map != <span class="keyword">null</span>)                    <span class="comment">// map可能未被创建</span></span><br><span class="line">        map.set(<span class="keyword">this</span>, value);           <span class="comment">// 直接设置</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        createMap(t, value);           <span class="comment">// 将其创建并将当前值设置进去</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>set的主要步骤如下：</p><ul><li>实现获取当前线程的引用</li><li>通过当前线程的引用获取线程内部的ThreadLocalMap</li><li>如果ThreadLocalMap为空，创建一个ThreadLocalMap，并设置</li><li>如果ThreadLocalMap不为空，将其添加到map中</li></ul><p>set的时序图：</p><p><img src="https://gitee.com/tobing/imagebed/raw/master/26ee2331e66f1f8320ff3624952ecbb2.jpg" class="lazyload" data-srcset="https://gitee.com/tobing/imagebed/raw/master/26ee2331e66f1f8320ff3624952ecbb2.jpg" srcset="data:image/png;base64,666" alt="img"></p><p>下面展示了getMap()方法：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">ThreadLocalMap <span class="title">getMap</span><span class="params">(Thread t)</span> </span>&#123;   <span class="comment">// 获取线程的threadLocals属性(ThreadLocalMap)</span></span><br><span class="line">    <span class="keyword">return</span> t.threadLocals;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>getMap方法主要是获取到指定线程的threadLocals属性，即：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* ThreadLocal values pertaining to this thread. This map is maintained</span></span><br><span class="line"><span class="comment">     * by the ThreadLocal class. */</span></span><br><span class="line">ThreadLocal.ThreadLocalMap threadLocals = <span class="keyword">null</span>;</span><br></pre></td></tr></table></figure><p>可以看到每个Thread中都有一个threadLocals属性，默认为null，因此threadLocals是线程隔离的，其中保存的值自然也是线程隔离的。</p><p>当ThreadLocalMap的set方法被调用，当前的ThreadLocal对象的引用将作为key，需要保存的对象作为value，封装为Entry保存到map中。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 将键值对保存到map中</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">set</span><span class="params">(ThreadLocal&lt;?&gt; key, Object value)</span> </span>&#123;</span><br><span class="line">Entry[] tab = table;</span><br><span class="line"><span class="keyword">int</span> len = tab.length;</span><br><span class="line"><span class="comment">// 计算key在数组中的下标</span></span><br><span class="line"><span class="keyword">int</span> i = key.threadLocalHashCode &amp; (len - <span class="number">1</span>);</span><br><span class="line"><span class="comment">// 采用线性探索查找出空闲的位置</span></span><br><span class="line"><span class="keyword">for</span> (Entry e = tab[i]; e != <span class="keyword">null</span>; e = tab[i = nextIndex(i, len)]) &#123;</span><br><span class="line"><span class="comment">// 获取元素的hash值</span></span><br><span class="line">ThreadLocal&lt;?&gt; k = e.get();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 如果ThreadLocal的key匹配，直接改变map中的值</span></span><br><span class="line"><span class="keyword">if</span> (k == key) &#123;</span><br><span class="line">e.value = value;</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 如果key为null，表明key被清除，可以直接替换</span></span><br><span class="line"><span class="keyword">if</span> (k == <span class="keyword">null</span>) &#123;</span><br><span class="line">replaceStaleEntry(key, value, i);</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 在遇到空插槽之前，找不到匹配的ThreadLocal对象。将ThreadLocal对象和缓存的值排列在空插槽中</span></span><br><span class="line">tab[i] = <span class="keyword">new</span> Entry(key, value);</span><br><span class="line"><span class="keyword">int</span> sz = ++size;</span><br><span class="line"><span class="comment">//  如果没有元素被清理，检查当前数组的容量是否差错扩展临界值，以此来考虑是否需要扩展。</span></span><br><span class="line"><span class="keyword">if</span> (!cleanSomeSlots(i, sz) &amp;&amp; sz &gt;= threshold) &#123;</span><br><span class="line">rehash();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>下图展示了Thread、ThreadLocal、ThreadLocalMap三者之间的关系：</p><p><img src="https://gitee.com/tobing/imagebed/raw/master/40d360a33d61aca2ab38d712c1d92dc3.jpg" class="lazyload" data-srcset="https://gitee.com/tobing/imagebed/raw/master/40d360a33d61aca2ab38d712c1d92dc3.jpg" srcset="data:image/png;base64,666" alt="img"></p><h4 id="ThreadLocal的get方法"><a href="#ThreadLocal的get方法" class="headerlink" title="ThreadLocal的get方法"></a>ThreadLocal的get方法</h4><p>源码如下：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> T <span class="title">get</span><span class="params">()</span> </span>&#123;</span><br><span class="line">Thread t = Thread.currentThread();</span><br><span class="line">ThreadLocalMap map = getMap(t);</span><br><span class="line"><span class="keyword">if</span> (map != <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="comment">// 尝试从map中获取Entry</span></span><br><span class="line">ThreadLocalMap.Entry e = map.getEntry(<span class="keyword">this</span>);</span><br><span class="line"><span class="keyword">if</span> (e != <span class="keyword">null</span>) &#123;</span><br><span class="line"><span class="meta">@SuppressWarnings(&quot;unchecked&quot;)</span></span><br><span class="line">T result = (T) e.value;</span><br><span class="line"><span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 如果map为null，初始化当前线程的ThreadLocalMap,最后返回与当前ThreadLocal对象关联的初始值</span></span><br><span class="line"><span class="keyword">return</span> setInitialValue();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>执行的时序图如下：</p><p><img src="https://gitee.com/tobing/imagebed/raw/master/1e6e91648ca279779c505357af2814fb.jpg" class="lazyload" data-srcset="https://gitee.com/tobing/imagebed/raw/master/1e6e91648ca279779c505357af2814fb.jpg" srcset="data:image/png;base64,666" alt="img"></p><p>ThreadLocalMap.getEntry方法：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> Entry <span class="title">getEntry</span><span class="params">(ThreadLocal&lt;?&gt; key)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 运算获取下标</span></span><br><span class="line"><span class="keyword">int</span> i = key.threadLocalHashCode &amp; (table.length - <span class="number">1</span>);</span><br><span class="line">Entry e = table[i];</span><br><span class="line"><span class="comment">// 如果e不为空，而且e对一个拿到key与传入的相同，表示正是要找的，直接返回</span></span><br><span class="line"><span class="keyword">if</span> (e != <span class="keyword">null</span> &amp;&amp; e.get() == key) &#123;</span><br><span class="line"><span class="keyword">return</span> e;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="comment">// 如果key不相等或者e为null，从i开始先后探索查找</span></span><br><span class="line"><span class="keyword">return</span> getEntryAfterMiss(key, i, e);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>下面展示的是ThreadLocalMap的resize方法：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">resize</span><span class="params">()</span> </span>&#123;</span><br><span class="line">Entry[] oldTab = table;</span><br><span class="line"><span class="keyword">int</span> oldLen = oldTab.length;</span><br><span class="line"><span class="keyword">int</span> newLen = oldLen * <span class="number">2</span>;</span><br><span class="line"><span class="comment">// 创建一个新的数组，长度为原来的2倍</span></span><br><span class="line">Entry[] newTab = <span class="keyword">new</span> Entry[newLen];</span><br><span class="line"><span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 从旧数组中将值复制到新数组</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; oldLen; ++j) &#123;</span><br><span class="line">Entry e = oldTab[j];</span><br><span class="line"><span class="keyword">if</span> (e != <span class="keyword">null</span>) &#123;</span><br><span class="line">ThreadLocal&lt;?&gt; k = e.get();</span><br><span class="line"><span class="comment">// 如果发现一个k以及为null，即为垃圾值，直接将value的引用就行清除，以便其可以被GC回收</span></span><br><span class="line"><span class="keyword">if</span> (k == <span class="keyword">null</span>) &#123;</span><br><span class="line">e.value = <span class="keyword">null</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="comment">// 计算ThreadLocal在Map的新位置</span></span><br><span class="line"><span class="keyword">int</span> h = k.threadLocalHashCode &amp; (newLen - <span class="number">1</span>);</span><br><span class="line"><span class="comment">// 如果发生了冲突，使用线性探索寻找合适的位置</span></span><br><span class="line"><span class="keyword">while</span> (newTab[h] != <span class="keyword">null</span>) &#123;</span><br><span class="line">h = nextIndex(h, newLen);</span><br><span class="line">&#125;</span><br><span class="line">newTab[h] = e;</span><br><span class="line">count++;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 设置新的size，临界长度</span></span><br><span class="line">setThreshold(newLen);</span><br><span class="line">size = count;</span><br><span class="line">table = newTab;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="三、参考文献"><a href="#三、参考文献" class="headerlink" title="三、参考文献"></a>三、参考文献</h3><ul><li><a href="http://tutorials.jenkov.com/java-concurrency/threadlocal.html">Java ThreadLocal- Jakob Jenkov</a></li><li><a href="https://www.fatalerrors.org/a/using-threadlocal-to-manage-user-information-under-high-concurrency-request.html">Using ThreadLocal to manage user information under high concurrency request</a></li><li><a href="https://www.baeldung.com/java-threadlocal">An Introduction to ThreadLocal in Java</a></li><li><a href="https://programmer.help/blogs/understand-threadlocal-principle.html">Understand ThreadLocal principle</a></li><li><a href="https://mp.weixin.qq.com/s/vURwBPgVuv4yGT1PeEHxZQ">一篇文章彻底了解ThreadLocal的原理</a></li><li><a href="https://www.javaspecialists.eu/archive/Issue164-Why-0x61c88647.html">Why 0x61c88647?</a></li><li><a href="https://github.com/Tobingindex/platform/blob/master/platform-order/src/main/java/top/tobing/platform/order/vo/UserContextHolder.java">platform-order#UserConteextHolder</a></li><li><a href="https://github.com/Tobingindex/platform/blob/master/platform-order/src/main/java/top/tobing/platform/order/interceptor/LoginUserInterceptor.java">platform-order#LoginUserInterceptor</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> 技术应用 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> ThreadLocal </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>聊聊伪共享</title>
      <link href="2021/03/20/java-false-sharing/"/>
      <url>2021/03/20/java-false-sharing/</url>
      
        <content type="html"><![CDATA[<p>在看《并发编程的艺术》的时候，在「volatile的使用优化」中提到追加字节能够优化性能，当时看的似懂非懂的。如今看到《并发编程之美》中的「伪共享」，对其原理又有了新的理解。接下来我们来聊聊伪共享。</p><a id="more"></a><h1 id="聊聊伪共享"><a href="#聊聊伪共享" class="headerlink" title="聊聊伪共享"></a>聊聊伪共享</h1><p>我认为伪共享概念有点抽象，在聊伪共享之前我们先来聊聊计算机的缓存机制。</p><h2 id="1-缓存体制"><a href="#1-缓存体制" class="headerlink" title="1. 缓存体制"></a>1. 缓存体制</h2><p>CPU与内存之间的速度相差很大，为了缓解两者之间的速度差异，引入了缓存机制。一般来说，缓存是集成在我们的CPU上的，打开CPU-Z我们就可以看到我们CPU集成的缓存信息：</p><p><img src="https://tobing-markdown.oss-cn-shenzhen.aliyuncs.com/image-20210320224842098.png" class="lazyload" data-srcset="https://tobing-markdown.oss-cn-shenzhen.aliyuncs.com/image-20210320224842098.png" srcset="data:image/png;base64,666" alt="image-20210320224842098"></p><center>图 1  CPU-Z</center><p>从上面可以看到我的CPU是支持三级缓存的，而且还可以看出三级缓存的大小。</p><p>现代CPU上基本都会配置有缓存(下面称Cache)。既然都有缓存，那么它们是如何工作的呢？</p><p>当CPU访问某个变量的时候，会先去CPU Cache中查看是否有该变量，如果有直接从其中获取，否则去主内存中获取该变量，然后把该变量所在的内存区域的一个Cache行大小的内存复制到Cache中。</p><p><img src="https://tobing-markdown.oss-cn-shenzhen.aliyuncs.com/image-20210320225343906.png" class="lazyload" data-srcset="https://tobing-markdown.oss-cn-shenzhen.aliyuncs.com/image-20210320225343906.png" srcset="data:image/png;base64,666" alt="image-20210320225343906"></p><center> 图 2  CPU/缓存与主内存</center><p>需要注意的是Cache中是按照<strong>行</strong>为单位的，行的大小通常为2的n次幂，如图1中我的CPU的三级缓存都是：<code>64-byte line size</code>的，即每行大小为64字节。</p><p>从上面我们可以知道：<strong>CPU去主内存中获取该一个变量的时候，会把该变量所在的内存区域的一个Cache行大小的内存复制到Cache中作为一行。</strong></p><p>比如下面代码：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">long</span> a1,a2,a3,a4,a5,a6,a7,a8;<span class="comment">// Java中,一个long类型的变量占用8byte</span></span><br></pre></td></tr></table></figure><p>当CPU去读a1变量时，发现三级缓存中都没有，就去主内存去读，读的时候顺便把a2-a8内存区域一起读到缓存中，因为刚好64byte。</p><p>为什么会把附近的内存都读到Cache中呢？这其实是利用了程序运行的<a href="https://baike.baidu.com/item/%E7%A8%8B%E5%BA%8F%E5%B1%80%E9%83%A8%E6%80%A7%E5%8E%9F%E7%90%86/">局部性原则</a>，具体本文不做深究，我们只需要知道，这样子在单线程下会大概率提高数据的读写效率，因为这些数据都在缓存中，访问起来很快。</p><p>下面我们就来测试一下运用局部性原理带来的性能提升：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo10LocalPrinciple</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> LINE_NUM = <span class="number">10240</span>;   <span class="comment">// 一个int4个字节</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> COLUM_NUM = <span class="number">10240</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        testCache();</span><br><span class="line">        testUnCache();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">testCache</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">long</span>[][] array = <span class="keyword">new</span> <span class="keyword">long</span>[LINE_NUM][COLUM_NUM];<span class="comment">// 按行访问，内存连续</span></span><br><span class="line">        <span class="keyword">long</span> start = System.currentTimeMillis();<span class="comment">// 每次访问可以服用缓存行的内容</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; LINE_NUM; i++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; COLUM_NUM; j++) &#123;</span><br><span class="line">                array[i][j] = i * <span class="number">2</span> + j;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">long</span> end = System.currentTimeMillis();</span><br><span class="line">        <span class="keyword">long</span> cacheTime = end - start;</span><br><span class="line">        System.out.println(<span class="string">&quot;cache time:&quot;</span> + cacheTime);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">testUnCache</span><span class="params">()</span> </span>&#123;<span class="comment">// 按列访问，内存不连续</span></span><br><span class="line">        <span class="keyword">long</span>[][] array = <span class="keyword">new</span> <span class="keyword">long</span>[LINE_NUM][COLUM_NUM];</span><br><span class="line">        <span class="keyword">long</span> start = System.currentTimeMillis();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; LINE_NUM; i++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; COLUM_NUM; j++) &#123;</span><br><span class="line">                array[j][i] = i * <span class="number">2</span> + j;<span class="comment">// 每次访问都要重新去内存读</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">long</span> end = System.currentTimeMillis();</span><br><span class="line">        <span class="keyword">long</span> cacheTime = end - start;</span><br><span class="line">        System.out.println(<span class="string">&quot;no cache time:&quot;</span> + cacheTime);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>输出：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cache time:140</span><br><span class="line">no cache time:2080</span><br></pre></td></tr></table></figure><p>从结果看出，testCache 比 testUnCache 性能的提升还是比较明显的。</p><p>原因是数组内的元素的内存地址是连续的，当访问数组第一个元素时，会把第一个元素后的若干元素块放入缓存行，这样顺序访问数组元素时会在缓存中直接命中，因而就不会去主内存读取了，后续访问也是这样。也就是说，当顺序访问数组里面元素时，如果当前元素在缓存没有命中， 那么会从主内存一下子读取后续若干个元素到缓存，也就是一次内存访问可以让后面多次访问直接在缓存中命中。</p><p>而在 testUnCache 是跳跃式访问数组元素的，不是顺序的，这破坏了 程序访问的局部性原则，并且缓存是有容量控制的，当缓存满了时会根据一定淘汰算法替换缓存行，这会导致从内存置换过来的缓存行的元素还没等到被读取就被替换掉了。</p><h2 id="2-伪共享问题"><a href="#2-伪共享问题" class="headerlink" title="2. 伪共享问题"></a>2. 伪共享问题</h2><h3 id="2-1-何为伪共享"><a href="#2-1-何为伪共享" class="headerlink" title="2.1 何为伪共享"></a>2.1 何为伪共享</h3><p>从上面我们可以知道单线程环境下，CPU 将访问主内存变量是读取多个变量到内存中对程序的性能有一定的提升。那么在多线程环境下，结论还是一样吗？</p><p>前面我们知道，存放到 Cache 行的是内存块而不是单个变量，所以可能会把多个变量存放到 Cache 行中。<strong>当多个线程同时修改一个缓存行里面的多个变量时，由于缓冲行同时只能由一个线程操作，所有相比于将每个变量放到一个缓存行，性能会有所下降，这就是伪共享。</strong></p><p><img src="https://tobing-markdown.oss-cn-shenzhen.aliyuncs.com/cache.jpg" class="lazyload" data-srcset="https://tobing-markdown.oss-cn-shenzhen.aliyuncs.com/cache.jpg" srcset="data:image/png;base64,666" alt="cache"></p><center> 图 3  缓存</center><p>如上图，变量 x 和 y 同时被放到 CPU 的一级缓存和二级缓存中。</p><p>当线程 A 使用 CPU1 对变量 x 进行更新时，首先会修改 CPU1 的一级缓存变量 x 所在的缓存行，这时在<strong>缓存一致性协议</strong>下，CPU2 中变量 x 所在的缓存行失效。那么线程 B 在写入变量 x 时只能去二级缓存里面找，这就破坏了一级缓存。这也意味着，多个线程不能同时去修改自己使用的 CPU 位于同一个缓存行的变量。更坏的情况时，如果 CPU 只有一级缓存，就只能去主内存中访问，这将极大降低效率。</p><h3 id="2-2-伪共享的解决"><a href="#2-2-伪共享的解决" class="headerlink" title="2.2 伪共享的解决"></a>2.2 伪共享的解决</h3><p>从上面我们可以知道：伪共享的产生是因为多个变量被放入了一个缓存行中，并且多个线程同时去写入缓存行中不同的变量。既然如此，我们为何不将一个变量放在一个缓存行里面呢？事实上人们也正是这样来解决伪共享问题的，如下面代码。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">CacheLong</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">volatile</span> <span class="keyword">long</span> value = <span class="number">0L</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">long</span> p1, p2, p3, p4, p5, p6;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>加入缓存行为 64 字节，当我们的 CacheLong 类里面填充 6 个 long 类型的变量时，每个 long 类型占用 8 个字节，加上 value 变量的8字节总共 56 字节。另外这里的CacheLong是有个类对象，而每个类对象的字节码的对象头占用8字节，因此一个CacheLong对象实际上会占用64字节的内存，正好可以放到缓存行中。</p><p>这种方式在《并发编程的艺术》    volatile的优化中的「追加字节能优化性能」中也曾提到。</p><p>虽然我们知道填充满一个缓存行可以在并发环境下提高性能，但是我们在设计类或者变量的时候，需要每次都要计算要填充的数值，这样岂不是很麻烦？</p><p>JDK8提供了sun.misc.Contended注解，用来解伪共享问题。将上面代码修改为如下。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@sun</span>.misc.Contended</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">CacheLong</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">volatile</span> <span class="keyword">long</span> value = <span class="number">0L</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>该注解也可以用来修饰变量，如Thread类中。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// The following three initially uninitialized fields are exclusively </span></span><br><span class="line"><span class="comment">// managed by class java.util.concurrent.ThreadLocalRandom. These</span></span><br><span class="line"><span class="comment">// fields are used to build the high-performance PRNGs in the</span></span><br><span class="line"><span class="comment">// concurrent code, and we can not risk accidental false sharing.</span></span><br><span class="line"><span class="comment">// Hence, the fields are isolated with @Contended.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 下面三个字段是在并发编程中用来构建高性能伪随机数发生器，</span></span><br><span class="line"><span class="comment">// 所以我们应该避免这些变量在并发编程发生伪共享的意外情况，</span></span><br><span class="line"><span class="comment">// 因此这些字段被@Contended注解修饰</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/** The current seed for a ThreadLocalRandom */</span></span><br><span class="line"><span class="meta">@sun</span>.misc.Contended(<span class="string">&quot;tlr&quot;</span>)</span><br><span class="line">    <span class="keyword">long</span> threadLocalRandomSeed;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** Probe hash value; nonzero if threadLocalRandomSeed initialized */</span></span><br><span class="line"><span class="meta">@sun</span>.misc.Contended(<span class="string">&quot;tlr&quot;</span>)</span><br><span class="line">    <span class="keyword">int</span> threadLocalRandomProbe;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** Secondary seed isolated from public ThreadLocalRandom sequence */</span></span><br><span class="line"><span class="meta">@sun</span>.misc.Contended(<span class="string">&quot;tlr&quot;</span>)</span><br><span class="line">    <span class="keyword">int</span> threadLocalRandomSecondarySeed;</span><br></pre></td></tr></table></figure><p>需要注意的是，@Contended只能用来修饰Java核心类，不然rt包下的类。如果在用户类路径下使用这个注解，需要在虚拟机中添加参数：-XX:-RestrictContended。填充的默认宽度为128，可以使用自定义配置：-XX:ContendedPaddingWidth。</p><h2 id="3-总结"><a href="#3-总结" class="headerlink" title="3. 总结"></a>3. 总结</h2><ul><li>现代计算机CPU中都存在着缓存机制，如我的计算机CPU就有三级缓存，而且没个缓存的缓存行大小为64byte。</li><li>CPU在访问操作变量的时候，先去缓存行中找，如果三级缓存都没找到，就会去内存中加载该变量到缓存中。</li><li>在加载变量的时候，不仅仅是将当前变量加载，而是将当前变量所在的连续代码块一起添加到缓存行中，这是利用了局部性定律。</li><li>这种策略在单线程情况下，往往能够提高程序的整体性能，比如顺序访问一个数组的时候，就可以利用之前已经加载到的数据，而不需要回到内存中。</li><li>但是，在多线程环境下，相同的若干变量被加载到不同的缓存行中，一个线程对其中变量执行修改，会反映到缓存行中。</li><li>此时在缓存一致性协议下，其他保存了该变量的缓存行失效，如果CPU需要用到这些失效的缓存行中的变量，不得不再去内存中加载，这就是伪共享问题(false-sharing)。</li><li>因此伪共享问题是在并发的环境下，多个线程并发修改一个缓存行里面的多个变量时会竞争缓冲行，从而导致程序运行性能降低。</li><li>那么我们是否可以在一个缓存行中值存放一个变量？JDK8正是通过字节填充的方式来实现缓存行中只存放一个被操作的变量，从而解决伪共享问题的。</li></ul><blockquote><p>个人觉得：false-sharing翻译为失败共享应该更为贴切。</p></blockquote><h2 id="4-参考"><a href="#4-参考" class="headerlink" title="4. 参考"></a>4. 参考</h2><ul><li><a href="https://book.douban.com/subject/30351286/">Java并发编程之美</a></li><li><a href="https://book.douban.com/subject/26591326/">Java并发编程的艺术</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> 理论学习 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> 并发 </tag>
            
            <tag> 伪共享 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>单例设计模式</title>
      <link href="2021/03/12/%E5%8D%95%E4%BE%8B%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
      <url>2021/03/12/%E5%8D%95%E4%BE%8B%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/</url>
      
        <content type="html"><![CDATA[<p>单例模式是Java中最简单的设计模式之一，属于创建型模式，提供了一种创建对象的方式。单例模式主要解决的是，⼀个全局使⽤的类频繁的创建和消费，从⽽提升提升整体的代码的性能。</p><a id="more"></a><h1 id="Singleton-Pattern"><a href="#Singleton-Pattern" class="headerlink" title="Singleton Pattern"></a>Singleton Pattern</h1><p>单例设计模式是最简单的设计模式之一，其实现方式也多种多样。</p><h2 id="1、单例的实现方式"><a href="#1、单例的实现方式" class="headerlink" title="1、单例的实现方式"></a>1、单例的实现方式</h2><p>单例的实现方式较多，主要从实现上分为是否支持懒汉式、是否线程安全等。</p><h3 id="1-1-饿汉式-静态变量-线程安全"><a href="#1-1-饿汉式-静态变量-线程安全" class="headerlink" title="1.1 饿汉式-静态变量-线程安全"></a>1.1 饿汉式-静态变量-线程安全</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Singleton01</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 私有化构造器，防止被手动创建</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Singleton01</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line">    <span class="comment">// 在类【初始化】阶段调用执行创建，由JVM保证线程安全</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Singleton01 instance = <span class="keyword">new</span> Singleton01();</span><br><span class="line">    <span class="comment">// 对外获取单例对象的方法</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Singleton01 <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>new Singleton01</code>会在类初始化阶段被创建：</p><p><img src="https://tobing-markdown.oss-cn-shenzhen.aliyuncs.com/image-20210312184627616.png" class="lazyload" data-srcset="https://tobing-markdown.oss-cn-shenzhen.aliyuncs.com/image-20210312184627616.png" srcset="data:image/png;base64,666" alt="image-20210312184627616"></p><blockquote><p><code>&lt;clinit&gt;</code>会在类初始化阶段被执行，对于<code>&lt;clinit&gt;()</code>方法的调用，也就是类的初始化，虚拟机会在内部确保线程安全性。虚拟机会确保<code>&lt;clinit&gt;()</code>在多线程环境下能被正常的加锁、同步。如果多线程同时初始化一个类，只能有一个线程执行该类的<code>&lt;clinit&gt;()</code>方法。</p></blockquote><h3 id="1-2-懒汉式-内部类-线程安全"><a href="#1-2-懒汉式-内部类-线程安全" class="headerlink" title="1.2 懒汉式-内部类-线程安全"></a>1.2 懒汉式-内部类-线程安全</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Singleton02</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 私有静态内部类</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">SingletonHolder</span> </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> Singleton02 instance = <span class="keyword">new</span> Singleton02();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 私有化构造器</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Singleton02</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line">    <span class="comment">// 对外访问的方法</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Singleton02 <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> SingletonHolder.instance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>使⽤类的静态内部类实现的单例模式，既保证了线程安全有保证了懒加载，同时不会因为加锁的⽅式耗费性能。 </p><p>这主要是因为JVM虚拟机可以保证多线程并发访问的正确性，也就是⼀个类的构造⽅法在多线程环境下可以被正确的加载。</p><p>此种⽅式也是⾮常推荐使⽤的⼀种单例模式。</p></blockquote><h3 id="1-3-懒汉式-双重校验锁-线程安全"><a href="#1-3-懒汉式-双重校验锁-线程安全" class="headerlink" title="1.3 懒汉式-双重校验锁-线程安全"></a>1.3 懒汉式-双重校验锁-线程安全</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Singleton03</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">volatile</span> Singleton03 instance;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Singleton03</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 双重校验</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> Singleton03 <span class="title">newInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (instance == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (Singleton03.class) &#123;</span><br><span class="line">                <span class="keyword">if</span> (instance == <span class="keyword">null</span>) &#123;</span><br><span class="line">                    instance = <span class="keyword">new</span> Singleton03();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>为什么使用volatile？</p></blockquote><p><code>instance = new Singleton03();</code>在底层会拆分为以下几个步骤：</p><p>a. 申请对象的内存空间</p><p>b. 初始化内存空间</p><p>c. 将instance指向分配的内存空间</p><p>由于存在指令重排序，b与c的执行顺序可以不一致，可能出现一下顺序：</p><p>a. 申请对象的内存空间</p><p>c. 将instance指向分配的内存空间</p><p>b. 初始化内存空间</p><p>这时就会出现instance不是null，而指向的地方却仍未被初始化。</p><p>假想一下情况，A线程刚好执行到c，这时刚好系统调度，B线程判断instance不是null，获取到了instance，并通过instance，而instance其实未被初始化完成，这就会出现安全问题。使用volatile修饰可以避免该变量在操作时发生指令重排序，可以避免以上隐患的发生。</p><h3 id="1-4-懒汉式-CAS-线程安全"><a href="#1-4-懒汉式-CAS-线程安全" class="headerlink" title="1.4 懒汉式-CAS-线程安全"></a>1.4 懒汉式-CAS-线程安全</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Singleton04</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> AtomicReference&lt;Singleton04&gt; INSTANCE = <span class="keyword">new</span> AtomicReference&lt;&gt;();</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Singleton04 instance;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Singleton04</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Singleton04 <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">            Singleton04 instance = INSTANCE.get();</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">null</span> != instance) <span class="keyword">return</span> instance;</span><br><span class="line">            INSTANCE.compareAndSet(<span class="keyword">null</span>, <span class="keyword">new</span> Singleton04());</span><br><span class="line">            <span class="keyword">return</span> instance;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>java并发库提供了很多原⼦类来⽀持并发访问的数据安全 性； AtomicInteger 、 AtomicBoolean 、 AtomicLong 、 AtomicReference 。</p><p>AtomicReference 可以封装引⽤⼀个V实例，⽀持并发访问如上的单例⽅式就是使⽤了这样的⼀个特点。 </p><p>使⽤CAS的好处就是不需要使⽤传统的加锁⽅式保证线程安全，⽽是依赖于CAS的忙等算法，依赖于底层硬件的实现，来保证线程安全。</p><p>相对于其他锁的实现没有线程的切换和阻塞也就没有了额外 的开销，并且可以⽀持较⼤的并发性。</p><p>当然CAS也有⼀个缺点就是忙等，如果⼀直没有获取到将会处于死循环中。</p></blockquote><h3 id="1-5-饿汉式-枚举-线程安全"><a href="#1-5-饿汉式-枚举-线程安全" class="headerlink" title="1.5 饿汉式-枚举-线程安全"></a>1.5 饿汉式-枚举-线程安全</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">enum</span> <span class="title">Singleton05</span> </span>&#123;</span><br><span class="line">    INSTANCE;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>Effective Java作者推荐，枚举类型是线程安全的，由JVM保证，枚举的写法非常简单，而且枚举类型是 所用单例实现中唯一一种不会被破坏的单例实现模式。</p></blockquote><h2 id="2、单例的使用场景"><a href="#2、单例的使用场景" class="headerlink" title="2、单例的使用场景"></a>2、单例的使用场景</h2><p>单例的使用场景随处可见，JDK中Runtime类就实现了单例设计模式。</p><p><img src="https://tobing-markdown.oss-cn-shenzhen.aliyuncs.com/image-20210312203532350.png" class="lazyload" data-srcset="https://tobing-markdown.oss-cn-shenzhen.aliyuncs.com/image-20210312203532350.png" srcset="data:image/png;base64,666" alt="image-20210312203532350"></p><p>除此之外，单例还被利用在Spring中⼀个单例模式bean的⽣成和使⽤。</p><h2 id="3、总结"><a href="#3、总结" class="headerlink" title="3、总结"></a>3、总结</h2><p>单例模式的实现可以分为线程是否安全、是否懒加载。</p><ul><li>懒加载<ul><li>双重检查锁：synchronized代码块代替synchronized方法，省去不必要的锁，大大提高性能</li><li>内部类：既实现了懒加载，又不用加锁</li><li>CAS：利用了CAS的特性，不加锁，但是循环太久会浪费资源</li></ul></li><li>饿汉式<ul><li>静态变量实现：利用类【初始化】会执行<code>&lt;clinit&gt;</code>实现实例的创建</li><li>枚举：JVM提供线程安全支持，Effective Java作者推荐</li></ul></li></ul><p>之所以区分懒加载，一部分原因就是因为一些使用周期比较短的类，如果过早的被创建而却不被使用，会存在内存的浪费(有些人也称为广义上的内存泄漏)，因此对于懒饿的使用应该根据使用场景而定，比如JDK的Runtime由于一启动就要使用，因此使用饿汉式来实现。</p><h2 id="4、参考"><a href="#4、参考" class="headerlink" title="4、参考"></a>4、参考</h2><ul><li><a href="http://tobing.top/2021/03/11/%E4%BB%A3%E7%90%86%E6%A8%A1%E5%BC%8F/%E9%BB%91%E9%A9%AC%E7%A8%8B%E5%BA%8F%E5%91%98Java%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E8%AF%A6%E8%A7%A3">黑马程序员Java设计模式详解</a></li><li><a href="https://bugstack.cn/">重学设计模式</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> 理论学习 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> 设计模式 </tag>
            
            <tag> 单例 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>代理模式</title>
      <link href="2021/03/11/%E4%BB%A3%E7%90%86%E6%A8%A1%E5%BC%8F/"/>
      <url>2021/03/11/%E4%BB%A3%E7%90%86%E6%A8%A1%E5%BC%8F/</url>
      
        <content type="html"><![CDATA[<p>代理模式对于我们来说并不难理解，日常生活中我们经常能看到代理模式的影子。我们平时使用「智行」、「同程」等买票的时候，就是一个典型代理模式的应用。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">我们(使用者) ----- 智行&#x2F;同程(代理者) ----&gt; 12306(被代理者)</span><br></pre></td></tr></table></figure><p>我们不直接通过12306买票，因为这样抢票并不方便，我们通过「智行」/「同程」等第三方专业机构来帮我们买票，这些机构建来代替我们去12306买票，同时这些机构代代理买票的过程中会增强一系列功能，如：增值服务、用户消费记录等。</p><p>Java中也实现了代理模式，本文我们来讨论一下「代理模式」。</p><a id="more"></a><h1 id="代理模式"><a href="#代理模式" class="headerlink" title="代理模式"></a>代理模式</h1><h2 id="1、概述"><a href="#1、概述" class="headerlink" title="1、概述"></a>1、概述</h2><p>代理模式使用代理对象来代替真实对象的访问，可以在不修改原目标对象的前提下，提供额外的功能操作，扩展目标对象的功能。</p><p>Java中的代理按照代理类生成时机不同又分为静态代理和动态代理。静态代理代理类在编译期就生成，而动态代理代理类则是在Java运行时动态生成。动态代理又有JDK代理和CGLib代理两种。</p><h2 id="2、静态代理"><a href="#2、静态代理" class="headerlink" title="2、静态代理"></a>2、静态代理</h2><p><strong>静态代理中，对目标的每个方法增强都是通过手动完成。</strong>实际应用场景很少，日常开发几乎用不到。</p><p>【静态代理的实现步骤：】</p><ol><li>定义一个接口及其实现类；</li><li>创建一个代理类实现这个类；</li><li>将目标对象放到代理类中，任何代理类的对应方法调用目标类的对应方法，主要可以通过代理类屏蔽对目标对象的访问。</li></ol><p>场景：买火车票我们不通过12306买票，而是使用「智行」、「同程」等代理购买，这些软件可以提供更加智能的路线选择，同时也提供了一些增值的服务(增强)</p><blockquote><p>卖票接口</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">SellTicket</span> </span>&#123;</span><br><span class="line">    <span class="function">String <span class="title">sell</span><span class="params">(Integer money)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>12306网站</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SellTicketImpl</span> <span class="keyword">implements</span> <span class="title">SellTicket</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">sell</span><span class="params">(Integer money)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;花费&quot;</span> + money + <span class="string">&quot;元购票.&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;购票成功&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>智行</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ZhixingProxy</span> <span class="keyword">implements</span> <span class="title">SellTicket</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> SellTicket sellTicket;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ZhixingProxy</span><span class="params">(SellTicket sellTicket)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.sellTicket = sellTicket;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">sell</span><span class="params">(Integer money)</span> </span>&#123;</span><br><span class="line">        money -= <span class="number">10</span>;            <span class="comment">// 收取手续费</span></span><br><span class="line">        System.out.println(<span class="string">&quot;[INFO]:智行购票中...&quot;</span>);</span><br><span class="line">        String ret = sellTicket.sell(money);<span class="comment">// 购票</span></span><br><span class="line">        System.out.println(<span class="string">&quot;[INFO]:智行购票成功...&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;智行:&quot;</span> + ret;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>使用者</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ProxyDemo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SellTicketImpl sellTicket = <span class="keyword">new</span> SellTicketImpl();</span><br><span class="line">        ZhixingProxy zhixingProxy = <span class="keyword">new</span> ZhixingProxy(sellTicket);</span><br><span class="line">        String ret = zhixingProxy.sell(<span class="number">100</span>);</span><br><span class="line">        System.out.println(ret);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>输出</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[INFO]:智行购票中...</span><br><span class="line">花费90元购票.</span><br><span class="line">[INFO]:智行购票成功...</span><br><span class="line">智行:购票成功</span><br></pre></td></tr></table></figure><h2 id="3、动态代理"><a href="#3、动态代理" class="headerlink" title="3、动态代理"></a>3、动态代理</h2><p>与静态代理相比，动态代理更加灵活，不需要针对每一个目标对象单独创建一个代理类，并且不需要必须实现接口，可以直接代理实现类。</p><p><strong>JVM动态生成代理类的字节码。Spring AOP、RPC框架的实现都依赖了动态代理。</strong></p><p>动态代理实际开发中使用较少，但是框架中被频繁使用。</p><p>Java 动态代理实现主要有两种：<strong>JDK 动态代理、CGLIB 动态代理</strong>。</p><h3 id="3-1-JDK-动态代理"><a href="#3-1-JDK-动态代理" class="headerlink" title="3.1 JDK 动态代理"></a>3.1 JDK 动态代理</h3><h4 id="3-1-1-API"><a href="#3-1-1-API" class="headerlink" title="3.1.1 API"></a>3.1.1 API</h4><p>JDK 动态代理中 <strong>InvocationHandler 接口</strong>和 <strong>Proxy 类</strong>是核心。</p><p>Proxy 类中的 newProxyInstance() 方法用来生成一个代理对象。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title">newProxyInstance</span><span class="params">(ClassLoader loader,// 类加载器，用来加载代理对象</span></span></span><br><span class="line"><span class="function"><span class="params">                                      Class&lt;?&gt;[] interfaces,// 被代理类实现的一些接口</span></span></span><br><span class="line"><span class="function"><span class="params">                                      InvocationHandler h)</span><span class="comment">// 实现了 InvocationHandler 的对象</span></span></span><br><span class="line"><span class="function">    <span class="keyword">throws</span> IllegalArgumentException </span>&#123;</span><br><span class="line">    ......</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>JDK 动态代理中通过 InvocationHandler 来自定义代理逻辑。</p><p>当动态代理调用工业方法是，这个方法的调用会被转发到实现了 InvocationHandler 接口类的 invoke 方法来调用。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">InvocationHandler</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">invoke</span><span class="params">(Object proxy, // 动态生成的代理类</span></span></span><br><span class="line"><span class="function"><span class="params">                         Method method, // 与代理类对象调用的方法相对应</span></span></span><br><span class="line"><span class="function"><span class="params">                         Object[] args)</span><span class="comment">// 当前method方法的参数</span></span></span><br><span class="line"><span class="function">        <span class="keyword">throws</span> Throwable</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>通过Proxy 类的 newProxyInstance() 创建的代理对象在调用方法的时候，实际会调用到实现了 InvocationHandler 接口类的 invoke 方法 。</p><p>因此可以在 invoke 方法中自定义处理逻辑。</p><h4 id="3-1-2-使用步骤"><a href="#3-1-2-使用步骤" class="headerlink" title="3.1.2 使用步骤"></a>3.1.2 使用步骤</h4><p>1、定义一个接口以及实现类，该实现类是被代理类</p><p>2、自定 InvocationHandler 接口并重写 invoke方法，在 invoke 内部调用被代理对象的方法，并自定义一些逻辑。</p><p>3、通过 Proxy.newProxyInstance 创建一个代理对象。</p><h4 id="3-1-3-场景实现"><a href="#3-1-3-场景实现" class="headerlink" title="3.1.3 场景实现"></a>3.1.3 场景实现</h4><blockquote><p>卖票接口：参考上面</p></blockquote><blockquote><p>12306：参考上面</p></blockquote><blockquote><p>JDK 动态代理</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JDKProxy</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SellTicketImpl sellTicket = <span class="keyword">new</span> SellTicketImpl();</span><br><span class="line">        Class&lt;SellTicketImpl&gt; sellTicketClass = SellTicketImpl.class;</span><br><span class="line">        SellTicket sellTicketProxy = (SellTicket)Proxy.newProxyInstance(sellTicketClass.getClassLoader(), sellTicketClass.getInterfaces(), <span class="keyword">new</span> InvocationHandler() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> Object <span class="title">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;[JDKProxy INFO]:执行前&quot;</span>);</span><br><span class="line">                String ret = (String) method.invoke(sellTicket, args);</span><br><span class="line">                System.out.println(<span class="string">&quot;[JDKProxy INFO]:执行后&quot;</span>);</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&quot;[JDKProxy ]:&quot;</span> + ret;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        String ret = sellTicketProxy.sell(<span class="number">100</span>);</span><br><span class="line">        System.out.println(ret);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>上面代码中我们通过匿名对象的方式将InvocationHandler实现传递个newProxyInstance参数中。</p><blockquote><p>输出</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[JDKProxy INFO]:执行前</span><br><span class="line">花费100元购票.</span><br><span class="line">[JDKProxy INFO]:执行后</span><br><span class="line">[JDKProxy ]:购票成功</span><br></pre></td></tr></table></figure><h3 id="3-2-CGLib-动态代理"><a href="#3-2-CGLib-动态代理" class="headerlink" title="3.2 CGLib 动态代理"></a>3.2 CGLib 动态代理</h3><p><strong>JDK 动态代理中存在一个问题，只能代理实现了接口的类。</strong></p><p><strong>为了解决这个问题，可以使用 CGLIB 动态代理开避免这个问题。</strong></p><p><a href="https://github.com/cglib/cglib">CBLIB</a>，Code Generation Lib ，是一个基于<a href="https://www.baeldung.com/java-asm">ASM</a>的动态字节码生成库，它允许我们在运行时对字节码进行修改和动态生成。</p><p>CGLIB 通过继承方式实现代理，很知名的开源框架使用了 CGLIB ，如 Spring AOP。</p><h4 id="3-2-1-API"><a href="#3-2-1-API" class="headerlink" title="3.2.1 API"></a>3.2.1 API</h4><p><strong>CGLIB 动态代理中， MethodInterceptor 接口和 Enhancer 类是核心。</strong></p><p>使用时需要自定义 MethodInterceptor 接口 并重写 intercept 方法，intercept 用于增强。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">MethodInterceptor</span> <span class="keyword">extends</span> <span class="title">Callback</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">intercept</span><span class="params">(Object obj, // 被代理的对象，需要被增强的对象</span></span></span><br><span class="line"><span class="function"><span class="params">                            java.lang.reflect.Method method,// 被增强的方法</span></span></span><br><span class="line"><span class="function"><span class="params">                            Object[] args,// 方法传入的参数</span></span></span><br><span class="line"><span class="function"><span class="params">                            MethodProxy proxy// 用于调用原始方法的参数</span></span></span><br><span class="line"><span class="function"><span class="params">                           )</span> <span class="keyword">throws</span> Throwable</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>可以通过 Enhancer 类动态获取被代理类，当代理类调用方法时，实际调用的是 MethodInterceptor 的 intercept 方法。</p><h4 id="3-2-2-使用步骤"><a href="#3-2-2-使用步骤" class="headerlink" title="3.2.2 使用步骤"></a>3.2.2 使用步骤</h4><p>1、定义被代理类</p><p>2、自定义 MethodInterceptor 重写 intercept 方法，intercept 与 JDK动态代理的 invoke 方法类似。</p><p>3、通过 Enhancer 类的 create 方法创建对象。</p><h4 id="3-2-3-代码示例"><a href="#3-2-3-代码示例" class="headerlink" title="3.2.3 代码示例"></a>3.2.3 代码示例</h4><blockquote><p>添加依赖：CGLIB 不是JDK原生内容，是有个开源项目</p></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>cglib<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cglib<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.3.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>接口：参考静态代理代码</p></blockquote><blockquote><p>12306：参考静态代码</p></blockquote><blockquote><p>CGLIBProxy</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CGLibProxy</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SellTicketImpl sellTicket = <span class="keyword">new</span> SellTicketImpl();</span><br><span class="line">        Class&lt;SellTicketImpl&gt; sellTicketClass = SellTicketImpl.class;</span><br><span class="line">        SellTicket sellTicketProxy = (SellTicket) Enhancer.create(sellTicketClass, sellTicketClass.getInterfaces(), <span class="keyword">new</span> MethodInterceptor() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> Object <span class="title">intercept</span><span class="params">(Object o, Method method, Object[] objects, MethodProxy methodProxy)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;[CGLib INFO]:动态前&quot;</span>);</span><br><span class="line">                String ret = (String) methodProxy.invoke(sellTicket, objects);</span><br><span class="line">                System.out.println(<span class="string">&quot;[CGLib INFO]:执行后&quot;</span>);</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&quot;[CGLib INFO]:&quot;</span> + ret;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        String ret = sellTicketProxy.sell(<span class="number">100</span>);</span><br><span class="line">        System.out.println(ret);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>上面通过匿名对象来传递MethodInterceptor实现。</p><blockquote><p>输出</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[CGLib INFO]:动态前</span><br><span class="line">花费100元购票.</span><br><span class="line">[CGLib INFO]:执行后</span><br><span class="line">[CGLib INFO]:购票成功</span><br></pre></td></tr></table></figure><h3 id="3-3-JDK-与-CGLIB-对比"><a href="#3-3-JDK-与-CGLIB-对比" class="headerlink" title="3.3 JDK 与 CGLIB 对比"></a>3.3 JDK 与 CGLIB 对比</h3><table><thead><tr><th></th><th>JDK动态代理</th><th>CGLib动态代理</th></tr></thead><tbody><tr><td>实现原理</td><td>反射机制生成</td><td>ASM字节码框架</td></tr><tr><td>使用场景</td><td>实现了接口的类</td><td>对于不实现接口的可以使用CGLib</td></tr><tr><td>效率</td><td>一般较高</td><td>相对较低</td></tr><tr><td>核心API</td><td>Proxy/InvocationHandler</td><td>Enhancer/MethodInterceptor</td></tr></tbody></table><p>注意：由于CGlib是通过生成被代理类的子类的方式来增强，因此不用用于final修饰的类中。</p><h2 id="4、补充-代理模式对比"><a href="#4、补充-代理模式对比" class="headerlink" title="4、补充-代理模式对比"></a>4、补充-代理模式对比</h2><h3 id="4-1-JDK代理和CGLIB代理"><a href="#4-1-JDK代理和CGLIB代理" class="headerlink" title="4.1 JDK代理和CGLIB代理"></a>4.1 JDK代理和CGLIB代理</h3><p>使用CGLib实现动态代理，CGLib底层采用ASM字节码生成框架，使用字节码技术生成代理类，在 JDK1.6之前比使用Java反射效率要高。唯一需要注意的是，CGLib不能对声明为final的类或者 方法进行代理，因为CGLib原理是动态生成被代理类的子类。</p><p>在JDK1.6、JDK1.7、JDK1.8逐步对JDK动态代理优化之后，在调用次数较少的情况下，JDK代 理效率高于CGLib代理效率，只有当进行大量调用的时候，JDK1.6和JDK1.7比CGLib代理效率 低一点，但是到JDK1.8的时候，JDK代理效率高于CGLib代理。所以如果有接口使用JDK动态代 理，如果没有接口使用CGLIB代理。</p><h3 id="4-2-静态代理与动态代理"><a href="#4-2-静态代理与动态代理" class="headerlink" title="4.2 静态代理与动态代理"></a>4.2 静态代理与动态代理</h3><p>动态代理与静态代理相比较，最大的好处是接口中声明的所有方法都被转移到调用处理器一个集中 的方法中处理（InvocationHandler.invoke）。这样，在接口方法数量比较多的时候，我们 可以进行灵活处理，而不需要像静态代理那样每一个方法进行中转。</p><p>如果接口增加一个方法，静态代理模式除了所有实现类需要实现这个方法外，所有代理类也需要实 现此方法。增加了代码维护的复杂度。而动态代理不会出现该问题</p><h2 id="5、参考"><a href="#5、参考" class="headerlink" title="5、参考"></a>5、参考</h2><ul><li><a href="https://github.com/Snailclimb/JavaGuide">JavaGuide</a></li><li><a href="%E9%BB%91%E9%A9%AC%E7%A8%8B%E5%BA%8F%E5%91%98Java%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E8%AF%A6%E8%A7%A3">黑马程序员Java设计模式详解</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> 理论学习 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> 动态代理 </tag>
            
            <tag> 设计模式 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>再谈反射</title>
      <link href="2021/03/10/%E5%86%8D%E8%B0%88%E5%8F%8D%E5%B0%84/"/>
      <url>2021/03/10/%E5%86%8D%E8%B0%88%E5%8F%8D%E5%B0%84/</url>
      
        <content type="html"><![CDATA[<p>JVM在加载完类之后，会在方法区产生一个对应的Class类型的对象，这个对象包含了完整类的结构信息。这个对象就像一面镜子，可以反映类的内部结构，我们形象地称这种机制为「反射」。反射的使用场景有很多，比如 Spring IOC 便利用了反射机制，接下我们来聊一下反射。</p><a id="more"></a><h1 id="Reflection"><a href="#Reflection" class="headerlink" title="Reflection"></a>Reflection</h1><p>反射(Reflection)，指在程序运行期间可以动态获取一个类的所有信息，并且能够直接操作任意对象的内部属性以及方法。</p><p>反射是「动态语言」的关键，，可以使得编程更加灵活。</p><h2 id="1、概述"><a href="#1、概述" class="headerlink" title="1、概述"></a>1、概述</h2><p>JVM的「类加载子系统」可以从文件系统或者网络中加载.class文件。加载之后的.class文件会在类加载子系统执行：<strong>加载、链接、初始化</strong>。</p><p><img src="https://tobing-markdown.oss-cn-shenzhen.aliyuncs.com/image-20201120221030003.png" class="lazyload" data-srcset="https://tobing-markdown.oss-cn-shenzhen.aliyuncs.com/image-20201120221030003.png" srcset="data:image/png;base64,666" alt="image-20201120221030003"></p><p>在加载阶段，JVM通过类的全限定类名获取定义此类的二进制字节流，将字节流代表的静态存储结构转换为方法区的运行时数据结构，并在内存中生成一个代表该类的<code>java.lang.Class</code>对象，作为方法区这个类的各种数据访问入口。</p><p>通过内存中的这个<code>java.lang.Class</code>，可以映射类的所有信息，因此我们形象地称这种机制为：<strong>「反射」</strong>。</p><h2 id="2、Class"><a href="#2、Class" class="headerlink" title="2、Class"></a>2、Class</h2><h3 id="2-1-Class获取的方式"><a href="#2-1-Class获取的方式" class="headerlink" title="2.1 Class获取的方式"></a>2.1 Class获取的方式</h3><p>从上面可以知道，与类关联的Class是在加载过程生成的，可以反映类的结构信息。那么我们该然后获取到这个Class呢？主要有以下几种方式。</p><ul><li><strong>通过类的静态属性class</strong>，这种方式比较安全，性能较高</li><li><strong>通过实例的getClass方法</strong>，getClass是Object的弍native方法</li><li><strong>通过全限定类名</strong>，JDBC的驱动加载使用过这种方式</li></ul><blockquote><p>获取Class的几种方式</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ReflectionDemo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ClassNotFoundException </span>&#123;</span><br><span class="line">        <span class="comment">// 方式1：通过类的class属性获取</span></span><br><span class="line">        Class&lt;ReflectionDemo&gt; clazz1 = ReflectionDemo.class;</span><br><span class="line">        <span class="comment">// 方式2：通过类的实例，调用getClass方法</span></span><br><span class="line">        Class&lt;? extends ReflectionDemo&gt; clazz2 = <span class="keyword">new</span> ReflectionDemo().getClass();</span><br><span class="line">        <span class="comment">// 方式3：通过类的全限定类名</span></span><br><span class="line">        Class&lt;? extends Class&gt; clazz3 = Class.forName(<span class="string">&quot;top.tobing.review.ReflectionDemo&quot;</span>).getClass();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-2-Class的特征"><a href="#2-2-Class的特征" class="headerlink" title="2.2 Class的特征"></a>2.2 Class的特征</h3><p>Class 中可以获取某个类的属性、方法和构造器、某个类到底实现了哪些接口。对于每个类而言，JRE 都为其保留一个不变的 Class 类型的对象。值得注意的是，Class具有以下特征。</p><ul><li>Class本身也是一个类 </li><li>Class 对象只能由系统建立对象 </li><li>一个加载的类在 JVM 中只会有一个Class实例</li><li>一个Class对象对应的是一个加载到JVM中的一个.class文件 </li><li>每个类的实例都会记得自己是由哪个 Class 实例所生成</li><li>通过Class可以完整地得到一个类中的所有被加载的结构</li><li>Class类是Reflection的根源，针对任何你想动态加载、运行的类，唯有先获得相应的 Class对象</li></ul><blockquote><p>Class中常用API</p></blockquote><table><thead><tr><th>方法名称</th><th>说明</th></tr></thead><tbody><tr><td>static Class forName(String name)</td><td>返回指定类名 name 的 Class 对象</td></tr><tr><td>Object newInstance()</td><td>调用缺省构造函数，返回该Class对象的一个实例</td></tr><tr><td>getName()</td><td>返回此Class对象所表示的实体（类、接口、数组类、基本类型 或void）名称</td></tr><tr><td>Class getSuperClass()</td><td>返回当前Class对象的父类的Class对象</td></tr><tr><td>Class [] getInterfaces()</td><td>获取当前Class对象的接口</td></tr><tr><td>ClassLoader getClassLoader()</td><td>返回该类的类加载器</td></tr><tr><td>Class getSuperclass()</td><td>返回表示此Class所表示的实体的超类的Class</td></tr><tr><td>Constructor[] getConstructors()</td><td>返回一个包含某些Constructor对象的数组</td></tr><tr><td>Field[] getDeclaredFields()</td><td>返回Field对象的一个数组</td></tr><tr><td>Method getMethod(String  name,Class … paramTypes)</td><td>返回一个Method对象，此对象的形参类型为paramType</td></tr></tbody></table><blockquote><p>利用反射获取一个类的所有方法</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ReflectionDemo02</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Class&lt;String&gt; clazz = String.class;</span><br><span class="line">        StringBuilder res = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">        <span class="keyword">for</span> (Method method : clazz.getMethods()) &#123;</span><br><span class="line">            res.append(method.getReturnType().getSimpleName());</span><br><span class="line">            res.append(<span class="string">&quot; &quot;</span>);</span><br><span class="line">            res.append(method.getName());</span><br><span class="line">            res.append(<span class="string">&quot;(&quot;</span>);</span><br><span class="line">            Parameter[] parameters = method.getParameters();</span><br><span class="line">            <span class="keyword">if</span> (parameters != <span class="keyword">null</span> &amp;&amp; parameters.length != <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; parameters.length; i++) &#123;</span><br><span class="line">                    res.append(parameters[i].getType().getSimpleName());</span><br><span class="line">                    res.append(<span class="string">&quot; &quot;</span>);</span><br><span class="line">                    res.append(parameters[i].getName());</span><br><span class="line">                    <span class="keyword">if</span> (i != parameters.length - <span class="number">1</span>) &#123;</span><br><span class="line">                        res.append(<span class="string">&quot;, &quot;</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            res.append(<span class="string">&quot;)\n&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(res.toString());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="3、反射的应用"><a href="#3、反射的应用" class="headerlink" title="3、反射的应用"></a>3、反射的应用</h2><p>我们常用的Spring框架底层大量使用了反射技术。</p><h3 id="3-1-Spring-IOC"><a href="#3-1-Spring-IOC" class="headerlink" title="3.1 Spring IOC"></a>3.1 Spring IOC</h3><p>IOC，Inversion Of Control，控制反转，即将对象生命周期和对象间关系等控制权从程序员手上交到Spring IOC容器中。IOC并不是一种具体的技术，而是一种设计思想。</p><blockquote><p>为什么使用Spring IOC</p></blockquote><p>传统的Java SE 编程中，类的数量不多，类之间的关系不复杂，可以通过new在对象内部创建需要依赖的对象，这是一种主动的方式来创建对象；</p><p>然而在Java EE编程中，类的数量开始变多，对象之间相互依赖开始变的复杂，Controller层的一个实例可能依赖了若干个Service层的实例，Service层实例可能又依赖了若干个Dao层实例，不同Service、Controller中可能依赖同一个对象；</p><p>这时，如果再通过手动的方式为每个类创建依赖的对象，则对象之间存在较高的耦合度，维护起来并不方便。于是Spring 通过IOC的方式，将对象生命周期以及依赖关系管理的控制权从编码人员手上移到了Spring手上。Spring可以提前创建好需要使用的对象，并将这些对象放到IOC容器中进行管理，当需要某个对象时，只需要通过<code>@Autowried</code>等方式来将对象注入。这样编码人员便不用关心类的创建以及依赖管理等细节，可以将精力放到实际的逻辑中，从而提高开发效率。</p><blockquote><p>如何实现 IOC</p></blockquote><p>那么Spring是如何通过一个<code>@Autowried</code>注解就可以实现依赖对象的注入呢？答案尽在反射技术。</p><p><img src="https://tobing-markdown.oss-cn-shenzhen.aliyuncs.com/SpringIOC.png" class="lazyload" data-srcset="https://tobing-markdown.oss-cn-shenzhen.aliyuncs.com/SpringIOC.png" srcset="data:image/png;base64,666" alt="SpringIOC"></p><p>Web容器在启动时会启动Spring容器，Spring容器在启动时会通过xml、或者注解扫描的方式来创建出各种Bean，这种在运行期间创建对象的方式正是反射。</p><p>详细将会在「再谈Spring」中见。</p><h2 id="4、反射的优缺点"><a href="#4、反射的优缺点" class="headerlink" title="4、反射的优缺点"></a>4、反射的优缺点</h2><h3 id="4-1-优点"><a href="#4-1-优点" class="headerlink" title="4.1 优点"></a>4.1 优点</h3><ul><li><strong>可扩展性</strong> ：应用程序可以利用全限定名创建可扩展对象的实例，来使用来自外部的用户自定义类。</li><li><strong>类浏览器和可视化开发环境</strong> ：一个类浏览器需要可以枚举类的成员。可视化开发环境（如 IDE）可以从利用反射中可用的类型信息中受益，以帮助程序员编写正确的代码。</li><li><strong>调试器和测试工具</strong> ： 调试器需要能够检查一个类里的私有成员。测试工具可以利用反射来自动地调用类里定义的可被发现的 API 定义，以确保一组测试中有较高的代码覆盖率。</li></ul><h3 id="4-2-缺点"><a href="#4-2-缺点" class="headerlink" title="4.2 缺点"></a>4.2 缺点</h3><p>尽管反射非常强大，但也不能滥用。如果一个功能可以不用反射完成，那么最好就不用。在我们使用反射技术时，下面几条内容应该牢记于心。</p><ul><li><strong>性能开销</strong> ：反射涉及了动态类型的解析，所以 JVM 无法对这些代码进行优化。因此，反射操作的效率要比那些非反射操作低得多。我们应该避免在经常被执行的代码或对性能要求很高的程序中使用反射。</li><li><strong>安全限制</strong> ：使用反射技术要求程序必须在一个没有安全限制的环境中运行。如果一个程序必须在有安全限制的环境中运行，如 Applet，那么这就是个问题了。</li><li><strong>内部暴露</strong> ：由于反射允许代码执行一些在正常情况下不被允许的操作（比如访问私有的属性和方法），所以使用反射可能会导致意料之外的副作用，这可能导致代码功能失调并破坏可移植性。反射代码破坏了抽象性，因此当平台发生改变的时候，代码的行为就有可能也随着变化。</li></ul><h2 id="5、总结"><a href="#5、总结" class="headerlink" title="5、总结"></a>5、总结</h2><p>在JVM会在类加载阶段生成与类唯一的匹配的Class对象放到内存中，通过这个Class对象可以反映类的内部结构，如方法、变量、构造器等信息，通过Class对象的还可以动态地创建该类的实例，我们形象地将这种机制称为「反射」。如果想要通过「反射」来动态创建类的实例，就要先获取该类的Class对象，主要有三种方式获取：</p><ul><li>类名.class</li><li>实例.getClass()</li><li>Class.forName(“全限定类名”)</li></ul><p>反射的应用场景比较广泛，在一些框架中被广泛适应，如Spring中实现控制反转的时就是利用反射来创建对象，并将对象放到容器中管理。</p><h2 id="6、参考"><a href="#6、参考" class="headerlink" title="6、参考"></a>6、参考</h2><ul><li><p><a href="https://www.bilibili.com/video/BV1Kb411W75N">尚硅谷Java基础-宋红康</a></p></li><li><p><a href="https://book.douban.com/subject/34907497/">深入理解Java虚拟机</a></p></li><li><p><a href="https://github.com/CyC2018/CS-Notes/blob/master/notes/Java%20%E5%9F%BA%E7%A1%80.md#%E4%B8%83%E5%8F%8D%E5%B0%84">CyC2018/CS-Notes</a></p></li><li><p><a href="https://docs.oracle.com/javase/tutorial/reflect/index.html">Trail: The Reflection API</a></p></li></ul>]]></content>
      
      
      <categories>
          
          <category> 理论学习 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> 反射 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>线程池的简单使用</title>
      <link href="2021/03/09/%E7%BA%BF%E7%A8%8B%E6%B1%A0%E7%9A%84%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8/"/>
      <url>2021/03/09/%E7%BA%BF%E7%A8%8B%E6%B1%A0%E7%9A%84%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8/</url>
      
        <content type="html"><![CDATA[<p>线程作为一种稀缺资源，在线程较多的情况下，频繁创建、销毁消除将会带来较大的系统开销。线程池基于池化思想，内部维护多个线程，可以对内部的线程进行统一的管理和监控，一方面避免了处理任务时创建销毁线程开销的代价，另一方面避免了线程数量膨胀导致的过分调度问题，保证了对内核的充分利用。</p><a id="more"></a><h1 id="线程池"><a href="#线程池" class="headerlink" title="线程池"></a>线程池</h1><h2 id="1、线程池的优点"><a href="#1、线程池的优点" class="headerlink" title="1、线程池的优点"></a>1、线程池的优点</h2><p>上面我们提到，线程池是一种稀缺资源，频繁创建销毁线程会造成较大的系统开销，因此引入了线程池技术。</p><p>线程池技术主要具有以下优点：</p><ul><li><p><strong>降低资源消耗。</strong>通过重复利用已经创建的线程，降低线程创建和销毁造成的损耗。</p></li><li><p><strong>提高响应速度。</strong>当任务下达时，任务不需要等待线程创建就能直接执行。</p></li><li><p><strong>提高线程可管理性。</strong>线程是稀缺资源，如果无限创建不仅会消耗系统资源，还会降低系统稳定性。使用线程池可以统一分配、调优和监控。</p></li></ul><h2 id="2、线程池架构设计"><a href="#2、线程池架构设计" class="headerlink" title="2、线程池架构设计"></a>2、线程池架构设计</h2><p>线程池这么好，那么需要我们自己实现吗？可以但没有必要，因为Java中以及封装好了线程池的实现。</p><p>Java中，线程池是通过Executor框架来实现的，该框架主要用到：Executor、ExecutorService、ThreadPoolExecutor、Executors这几个类。</p><p><img src="https://tobing-markdown.oss-cn-shenzhen.aliyuncs.com/93nTP8aoAcH7XGq.png" class="lazyload" data-srcset="https://tobing-markdown.oss-cn-shenzhen.aliyuncs.com/93nTP8aoAcH7XGq.png" srcset="data:image/png;base64,666" alt="image-20201114092231857"></p><ul><li><strong>Executor 接口</strong>：将任务提交和任务执行进行解耦。用户无需关注如何创建线程，如何调度线程来执行任务，用户只需提供Runnable对象，将任务的运行逻辑提交到执行器(Executor)中，由Executor框架完成线程的调配和任务的执行部分。</li><li><strong>ExecutorService 接口</strong>：扩充执行任务的能力，补充可以为一个或一批异步任务生成Future的方法；提供了管控线程池的方法，比如停止线程池的运行。</li><li><strong>AbstractExecutorService 抽象类</strong>：将执行任务的流程串联了起来，保证下层的实现只需关注一个执行任务的方法即可。</li><li><strong>ThreadPoolExecutor 类</strong>：实现最复杂的运行部分，ThreadPoolExecutor将会一方面维护自身的生命周期，另一方面同时管理线程和任务，使两者良好的结合从而执行并行任务。</li></ul><h2 id="3、-线程池的简单使用"><a href="#3、-线程池的简单使用" class="headerlink" title="3、 线程池的简单使用"></a>3、 线程池的简单使用</h2><p>Java中的Executors线程池工具类为我们提供了3种创建线程的方法：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//执行一个长期的任务,性能好很多</span></span><br><span class="line">ExecutorService threadPool1 = Executors.newFixedThreadPool(<span class="number">5</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 一个任务一个线程执行的任务场景</span></span><br><span class="line">ExecutorService threadPool2 = Executors.newSingleThreadExecutor();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 适用于：执行很多短期异步的小程序或者负载较轻的服务器</span></span><br><span class="line">ExecutorService threadPool3 = Executors.newCachedThreadPool();</span><br></pre></td></tr></table></figure><p>尽管Executors为我们提供了3种创建线程池的方式，但是这几种创建方式并不适合在生产环境中使用：</p><blockquote><p>阿里巴巴开发手册</p></blockquote><p><img src="https://tobing-markdown.oss-cn-shenzhen.aliyuncs.com/image-20210309214056272.png" class="lazyload" data-srcset="https://tobing-markdown.oss-cn-shenzhen.aliyuncs.com/image-20210309214056272.png" srcset="data:image/png;base64,666" alt="image-20210309214056272"></p><p>要分析其存在的隐患，要先去了解Java中线程池的核心类：ThreadPoolExecutor</p><h2 id="4、-ThreadPoolExecutor"><a href="#4、-ThreadPoolExecutor" class="headerlink" title="4、 ThreadPoolExecutor"></a>4、 ThreadPoolExecutor</h2><p>上面提到道，Executors方式创建的线程池在实践中容易导致OOM，为了解释清楚，我们先分析一下ThreadPoolExecutor。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">ThreadPoolExecutor</span><span class="params">(<span class="keyword">int</span> corePoolSize,</span></span></span><br><span class="line"><span class="function"><span class="params">                          <span class="keyword">int</span> maximumPoolSize,</span></span></span><br><span class="line"><span class="function"><span class="params">                          <span class="keyword">long</span> keepAliveTime,</span></span></span><br><span class="line"><span class="function"><span class="params">                          TimeUnit unit,</span></span></span><br><span class="line"><span class="function"><span class="params">                          BlockingQueue&lt;Runnable&gt; workQueue,</span></span></span><br><span class="line"><span class="function"><span class="params">                          ThreadFactory threadFactory,</span></span></span><br><span class="line"><span class="function"><span class="params">                          RejectedExecutionHandler handler)</span></span></span><br></pre></td></tr></table></figure><p>上面展示了ThreadPoolExecutor的构造方法，接下来我们了解这个7大参数</p><ul><li><p>corePoolSize：线程池常驻核心线程数</p></li><li><p>maximumPoolSize：线程池能够容纳同时执行的最大线程数</p></li><li><p>keepAliveTime：多余的空闲线程存活时间、当空闲时间达到keepAliveTime，多余线程会被销毁直到剩下corePoolSize</p></li><li><p>unit：keepAliveTime单位</p></li><li><p>workQueue：任务队列，提交但未执行的任务。</p></li><li><p>threadFactory：线程池中工作线程的线程工厂，一般采用默认即可</p></li><li><p>handler：拒绝策略。当线程队列满并且工作线程大于线程池最大线程数，handler将指定任何拒绝新来的线程。</p></li></ul><p>在使用ThreadPoolExecutor前，我们先通过图解方式讲解线程池底层执行的原理：</p><p><img src="https://i.loli.net/2020/11/14/UVDLHZGlF6hsIkv.png" class="lazyload" data-srcset="https://i.loli.net/2020/11/14/UVDLHZGlF6hsIkv.png" srcset="data:image/png;base64,666" alt="image-20201114094735529"></p><ol><li>创建线程池后，等待提交过来的线程任务</li><li>在调用execut()方法添加一个任务请求，线程池会做如下判断：<ul><li>如果正在运行的线程数量小于corePoolSize，则马上创建线程运行这个任务。</li><li>如果正在运行的线程数量大于corePoolSize，则在<strong>workQueue中等待</strong>。</li><li>如果workQueue队列已满，且正在运行的线程数量还小于maximumPoolSize，则创建<strong>非核心线程</strong>立即执行这个任务。</li><li>如果workQueue队列已满，且正在运行的线程数量大于或等于maximumPoolSize，则会使用<strong>拒绝策略</strong>执行拒绝。</li></ul></li><li>当一个线程完成任务，会从workQueue中取出一个人任务执行。</li><li>当一个线程空闲时间超过keepAliveTime，线程池会判断：<ul><li>如果当前运行的线程数大于corePoolSize，那么线程会被停用</li></ul></li></ol><h2 id="5、拒绝策略"><a href="#5、拒绝策略" class="headerlink" title="5、拒绝策略"></a>5、拒绝策略</h2><p>上面提到当<strong>等待队列已满且线程池最大线程数也满</strong>的时候，无法继续为新任务提供服务，这时候，需要拒绝策略机制合理处理这个问题。</p><p>JDK中为我们提供了4种拒绝策略：</p><ul><li>AbortPolicy：默认策略，直接<strong>抛出异常</strong>阻止系统正常运行。</li><li>CallerRunPolicy：“调用者运行”机制，不会抛弃任务，也不会抛出异常，而是给调用线程池的线程执行。</li><li>DiscardOldestPolicy：抛弃队列中等待最久的。</li><li>DiscardPolicy：直接丢弃任务，不做任务响应。（如果允许任务丢失，将会是最好的拒绝策略）。</li></ul><h2 id="6、Executors风险分析"><a href="#6、Executors风险分析" class="headerlink" title="6、Executors风险分析"></a>6、Executors风险分析</h2><p>上面我们已经简单介绍了ThreadPoolExecuto构造函数的各个参数，下面我们观察Executors中几种常见线程池的方式，进而分析其风险。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// FixedThreadPool</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ExecutorService <span class="title">newFixedThreadPool</span><span class="params">(<span class="keyword">int</span> nThreads)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> ThreadPoolExecutor(nThreads, nThreads,</span><br><span class="line">                                  <span class="number">0L</span>, TimeUnit.MILLISECONDS,</span><br><span class="line">                                  <span class="keyword">new</span> LinkedBlockingQueue&lt;Runnable&gt;());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// SingleThreadExecutor</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ExecutorService <span class="title">newSingleThreadExecutor</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> FinalizableDelegatedExecutorService</span><br><span class="line">        (<span class="keyword">new</span> ThreadPoolExecutor(<span class="number">1</span>, <span class="number">1</span>,</span><br><span class="line">                                <span class="number">0L</span>, TimeUnit.MILLISECONDS,</span><br><span class="line">                                <span class="keyword">new</span> LinkedBlockingQueue&lt;Runnable&gt;()));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// CacheThreadPool</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ExecutorService <span class="title">newCachedThreadPool</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> ThreadPoolExecutor(<span class="number">0</span>, Integer.MAX_VALUE,</span><br><span class="line">                                  <span class="number">60L</span>, TimeUnit.SECONDS,</span><br><span class="line">                                  <span class="keyword">new</span> SynchronousQueue&lt;Runnable&gt;());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>上面代码展示了Executors中创建创建线程池的逻辑，可以看到底层都是通过 ThreadPoolExecutor 来创建，这就是为什么要在分析前先了解一下它。</p><p>从上面提到的ThreadPoolExecutor 我看可以知道</p><ul><li>对于FixedThreadPool 与 SingleThreadExecutor 都是使用 LinkedBlockingQueue 作为阻塞队列，这是一个无界第队列，当阻塞的任务过多的时候，将会导致内存占用太大，从而导致OOM。</li><li>对于CacheThreadPool ，最大线程数没有进行限制，当线程提交过多，将会导致线程池创建的线程太多，从而导致OOM。</li></ul><h2 id="7、自定义线程池"><a href="#7、自定义线程池" class="headerlink" title="7、自定义线程池"></a>7、自定义线程池</h2><p>从上面分析，我们知道Executors的方式创建线程池确实存在安全隐患，因此我们应该使用 ThreadPoolExecutor 来创建线程池，那么应该如何配置其参数呢？</p><p>这需要我们区分不同类型的业务场景：<strong>CPU密集型和IO密集型</strong>。</p><h4 id="CPU密集型"><a href="#CPU密集型" class="headerlink" title="CPU密集型"></a>CPU密集型</h4><p>CPU密集型指的是，任务需要大量的运算而没有阻塞（如IO阻塞），CPU一直在全力运算。</p><p>CPU密集型任务只有在正在的多核CPU上才能得到加锁。</p><blockquote><p>可以通过Runtime.getRuntime().availableProcessors()拿到CPU核心数。</p></blockquote><p>CPU密集型任务配置尽可能少的线程数量：线程数=CPU核数+1</p><h4 id="IO密集型"><a href="#IO密集型" class="headerlink" title="IO密集型"></a>IO密集型</h4><p>由于IO密集型，线程常常是在等待IO操作而阻塞，因此应该配置尽量多的线程。</p><p>线程数量=CPU核心数*2</p><h2 id="8、参考"><a href="#8、参考" class="headerlink" title="8、参考"></a>8、参考</h2><ul><li><p><a href="https://tech.meituan.com/2020/04/02/java-pooling-pratice-in-meituan.html">Java线程池实现原理及其在美团业务中的实践</a></p></li><li><p><a href="https://book.douban.com/subject/26591326/">Java并发编程的艺术</a></p></li></ul>]]></content>
      
      
      <categories>
          
          <category> 理论学习 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> 线程池 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>双亲委派机制</title>
      <link href="2021/03/06/%E5%8F%8C%E4%BA%B2%E5%A7%94%E6%B4%BE%E6%9C%BA%E5%88%B6/"/>
      <url>2021/03/06/%E5%8F%8C%E4%BA%B2%E5%A7%94%E6%B4%BE%E6%9C%BA%E5%88%B6/</url>
      
        <content type="html"><![CDATA[<p>JVM可以使用类加载器通过全限定类名的方式来加载一个类。类加载器在加载类的时候会使用一种称为「双亲委派」的机制来实现类的加载，本文将简要介绍双亲委派机制。</p><a id="more"></a><h1 id="双亲委派机制"><a href="#双亲委派机制" class="headerlink" title="双亲委派机制"></a>双亲委派机制</h1><p>类加载器是JVM执行类加载机制的前提，类加载器实现了「双亲委派」机制，介绍「双亲委派」机制前先简要介绍一下类加载器。</p><h2 id="一、类加载器"><a href="#一、类加载器" class="headerlink" title="一、类加载器"></a>一、类加载器</h2><h3 id="1-1-类加载器作用"><a href="#1-1-类加载器作用" class="headerlink" title="1.1 类加载器作用"></a>1.1 类加载器作用</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Xxxx.class -----二进制流-----&gt; Class对象</span><br></pre></td></tr></table></figure><p>ClassLoader是Java的核心组件，所有的Class都是ClassLoader进行加载的，ClassLoader负责通过各种方式将Class信息的二进制流数据读入JVM内部，转换为一个与目标类对应的java.lang.Class对象实例。然后交给Java虚拟机进行链接、初始化等操作。因此，ClassLoader在整个装载阶段，只能影响类加载，而无法通过ClassLoader区改变类的链接和初始化行为。至于是否可以运行，有Execution Engine决定。</p><p>类加载器最早出现在Java1.0中，那时候只是单纯为了满足Java Applet应用而被研发出来，但如今却在OSGi、字节码加解密中大放异彩。这主要归功于Java虚拟机的设计者当初在设计类加载的时候，并没有考虑将它绑定到JVM内部，这样做的好处是能够灵活和动态的执行类加载操作。</p><p><img src="https://tobing-markdown.oss-cn-shenzhen.aliyuncs.com/image-20201120221030003.png" class="lazyload" data-srcset="https://tobing-markdown.oss-cn-shenzhen.aliyuncs.com/image-20201120221030003.png" srcset="data:image/png;base64,666" alt="image-20201120221030003"></p><h3 id="1-2-类加载方式的分类"><a href="#1-2-类加载方式的分类" class="headerlink" title="1.2 类加载方式的分类"></a>1.2 类加载方式的分类</h3><p>JVM可以通过显式加载与隐式加载将class文件加载到内存中</p><ul><li>显式加载，通过调用ClassLoader加载class对象，如直接使用Class.forName(name)或this.getClass().getClassLoader().loadClass()加载class对象。</li><li>隐式加载，通过Java虚拟机自动加载到内存中，如加载某个类时，该类中引用了另外一个类，此时则通过隐式加载。</li></ul><h3 id="1-3-类加载的基本机制"><a href="#1-3-类加载的基本机制" class="headerlink" title="1.3 类加载的基本机制"></a>1.3 类加载的基本机制</h3><p>类加载的时候有三个特征：</p><ul><li><strong>双亲委派模型</strong>。不是所有的类加载都遵循这个模型。有时候，启动类加载的类型可能要加载用户代码，如JDK内部的ServiceProvider、ServiceLoader机制，用户可用在标准的API框架上，提供自己的实现，如Java中的JNDI、JDBC、文件系统、Cipher等，都是利用该机制。这时不是采用双亲委派机制，而是上下文加载器。</li><li>可见性，子类加载器可用访问父加载器加载的类型，但反过来不行 。不然因为缺少不要的割裂就没办法利用类加载器去实现容器的逻辑。</li><li>单一性，由于父加载器的类型对于子加载器是可见的，所以父加载器中加载过的类型，就不会在子加载器中重复加载。但是注意，类加载器“邻居”间，同一类型仍然可以被加载多次，因为互不可见。</li></ul><h3 id="1-4-类加载器类型"><a href="#1-4-类加载器类型" class="headerlink" title="1.4 类加载器类型"></a>1.4 类加载器类型</h3><p>JVM把类加载器分为两类：引导类加载器（Bootstrap ClassLoader）和自定义加载器（User-Defined ClassLoader）。</p><p>不同的类加载器主机不是继承关系，而是包含关系，<strong>下层类加载器包含上层类加载器的引用</strong>。</p><blockquote><p>启动类加载器 /引导类加载器</p></blockquote><p>Bootstrap ClassLoader，使用C/C++实现，嵌套在JVM内部。</p><p>加载Java核心库：JAVA_HOME/jre/lib/rt.jar或sun.boot.class.path，用于提供JVM自身需要的类。</p><p>并不继承与java.lang.ClassLoader，没有父加载器。</p><p>出于安全考虑，Bootstrap启动类加载器只加载包名为<code>java/javax/sun</code>等开头的类。</p><p>引导类加载器可以加载扩展类加载器和应用程序类加载器，并为他们指定父类加载器。</p><blockquote><p>扩展类加载器</p></blockquote><p>Extension ClassLoader，Java编写，sun.misc.Launcher$ExtClassLoader实现。</p><p>Extension ClassLoader继承于ClassLoader，它的父类加载器为启动类加载器。</p><p>从java.ext.dirs系统属性指定的目录加载类库，或从jre/lib/ext子目录下加载类库。</p><p>如果用户将jar放到以上目录，将会自动被加载。</p><blockquote><p>用户自定义类加载器</p></blockquote><p>日常开发中都是使用上述三种类加载器交叉使用，但必要时我们也可以自定义类加载器。</p><p>Java开发者可以自定义类加载器来实现类库的动态加载，加载源可以是jar，也可以是网络的远程资源。</p><p><strong>通过类加载器可以实现精美绝伦的插件机制。</strong>如著名的OSGI组件框架、Eclipse插件机制等。</p><p>类加载器为应用程序提供了一种动态添加新功能的机制，这种机制无需重新打包发布应用程序就能实现。</p><p>同时，自定义类加载器可以实现应用隔离，如 Tomcat、Spring等中间件和组件框架都在内部实现了自定义加载器，并且通过自定义加载器隔离不同的组件模块。</p><p>自定义类加载器通常继承与ClassLoader。</p><h2 id="二、双亲委派机制"><a href="#二、双亲委派机制" class="headerlink" title="二、双亲委派机制"></a>二、双亲委派机制</h2><p>上面在介绍类加载器时提到，类加载器实现类加载时，具有「双亲委派」的特征，下面正式聊聊双亲委派模型。</p><p>JDK1.2开始，类的加载过程采用双亲委派机制，这机制能够更好的保证Java平台安全。</p><h3 id="2-1-定义"><a href="#2-1-定义" class="headerlink" title="2.1 定义"></a>2.1 定义</h3><p>一个类加载器在接收到类加载的请求的时候，首先不会自己尝试加载，而是先把这请求交给父类加载器去加载，依次递归。如果父类加载器可以完成类的加载任务，则成功返回；否则自己其加载。</p><p><strong>双亲委派机制本质上是规定了类的加载顺序：引导类加载器 –&gt; 扩展类加载器 –&gt; 系统类加载器 –&gt; 自定义类加载器</strong></p><h3 id="2-2-代码实现"><a href="#2-2-代码实现" class="headerlink" title="2.2 代码实现"></a>2.2 代码实现</h3><p>双亲委派机制具体实现是在<code>java.lang.ClassLoader.loadClass(String, boolean)</code>中体现。逻辑如下：</p><p>（1）当前类加载器缓存中查找该类，有则直接返回；</p><p>（2）判断当前父类加载器是否为空，不为空，则调用parent.loadClass()进行加载；【双亲委派机制】</p><p>（3）如果父类加载器为空，则调用findBootstrapClassOrNull()接口，让引导类加载器加载；【双亲委派机制】</p><p>（4）如果以上三步都不成功，自己加载，调用findClass(name)。该接口最终调用ClassLoader的defineClass系列的native接口加载目标Java类。</p><blockquote><p>Java 8 <code>java.lang.ClassLoader.loadClass(String, boolean)</code></p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> Class&lt;?&gt; loadClass(String name, <span class="keyword">boolean</span> resolve)          <span class="comment">// loadClass</span></span><br><span class="line">    <span class="keyword">throws</span> ClassNotFoundException</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">synchronized</span> (getClassLoadingLock(name)) &#123;                      <span class="comment">// 并发控制</span></span><br><span class="line">        <span class="comment">// First, check if the class has already been loaded        检查类是否已经被定义</span></span><br><span class="line">        Class&lt;?&gt; c = findLoadedClass(name);         <span class="comment">// 判断该类是否已经加载</span></span><br><span class="line">        <span class="keyword">if</span> (c == <span class="keyword">null</span>) &#123;                            <span class="comment">// 尚未加载</span></span><br><span class="line">            <span class="keyword">long</span> t0 = System.nanoTime();</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (parent != <span class="keyword">null</span>) &#123;               <span class="comment">// 判断是否具有父加载器</span></span><br><span class="line">                    c = parent.loadClass(name, <span class="keyword">false</span>);  <span class="comment">// 先调用父加载器加载【双亲委派机制】</span></span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    c = findBootstrapClassOrNull(name);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">                <span class="comment">// ClassNotFoundException thrown if class not found</span></span><br><span class="line">                <span class="comment">// from the non-null parent class loader</span></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (c == <span class="keyword">null</span>) &#123;        <span class="comment">// 如果父加载器没找到，从当前类加载器中查找</span></span><br><span class="line">                <span class="comment">// If still not found, then invoke findClass in order</span></span><br><span class="line">                <span class="comment">// to find the class.</span></span><br><span class="line">                <span class="keyword">long</span> t1 = System.nanoTime();</span><br><span class="line">                c = findClass(name);</span><br><span class="line"></span><br><span class="line">                <span class="comment">// this is the defining class loader; record the stats</span></span><br><span class="line">                sun.misc.PerfCounter.getParentDelegationTime().addTime(t1 - t0);</span><br><span class="line">                sun.misc.PerfCounter.getFindClassTime().addElapsedTimeFrom(t1);</span><br><span class="line">                sun.misc.PerfCounter.getFindClasses().increment();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (resolve) &#123;</span><br><span class="line">            resolveClass(c);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> c;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-3-实践"><a href="#2-3-实践" class="headerlink" title="2.3 实践"></a>2.3 实践</h3><p>Java虚拟机规范没有明确要求类加载器的加载机制一定要采用双亲委派机制，只是建议使用。</p><p>在Tomcat中，类加载器采用的加载机制和双亲委派机制有一定区别，当缺省的类加载器收到一个加载任务的时候，首先会自行加载，当加载失败，才会将类加载委派给父类加载器，同时也是Servlet规范推荐的做法。</p><h3 id="2-4-破坏双亲委派机制"><a href="#2-4-破坏双亲委派机制" class="headerlink" title="2.4 破坏双亲委派机制"></a>2.4 破坏双亲委派机制</h3><p>双亲委派机制<strong>不是一个具有强制性</strong>的模型，而是Java设计者<strong>推荐</strong>使用的类加载方式。</p><p>在JDK9之前，出现过三次破坏双亲委派机制的情况。</p><p><strong>（1）JDK1.2前</strong></p><p>ClassLoader诞生于JDK1.0，但是双亲委派机制是JDK1.2才引入。因此JDK1.2 之前的自定义实现的用户自定义类加载器是不具有双亲委派机制的。同时，为了对已有代码的兼容，JDK1.2在对具体类加载器实现时，将<strong>类字节码文件的加载</strong>以及<strong>字节码文件转换为Class文件</strong>分离，分别是loadClass与defineClass方法。推荐使用重写defineClass来避免破坏双亲委派机制。</p><p><strong>（2）线程上下文</strong></p><p>双亲委派模式自身存在缺陷，即上级加载器无法使用下级加载器的类。而实际引用中存在上级定义规范，下级实现的情况，如JDBC。JDBC是Java定义的规范接口，需要实际的数据库厂商根据自身特点来实现，而JDBC接口是Java核心类库定义的，应该属于引导类加载器管理；而数据库厂商实现的自然是应用程序类加载器，此时如果依旧采用纯双亲委派机制就无法实现JDBC的需求。</p><p>为了解决这个困境，Java设计团队引入了<strong>线程上下文类加载器</strong>。线程上下文类加载器运行父类加载器去请求子类加载器完成类的加载的行为。这便破坏了双亲委派机制。</p><blockquote><p>图：线程上下文加载器</p></blockquote><p><img src="https://tobing-markdown.oss-cn-shenzhen.aliyuncs.com/tAQjU4vlirpD8wk.png" class="lazyload" data-srcset="https://tobing-markdown.oss-cn-shenzhen.aliyuncs.com/tAQjU4vlirpD8wk.png" srcset="data:image/png;base64,666" alt="tAQjU4vlirpD8wk"></p><p><strong>（3）热代码替换</strong></p><p>这一次破坏源于用户对程序动态性的追求，Hot Swap，Hot Deployment等。</p><p>IBM主导的JSR-291实现的模块热部署采用了自定义类加载器，该自定义加载器不再使用双亲委派模型推荐的树形结构，而是采用的复杂的网状结构。</p><p><strong>注意</strong></p><p>“被破坏”不意味着就是贬义，只要理由充分，突破旧的原则无疑就是一种创新。</p><h2 id="三、总结"><a href="#三、总结" class="headerlink" title="三、总结"></a>三、总结</h2><p>JVM通过ClassLoader实现类的加载。ClassLoader在加载时会遵循双亲委派机制，即在实现类加载时递归请求委派父类加载器区加载，直到顶层父类无法加载，才会返回让当前类机制器实现加载。这种方式既可以避免类的重复加载，确保类的全局唯一，又可以保证程序安全，防止核心API被褚篡改。</p><p>同时双亲委派模型不是一个强制性模型，JDK9 前，历史上出现了3次破坏双亲委派模型的情况：</p><ul><li>JDK1.2前：双亲委派机制是JDK1.2才引入，之前自定义的不具有双亲委派机制。</li><li>线程上下文：双亲委派机制本身具有缺陷，即上级加载器无法使用下级加载器的类，而实际中又存在这种场景，如：JDBC。</li><li>热代码替换【了解】。</li></ul><h2 id="四、参考"><a href="#四、参考" class="headerlink" title="四、参考"></a>四、参考</h2><ul><li><a href="https://www.bilibili.com/video/BV1PJ411n7xZ">JVM-宋红康</a></li><li><a href="https://book.douban.com/subject/34907497/">深入理解Java虚拟机</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> 理论学习 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> JVM </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>排序算法-快速排序</title>
      <link href="2021/02/27/%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95-%E5%BF%AB%E9%80%9F%E6%8E%92%E5%BA%8F/"/>
      <url>2021/02/27/%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95-%E5%BF%AB%E9%80%9F%E6%8E%92%E5%BA%8F/</url>
      
        <content type="html"><![CDATA[<p>快速排序是一种高级排序算法，虽然他的最优时间复杂度是O(nlogn)，但是其前面的常数比其他高级排序算法要小，因此比其他高级算法要快很多。</p><a id="more"></a><h1 id="快速排序"><a href="#快速排序" class="headerlink" title="快速排序"></a>快速排序</h1><p>快速排序，Quicksort，又称分区交换排序（partition-exchange sort），简称快排，最早由<a href="https://zh.wikipedia.org/wiki/%E6%9D%B1%E5%B0%BC%C2%B7%E9%9C%8D%E7%88%BE">东尼·霍尔</a>提出。</p><p>快速排序通常明显比其他算法块，因为它的内部循环可以在大部分的架构上很有效率地达成。</p><p>快速排序算法执行流程：</p><ol><li><strong>挑选基准值</strong>：从数列中挑出一个元素，称为“基准”（pivot），</li><li><strong>分割</strong>：重新排序数列，所有比基准值小的元素摆放在基准前面，所有比基准值大的元素摆在基准后面（与基准值相等的数可以到任何一边）。在这个分割结束之后，对基准值的排序就已经完成，</li><li><strong>递归排序子序列</strong>：递归地将小于基准值元素的子序列和大于基准值元素的子序列排序。</li></ol><p>递归到最底部的判断条件是数列的大小是零或一，此时该数列显然已经有序。</p><p>选取基准值有数种具体方法，此选取方法对排序的时间性能有决定性影响。</p><h2 id="示意图"><a href="#示意图" class="headerlink" title="示意图"></a>示意图</h2><p><img src="https://tobing-markdown.oss-cn-shenzhen.aliyuncs.com/Sorting_quicksort_anim.gif" class="lazyload" data-srcset="https://tobing-markdown.oss-cn-shenzhen.aliyuncs.com/Sorting_quicksort_anim.gif" srcset="data:image/png;base64,666" alt="Sorting_quicksort_anim"></p><p>使用快速排序法对一列数字进行排序的过程</p><p><img src="https://tobing-markdown.oss-cn-shenzhen.aliyuncs.com/%E5%BF%AB%E6%8E%92.gif" class="lazyload" data-srcset="https://tobing-markdown.oss-cn-shenzhen.aliyuncs.com/%E5%BF%AB%E6%8E%92.gif" srcset="data:image/png;base64,666" alt="快排"></p><p>简单快排基本交换</p><p><img src="https://tobing-markdown.oss-cn-shenzhen.aliyuncs.com/%E5%BF%AB%E9%80%9F%E6%8E%92%E5%BA%8F%E6%B3%95%20.gif" class="lazyload" data-srcset="https://tobing-markdown.oss-cn-shenzhen.aliyuncs.com/%E5%BF%AB%E9%80%9F%E6%8E%92%E5%BA%8F%E6%B3%95%20.gif" srcset="data:image/png;base64,666" alt="快速排序法 "></p><p>简单快排最后交换</p><h2 id="复杂度"><a href="#复杂度" class="headerlink" title="复杂度"></a>复杂度</h2><table><thead><tr><th align="left">复杂度</th><th>值</th></tr></thead><tbody><tr><td align="left"><strong>平均时间复杂度</strong></td><td><strong>O(nlogn)</strong></td></tr><tr><td align="left"><strong>最坏时间复杂度</strong></td><td><strong>O(n^2)</strong></td></tr><tr><td align="left"><strong>最优时间复杂度</strong></td><td><strong>O(nlogn)</strong></td></tr><tr><td align="left"><strong>空间复杂度</strong></td><td><strong>根据实现的方式不同而不同</strong></td></tr><tr><td align="left">稳定性</td><td>不稳定</td></tr></tbody></table><h2 id="Java实现"><a href="#Java实现" class="headerlink" title="Java实现"></a>Java实现</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">QuickSort</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">sort</span><span class="params">(Comparable[] arr)</span> </span>&#123;</span><br><span class="line">        sort(arr, <span class="number">0</span>, arr.length - <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 递归对 arr[left...right] 排序</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> arr   数组</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> left  左边界</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> right 右边界</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">sort</span><span class="params">(Comparable[] arr, <span class="keyword">int</span> left, <span class="keyword">int</span> right)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (left &gt;= right) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">int</span> p = partition(arr, left, right);  <span class="comment">// 【&lt; segment，segment，&gt; segment】</span></span><br><span class="line">        sort(arr, left, p - <span class="number">1</span>);               <span class="comment">// 处理【&lt; segment】部分</span></span><br><span class="line">        sort(arr, p + <span class="number">1</span>, right);              <span class="comment">// 处理【&gt; segment】部分</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 对 arr[left...right] 进行 partition</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> arr   数组</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> left  左边界</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> right 右边界</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">partition</span><span class="params">(Comparable[] arr, <span class="keyword">int</span> left, <span class="keyword">int</span> right)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 选基准：此处每次选择最左边的元素</span></span><br><span class="line">        Comparable base = arr[left];</span><br><span class="line"></span><br><span class="line">        <span class="comment">// arr[left+1...segment] &lt; base ；arr[segment+1...i) &gt; base</span></span><br><span class="line">        <span class="keyword">int</span> segment = left;   <span class="comment">// j 是小于基值和大于基值的分界点</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = left + <span class="number">1</span>; i &lt;= right; i++) &#123; <span class="comment">// arr ==&gt; 【segment，&lt; segment，&gt; segment】</span></span><br><span class="line">            <span class="comment">// 对于比基准值小的值，放在segment所在的位置，segment索引递增</span></span><br><span class="line">            <span class="keyword">if</span> (arr[i].compareTo(base) &lt; <span class="number">0</span>) &#123;</span><br><span class="line">                segment++;</span><br><span class="line">                Comparable temp = arr[i];</span><br><span class="line">                arr[i] = arr[segment];</span><br><span class="line">                arr[segment] = temp;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 结束之后，将 base 放到 segment 位置</span></span><br><span class="line">        <span class="comment">// 【segment，&lt; segment，&gt; segment】 ==&gt; 【&lt; segment，segment，&gt; segment】</span></span><br><span class="line">        Comparable temp = arr[segment];</span><br><span class="line">        arr[segment] = arr[left];</span><br><span class="line">        arr[left] = temp;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 返回基准值所在的索引</span></span><br><span class="line">        <span class="keyword">return</span> segment;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>快排是东尼·霍尔提出的一种高级排序算法，主要流程有：<strong>选基准、分割、递归排序子序列</strong>三个过程。快速排序的平均和最优时间复杂度是O(nlogn)，最坏时间复杂度可达O(n^2)，是一种不稳定的排序算法。Java 主要排序方法为 java.util.Arrays.sort()，对于原始数据类型使用三向切分的快速排序。</p><h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul><li><p><a href="https://zh.wikipedia.org/zh/%E5%BF%AB%E9%80%9F%E6%8E%92%E5%BA%8F">快速排序-维基百科</a></p></li><li><p><a href="https://coding.imooc.com/class/chapter/71.html#Anchor">慕课网-玩转算法面试</a></p></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> 排序算法 </tag>
            
            <tag> 快速排序 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>排序算法-归并排序</title>
      <link href="2021/02/27/%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95-%E5%BD%92%E5%B9%B6%E6%8E%92%E5%BA%8F/"/>
      <url>2021/02/27/%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95-%E5%BD%92%E5%B9%B6%E6%8E%92%E5%BA%8F/</url>
      
        <content type="html"><![CDATA[<p>归并排序是一种高级排序算法，本文介绍了归并排序的 Java 实现。</p><a id="more"></a><h1 id="归并排序"><a href="#归并排序" class="headerlink" title="归并排序"></a>归并排序</h1><p>归并算法，Merge Sort，是建立在归并操作上的一种有效的排序算，时间复杂度为 <code>O(nlogn)</code>。</p><p>1945年由<a href="https://zh.wikipedia.org/wiki/%E7%BA%A6%E7%BF%B0%C2%B7%E5%86%AF%C2%B7%E8%AF%BA%E4%BC%8A%E6%9B%BC">约翰·冯·诺伊曼</a>首次提出。该算法是采用<a href="https://zh.wikipedia.org/wiki/%E5%88%86%E6%B2%BB%E6%B3%95">分治法</a>（Divide and Conquer）的一个非常典型的应用，且各层分治递归可以同时进行。</p><p>归并算法执行流程：</p><ol><li><p><strong>分割</strong>：递归地把当前序列平均分割成两半。</p></li><li><p><strong>集成</strong>：在保持元素顺序的同时将上一步得到的子序列集成到一起（归并）。</p></li></ol><h2 id="示意图"><a href="#示意图" class="headerlink" title="示意图"></a>示意图</h2><p><img src="https://tobing-markdown.oss-cn-shenzhen.aliyuncs.com/Merge_sort_animation2.gif" class="lazyload" data-srcset="https://tobing-markdown.oss-cn-shenzhen.aliyuncs.com/Merge_sort_animation2.gif" srcset="data:image/png;base64,666" alt="Merge_sort_animation2"></p><p>使用合并排序为一列数字进行排序的过程</p><p><img src="https://tobing-markdown.oss-cn-shenzhen.aliyuncs.com/Merge-sort-example-300px.gif" class="lazyload" data-srcset="https://tobing-markdown.oss-cn-shenzhen.aliyuncs.com/Merge-sort-example-300px.gif" srcset="data:image/png;base64,666" alt="Merge-sort-example-300px"></p><p>使用合并排序为一列数字进行排序的过程</p><h2 id="复杂度"><a href="#复杂度" class="headerlink" title="复杂度"></a>复杂度</h2><table><thead><tr><th align="left">复杂度</th><th>值</th></tr></thead><tbody><tr><td align="left"><strong>平均时间复杂度</strong></td><td><strong>O(nlogn)</strong></td></tr><tr><td align="left"><strong>最坏时间复杂度</strong></td><td><strong>O(nlogn)</strong></td></tr><tr><td align="left"><strong>最优时间复杂度</strong></td><td><strong>O(nlogn)</strong></td></tr><tr><td align="left"><strong>空间复杂度</strong></td><td><strong>O(n)</strong></td></tr><tr><td align="left">稳定性</td><td>稳定</td></tr></tbody></table><h2 id="Java-实现"><a href="#Java-实现" class="headerlink" title="Java 实现"></a>Java 实现</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MergeSort</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 对 arr进行排序</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> arr arr</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">sort</span><span class="params">(Comparable[] arr)</span> </span>&#123;</span><br><span class="line">        sort(arr, <span class="number">0</span>, arr.length - <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 为 arr[left...right] 的元素排序</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> arr   arr</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> left  左边界</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> right 右边界</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">sort</span><span class="params">(Comparable[] arr, <span class="keyword">int</span> left, <span class="keyword">int</span> right)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 如果只剩下一个元素，直接返回</span></span><br><span class="line">        <span class="keyword">if</span> (left &gt;= right) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 计算中点</span></span><br><span class="line">        <span class="keyword">int</span> mid = (left + right) &gt;&gt;&gt; <span class="number">1</span>;<span class="comment">// 相当于(left+right)/2 位运算要比除法效率高</span></span><br><span class="line">        sort(arr, left, mid);</span><br><span class="line">        sort(arr, mid + <span class="number">1</span>, right);</span><br><span class="line">        merge(arr, left, mid, right);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 将 arr[left...mid] 与 arr[mid+1...right] 两个子数组归并操作</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> arr   arr</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> left  左边界</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> mid   中心</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> right 右边界</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">merge</span><span class="params">(Comparable[] arr, <span class="keyword">int</span> left, <span class="keyword">int</span> mid, <span class="keyword">int</span> right)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 对子数组进行拷贝，便于比较归并</span></span><br><span class="line">        Comparable[] temp = Arrays.copyOfRange(arr, left, right + <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">int</span> i = left;</span><br><span class="line">        <span class="keyword">int</span> j = mid + <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> k = left; k &lt;= right; k++) &#123;</span><br><span class="line">            <span class="comment">// 左边子数组归并完毕</span></span><br><span class="line">            <span class="keyword">if</span> (i &gt; mid) &#123;</span><br><span class="line">                arr[k] = temp[j - left];</span><br><span class="line">                j++;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 右边子数组归并完毕</span></span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (j &gt; right) &#123;</span><br><span class="line">                arr[k] = temp[i - left];</span><br><span class="line">                i++;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 左边子数组所指元素 &gt; 右边子数组所指元素</span></span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (temp[i - left].compareTo(temp[j - left]) &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                arr[k] = temp[j - left];</span><br><span class="line">                j++;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 否则</span></span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                arr[k] = temp[i - left];</span><br><span class="line">                i++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>归并排序是由冯·诺依曼提出的一种高级排序算法，主要流程有：分割、集成两个过程。归并排序的平均、最坏、最好时间复杂度都是O(nlogn)，是一种稳定的排序算法。Java 主要排序方法为 java.util.Arrays.sort()，对于引用数据类型使用归并排序。</p><h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul><li><p><a href="https://zh.wikipedia.org/zh-hans/%E5%BD%92%E5%B9%B6%E6%8E%92%E5%BA%8F">归并排序-维基百科</a></p></li><li><p><a href="https://coding.imooc.com/class/chapter/71.html#Anchor">慕课网-玩转算法面试</a></p></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> 排序算法 </tag>
            
            <tag> 归并排序 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Github骚操作</title>
      <link href="2020/11/16/Github%E9%AA%9A%E6%93%8D%E4%BD%9C/"/>
      <url>2020/11/16/Github%E9%AA%9A%E6%93%8D%E4%BD%9C/</url>
      
        <content type="html"><![CDATA[<p>GitHub作为一个基于git的代码托管平台，具有全球海量的用户，其中也包含了很多价值极高的开源项目，接下来接受一下GitHub骚操作。</p><a id="more"></a><h1 id="Github骚操作"><a href="#Github骚操作" class="headerlink" title="Github骚操作"></a>Github骚操作</h1><h2 id="1-搜索"><a href="#1-搜索" class="headerlink" title="1. 搜索"></a>1. 搜索</h2><h3 id="范围搜索"><a href="#范围搜索" class="headerlink" title="范围搜索"></a>范围搜索</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">keyword <span class="keyword">in</span>:name<span class="comment"># 根据项目名搜索</span></span><br><span class="line">keyword <span class="keyword">in</span>:description<span class="comment"># 根据描述搜索</span></span><br><span class="line">keyword <span class="keyword">in</span>:readme<span class="comment"># 根据readme搜索</span></span><br><span class="line">keyword <span class="keyword">in</span>:name,description <span class="comment"># 混合搜索</span></span><br></pre></td></tr></table></figure><h3 id="根据stars、froks搜索"><a href="#根据stars、froks搜索" class="headerlink" title="根据stars、froks搜索"></a>根据stars、froks搜索</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">keyword stars:&gt;5000<span class="comment"># 搜索stars数&gt;5000</span></span><br><span class="line">keyword forks:&gt;1000<span class="comment"># 搜索forks数&gt;1000</span></span><br><span class="line">keyword stars:500..1000<span class="comment"># 搜索stars数在[500,1000]之间</span></span><br><span class="line">keyword forks:&gt;1000 stars:&gt;5000<span class="comment"># 组合</span></span><br></pre></td></tr></table></figure><h2 id="2-学习"><a href="#2-学习" class="headerlink" title="2. 学习"></a>2. 学习</h2><h3 id="教程"><a href="#教程" class="headerlink" title="教程"></a>教程</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">awesome java <span class="comment"># 精品推荐</span></span><br></pre></td></tr></table></figure><h3 id="项目内搜索代码"><a href="#项目内搜索代码" class="headerlink" title="项目内搜索代码"></a>项目内搜索代码</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">项目网页上直接输入：T</span><br></pre></td></tr></table></figure><h3 id="读代码"><a href="#读代码" class="headerlink" title="读代码"></a>读代码</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">url后紧跟<span class="comment">#L12            ## 指定行号为12</span></span><br><span class="line">url后紧跟<span class="comment">#L12-L20            ## 指定行号范围12-20</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看GroovyScriptController.java第13行代码</span></span><br><span class="line">https://github.com/...../springboot/web/GroovyScriptController.java<span class="comment">#L13  </span></span><br><span class="line"><span class="comment"># 查看GroovyScriptController.java第13行-20行</span></span><br><span class="line">https://github.com/...../springboot/web/GroovyScriptController.java<span class="comment">#L13-L20 </span></span><br></pre></td></tr></table></figure><h3 id="关注大佬"><a href="#关注大佬" class="headerlink" title="关注大佬"></a>关注大佬</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">location:beijing<span class="comment"># 寻找北京的用户</span></span><br><span class="line">language:java<span class="comment"># 寻找使用java的用户</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 工具使用 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> GitHub </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MySQL进阶-2-索引优化分析</title>
      <link href="2020/08/22/MySQL%E8%BF%9B%E9%98%B6-2-%E7%B4%A2%E5%BC%95%E4%BC%98%E5%8C%96%E5%88%86%E6%9E%90/"/>
      <url>2020/08/22/MySQL%E8%BF%9B%E9%98%B6-2-%E7%B4%A2%E5%BC%95%E4%BC%98%E5%8C%96%E5%88%86%E6%9E%90/</url>
      
        <content type="html"><![CDATA[<p>MySQL进阶第二弹。</p><a id="more"></a><h1 id="MySQL进阶-2-索引优化分析"><a href="#MySQL进阶-2-索引优化分析" class="headerlink" title="MySQL进阶-2-索引优化分析"></a>MySQL进阶-2-索引优化分析</h1><h2 id="1-导致SQL慢的原因"><a href="#1-导致SQL慢的原因" class="headerlink" title="1. 导致SQL慢的原因"></a>1. 导致SQL慢的原因</h2><ol><li>查询语句写的烂</li><li>（单值、复合）索引实现</li><li>关联查询太多join</li><li>服务器调优以及各参数的设置</li></ol><h2 id="2-常见通用的join查询"><a href="#2-常见通用的join查询" class="headerlink" title="2. 常见通用的join查询"></a>2. 常见通用的join查询</h2><h3 id="2-1-SQL执行顺序"><a href="#2-1-SQL执行顺序" class="headerlink" title="2.1 SQL执行顺序"></a>2.1 SQL执行顺序</h3><ol><li><p>SQL通用编写语法</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">distinct</span></span><br><span class="line">&lt;select_list&gt;</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">&lt;left_table&gt; &lt;<span class="keyword">join</span> <span class="keyword">type</span>&gt;</span><br><span class="line"></span><br><span class="line"><span class="keyword">join</span> &lt;right_table&gt; <span class="keyword">on</span> &lt;join_condition&gt;</span><br><span class="line"></span><br><span class="line"><span class="keyword">where</span> </span><br><span class="line">&lt;where_condition&gt;</span><br><span class="line"></span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> </span><br><span class="line">&lt;group_by_list&gt;</span><br><span class="line"></span><br><span class="line"><span class="keyword">having</span> </span><br><span class="line">&lt;having_condition&gt;</span><br><span class="line"></span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span></span><br><span class="line">&lt;order_by_condition&gt;</span><br><span class="line"></span><br><span class="line">limint &lt;limint_number&gt;</span><br></pre></td></tr></table></figure></li><li><p>机器读取顺序</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">from  &lt;left_table&gt;</span><br><span class="line">on  &lt;join_condition&gt;</span><br><span class="line">where  &lt;where_condition&gt;</span><br><span class="line">group by &lt;group_by_list&gt;</span><br><span class="line">having &lt;having_condition&gt;</span><br><span class="line"><span class="keyword">select</span></span><br><span class="line"><span class="keyword">distinct</span>  &lt;select_list&gt;</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> &lt;order_by_condition&gt;</span><br><span class="line">limint &lt;limint_number&gt;</span><br></pre></td></tr></table></figure><p><img src="https://gitee.com/tobing/imagebed/raw/master/1597149848138.png" class="lazyload" data-srcset="https://gitee.com/tobing/imagebed/raw/master/1597149848138.png" srcset="data:image/png;base64,666" alt="底层读取顺序"></p></li></ol><h3 id="2-2-7种Join"><a href="#2-2-7种Join" class="headerlink" title="2.2 7种Join"></a>2.2 7种Join</h3><h4 id="2-2-1-示意图"><a href="#2-2-1-示意图" class="headerlink" title="2.2.1 示意图"></a>2.2.1 示意图</h4><p><img src="https://gitee.com/tobing/imagebed/raw/master/1597151133049.png" class="lazyload" data-srcset="https://gitee.com/tobing/imagebed/raw/master/1597151133049.png" srcset="data:image/png;base64,666" alt="1597151133049"></p><h4 id="2-2-2-示例"><a href="#2-2-2-示例" class="headerlink" title="2.2.2 示例"></a>2.2.2 示例</h4><ol><li><p>建表</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 创建数据库</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">DATABASE</span> mysq;</span><br><span class="line"><span class="keyword">USE</span> mysq;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 创建部门表</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`t_dept`</span>( </span><br><span class="line">    <span class="string">`id`</span><span class="built_in">INT</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT, </span><br><span class="line">    <span class="string">`deptName`</span><span class="built_in">VARCHAR</span>(<span class="number">30</span>)<span class="keyword">DEFAULT</span> <span class="literal">NULL</span>, </span><br><span class="line">    <span class="string">`address`</span><span class="built_in">VARCHAR</span>(<span class="number">40</span>)<span class="keyword">DEFAULT</span> <span class="literal">NULL</span>, </span><br><span class="line">    PRIMARY <span class="keyword">KEY</span>(<span class="string">`id`</span>)</span><br><span class="line">)<span class="keyword">ENGINE</span>=<span class="keyword">INNODB</span> AUTO_INCREMENT=<span class="number">1</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8; </span><br><span class="line"></span><br><span class="line"><span class="comment">-- 创建员工表</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`t_emp`</span>( </span><br><span class="line">    <span class="string">`id`</span><span class="built_in">INT</span>(<span class="number">11</span>)<span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT, </span><br><span class="line">    <span class="string">`name`</span><span class="built_in">VARCHAR</span>(<span class="number">20</span>)<span class="keyword">DEFAULT</span> <span class="literal">NULL</span>, </span><br><span class="line">    <span class="string">`age`</span><span class="built_in">INT</span>(<span class="number">3</span>)<span class="keyword">DEFAULT</span> <span class="literal">NULL</span>, </span><br><span class="line">    <span class="string">`deptId`</span><span class="built_in">INT</span>(<span class="number">11</span>)<span class="keyword">DEFAULT</span> <span class="literal">NULL</span>, </span><br><span class="line">    empno <span class="built_in">INT</span> <span class="keyword">NOT</span> <span class="literal">NULL</span>, PRIMARY <span class="keyword">KEY</span>(<span class="string">`id`</span>), </span><br><span class="line"><span class="keyword">KEY</span><span class="string">`idx_dept_id`</span>(<span class="string">`deptId`</span>) </span><br><span class="line"><span class="comment">#CONSTRAINT`fk_dept_id`FOREIGNKEY(`deptId`)REFERENCES`t_dept`(`id`) </span></span><br><span class="line">)<span class="keyword">ENGINE</span>=<span class="keyword">INNODB</span> AUTO_INCREMENT=<span class="number">1</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8; </span><br><span class="line"></span><br><span class="line"><span class="comment">-- 插入数据</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> t_dept(deptName,address)<span class="keyword">VALUES</span>(<span class="string">&#x27;华山&#x27;</span>,<span class="string">&#x27;华山&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> t_dept(deptName,address)<span class="keyword">VALUES</span>(<span class="string">&#x27;丐帮&#x27;</span>,<span class="string">&#x27;洛阳&#x27;</span>); </span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> t_dept(deptName,address)<span class="keyword">VALUES</span>(<span class="string">&#x27;峨眉&#x27;</span>,<span class="string">&#x27;峨眉山&#x27;</span>); </span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> t_dept(deptName,address)<span class="keyword">VALUES</span>(<span class="string">&#x27;武当&#x27;</span>,<span class="string">&#x27;武当山&#x27;</span>); </span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> t_dept(deptName,address)<span class="keyword">VALUES</span>(<span class="string">&#x27;明教&#x27;</span>,<span class="string">&#x27;光明顶&#x27;</span>); </span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> t_dept(deptName,address)<span class="keyword">VALUES</span>(<span class="string">&#x27;少林&#x27;</span>,<span class="string">&#x27;少林寺&#x27;</span>); </span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> t_emp(<span class="keyword">NAME</span>,age,deptId,empno)<span class="keyword">VALUES</span>(<span class="string">&#x27;风清扬&#x27;</span>,<span class="number">90</span>,<span class="number">1</span>,<span class="number">100001</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> t_emp(<span class="keyword">NAME</span>,age,deptId,empno)<span class="keyword">VALUES</span>(<span class="string">&#x27;岳不群&#x27;</span>,<span class="number">50</span>,<span class="number">1</span>,<span class="number">100002</span>); </span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> t_emp(<span class="keyword">NAME</span>,age,deptId,empno)<span class="keyword">VALUES</span>(<span class="string">&#x27;令狐冲&#x27;</span>,<span class="number">24</span>,<span class="number">1</span>,<span class="number">100003</span>); </span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> t_emp(<span class="keyword">NAME</span>,age,deptId,empno)<span class="keyword">VALUES</span>(<span class="string">&#x27;洪七公&#x27;</span>,<span class="number">70</span>,<span class="number">2</span>,<span class="number">100004</span>); </span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> t_emp(<span class="keyword">NAME</span>,age,deptId,empno)<span class="keyword">VALUES</span>(<span class="string">&#x27;乔峰&#x27;</span>,<span class="number">35</span>,<span class="number">2</span>,<span class="number">100005</span>); </span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> t_emp(<span class="keyword">NAME</span>,age,deptId,empno)<span class="keyword">VALUES</span>(<span class="string">&#x27;灭绝师太&#x27;</span>,<span class="number">70</span>,<span class="number">3</span>,<span class="number">100006</span>); </span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> t_emp(<span class="keyword">NAME</span>,age,deptId,empno)<span class="keyword">VALUES</span>(<span class="string">&#x27;周芷若&#x27;</span>,<span class="number">20</span>,<span class="number">3</span>,<span class="number">100007</span>); </span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> t_emp(<span class="keyword">NAME</span>,age,deptId,empno)<span class="keyword">VALUES</span>(<span class="string">&#x27;张三丰&#x27;</span>,<span class="number">100</span>,<span class="number">4</span>,<span class="number">100008</span>); </span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> t_emp(<span class="keyword">NAME</span>,age,deptId,empno)<span class="keyword">VALUES</span>(<span class="string">&#x27;张无忌&#x27;</span>,<span class="number">25</span>,<span class="number">5</span>,<span class="number">100009</span>); </span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> t_emp(<span class="keyword">NAME</span>,age,deptId,empno)<span class="keyword">VALUES</span>(<span class="string">&#x27;韦小宝&#x27;</span>,<span class="number">18</span>,<span class="literal">NULL</span>,<span class="number">100010</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li><p>测试案例</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 【交集】所有有门派人员的信息（要求显示门派名称）</span></span><br><span class="line"><span class="keyword">SELECT</span> e.<span class="string">`name`</span>,d.<span class="string">`deptName`</span> <span class="keyword">FROM</span> t_emp e <span class="keyword">INNER</span> <span class="keyword">JOIN</span> t_dept d <span class="keyword">ON</span> e.<span class="string">`deptId`</span> = d.<span class="string">`id`</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 【全A】列出所有人员及其门派信息</span></span><br><span class="line"><span class="keyword">SELECT</span> e.<span class="string">`name`</span>, d.<span class="string">`deptName`</span> <span class="keyword">FROM</span> t_emp e <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> t_dept d <span class="keyword">ON</span> e.<span class="string">`deptId`</span> = d.<span class="string">`id`</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 【全B】列出所有门派</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> t_dept;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 【A特】所有无门派人士</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> t_emp <span class="keyword">WHERE</span> deptId <span class="keyword">IS</span> <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 【B特】所有无人门派</span></span><br><span class="line"><span class="keyword">SELECT</span> e.<span class="string">`name`</span>,d.<span class="string">`deptName`</span> <span class="keyword">FROM</span> t_emp e <span class="keyword">RIGHT</span> <span class="keyword">JOIN</span> t_dept d <span class="keyword">ON</span> e.<span class="string">`deptId`</span> = d.<span class="string">`id`</span> <span class="keyword">WHERE</span> e.<span class="string">`name`</span> <span class="keyword">IS</span> <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 【全部】所有人员和门派的对应关系</span></span><br><span class="line"><span class="keyword">SELECT</span> e.<span class="string">`name`</span>,d.<span class="string">`deptName`</span> <span class="keyword">FROM</span> t_emp e <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> t_dept d <span class="keyword">ON</span> e.<span class="string">`deptId`</span> = d.<span class="string">`id`</span></span><br><span class="line"><span class="keyword">UNION</span></span><br><span class="line"><span class="keyword">SELECT</span> e.<span class="string">`name`</span>,d.<span class="string">`deptName`</span> <span class="keyword">FROM</span> t_emp e <span class="keyword">RIGHT</span> <span class="keyword">JOIN</span> t_dept d <span class="keyword">ON</span> e.<span class="string">`deptId`</span> = d.<span class="string">`id`</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--  【A特和B特】所有没有入门派的人员和没人入的门派</span></span><br><span class="line"><span class="keyword">SELECT</span> e.<span class="string">`name`</span>,d.<span class="string">`deptName`</span> <span class="keyword">FROM</span> t_emp e <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> t_dept d <span class="keyword">ON</span> e.<span class="string">`deptId`</span> = d.<span class="string">`id`</span> <span class="keyword">WHERE</span> d.<span class="string">`deptName`</span> <span class="keyword">IS</span>  <span class="literal">NULL</span></span><br><span class="line"><span class="keyword">UNION</span></span><br><span class="line"><span class="keyword">SELECT</span> e.<span class="string">`name`</span>,d.<span class="string">`deptName`</span> <span class="keyword">FROM</span> t_emp e <span class="keyword">RIGHT</span> <span class="keyword">JOIN</span> t_dept d <span class="keyword">ON</span> e.<span class="string">`deptId`</span> = d.<span class="string">`id`</span> <span class="keyword">WHERE</span> e.<span class="string">`name`</span> <span class="keyword">IS</span>  <span class="literal">NULL</span></span><br></pre></td></tr></table></figure></li></ol><h2 id="3-索引简介"><a href="#3-索引简介" class="headerlink" title="3. 索引简介"></a>3. 索引简介</h2><h3 id="3-1-是什么"><a href="#3-1-是什么" class="headerlink" title="3.1 是什么"></a>3.1 是什么</h3><p>​    <strong>索引（index）是帮助MySQL实现高效获取数据的数据结构。</strong></p><p>​    我们可以简单理解为：<strong>排好序的快速查找数据结构</strong>。数据库系统维护着满足特定查找算法的数据结构，这些数据结构一某种方式引用数据，这样就可以在这些数据结构上实现高级查找算法。这便是索引。</p><p><img src="https://gitee.com/tobing/imagebed/raw/master/%E6%97%A0%E6%A0%87%E9%A2%98.png" class="lazyload" data-srcset="https://gitee.com/tobing/imagebed/raw/master/%E6%97%A0%E6%A0%87%E9%A2%98.png" srcset="data:image/png;base64,666" alt="无标题"></p><p>​    上图中，为了加快Col2的查找，可以维护右边所示的二叉查找树，每个节点分别包含索引键值和一个指向对应数据记录物理地址的指针，这样既可以运用二叉查找树在一定复杂度内获取相应数据，从而快速索引出符合条件的记录。</p><p>​    一般来说，索引本身很大，不可能全部存储到内存中，因此索引往往以文件的形式保存在硬盘中。平时我们提到的索引，如果没有特别说明都是指的是B树（多路搜索树，并不一定是二叉树）结构组织的索引。其中聚集索引、次要索引、覆盖索引、符合索引、前缀索引、唯一索引都是使用B+树索引，统称索引。处理B+树索引还有哈希索引等。</p><h3 id="3-2-索引优势"><a href="#3-2-索引优势" class="headerlink" title="3.2 索引优势"></a>3.2 索引优势</h3><p>​    类似大学图书馆建立书目索引，索引可以提高数据检索效率，降低数据库IO成本。通过建立索引还会对数据进行排序，降低数据排序成本，减少CPU的消耗。</p><h3 id="3-3-索引劣势"><a href="#3-3-索引劣势" class="headerlink" title="3.3 索引劣势"></a>3.3 索引劣势</h3><p>​    索引实际上是一张表，保存了主键和索引字段，并指向实体表的记录，所以需要占用一定空间。</p><p>​    索引虽然提高了查询速度，但是会降低更新表的速度，如果对表进行insert、update和delete，MySQL不仅要存数据，还要保存胰腺癌丝印文件每次更新添加了索引列的字段，都会调整因为更新而带来的键值变化后的索引信息。</p><p>​    索引只是提高效率的一个因素，如果你的MySQL有大数据量的表，就要花时间在研究优秀的索引，或者优化查询语句。</p><h3 id="3-4-索引分类"><a href="#3-4-索引分类" class="headerlink" title="3.4 索引分类"></a>3.4 索引分类</h3><p>​    索引又分为：单值索引、唯一索引、复合索引等。</p><ol><li>单值索引：一个索引只包含单个列、一个表可以有多个单列索引。</li><li>唯一索引：索引的值必须唯一，但允许有空值。</li><li>符合索引：一个索引包含多个列。</li></ol><h3 id="3-5-索引使用"><a href="#3-5-索引使用" class="headerlink" title="3.5 索引使用"></a>3.5 索引使用</h3><ol><li><p>创建索引</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 方式1</span></span><br><span class="line"><span class="keyword">create</span> [<span class="keyword">unique</span>] <span class="keyword">index</span> indexName <span class="keyword">on</span> mytable(collumname(<span class="keyword">length</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 方式2</span></span><br><span class="line"><span class="keyword">alter</span> mytable <span class="keyword">add</span> [<span class="keyword">unique</span>] <span class="keyword">index</span> [indexname] <span class="keyword">on</span> (columname(<span class="keyword">lenght</span>))</span><br></pre></td></tr></table></figure></li><li><p>删除</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">index</span> [indexName] <span class="keyword">on</span> mytable</span><br></pre></td></tr></table></figure></li><li><p>查看索引</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> <span class="keyword">index</span> <span class="keyword">from</span> table_name</span><br></pre></td></tr></table></figure></li><li><p>添加</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 添加逐渐、意味着索引值必须唯一，且不能为null</span></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> tb_name <span class="keyword">add</span> primary <span class="keyword">key</span> (column_list)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 创建索引值必须唯一（Null可以出现多次）</span></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> tb_name <span class="keyword">add</span> <span class="keyword">unique</span> index_name (column_list)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 添加普通索引，索引值可能出现多次</span></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> tb_name <span class="keyword">add</span> <span class="keyword">index</span> indx_name(column_list)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 指定索引为FullText、用于全文索引</span></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> tb_name <span class="keyword">add</span> fulltext index_name(column_list)</span><br></pre></td></tr></table></figure></li></ol><h3 id="3-6-索引结构"><a href="#3-6-索引结构" class="headerlink" title="3.6 索引结构"></a>3.6 索引结构</h3><ol><li><p>BTree索引</p><p>​    BTree索引（Balanced Tree），是一种很普遍的数据库索引结构，是oracle默认的索引结构类型。其特点是定位高效、利用率高、自我平衡，特别适用于高基数字段，定位单条或小范围数据非常高效。理论上，适用BTree在亿条数据与100条数据中定位记录花销相同。BTree索引的数据结构如下图：</p><p><img src="https://gitee.com/tobing/imagebed/raw/master/1597285909182.png" class="lazyload" data-srcset="https://gitee.com/tobing/imagebed/raw/master/1597285909182.png" srcset="data:image/png;base64,666" alt="1597285909182"></p><p>​    BTree索引的主要特点：</p><ul><li><p>树形结构：有根节点（root）、分支（branches）、叶（leaves）三级节点组成，其中分支节点可以有多层。</p></li><li><p>多分支结构：与binary tree 不同，BTree索引中一个root、branch可以有多个子节点（超过2个）。</p></li><li><p>双向链表：整个叶子节点部分是一个双向链表</p></li></ul></li><li><p>Hash索引【了解】</p></li><li><p>Full-Text索引【了解】</p></li><li><p>R-Tree索引【了解】</p></li></ol><h3 id="3-7-创建索引的场景"><a href="#3-7-创建索引的场景" class="headerlink" title="3.7 创建索引的场景"></a>3.7 创建索引的场景</h3><ol><li>主键自动创建索引</li><li>频繁作为查询条件的字段应该创建索引</li><li>查询中与其他表关联的字段，外加关系建立索引</li><li>查询中排序的字段时候创建索引，排序字段若通过索引去访问将大大提高排序速度</li><li>查询中统计或者分组字段</li></ol><h3 id="3-8-不创建索引的场景"><a href="#3-8-不创建索引的场景" class="headerlink" title="3.8 不创建索引的场景"></a>3.8 不创建索引的场景</h3><ol><li>表记录太少（没必要）</li><li>经常增删改的表</li><li>数据重复且分布平均的表字段</li><li>where条件用不到的字段</li></ol><h2 id="4-索引性能分析"><a href="#4-索引性能分析" class="headerlink" title="4. 索引性能分析"></a>4. 索引性能分析</h2><h3 id="4-1-MySQL-Query-Optimizer"><a href="#4-1-MySQL-Query-Optimizer" class="headerlink" title="4.1 MySQL Query Optimizer"></a>4.1 MySQL Query Optimizer</h3><ol><li>MySQL中专门负责优化SELECT语句的优化器模块，主要功能：通过计算分析系统中收集到的统计信息，为客户端请求的Query提供他任务最优的计划</li></ol><ol start="2"><li>客户端向MySQL请求一条Query，命令解析器模块完成请求分类，区别出是SELECT并转发给MySQL Query Optimizer是，MySQL Query Optimizer会将整条Query进行优化，处理掉一些常量表达式的预算，直接换成常量值，并对Query中的查询条件进行简化和转换如去掉一些无用或显而易见的条件、结构调整等。然后分析Query中的Hint信息，看现实Hint信息是否可以完全确定Query的执行计划。如果没Hint或Hint还不足以完全确定该Query的执行计划，则会读取涉及对象的统计信息，根据Query进行写相应计算分析，然后在得出最后的执行计划。</li></ol><h3 id="4-2-MySQl常见瓶颈"><a href="#4-2-MySQl常见瓶颈" class="headerlink" title="4.2 MySQl常见瓶颈"></a>4.2 MySQl常见瓶颈</h3><ol><li>CPU：CPU饱和一般发生在数据装入内存或从磁盘上读取数据</li><li>IO：磁盘I/O瓶颈发生在装入数据远大于内存容量</li><li>服务器硬件：top、free、iostat和vmstat等查看系统性能状态</li></ol><h3 id="4-3-Explain"><a href="#4-3-Explain" class="headerlink" title="4.3 Explain"></a>4.3 Explain</h3><ol><li><p>定义</p><p>​    可以使用Explain来模拟优化器执行SQL语句，从而知道MySQL是如何处理你的SQL语句，进而分析查询语句或者结构性能瓶颈。</p></li><li><p>用处</p><p>​    查看<strong>表的读取顺序、数据读取操作的操作类型、那些索引可用、那些索引被实际使用，表之间的引用，每张表有多少行被优化器执行</strong>。</p></li><li><p>用法</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">explain</span> <span class="keyword">sql</span>语句</span><br></pre></td></tr></table></figure><p>返回信息</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">+----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+-------+</span><br><span class="line">| id | select_type | table | partitions | type | possible_keys | key  | key_len | ref  | rows | filtered | Extra |</span><br><span class="line">+----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+-------+</span><br><span class="line">|  1 | SIMPLE      | user  | NULL       | ALL  | NULL          | NULL | NULL    | NULL |    6 |   100.00 | NULL  |</span><br><span class="line">+----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+-------+</span><br><span class="line"></span><br></pre></td></tr></table></figure></li></ol><h3 id="4-4-Explain-字段详情"><a href="#4-4-Explain-字段详情" class="headerlink" title="4.4 Explain 字段详情"></a>4.4 Explain 字段详情</h3><ol><li><p>id</p><p>​        <strong>id是SELECT查询的序列号，包含一组数字，表示查询中执行SELECT子句或者操作表的顺序。</strong>通常包含3中情况：</p><p>【1】id相同，执行顺序由上而下</p><img src="/images/1597322406715.png" class="lazyload" data-srcset="/images/1597322406715.png" srcset="data:image/png;base64,666" alt="1597322406715" style="zoom:150%;" /><p>【2】id不同，如果是子查询，id序号会递增，id值越大，优先级越高，越先执行。</p><img src="/images/1597322426189.png" class="lazyload" data-srcset="/images/1597322426189.png" srcset="data:image/png;base64,666" alt="1597322426189" style="zoom:150%;" /><p>【3】id相同和不同并存</p></li></ol><img src="https://gitee.com/tobing/imagebed/raw/master/1597322445848.png" class="lazyload" data-srcset="https://gitee.com/tobing/imagebed/raw/master/1597322445848.png" srcset="data:image/png;base64,666" alt="1597322445848" style="zoom:150%;" /><ol start="2"><li><p>select_type</p><p>​        select_type，查询类型，主要用于区别普通查询、联合查询、子查询等复杂查询，一共有6种，包含了：</p><ul><li>SIMPLE：简单SELECT查询，查询中不包含子查询或者union</li><li>PRIMARY：查询中若包含了任何复杂的子部分，最外层查询则会被标记为Primary</li><li>SUBQUERY：在SELECT或者WHERE列表中包含了子查询</li><li>DERIVED：在FROM列表中包含的子查询会被标注为DERIVED（衍生）MySQL会递归执行这些子查询，把结果放在临时表</li><li>UNION：若第二个SELECT出现union之后，则会被标记为union；若union包含在from的子查询中，外层SELECT将被标记为DERIVED。</li><li>UNION RESULT：从union表活动结果的SELECT</li></ul></li></ol><ol start="3"><li><p>table</p><p>​        显示一行的数据是关于哪张表的</p></li></ol><ol start="4"><li><p>type</p><p>​        type显示的是访问类型，是较为重要的一项指标，，结果值从好到坏依次是：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">system &gt; const &gt; eq_ref &gt; ref &gt; fulltext &gt; ref_or_null &gt; index_merge &gt; unique_subquery &gt; index_subquery &gt; range &gt; index &gt; ALL</span><br></pre></td></tr></table></figure><blockquote><p>我们一般只需要记得：system &gt; const &gt; eq_ref &gt; ref &gt; range &gt; index &gt; ALL</p><p>一般来说保证达到range、最好到ref。</p></blockquote><table><thead><tr><th>类型</th><th align="left">说明</th></tr></thead><tbody><tr><td>system</td><td align="left">表中只有一行，是const类型特例，平时不会出现，可以忽略不计。</td></tr><tr><td>const</td><td align="left">表示通过索引一次就能找到，用于比较primary key或unique索引。因为只匹配一行，所以很快。</td></tr><tr><td>eq_ref</td><td align="left">唯一性索引，对于每个索引键，表中只有一条记录与之匹配，常见于主键或唯一索引。</td></tr><tr><td>ref</td><td align="left">非唯一索引，返回匹配某个单独值的所有行。本质上也是索引访问，他返回所有匹配单个值的行，然而可以会有多个符合条件的行。</td></tr><tr><td>range</td><td align="left">检索给定范围，使用一个索引选择行。一般where中出现between、&gt;、&lt;、in等。</td></tr><tr><td>index</td><td align="left">Full Index Scan，与ALL区别是index类型只遍历索引数。索引文件比数据文件小，读取比ALL快。</td></tr><tr><td>all</td><td align="left">Full Table Scan，将遍历全表以找到匹配的行。</td></tr></tbody></table></li></ol><ol start="5"><li><p>possible_keys</p><p>​        显示可能应用到这张表的索引，一个或者多个；查询涉及的字段若存在索引，则该索引将会被列出，但<strong>不一定被查询实际使用</strong>。</p></li></ol><ol start="6"><li><p>key</p><p>​        实际使用的索引。如果为null，则没有使用索引。查询中若使用了覆盖索引，则索引和查询的SELECT字段你重叠。</p></li></ol><ol start="7"><li><p>key_len</p><p>​        表示索引中使用的字节数，可以通过计算查询中使用的索引的长度。在不损失精确性的情况下，长度越短越好；key_len显示的值为索引最大可能长度，并非实际使用长度，即key_len是根据表定义计算而得，不是通过表内检索出的。</p></li></ol><ol start="8"><li><p>ref</p><p>​        显示索引那一列被使用了，如果可能的话，是一个常数。那些列或常量被用于查找索引列上的值。</p></li></ol><ol start="9"><li><p>rows</p><p>​        根据表统计信息及索引选用情况，大致估算出找到所需的记录所需要读取的行数</p></li></ol><ol start="10"><li><p>Extra</p><p>​        包含不适合在其他列中显示但十分重要的额外信息.</p></li></ol><h3 id="4-5-Explain测试"><a href="#4-5-Explain测试" class="headerlink" title="4.5 Explain测试"></a>4.5 Explain测试</h3><ol><li><p>阐述下图的执行顺序</p><img src="https://gitee.com/tobing/imagebed/raw/master/1597482346266.png" class="lazyload" data-srcset="https://gitee.com/tobing/imagebed/raw/master/1597482346266.png" srcset="data:image/png;base64,666" alt="1597482346266" style="zoom:150%;" /></li><li><p>执行顺序</p><p>​    【1】第四行（selec name，id from t2），select_type为union、说明第三个select是union里面的第二个select。</p><p>​    【2】第二行（selec id，name from t1 wehre ohter_column = ‘ ’），查询包含在from，因此是衍生表DERIVED。</p><p>​    【3】第三行（select id from t3)，违章查询，说为整个查询的第二个select。</p><p>​    【4】第一行（select d1.name ….），表示union里面的第一个select，select_type为primary 表示该查询为外层查询，table列被标记为derived3说明查询结果来着一个衍生表，3表示衍生来自第三个查询。</p><p>​    【5】第五行（…union…）代表从union的临时表中读取行的阶段，table列的union1,4代表用第一个好第四个select结果进行union。</p></li></ol><h2 id="5-索引优化"><a href="#5-索引优化" class="headerlink" title="5. 索引优化"></a>5. 索引优化</h2><h3 id="5-0-数据准备"><a href="#5-0-数据准备" class="headerlink" title="5.0 数据准备"></a>5.0 数据准备</h3><ol><li><p>建表语句</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">DATABASE</span> sqlplus;</span><br><span class="line"><span class="keyword">USE</span> sqlplus;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 创建部门表</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span><span class="string">`dept`</span>(</span><br><span class="line"><span class="string">`id`</span><span class="built_in">INT</span>(<span class="number">11</span>)<span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT,</span><br><span class="line"><span class="string">`deptName`</span><span class="built_in">VARCHAR</span>(<span class="number">30</span>)<span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line"><span class="string">`address`</span><span class="built_in">VARCHAR</span>(<span class="number">40</span>)<span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">ceo <span class="built_in">INT</span> <span class="literal">NULL</span>, PRIMARY <span class="keyword">KEY</span>(<span class="string">`id`</span>)</span><br><span class="line">)<span class="keyword">ENGINE</span>=<span class="keyword">INNODB</span> AUTO_INCREMENT=<span class="number">1</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 创建员工表</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span><span class="string">`emp`</span>(</span><br><span class="line"><span class="string">`id`</span><span class="built_in">INT</span>(<span class="number">11</span>)<span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT,</span><br><span class="line"><span class="string">`empno`</span><span class="built_in">INT</span> <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line"><span class="string">`name`</span><span class="built_in">VARCHAR</span>(<span class="number">20</span>)<span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line"><span class="string">`age`</span><span class="built_in">INT</span>(<span class="number">3</span>)<span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line"><span class="string">`deptId`</span><span class="built_in">INT</span>(<span class="number">11</span>)<span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">PRIMARY <span class="keyword">KEY</span>(<span class="string">`id`</span>)</span><br><span class="line"><span class="comment">#CONSTRAINT`fk_dept_id`FOREIGNKEY(`deptId`)REFERENCES`t_dept`(`id`)</span></span><br><span class="line">)<span class="keyword">ENGINE</span>=<span class="keyword">INNODB</span> AUTO_INCREMENT=<span class="number">1</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8;</span><br></pre></td></tr></table></figure></li><li><p>设置参数</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 设置参数</span></span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">VARIABLES</span> <span class="keyword">LIKE</span> <span class="string">&#x27;log_bin_trust_function_creators&#x27;</span>;</span><br><span class="line"><span class="keyword">SET</span> <span class="keyword">GLOBAL</span> log_bin_trust_function_creators = <span class="number">1</span>;</span><br></pre></td></tr></table></figure></li><li><p>编写函数用于生产随机字符串</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 产生随机字符串</span></span><br><span class="line">DELIMITER $$</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">FUNCTION</span> rand_string(n <span class="built_in">INT</span>)<span class="keyword">RETURNS</span> <span class="built_in">VARCHAR</span>(<span class="number">255</span>)</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line"><span class="keyword">DECLARE</span> chars_str <span class="built_in">VARCHAR</span>(<span class="number">100</span>)<span class="keyword">DEFAULT</span> <span class="string">&#x27;abcdefghijklmnopqrstuvwxyzABCDEFJHIJKLMNOPQRSTUVWXYZ&#x27;</span>;</span><br><span class="line"><span class="keyword">DECLARE</span> return_str <span class="built_in">VARCHAR</span>(<span class="number">255</span>)<span class="keyword">DEFAULT</span><span class="string">&#x27; &#x27;</span>;</span><br><span class="line"><span class="keyword">DECLARE</span> i <span class="built_in">INT</span> <span class="keyword">DEFAULT</span> <span class="number">0</span>;</span><br><span class="line">WHILE i &lt; n DO</span><br><span class="line"><span class="keyword">SET</span> return_str=<span class="keyword">CONCAT</span>(return_str,<span class="keyword">SUBSTRING</span>(chars_str,<span class="keyword">FLOOR</span>(<span class="number">1</span>+<span class="keyword">RAND</span>()*<span class="number">52</span>),<span class="number">1</span>));</span><br><span class="line"><span class="keyword">SET</span> i=i+<span class="number">1</span>;</span><br><span class="line"><span class="keyword">END</span> <span class="keyword">WHILE</span>;</span><br><span class="line">RETURN return_str;</span><br><span class="line"><span class="keyword">END</span> $$</span><br></pre></td></tr></table></figure></li><li><p>随机生产部门编号</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 随机产生部门编号</span></span><br><span class="line">DELIMITER $$</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">FUNCTION</span> rand_num(from_num <span class="built_in">INT</span>,to_num <span class="built_in">INT</span>)<span class="keyword">RETURNS</span> <span class="built_in">INT</span>(<span class="number">11</span>)</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line"><span class="keyword">DECLARE</span> i <span class="built_in">INT</span> <span class="keyword">DEFAULT</span> <span class="number">0</span>;</span><br><span class="line"><span class="keyword">SET</span> i=<span class="keyword">FLOOR</span>(from_num+<span class="keyword">RAND</span>()*(to_num-from_num+<span class="number">1</span>)) ;</span><br><span class="line">RETURN i;</span><br><span class="line"><span class="keyword">END</span> $$</span><br></pre></td></tr></table></figure></li><li><p>编写存储过程用于给emp表插入数据</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">DELIMITER $$</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> insert_emp( <span class="keyword">START</span> <span class="built_in">INT</span>, max_num <span class="built_in">INT</span>)</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line"><span class="keyword">DECLARE</span> i <span class="built_in">INT</span> <span class="keyword">DEFAULT</span> <span class="number">0</span>;</span><br><span class="line"><span class="comment">-- setautocommit=0 把 autocommit 设置成 0</span></span><br><span class="line"><span class="keyword">SET</span> autocommit = <span class="number">0</span>;</span><br><span class="line">REPEAT</span><br><span class="line"><span class="keyword">SET</span> i=i+<span class="number">1</span>;</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> emp (empno, <span class="keyword">NAME</span> ,age ,deptid ) <span class="keyword">VALUES</span> ((<span class="keyword">START</span>+i) ,rand_string(<span class="number">6</span>) , rand_num(<span class="number">30</span>,<span class="number">50</span>),rand_num(<span class="number">1</span>,<span class="number">10000</span>));</span><br><span class="line">UNTIL i=max_num</span><br><span class="line"><span class="keyword">END</span> <span class="keyword">REPEAT</span>;</span><br><span class="line"><span class="keyword">COMMIT</span>;</span><br><span class="line"><span class="keyword">END</span> $$</span><br><span class="line"><span class="comment">-- 删除 </span></span><br><span class="line"><span class="comment">-- DELIMITER; </span></span><br><span class="line"><span class="comment">-- dropPROCEDUREinsert_emp;</span></span><br></pre></td></tr></table></figure></li><li><p>编写存储过程用于给dept表插入数据</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 执行存储过程，往 dept 表添加随机数据</span></span><br><span class="line">DELIMITER $$</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span><span class="string">`insert_dept`</span>( max_num <span class="built_in">INT</span>)</span><br><span class="line"><span class="keyword">BEGIN</span> <span class="keyword">DECLARE</span> i <span class="built_in">INT</span> <span class="keyword">DEFAULT</span> <span class="number">0</span>;</span><br><span class="line"><span class="keyword">SET</span> autocommit=<span class="number">0</span>;</span><br><span class="line">REPEAT <span class="keyword">SET</span> i=i+<span class="number">1</span>;</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> dept(deptname,address,ceo)<span class="keyword">VALUES</span>(rand_string(<span class="number">8</span>),rand_string(<span class="number">10</span>),rand_num(<span class="number">1</span>,<span class="number">500000</span>));</span><br><span class="line">UNTIL i=max_num</span><br><span class="line"><span class="keyword">END</span> <span class="keyword">REPEAT</span>;</span><br><span class="line"><span class="keyword">COMMIT</span>;</span><br><span class="line"><span class="keyword">END</span> $$</span><br><span class="line"><span class="comment">-- 删除</span></span><br><span class="line"><span class="comment">-- DELIMITER;</span></span><br><span class="line"><span class="comment">-- dropPROCEDUREinsert_dept;</span></span><br></pre></td></tr></table></figure></li><li><p>调用存储过程，插入数据</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 执行存储过程，往 dept 表添加 1 万条数据</span></span><br><span class="line">DELIMITER ;</span><br><span class="line"><span class="keyword">CALL</span> insert_dept(<span class="number">10000</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 执行存储过程，往 emp 表添加 50 万条数据 </span></span><br><span class="line">DELIMITER; </span><br><span class="line"><span class="keyword">CALL</span> insert_emp(<span class="number">100000</span>,<span class="number">500000</span>);</span><br></pre></td></tr></table></figure></li></ol><h3 id="5-1-常见单表索引失效"><a href="#5-1-常见单表索引失效" class="headerlink" title="5.1 常见单表索引失效"></a>5.1 常见单表索引失效</h3><ol><li><p>全值匹配我最爱</p><p>语句</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 创建复合索引</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">INDEX</span> idx_emp_agedeptIdname <span class="keyword">ON</span> emp(age, deptId, <span class="keyword">NAME</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 全值索引我最爱</span></span><br><span class="line"><span class="keyword">EXPLAIN</span> <span class="keyword">SELECT</span> * <span class="keyword">FROM</span> emp <span class="keyword">WHERE</span> emp.age = <span class="number">30</span>;</span><br><span class="line"><span class="keyword">EXPLAIN</span> <span class="keyword">SELECT</span> * <span class="keyword">FROM</span> emp <span class="keyword">WHERE</span> emp.age = <span class="number">30</span> <span class="keyword">AND</span> deptId = <span class="number">4</span>;</span><br><span class="line"><span class="keyword">EXPLAIN</span> <span class="keyword">SELECT</span> * <span class="keyword">FROM</span> emp <span class="keyword">WHERE</span> emp.age = <span class="number">30</span> <span class="keyword">AND</span> deptId = <span class="number">4</span> <span class="keyword">AND</span> emp.name = <span class="string">&#x27;abcd&#x27;</span>;</span><br><span class="line"><span class="comment">-- 顺序调换也不要紧，执行前优化器会自动优化</span></span><br><span class="line"><span class="keyword">EXPLAIN</span> <span class="keyword">SELECT</span> * <span class="keyword">FROM</span> emp <span class="keyword">WHERE</span> emp.age = <span class="number">30</span> <span class="keyword">AND</span> emp.name = <span class="string">&#x27;abcd&#x27;</span> <span class="keyword">AND</span> deptId = <span class="number">4</span>;</span><br></pre></td></tr></table></figure><p>结果</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; EXPLAIN SELECT * FROM emp WHERE emp.age &#x3D; 30 AND deptId &#x3D; 4 AND emp.name &#x3D; &#39;abcd&#39;;</span><br><span class="line">+----+-------------+-------+------------+------+------------------------------------+-----------------------+---------+-------------------+------+----------+-------+</span><br><span class="line">| id | select_type | table | partitions | type | possible_keys                      | key                   | key_len | ref               | rows | filtered | Extra |</span><br><span class="line">+----+-------------+-------+------------+------+------------------------------------+-----------------------+---------+-------------------+------+----------+-------+</span><br><span class="line">|  1 | SIMPLE      | emp   | NULL       | ref  | idx_emp_agedeptIdname,idx_emp_name | idx_emp_agedeptIdname | 73      | const,const,const |    1 |   100.00 | NULL  |</span><br><span class="line">+----+-------------+-------+------------+------+------------------------------------+-----------------------+---------+-------------------+------+----------+-------+</span><br><span class="line">1 row in set, 1 warning (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; EXPLAIN SELECT * FROM emp WHERE emp.age &#x3D; 30;</span><br><span class="line">+----+-------------+-------+------------+------+-----------------------+-----------------------+---------+-------+-------+----------+-------+</span><br><span class="line">| id | select_type | table | partitions | type | possible_keys         | key                   | key_len | ref   | rows  | filtered | Extra |</span><br><span class="line">+----+-------------+-------+------------+------+-----------------------+-----------------------+---------+-------+-------+----------+-------+</span><br><span class="line">|  1 | SIMPLE      | emp   | NULL       | ref  | idx_emp_agedeptIdname | idx_emp_agedeptIdname | 5       | const | 47832 |   100.00 | NULL  |</span><br><span class="line">+----+-------------+-------+------------+------+-----------------------+-----------------------+---------+-------+-------+----------+-------+</span><br><span class="line">1 row in set, 1 warning (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; EXPLAIN SELECT * FROM emp WHERE emp.age &#x3D; 30 AND deptId &#x3D; 4;</span><br><span class="line">+----+-------------+-------+------------+------+-----------------------+-----------------------+---------+-------------+------+----------+-------+</span><br><span class="line">| id | select_type | table | partitions | type | possible_keys         | key                   | key_len | ref         | rows | filtered | Extra |</span><br><span class="line">+----+-------------+-------+------------+------+-----------------------+-----------------------+---------+-------------+------+----------+-------+</span><br><span class="line">|  1 | SIMPLE      | emp   | NULL       | ref  | idx_emp_agedeptIdname | idx_emp_agedeptIdname | 10      | const,const |    1 |   100.00 | NULL  |</span><br><span class="line">+----+-------------+-------+------------+------+-----------------------+-----------------------+---------+-------------+------+----------+-------+</span><br><span class="line">1 row in set, 1 warning (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; EXPLAIN SELECT * FROM emp WHERE emp.age &#x3D; 30 AND deptId &#x3D; 4 AND emp.name &#x3D; &#39;abcd&#39;;</span><br><span class="line">+----+-------------+-------+------------+------+------------------------------------+-----------------------+---------+-------------------+------+----------+-------+</span><br><span class="line">| id | select_type | table | partitions | type | possible_keys                      | key                   | key_len | ref               | rows | filtered | Extra |</span><br><span class="line">+----+-------------+-------+------------+------+------------------------------------+-----------------------+---------+-------------------+------+----------+-------+</span><br><span class="line">|  1 | SIMPLE      | emp   | NULL       | ref  | idx_emp_agedeptIdname,idx_emp_name | idx_emp_agedeptIdname | 73      | const,const,const |    1 |   100.00 | NULL  |</span><br><span class="line">+----+-------------+-------+------------+------+------------------------------------+-----------------------+---------+-------------------+------+----------+-------+</span><br><span class="line">1 row in set, 1 warning (0.00 sec)</span><br></pre></td></tr></table></figure><blockquote><p>全职匹配我最爱指的是，查询的字段按照顺序在索引中都可以匹配到！</p><p>SQL 中查询字段的顺序，跟使用索引中字段的顺序，没有关系。优化器会在不影响 SQL 执行结果的前提下，给 你自动地优化。</p></blockquote></li></ol><ol start="2"><li><p>最佳左前缀法则</p><p>语句</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 最佳左前缀法则</span></span><br><span class="line"><span class="keyword">EXPLAIN</span> <span class="keyword">SELECT</span> * <span class="keyword">FROM</span> emp <span class="keyword">WHERE</span> deptId = <span class="number">4</span>;</span><br><span class="line"><span class="keyword">EXPLAIN</span> <span class="keyword">SELECT</span> * <span class="keyword">FROM</span> emp <span class="keyword">WHERE</span> emp.name = <span class="string">&#x27;abcd&#x27;</span> <span class="keyword">AND</span> deptId = <span class="number">4</span>;</span><br><span class="line"><span class="keyword">EXPLAIN</span> <span class="keyword">SELECT</span> * <span class="keyword">FROM</span> emp <span class="keyword">WHERE</span> emp.age = <span class="number">30</span> <span class="keyword">AND</span> emp.name = <span class="string">&#x27;abcd&#x27;</span>;</span><br></pre></td></tr></table></figure><p>结果</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; EXPLAIN SELECT * FROM emp WHERE deptId = 4;</span><br><span class="line">+<span class="comment">----+-------------+-------+------------+------+---------------+------+---------+------+--------+----------+-------------+</span></span><br><span class="line">| id | select_type | table | partitions | type | possible_keys | key  | key_len | ref  | rows   | filtered | Extra       |</span><br><span class="line">+<span class="comment">----+-------------+-------+------------+------+---------------+------+---------+------+--------+----------+-------------+</span></span><br><span class="line">|  1 | SIMPLE      | emp   | NULL       | ALL  | NULL          | NULL | NULL    | NULL | 499070 |    10.00 | Using where |</span><br><span class="line">+<span class="comment">----+-------------+-------+------------+------+---------------+------+---------+------+--------+----------+-------------+</span></span><br><span class="line">1 row in <span class="keyword">set</span>, <span class="number">1</span> <span class="keyword">warning</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">EXPLAIN</span> <span class="keyword">SELECT</span> * <span class="keyword">FROM</span> emp <span class="keyword">WHERE</span> emp.name = <span class="string">&#x27;abcd&#x27;</span> <span class="keyword">AND</span> deptId = <span class="number">4</span>;</span><br><span class="line">+<span class="comment">----+-------------+-------+------------+------+---------------+--------------+---------+-------+------+----------+-------------+</span></span><br><span class="line">| id | select_type | table | partitions | type | possible_keys | key          | key_len | ref   | rows | filtered | Extra       |</span><br><span class="line">+<span class="comment">----+-------------+-------+------------+------+---------------+--------------+---------+-------+------+----------+-------------+</span></span><br><span class="line">|  1 | SIMPLE      | emp   | NULL       | ref  | idx_emp_name  | idx_emp_name | 63      | const |    1 |    10.00 | Using where |</span><br><span class="line">+<span class="comment">----+-------------+-------+------------+------+---------------+--------------+---------+-------+------+----------+-------------+</span></span><br><span class="line">1 row in <span class="keyword">set</span>, <span class="number">1</span> <span class="keyword">warning</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">EXPLAIN</span> <span class="keyword">SELECT</span> * <span class="keyword">FROM</span> emp <span class="keyword">WHERE</span> emp.age = <span class="number">30</span> <span class="keyword">AND</span> emp.name = <span class="string">&#x27;abcd&#x27;</span>;</span><br><span class="line">+<span class="comment">----+-------------+-------+------------+------+------------------------------------+--------------+---------+-------+------+----------+-------------+</span></span><br><span class="line">| id | select_type | table | partitions | type | possible_keys                      | key          | key_len | ref   | rows | filtered | Extra       |</span><br><span class="line">+<span class="comment">----+-------------+-------+------------+------+------------------------------------+--------------+---------+-------+------+----------+-------------+</span></span><br><span class="line">|  1 | SIMPLE      | emp   | NULL       | ref  | idx_emp_agedeptIdname,idx_emp_name | idx_emp_name | 63      | const |    1 |     9.58 | Using where |</span><br><span class="line">+<span class="comment">----+-------------+-------+------------+------+------------------------------------+--------------+---------+-------+------+----------+-------------+</span></span><br><span class="line">1 row in <span class="keyword">set</span>, <span class="number">1</span> <span class="keyword">warning</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure><blockquote><p>查询字段与索引字段顺序的不同会导致，索引无法充分使用，甚至索引失效</p><p>使用复合索引，需要遵循最佳左前缀法则，即如果索引了多列，要遵守最左前缀法则。指的是查询从索 引的<strong>最左前列开始并且不跳过索引中的列</strong>。</p></blockquote></li></ol><ol start="3"><li><p>不在索引列做任何操作</p><p>语句</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 不要再索引列上做任何计算</span></span><br><span class="line"><span class="comment">-- 不要使用函数</span></span><br><span class="line"><span class="keyword">EXPLAIN</span> <span class="keyword">SELECT</span> * <span class="keyword">FROM</span> emp <span class="keyword">WHERE</span> emp.age = <span class="number">30</span>;</span><br><span class="line"><span class="keyword">EXPLAIN</span> <span class="keyword">SELECT</span> * <span class="keyword">FROM</span> emp <span class="keyword">WHERE</span> <span class="keyword">LEFT</span>(age,<span class="number">3</span>)= <span class="number">30</span>;</span><br><span class="line"><span class="comment">-- 不要使用转换</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">INDEX</span> idx_emp_name <span class="keyword">ON</span> emp(<span class="keyword">NAME</span>);</span><br><span class="line"><span class="keyword">EXPLAIN</span> <span class="keyword">SELECT</span> * <span class="keyword">FROM</span> emp <span class="keyword">WHERE</span> emp.name = <span class="string">&#x27;30000&#x27;</span>;</span><br><span class="line"><span class="keyword">EXPLAIN</span> <span class="keyword">SELECT</span> * <span class="keyword">FROM</span> emp <span class="keyword">WHERE</span> emp.name = <span class="number">30000</span>;</span><br></pre></td></tr></table></figure><p>结果</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; EXPLAIN SELECT * FROM emp WHERE emp.age = 30;</span><br><span class="line">+<span class="comment">----+-------------+-------+------------+------+-----------------------+-----------------------+---------+-------+-------+----------+-------+</span></span><br><span class="line">| id | select_type | table | partitions | type | possible_keys         | key                   | key_len | ref   | rows  | filtered | Extra |</span><br><span class="line">+<span class="comment">----+-------------+-------+------------+------+-----------------------+-----------------------+---------+-------+-------+----------+-------+</span></span><br><span class="line">|  1 | SIMPLE      | emp   | NULL       | ref  | idx_emp_agedeptIdname | idx_emp_agedeptIdname | 5       | const | 47832 |   100.00 | NULL  |</span><br><span class="line">+<span class="comment">----+-------------+-------+------------+------+-----------------------+-----------------------+---------+-------+-------+----------+-------+</span></span><br><span class="line">1 row in <span class="keyword">set</span>, <span class="number">1</span> <span class="keyword">warning</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">EXPLAIN</span> <span class="keyword">SELECT</span> * <span class="keyword">FROM</span> emp <span class="keyword">WHERE</span> <span class="keyword">LEFT</span>(age,<span class="number">3</span>)= <span class="number">30</span>;</span><br><span class="line">+<span class="comment">----+-------------+-------+------------+------+---------------+------+---------+------+--------+----------+-------------+</span></span><br><span class="line">| id | select_type | table | partitions | type | possible_keys | key  | key_len | ref  | rows   | filtered | Extra       |</span><br><span class="line">+<span class="comment">----+-------------+-------+------------+------+---------------+------+---------+------+--------+----------+-------------+</span></span><br><span class="line">|  1 | SIMPLE      | emp   | NULL       | ALL  | NULL          | NULL | NULL    | NULL | 499070 |   100.00 | Using where |</span><br><span class="line">+<span class="comment">----+-------------+-------+------------+------+---------------+------+---------+------+--------+----------+-------------+</span></span><br><span class="line">1 row in <span class="keyword">set</span>, <span class="number">1</span> <span class="keyword">warning</span> (<span class="number">0.00</span> sec)</span><br><span class="line">mysql&gt; <span class="keyword">EXPLAIN</span> <span class="keyword">SELECT</span> * <span class="keyword">FROM</span> emp <span class="keyword">WHERE</span> emp.name = <span class="string">&#x27;30000&#x27;</span>;</span><br><span class="line">+<span class="comment">----+-------------+-------+------------+------+---------------+--------------+---------+-------+------+----------+-------+</span></span><br><span class="line">| id | select_type | table | partitions | type | possible_keys | key          | key_len | ref   | rows | filtered | Extra |</span><br><span class="line">+<span class="comment">----+-------------+-------+------------+------+---------------+--------------+---------+-------+------+----------+-------+</span></span><br><span class="line">|  1 | SIMPLE      | emp   | NULL       | ref  | idx_emp_name  | idx_emp_name | 63      | const |    1 |   100.00 | NULL  |</span><br><span class="line">+<span class="comment">----+-------------+-------+------------+------+---------------+--------------+---------+-------+------+----------+-------+</span></span><br><span class="line">1 row in <span class="keyword">set</span>, <span class="number">1</span> <span class="keyword">warning</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">EXPLAIN</span> <span class="keyword">SELECT</span> * <span class="keyword">FROM</span> emp <span class="keyword">WHERE</span> emp.name = <span class="number">30000</span>;</span><br><span class="line">+<span class="comment">----+-------------+-------+------------+------+---------------+------+---------+------+--------+----------+-------------+</span></span><br><span class="line">| id | select_type | table | partitions | type | possible_keys | key  | key_len | ref  | rows   | filtered | Extra       |</span><br><span class="line">+<span class="comment">----+-------------+-------+------------+------+---------------+------+---------+------+--------+----------+-------------+</span></span><br><span class="line">|  1 | SIMPLE      | emp   | NULL       | ALL  | idx_emp_name  | NULL | NULL    | NULL | 499070 |    10.00 | Using where |</span><br><span class="line">+<span class="comment">----+-------------+-------+------------+------+---------------+------+---------+------+--------+----------+-------------+</span></span><br><span class="line">1 row in <span class="keyword">set</span>, <span class="number">3</span> <span class="keyword">warnings</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure><blockquote><p>不在索引列上做任何操作（计算、函数、(自动 or 手动)类型转换） ，会导致索引失效而转向全表扫描。</p><p>字符串不加单引号，则会在 name 列上做一次转换！</p></blockquote></li></ol><ol start="4"><li><p>存储引擎不能使用索引中范围条件右边的列</p><p>语句</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 索引列上不能有范围查询</span></span><br><span class="line"><span class="keyword">EXPLAIN</span> <span class="keyword">SELECT</span> * <span class="keyword">FROM</span> emp <span class="keyword">WHERE</span> emp.age = <span class="number">30</span> <span class="keyword">AND</span> deptId = <span class="number">4</span> <span class="keyword">AND</span> emp.name = <span class="string">&#x27;abcd&#x27;</span>;</span><br><span class="line"><span class="keyword">EXPLAIN</span> <span class="keyword">SELECT</span> * <span class="keyword">FROM</span> emp <span class="keyword">WHERE</span> emp.age = <span class="number">30</span> <span class="keyword">AND</span> deptId &gt; <span class="number">4</span> <span class="keyword">AND</span> emp.name = <span class="string">&#x27;abcd&#x27;</span>;</span><br></pre></td></tr></table></figure><p>结果</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; EXPLAIN SELECT * FROM emp WHERE emp.age = 30 AND deptId = 4 AND emp.name = &#x27;abcd&#x27;;</span><br><span class="line">+<span class="comment">----+-------------+-------+------------+------+------------------------------------+-----------------------+---------+-------------------+------+----------+-------+</span></span><br><span class="line">| id | select_type | table | partitions | type | possible_keys                      | key                   | key_len | ref               | rows | filtered | Extra |</span><br><span class="line">+<span class="comment">----+-------------+-------+------------+------+------------------------------------+-----------------------+---------+-------------------+------+----------+-------+</span></span><br><span class="line">|  1 | SIMPLE      | emp   | NULL       | ref  | idx_emp_agedeptIdname,idx_emp_name | idx_emp_agedeptIdname | 73      | const,const,const |    1 |   100.00 | NULL  |</span><br><span class="line">+<span class="comment">----+-------------+-------+------------+------+------------------------------------+-----------------------+---------+-------------------+------+----------+-------+</span></span><br><span class="line">1 row in <span class="keyword">set</span>, <span class="number">1</span> <span class="keyword">warning</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">EXPLAIN</span> <span class="keyword">SELECT</span> * <span class="keyword">FROM</span> emp <span class="keyword">WHERE</span> emp.age = <span class="number">30</span> <span class="keyword">AND</span> deptId &gt; <span class="number">4</span> <span class="keyword">AND</span> emp.name = <span class="string">&#x27;abcd&#x27;</span>;</span><br><span class="line">+<span class="comment">----+-------------+-------+------------+------+------------------------------------+--------------+---------+-------+------+----------+-------------+</span></span><br><span class="line">| id | select_type | table | partitions | type | possible_keys                      | key          | key_len | ref   | rows | filtered | Extra       |</span><br><span class="line">+<span class="comment">----+-------------+-------+------------+------+------------------------------------+--------------+---------+-------+------+----------+-------------+</span></span><br><span class="line">|  1 | SIMPLE      | emp   | NULL       | ref  | idx_emp_agedeptIdname,idx_emp_name | idx_emp_name | 63      | const |    1 |     9.57 | Using where |</span><br><span class="line">+<span class="comment">----+-------------+-------+------------+------+------------------------------------+--------------+---------+-------+------+----------+-------------+</span></span><br><span class="line">1 row in <span class="keyword">set</span>, <span class="number">1</span> <span class="keyword">warning</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure><blockquote><p>范围之后的索引全部失效</p><p>将可能做范围查询的字段的索引顺序放在最后</p></blockquote></li></ol><ol start="5"><li><p>尽量使用覆盖索引，减少select *</p><p>语句</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 尽量使用索引覆盖</span></span><br><span class="line"><span class="keyword">EXPLAIN</span> <span class="keyword">SELECT</span> * <span class="keyword">FROM</span> emp <span class="keyword">WHERE</span> emp.age = <span class="number">30</span> <span class="keyword">AND</span> deptId = <span class="number">4</span> <span class="keyword">AND</span> emp.name = <span class="string">&#x27;abcd&#x27;</span>;</span><br><span class="line"><span class="keyword">EXPLAIN</span> <span class="keyword">SELECT</span> age,deptId,<span class="keyword">NAME</span> <span class="keyword">FROM</span> emp <span class="keyword">WHERE</span> emp.age = <span class="number">30</span> <span class="keyword">AND</span> deptId = <span class="number">4</span> <span class="keyword">AND</span> emp.name = <span class="string">&#x27;abcd&#x27;</span>;</span><br></pre></td></tr></table></figure><p>结果</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; EXPLAIN SELECT * FROM emp WHERE emp.age = 30 AND deptId = 4 AND emp.name = &#x27;abcd&#x27;;</span><br><span class="line">+<span class="comment">----+-------------+-------+------------+------+------------------------------------+-----------------------+---------+-------------------+------+----------+-------+</span></span><br><span class="line">| id | select_type | table | partitions | type | possible_keys                      | key                   | key_len | ref               | rows | filtered | Extra |</span><br><span class="line">+<span class="comment">----+-------------+-------+------------+------+------------------------------------+-----------------------+---------+-------------------+------+----------+-------+</span></span><br><span class="line">|  1 | SIMPLE      | emp   | NULL       | ref  | idx_emp_agedeptIdname,idx_emp_name | idx_emp_agedeptIdname | 73      | const,const,const |    1 |   100.00 | NULL  |</span><br><span class="line">+<span class="comment">----+-------------+-------+------------+------+------------------------------------+-----------------------+---------+-------------------+------+----------+-------+</span></span><br><span class="line">1 row in <span class="keyword">set</span>, <span class="number">1</span> <span class="keyword">warning</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">EXPLAIN</span> <span class="keyword">SELECT</span> age,deptId,<span class="keyword">NAME</span> <span class="keyword">FROM</span> emp <span class="keyword">WHERE</span> emp.age = <span class="number">30</span> <span class="keyword">AND</span> deptId = <span class="number">4</span> <span class="keyword">AND</span> emp.name = <span class="string">&#x27;abcd&#x27;</span>;</span><br><span class="line">+<span class="comment">----+-------------+-------+------------+------+------------------------------------+-----------------------+---------+-------------------+------+----------+-------------+</span></span><br><span class="line">| id | select_type | table | partitions | type | possible_keys                      | key                   | key_len | ref               | rows | filtered | Extra       |</span><br><span class="line">+<span class="comment">----+-------------+-------+------------+------+------------------------------------+-----------------------+---------+-------------------+------+----------+-------------+</span></span><br><span class="line">|  1 | SIMPLE      | emp   | NULL       | ref  | idx_emp_agedeptIdname,idx_emp_name | idx_emp_agedeptIdname | 73      | const,const,const |    1 |   100.00 | Using index |</span><br><span class="line">+<span class="comment">----+-------------+-------+------------+------+------------------------------------+-----------------------+---------+-------------------+------+----------+-------------+</span></span><br><span class="line">1 row in <span class="keyword">set</span>, <span class="number">1</span> <span class="keyword">warning</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure></li></ol><ol start="6"><li><p>mysql在使用不等于是无法使用索引</p><p>语句</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 不要使用不等于</span></span><br><span class="line"><span class="keyword">EXPLAIN</span> <span class="keyword">SELECT</span> * <span class="keyword">FROM</span> emp <span class="keyword">WHERE</span> emp.name != <span class="string">&#x27;30000&#x27;</span>;</span><br><span class="line"><span class="keyword">EXPLAIN</span> <span class="keyword">SELECT</span> * <span class="keyword">FROM</span> emp <span class="keyword">WHERE</span> emp.name &lt;&gt; <span class="string">&#x27;30000&#x27;</span>;</span><br></pre></td></tr></table></figure><p>结果</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; EXPLAIN SELECT * FROM emp WHERE emp.name != &#x27;30000&#x27;;</span><br><span class="line">+<span class="comment">----+-------------+-------+------------+------+---------------+------+---------+------+--------+----------+-------------+</span></span><br><span class="line">| id | select_type | table | partitions | type | possible_keys | key  | key_len | ref  | rows   | filtered | Extra       |</span><br><span class="line">+<span class="comment">----+-------------+-------+------------+------+---------------+------+---------+------+--------+----------+-------------+</span></span><br><span class="line">|  1 | SIMPLE      | emp   | NULL       | ALL  | idx_emp_name  | NULL | NULL    | NULL | 499070 |    50.00 | Using where |</span><br><span class="line">+<span class="comment">----+-------------+-------+------------+------+---------------+------+---------+------+--------+----------+-------------+</span></span><br><span class="line">1 row in <span class="keyword">set</span>, <span class="number">1</span> <span class="keyword">warning</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">EXPLAIN</span> <span class="keyword">SELECT</span> * <span class="keyword">FROM</span> emp <span class="keyword">WHERE</span> emp.name &lt;&gt; <span class="string">&#x27;30000&#x27;</span>;</span><br><span class="line">+<span class="comment">----+-------------+-------+------------+------+---------------+------+---------+------+--------+----------+-------------+</span></span><br><span class="line">| id | select_type | table | partitions | type | possible_keys | key  | key_len | ref  | rows   | filtered | Extra       |</span><br><span class="line">+<span class="comment">----+-------------+-------+------------+------+---------------+------+---------+------+--------+----------+-------------+</span></span><br><span class="line">|  1 | SIMPLE      | emp   | NULL       | ALL  | idx_emp_name  | NULL | NULL    | NULL | 499070 |    50.00 | Using where |</span><br><span class="line">+<span class="comment">----+-------------+-------+------------+------+---------------+------+---------+------+--------+----------+-------------+</span></span><br><span class="line">1 row in <span class="keyword">set</span>, <span class="number">1</span> <span class="keyword">warning</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure><blockquote><p>mysql 在使用不等于(!= 或者&lt;&gt;)时，有时会无法使用索引会导致全表扫描。</p></blockquote></li></ol><ol start="7"><li><p>is null、is not null也无法使用索引</p><p>语句</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 不要使用is not null、is null</span></span><br><span class="line"><span class="keyword">EXPLAIN</span> <span class="keyword">SELECT</span> * <span class="keyword">FROM</span> emp <span class="keyword">WHERE</span> emp.name <span class="keyword">IS</span> <span class="literal">NULL</span>;</span><br><span class="line"><span class="keyword">EXPLAIN</span> <span class="keyword">SELECT</span> * <span class="keyword">FROM</span> emp <span class="keyword">WHERE</span> emp.name <span class="keyword">IS</span> <span class="keyword">NOT</span> <span class="literal">NULL</span>;</span><br></pre></td></tr></table></figure><p>结果</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; EXPLAIN SELECT * FROM emp WHERE emp.name IS NULL;</span><br><span class="line">+<span class="comment">----+-------------+-------+------------+------+---------------+--------------+---------+-------+------+----------+-----------------------+</span></span><br><span class="line">| id | select_type | table | partitions | type | possible_keys | key          | key_len | ref   | rows | filtered | Extra                 |</span><br><span class="line">+<span class="comment">----+-------------+-------+------------+------+---------------+--------------+---------+-------+------+----------+-----------------------+</span></span><br><span class="line">|  1 | SIMPLE      | emp   | NULL       | ref  | idx_emp_name  | idx_emp_name | 63      | const |    1 |   100.00 | Using index condition |</span><br><span class="line">+<span class="comment">----+-------------+-------+------------+------+---------------+--------------+---------+-------+------+----------+-----------------------+</span></span><br><span class="line">1 row in <span class="keyword">set</span>, <span class="number">1</span> <span class="keyword">warning</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">EXPLAIN</span> <span class="keyword">SELECT</span> * <span class="keyword">FROM</span> emp <span class="keyword">WHERE</span> emp.name <span class="keyword">IS</span> <span class="keyword">NOT</span> <span class="literal">NULL</span>;</span><br><span class="line">+<span class="comment">----+-------------+-------+------------+------+---------------+------+---------+------+--------+----------+-------------+</span></span><br><span class="line">| id | select_type | table | partitions | type | possible_keys | key  | key_len | ref  | rows   | filtered | Extra       |</span><br><span class="line">+<span class="comment">----+-------------+-------+------------+------+---------------+------+---------+------+--------+----------+-------------+</span></span><br><span class="line">|  1 | SIMPLE      | emp   | NULL       | ALL  | idx_emp_name  | NULL | NULL    | NULL | 499070 |    50.00 | Using where |</span><br><span class="line">+<span class="comment">----+-------------+-------+------------+------+---------------+------+---------+------+--------+----------+-------------+</span></span><br><span class="line">1 row in <span class="keyword">set</span>, <span class="number">1</span> <span class="keyword">warning</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure></li></ol><ol start="8"><li><p>like以通配符开头也不能使用索引</p><p>语句</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- like匹配</span></span><br><span class="line"><span class="keyword">EXPLAIN</span> <span class="keyword">SELECT</span> * <span class="keyword">FROM</span> emp <span class="keyword">WHERE</span> emp.name <span class="keyword">LIKE</span> <span class="string">&#x27;%30000&#x27;</span>;</span><br><span class="line"><span class="keyword">EXPLAIN</span> <span class="keyword">SELECT</span> * <span class="keyword">FROM</span> emp <span class="keyword">WHERE</span> emp.name <span class="keyword">LIKE</span> <span class="string">&#x27;%30000%&#x27;</span>;</span><br><span class="line"><span class="keyword">EXPLAIN</span> <span class="keyword">SELECT</span> * <span class="keyword">FROM</span> emp <span class="keyword">WHERE</span> emp.name <span class="keyword">LIKE</span> <span class="string">&#x27;30000%&#x27;</span>;</span><br></pre></td></tr></table></figure><p>结果</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; EXPLAIN SELECT * FROM emp WHERE emp.name LIKE &#x27;%30000&#x27;;</span><br><span class="line">+<span class="comment">----+-------------+-------+------------+------+---------------+------+---------+------+--------+----------+-------------+</span></span><br><span class="line">| id | select_type | table | partitions | type | possible_keys | key  | key_len | ref  | rows   | filtered | Extra       |</span><br><span class="line">+<span class="comment">----+-------------+-------+------------+------+---------------+------+---------+------+--------+----------+-------------+</span></span><br><span class="line">|  1 | SIMPLE      | emp   | NULL       | ALL  | NULL          | NULL | NULL    | NULL | 499070 |    11.11 | Using where |</span><br><span class="line">+<span class="comment">----+-------------+-------+------------+------+---------------+------+---------+------+--------+----------+-------------+</span></span><br><span class="line">1 row in <span class="keyword">set</span>, <span class="number">1</span> <span class="keyword">warning</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">EXPLAIN</span> <span class="keyword">SELECT</span> * <span class="keyword">FROM</span> emp <span class="keyword">WHERE</span> emp.name <span class="keyword">LIKE</span> <span class="string">&#x27;%30000%&#x27;</span>;</span><br><span class="line">+<span class="comment">----+-------------+-------+------------+------+---------------+------+---------+------+--------+----------+-------------+</span></span><br><span class="line">| id | select_type | table | partitions | type | possible_keys | key  | key_len | ref  | rows   | filtered | Extra       |</span><br><span class="line">+<span class="comment">----+-------------+-------+------------+------+---------------+------+---------+------+--------+----------+-------------+</span></span><br><span class="line">|  1 | SIMPLE      | emp   | NULL       | ALL  | NULL          | NULL | NULL    | NULL | 499070 |    11.11 | Using where |</span><br><span class="line">+<span class="comment">----+-------------+-------+------------+------+---------------+------+---------+------+--------+----------+-------------+</span></span><br><span class="line">1 row in <span class="keyword">set</span>, <span class="number">1</span> <span class="keyword">warning</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">EXPLAIN</span> <span class="keyword">SELECT</span> * <span class="keyword">FROM</span> emp <span class="keyword">WHERE</span> emp.name <span class="keyword">LIKE</span> <span class="string">&#x27;30000%&#x27;</span>;</span><br><span class="line">+<span class="comment">----+-------------+-------+------------+-------+---------------+--------------+---------+------+------+----------+-----------------------+</span></span><br><span class="line">| id | select_type | table | partitions | type  | possible_keys | key          | key_len | ref  | rows | filtered | Extra                 |</span><br><span class="line">+<span class="comment">----+-------------+-------+------------+-------+---------------+--------------+---------+------+------+----------+-----------------------+</span></span><br><span class="line">|  1 | SIMPLE      | emp   | NULL       | range | idx_emp_name  | idx_emp_name | 63      | NULL |    1 |   100.00 | Using index condition |</span><br><span class="line">+<span class="comment">----+-------------+-------+------------+-------+---------------+--------------+---------+------+------+----------+-----------------------+</span></span><br><span class="line">1 row in <span class="keyword">set</span>, <span class="number">1</span> <span class="keyword">warning</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure><blockquote><p>前缀不能出现模糊匹配！</p></blockquote></li></ol><ol start="9"><li><p>少用or，用它链接是会索引失效</p><p>语句</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 减少使用or</span></span><br><span class="line"><span class="keyword">EXPLAIN</span> <span class="keyword">SELECT</span> * <span class="keyword">FROM</span> emp <span class="keyword">WHERE</span> emp.age = <span class="number">30</span> <span class="keyword">AND</span> deptId = <span class="number">4</span> <span class="keyword">OR</span> emp.name = <span class="string">&#x27;abcd&#x27;</span>;</span><br><span class="line"><span class="keyword">EXPLAIN</span> <span class="keyword">SELECT</span> * <span class="keyword">FROM</span> emp <span class="keyword">WHERE</span> emp.age = <span class="number">30</span> <span class="keyword">OR</span> deptId = <span class="number">4</span>;</span><br></pre></td></tr></table></figure><p>结果</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; EXPLAIN SELECT * FROM emp WHERE emp.age = 30 AND deptId = 4 OR emp.name = &#x27;abcd&#x27;;</span><br><span class="line">+<span class="comment">----+-------------+-------+------------+-------------+------------------------------------+------------------------------------+---------+------+------+----------+-------------------------------------------------------------------+</span></span><br><span class="line">| id | select_type | table | partitions | type        | possible_keys                      | key                                | key_len | ref  | rows | filtered | Extra                                                             |</span><br><span class="line">+<span class="comment">----+-------------+-------+------------+-------------+------------------------------------+------------------------------------+---------+------+------+----------+-------------------------------------------------------------------+</span></span><br><span class="line">|  1 | SIMPLE      | emp   | NULL       | index_merge | idx_emp_agedeptIdname,idx_emp_name | idx_emp_agedeptIdname,idx_emp_name | 10,63   | NULL |    2 |   100.00 | Using sort_union(idx_emp_agedeptIdname,idx_emp_name); Using where |</span><br><span class="line">+<span class="comment">----+-------------+-------+------------+-------------+------------------------------------+------------------------------------+---------+------+------+----------+-------------------------------------------------------------------+</span></span><br><span class="line">1 row in <span class="keyword">set</span>, <span class="number">1</span> <span class="keyword">warning</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">EXPLAIN</span> <span class="keyword">SELECT</span> * <span class="keyword">FROM</span> emp <span class="keyword">WHERE</span> emp.age = <span class="number">30</span> <span class="keyword">OR</span> deptId = <span class="number">4</span>;</span><br><span class="line">+<span class="comment">----+-------------+-------+------------+------+-----------------------+------+---------+------+--------+----------+-------------+</span></span><br><span class="line">| id | select_type | table | partitions | type | possible_keys         | key  | key_len | ref  | rows   | filtered | Extra       |</span><br><span class="line">+<span class="comment">----+-------------+-------+------------+------+-----------------------+------+---------+------+--------+----------+-------------+</span></span><br><span class="line">|  1 | SIMPLE      | emp   | NULL       | ALL  | idx_emp_agedeptIdname | NULL | NULL    | NULL | 499070 |    14.50 | Using where |</span><br><span class="line">+<span class="comment">----+-------------+-------+------------+------+-----------------------+------+---------+------+--------+----------+-------------+</span></span><br><span class="line">1 row in <span class="keyword">set</span>, <span class="number">1</span> <span class="keyword">warning</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure><blockquote><p>使用 unionall 或者 union 来替代：</p></blockquote></li></ol><ol start="10"><li><p>口诀</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">全职匹配我最爱，最左前缀要遵守；</span><br><span class="line">带头大哥不能死，中间兄弟不能断；</span><br><span class="line">索引列上少计算，范围之后全失效；</span><br><span class="line">LIKE百分写最右，覆盖索引不写*； </span><br><span class="line">不等空值还有OR，索引影响要注意； </span><br><span class="line">VAR引号不可丢，SQL优化有诀窍。</span><br></pre></td></tr></table></figure></li></ol>]]></content>
      
      
      <categories>
          
          <category> 理论学习 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> MySQL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MySQL进阶-1-架构介绍</title>
      <link href="2020/08/09/MySQL%E8%BF%9B%E9%98%B6-1-%E6%9E%B6%E6%9E%84%E4%BB%8B%E7%BB%8D/"/>
      <url>2020/08/09/MySQL%E8%BF%9B%E9%98%B6-1-%E6%9E%B6%E6%9E%84%E4%BB%8B%E7%BB%8D/</url>
      
        <content type="html"><![CDATA[<p>MySQL进阶学习笔记。</p><a id="more"></a><h1 id="MySQL进阶-1-架构介绍"><a href="#MySQL进阶-1-架构介绍" class="headerlink" title="MySQL进阶-1-架构介绍"></a>MySQL进阶-1-架构介绍</h1><h2 id="1-MySQL简介"><a href="#1-MySQL简介" class="headerlink" title="1. MySQL简介"></a>1. MySQL简介</h2><h3 id="1-1-概述"><a href="#1-1-概述" class="headerlink" title="1.1 概述"></a>1.1 概述</h3><ol><li>MySQL是一个关系型数据库管理系统（RDBMS），由瑞典MySQL AB 公司开放，目前属于ORACLE公司。</li><li>MySQL是一种关系数据库管理系统，将数据保存在不同的表中，而不是将所有数据放在一个大仓库内，这样增加了速度并提高了灵活性。</li><li>MySQL是开源的，所以不需要支付额外的费用。</li><li>MySQL支持大型的数据库，可以出来拥有成千上万条记录的大型数据库。32位系统表文件最大支持4GB、64位系统最大表文件支持8TB。</li><li>MySQL使用标准的SQL数据语言形式。</li><li>MySQL可以运行于多个系统，并支持多语言。包括：C、C++、Java、Python、Perl、PHP、Ruby等等。</li><li>MySQL是可以定制的，采用了GPL协议，你可以修改源码来开发自己的系统。</li></ol><h3 id="1-2-MySQL进阶"><a href="#1-2-MySQL进阶" class="headerlink" title="1.2 MySQL进阶"></a>1.2 MySQL进阶</h3><ol><li>内核</li><li>SQL优化</li><li>服务器的优化</li><li>查询语句优化</li><li>主从复制</li><li>软硬件升级</li><li>容灾备份</li><li>SQL编程</li></ol><h2 id="2-Linux下MySQL使用"><a href="#2-Linux下MySQL使用" class="headerlink" title="2. Linux下MySQL使用"></a>2. Linux下MySQL使用</h2><h3 id="2-1-MySQL5-5安装"><a href="#2-1-MySQL5-5安装" class="headerlink" title="2.1 MySQL5.5安装"></a>2.1 MySQL5.5安装</h3><ol><li><p>下载地址：<a href="https://dev.mysql.com/downloads/mysql/">https://dev.mysql.com/downloads/mysql/</a></p></li><li><p>检查是否安装过MySQL</p></li><li><p>安装MySQL客户端、服务器端</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 安装服务器端</span></span><br><span class="line">rpm -ivh --nodeps MySQL-server-5.5.54-1.linux2.6.x86_64.rpm</span><br><span class="line"><span class="meta">#</span><span class="bash"> 安装客户端</span></span><br><span class="line">rpm -ivh --nodeps MySQL-client-5.5.54-1.linux2.6.x86_64.rpm</span><br></pre></td></tr></table></figure></li><li><p>启动MySQL服务</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service mysql start</span><br></pre></td></tr></table></figure></li><li><p>设置root密码</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqladmin -u root password 123456</span><br></pre></td></tr></table></figure></li><li><p>设置MySQL自启动</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 设置自启动</span></span><br><span class="line">chkconfig mysql on</span><br><span class="line"><span class="meta">#</span><span class="bash"> 检验是否设置成功</span></span><br><span class="line">ntsysv</span><br></pre></td></tr></table></figure></li><li><p>修改配置文件位置</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp /usr/share/mysql/my-huge.cnf /etc/my.cnf</span><br></pre></td></tr></table></figure><blockquote><p>将share下单my-huge.cnf配置文件复制到etc目录下，并且注意文件名。</p><p>不同版本的配置文件名可能不一样，如5.6的为my-defalut.cnf</p></blockquote></li><li><p>设置字符集编码</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 查看字符集 [默认客户端和服务端动用了Latin1，使用中文会乱码]</span></span><br><span class="line">show variales like &#x27;%char%&#x27;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 修改配置文件</span></span><br><span class="line">vim /etc/my.cnf</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 添加下面内容</span></span><br><span class="line"></span><br><span class="line">[client]</span><br><span class="line">default-character-set=utf8 # 设置编码</span><br><span class="line"></span><br><span class="line">[mysqld]</span><br><span class="line">lower_case_table_names=1   # 设置大小写区分情况</span><br><span class="line">character_set_server=utf8</span><br><span class="line">character_set_client=utf8</span><br><span class="line">collation-server=utf8_general_ci</span><br><span class="line">max_connections=1000       # 设置最大连接数</span><br><span class="line"></span><br><span class="line">[mysql]</span><br><span class="line">default-character-set=utf8</span><br></pre></td></tr></table></figure></li><li><p>MySQL一些目录</p><p>linux下查看</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ps -ef | grep mysql</span><br></pre></td></tr></table></figure><table><thead><tr><th>路径</th><th>解析</th><th>备注</th></tr></thead><tbody><tr><td>/var/lib/mysql</td><td>mysql数据库文件的存放路径</td><td>/var/lib/mysql/xxx.pid</td></tr><tr><td>/usr/share/mysql</td><td>配置文件目录</td><td>mysql.server命令及配置</td></tr><tr><td>/usr/bin</td><td>相关命令目录</td><td>mysqladmin mysqldump等命令</td></tr><tr><td>/etc/init.d/mysql</td><td>启停脚本目录</td><td></td></tr></tbody></table></li></ol><h3 id="2-2-MySQL配置文件"><a href="#2-2-MySQL配置文件" class="headerlink" title="2.2 MySQL配置文件"></a>2.2 MySQL配置文件</h3><table><thead><tr><th>文件</th><th>类型</th><th>备注</th></tr></thead><tbody><tr><td>log-bin</td><td>二进制配置文件</td><td>主从复制用到</td></tr><tr><td>log-error</td><td>错误日志文件</td><td>默认关闭</td></tr><tr><td>log</td><td>查询日志</td><td>默认关闭</td></tr><tr><td>frm</td><td>数据文件：表结构</td><td></td></tr><tr><td>myd</td><td>数据文件：表数据</td><td></td></tr><tr><td>myi</td><td>数据文件：表索引</td><td></td></tr><tr><td>my.ini或my.cnf</td><td>配置文件</td><td></td></tr></tbody></table><blockquote><p>log-errror：默认关闭，记录严重的警告信息和错误信息，每次启动关闭的详细信息。</p></blockquote><blockquote><p>log：默认关闭，记录查询的sql语句，开启会降低mysql整体性能。</p></blockquote><blockquote><p>数据文件在windows和Linux平台下不同</p><p>windows：..\MySQL\MySQL Server 5.7\data</p><p>linux：/var/lib/mysql</p></blockquote><h2 id="3-MySQl逻辑架构介绍"><a href="#3-MySQl逻辑架构介绍" class="headerlink" title="3. MySQl逻辑架构介绍"></a>3. MySQl逻辑架构介绍</h2><h3 id="3-1-总体概述"><a href="#3-1-总体概述" class="headerlink" title="3.1 总体概述"></a>3.1 总体概述</h3><p>​    和其他数据库相比，MySQL有点与众不同，他的架构可以在多种不同场景中应用并发挥良好作用。主要体现在存储引擎的架构上<strong>。插件式的存储引擎架构将查询处理和其他的系统任务以及数据的存储提取分离</strong>。这种架构可以根据业务的需求和实际需要选择合适的引擎。</p><p>​    下图展示了MySQL的框架图，包含了：<strong>连接层、服务层、引擎层、存储层</strong>。</p><p><img src="https://gitee.com/tobing/imagebed/raw/master/1596985484052.png" class="lazyload" data-srcset="https://gitee.com/tobing/imagebed/raw/master/1596985484052.png" srcset="data:image/png;base64,666" alt="1596985484052"></p><ol><li><p><strong>连接层</strong></p><p>​    最上层是一些客户端和连接服务，包含本地sock通信和大多数基于客户端/服务器端工具实现的类似于TCP/IP的通信。<strong>主要完成</strong>一些类似于<strong>连接处理、授权认证、以及相关的安全方案</strong>。在该层上引入了线程池的概念，为通过认证安全接入的客户端提供了线程。同样在该层上可以实现基于SSL的安全连接。服务器也会为安全接入的每个客户端验证它所具有的操作权限。</p></li><li><p><strong>服务层</strong></p><p>​    第二层架构主要完成大多数的核心服务功能，如SQL接口、并完成缓存的查询，SQL的分析和优化部分内置函数的执行。所有跨存储引擎的功能也在这一层实现，如过程、函数等。在该层，服务器会解析擦好像并创建相应的内部解析树，并对其完成相应的优化，如确定查询表的顺序，是否利用索引等，最后生成相应的执行操作。如果是select语句，服务器还会查询内部的缓存。如果缓存空间足够大，这样在解决大量读操作的环境能很好提升系统性能。</p></li><li><p><strong>引擎层</strong></p><p>​    存储引擎层，存储引擎真正负责MySQL中数据的存储和提取，服务器通过API与存储引擎进行通信。不同存储引擎的功能不同，这样有利于我们根据实际生产环境进行选择。</p></li><li><p><strong>存储层</strong></p><p>​    数据存储层，主要将数据存储在运行与裸设备的文件系统上，并完成与存储引擎的交互。</p></li><li><p>Connector</p><p>​    指的是不同语言中与SQL的交互</p></li><li><p>Managemen Service &amp; Utilities</p><p>​    系统管理和控制工具</p></li><li><p>Connection Pool</p><p>​    连接池，管理缓冲用户连接，线程处理等需要缓存的需求。</p><p>​    负责监听对MySQL Server的各种请求，接受连接请求，转发所有连接请求到线程管理模块。每一个连接上Server的客户端请求都会被分配一个线程来为其单独服务。而连接线程的主要工作就是负责MySQL Server与客户端的通信。</p></li><li><p>SQL Interface</p><p>​    SQL接口，接受用户的SQL命令，并且返回用户需要的查询结果。比如select 就是调用SQL Interface。</p></li><li><p>Parser：解析器</p><p>​    SQL命令传递到解析器会被解析器验证和解析。解析器有Lex和YACC实现，是一个很长的脚本。</p><p>​    在Mysql中我们习惯将所有Client端发送给Server端的命令都成为query，在Mysql Server里面，连接线程接收到客户端的一个 Query 后，会直接将该 query 传递给专门负责将各种 Query 进行分类然后转发给各个对应的处理模块。</p><p>​    主要功能：<br>​    a . 将SQL语句进行语义和语法的分析，分解成数据结构，然后按照不同的操作类型进行分类，然后做出针对性的转发到后续步骤，以后SQL语句的传递和处理就是基于这个结构的。<br>​    b.  如果在分解构成中遇到错误，那么就说明这个sql语句是不合理的</p></li><li><p>Optimizer：查询优化器</p><p>​    SQL语句在查询之前会使用查询优化器对查询进行优化。就是优化客户端请求的 query（sql语句） ，根据客户端请求的 query 语句，和数据库中的一些统计信息，在一系列算法的基础上进行分析，得出一个最优的策略，告诉后面的程序如何取得这个 query 语句的结果<br>他使用的是“选取-投影-联接”策略进行查询。<br>​       用一个例子就可以理解： select uid,name from user where gender = 1;<br>​       这个select 查询先根据where 语句进行选取，而不是先将表全部查询出来以后再进行gender过滤<br>​       这个select查询先根据uid和name进行属性投影，而不是将属性全部取出以后再进行过滤<br>​       将这两个查询条件联接起来生成最终查询结果</p></li><li><p>Cache和Buffer</p><p>​    他的主要功能是将客户端提交 给MySQL 的 Select 类 query 请求的返回结果集 cache 到内存中，与该 query 的一个 hash 值 做一个对应。该 Query 所取数据的基表发生任何数据的变化之后， MySQL 会自动使该 query 的Cache 失效。在读写比例非常高的应用系统中， Query Cache 对性能的提高是非常显著的。当然它对内存的消耗也是非常大的。<br>​    如果查询缓存有命中的查询结果，查询语句就可以直接去查询缓存中取数据。这个缓存机制是由一系列小缓存组成的。比如表缓存，记录缓存，key缓存，权限缓存等</p></li><li><p>存储引擎接口</p><p>​    存储引擎接口模块可以说是 MySQL 数据库中最有特色的一点了。目前各种数据库产品中，基本上只有 MySQL 可以实现其底层数据存储引擎的插件式管理。这个模块实际上只是 一个抽象类，但正是因为它成功地将各种数据处理高度抽象化，才成就了今天 MySQL 可插拔存储引擎的特色。<br>​     从上图还可以看出，MySQL区别于其他数据库的最重要的特点就是其插件式的表存储引擎。MySQL插件式的存储引擎架构提供了一系列标准的管理和服务支持，这些标准与存储引擎本身无关，可能是每个数据库系统本身都必需的，如SQL分析器和优化器等，而存储引擎是底层物理结构的实现，每个存储引擎开发者都可以按照自己的意愿来进行开发。<br>​    注意：存储引擎是基于表的，而不是数据库。</p></li></ol><h3 id="3-2-MySQL存储引擎"><a href="#3-2-MySQL存储引擎" class="headerlink" title="3.2 MySQL存储引擎"></a>3.2 MySQL存储引擎</h3><ol><li><p>查看存储引擎</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查看提供的引擎</span></span><br><span class="line"><span class="keyword">show</span> <span class="keyword">engines</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查看当前默认引擎</span></span><br><span class="line"><span class="keyword">show</span> <span class="keyword">variables</span> <span class="keyword">like</span> <span class="string">&quot;%storage_engine%&quot;</span>;</span><br><span class="line">+<span class="comment">------------------------+--------+</span></span><br><span class="line">| Variable_name          | Value  |</span><br><span class="line">+<span class="comment">------------------------+--------+</span></span><br><span class="line">| default_storage_engine | InnoDB |</span><br><span class="line">| storage_engine         | InnoDB |</span><br><span class="line">+<span class="comment">------------------------+--------+</span></span><br></pre></td></tr></table></figure></li><li><p>MyISAM和InnoDB</p><p>​    虽然Mysql提供了很多存储引擎，但我们常用的主要是：MyISAM和InnoDB，下面是两个存储引擎的对比。</p><table><thead><tr><th>对比项</th><th>MyISAM</th><th>InnoDB</th></tr></thead><tbody><tr><td>主外键</td><td>不支持</td><td>支持</td></tr><tr><td>事务</td><td>不支持</td><td>支持</td></tr><tr><td>行表锁</td><td>表锁，即使操作一条记录也会锁住整个表，不利于高并发</td><td>行锁，操作时只锁一行，不影响其他行，适合高并发。</td></tr><tr><td>缓存</td><td>只缓存索引，不缓存真实数据</td><td>不仅缓存索引，还缓存数据，堆内存要求较高</td></tr><tr><td>表空间</td><td>小</td><td>大</td></tr><tr><td>关注点</td><td>性能</td><td>事务</td></tr><tr><td>默认安装</td><td>Y</td><td>Y</td></tr></tbody></table></li><li><p>大厂使用的存储引擎</p><p>Percona、阿里巴巴大部分Mysql数据库其实使用的percona的原型加以修改。</p></li></ol><h2 id="4-总结"><a href="#4-总结" class="headerlink" title="4. 总结"></a>4. 总结</h2><p>​         这部分主要介绍了MySQL概述，MySQL的高级技术有哪些，MySQL5.5在Linux环境下的安装配置，MySQL5.5的配置文件结构，还结束了MySQL的逻辑架构。</p><p>​        MySQL逻辑架构可分为4层：连接层、服务层、引擎层、存储层。</p>]]></content>
      
      
      <categories>
          
          <category> 理论学习 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> MySQL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>微信小程序认证</title>
      <link href="2020/08/08/%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F%E8%AE%A4%E8%AF%81/"/>
      <url>2020/08/08/%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F%E8%AE%A4%E8%AF%81/</url>
      
        <content type="html"><![CDATA[<p>​    使用Java后台作为微信小程序开发的时候，我们通常需要前后端分离开发。这时候，我们通常编写开发的RESTful风格的后端接口，从而使得微信小程序可以进行远程调用、获取数据。这时候就涉及到一个问题，我们的接口任何人都可以调用，怎么知道调用该接口的是谁呢？这时候我们便需要使用到了<strong>认证机制</strong>。接下来我们来简要介绍常用的认证机制</p><a id="more"></a><h1 id="微信小程序认证"><a href="#微信小程序认证" class="headerlink" title="微信小程序认证"></a>微信小程序认证</h1><h2 id="1-问题引入"><a href="#1-问题引入" class="headerlink" title="1. 问题引入"></a>1. 问题引入</h2><p>​    使用Java后台作为微信小程序开发的时候，我们通常需要前后端分离开发。这时候，我们通常编写开发的RESTful风格的后端接口，从而使得微信小程序可以进行远程调用、获取数据。这时候就涉及到一个问题，我们的接口任何人都可以调用，怎么知道调用该接口的是谁呢？这时候我们便需要使用到了<strong>认证机制</strong>。接下来我们来简要介绍常用的认证机制。</p><h2 id="2-常见认证机制简介"><a href="#2-常见认证机制简介" class="headerlink" title="2. 常见认证机制简介"></a>2. 常见认证机制简介</h2><h3 id="2-1-HTTP-Basic-Auth"><a href="#2-1-HTTP-Basic-Auth" class="headerlink" title="2.1 HTTP Basic Auth"></a>2.1 HTTP Basic Auth</h3><p>​    HTTP Basic Auth，每次请求API时都提供用户uername和password，简而言之，Basic Auth是配合restFul PAPI使用最简单的认证方式，只提供用户名密码即可，但这种情况容易将用户名密码暴露给第三方客户端，在生产环境中越来越少。因此，开发对外开发的RESTful API时，尽量避免HTTP Basic Auth。</p><h3 id="2-2-Cookie-Auth"><a href="#2-2-Cookie-Auth" class="headerlink" title="2.2 Cookie Auth"></a>2.2 Cookie Auth</h3><p>​    Cookie认证机制就是为了一次请求认证在服务端建立一个Session对象，同时在客户端的浏览器创建一个Cookie对象；通过客户端带上Cookie对象，通过客户端带上Cookie对象来与服务器端的Session对象匹配状态管理。默认情况下，当我们关闭浏览器的时候，Cookie对象会被删除，但可以通过修改Cookie的expire time指定Cookie的生存时间。</p><h3 id="2-3-OAuth"><a href="#2-3-OAuth" class="headerlink" title="2.3 OAuth"></a>2.3 OAuth</h3><p>​    OAuth（开放授权）是一个开放的授权标准，允许用户让第三方应用访问该用户在某一个web服务上存储的私密资源，而无需用户名和密码提供第三方应用。</p><p>​    OAuth运行用户提供一个令牌，而不是用户名密码来访问他们的数据。每个令牌授权一个特定的第三方系统在特定的时段（例如，接下来2小时）内访问特定资源（例如仅仅是某一个相册的视频）。这样，OAuth让用户可以授权第三方网站访问他们存储在另外服务提供者的某些特定信息，而非所有内容。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">+--------+                               +---------------+</span><br><span class="line">|        |--(A)- Authorization Request -&gt;|   Resource    |</span><br><span class="line">|        |                               |     Owner     |</span><br><span class="line">|        |&lt;-(B)-- Authorization Grant ---|               |</span><br><span class="line">|        |                               +---------------+</span><br><span class="line">|        |</span><br><span class="line">|        |                               +---------------+</span><br><span class="line">|        |--(C)-- Authorization Grant --&gt;| Authorization |</span><br><span class="line">| Client |                               |     Server    |</span><br><span class="line">|        |&lt;-(D)----- Access Token -------|               |</span><br><span class="line">|        |                               +---------------+</span><br><span class="line">|        |</span><br><span class="line">|        |                               +---------------+</span><br><span class="line">|        |--(E)----- Access Token ------&gt;|    Resource   |</span><br><span class="line">|        |                               |     Server    |</span><br><span class="line">|        |&lt;-(F)--- Protected Resource ---|               |</span><br><span class="line">+--------+                               +---------------+</span><br><span class="line">             Figure 1: Abstract Protocol Flow</span><br></pre></td></tr></table></figure><p>  这种基于OAuth的认证机制适用于个人消费者类的互联网产品，然后社交类APP等应用，但不适合拥有自认证权限管理的企业应用。</p><h3 id="2-4-Token-Auth"><a href="#2-4-Token-Auth" class="headerlink" title="2.4 Token Auth"></a>2.4 Token Auth</h3><h5 id="2-4-1大概流程"><a href="#2-4-1大概流程" class="headerlink" title="2.4.1大概流程"></a>2.4.1大概流程</h5><ol><li>客户端使用用户名等请求登录</li><li>服务器端收到请求，验证用户名</li><li>验证成功后，服务器端签发token，再把token返回给客户端</li><li>客户端收到Token以后可以把它存储起来，比如放在Cookie里面</li><li>客户端每次收到服务端请求资源的时候需要带着客户端签发的token</li><li>服务器端收到请求，然后去验证客户端请求携带的token，验证成功，则取数据并返回。</li></ol><h5 id="2-4-2-与cookie对比"><a href="#2-4-2-与cookie对比" class="headerlink" title="2.4.2 与cookie对比"></a>2.4.2 与cookie对比</h5><table><thead><tr><th>Token</th><th>Cookie</th></tr></thead><tbody><tr><td>支持跨域</td><td>不支持跨域</td></tr><tr><td>无状态</td><td>有状态</td></tr><tr><td>更加适合CDN</td><td></td></tr><tr><td>去耦合</td><td></td></tr><tr><td>不行考虑CSRF</td><td></td></tr><tr><td>性能高</td><td></td></tr></tbody></table><blockquote><p>CSRF:跨站请求仿造，基于Cookie的弱点</p></blockquote><blockquote><p>无状态登录：服务器端不保存登录信息；有状态（比如cookie）服务器端要存储信息。</p></blockquote><h2 id="3-JWT"><a href="#3-JWT" class="headerlink" title="3. JWT"></a>3. JWT</h2><p>​    JSON WEB Token ，是一种非常轻巧的规范。运行我们在用户与服务器间传输安全可靠的信息。</p><h3 id="JWT组成"><a href="#JWT组成" class="headerlink" title="JWT组成"></a>JWT组成</h3><p>​    <strong>头部：</strong>用于描述关于该JWT的最基本的信息，例如其类型以及签名所用的算法等。这也可以被表示成一个JSON对象。</p><p>​    <strong>载荷：</strong>载荷就是存放有效信息的地方。这个名字像是特指飞机上承载的货品，这些有效信息包 含三个部分</p><p>​    <strong>签证：</strong>这个部分需要base64加密后的header和base64加密后的payload使用.连接组成的字符串，然后通过header中声明的加密方式进行加盐secret组合加密，然后就构成了jwt的签证。</p><h2 id="4-微信小程序实战"><a href="#4-微信小程序实战" class="headerlink" title="4. 微信小程序实战"></a>4. 微信小程序实战</h2><p>​    基于以上的介绍，结合微信小程序的特色，我们选择了token来进行认证。下图展示了微信小程序的认证流程。</p><img src="https://res.wx.qq.com/wxdoc/dist/assets/img/api-login.2fcc9f35.jpg" class="lazyload" data-srcset="https://res.wx.qq.com/wxdoc/dist/assets/img/api-login.2fcc9f35.jpg" srcset="data:image/png;base64,666"><p>​    结合微信小程序的认证过程，我们大致的执行流程如下：</p><ol><li>微信小程序启动，调用wx.login获取code，wx.request携带code访问个人服务器</li><li>个人服务器发送HTTP请求调用微信接口，拿到openid等信息。</li><li>个人服务器拿到签发的openid，生产token，返回给小程序。</li><li>小程序存储token，每次访问接口时携带上。</li><li>服务器端接受到小程序的调用，校验小程序的token，校验成功则返回数据。</li></ol><h3 id="小程序端代码"><a href="#小程序端代码" class="headerlink" title="小程序端代码"></a>小程序端代码</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 登录</span></span><br><span class="line">wx.login(&#123;</span><br><span class="line">    success: <span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">        wx.request(&#123;</span><br><span class="line">            url: <span class="string">&#x27;http://localhost:9002/user/login&#x27;</span>,</span><br><span class="line">            method: <span class="string">&quot;POST&quot;</span>,</span><br><span class="line">            data: &#123;</span><br><span class="line">                code: res.code</span><br><span class="line">            &#125;,</span><br><span class="line">            success: <span class="function"><span class="params">d</span> =&gt;</span> &#123;</span><br><span class="line">                <span class="comment">// 拿到token并存储</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="服务器端获取openid"><a href="#服务器端获取openid" class="headerlink" title="服务器端获取openid"></a>服务器端获取openid</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> WXResponse <span class="title">getWxuserOpenId</span><span class="params">(String code)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 拼接请求参数</span></span><br><span class="line">    String url = <span class="string">&quot;https://api.weixin.qq.com/sns/jscode2session?appid=&quot;</span></span><br><span class="line">        + wxMsg.getAppId() + <span class="string">&quot;&amp;secret=&quot;</span></span><br><span class="line">        + wxMsg.getAppSecret() + <span class="string">&quot;&amp;js_code=&quot;</span></span><br><span class="line">        + code + <span class="string">&quot;&amp;grant_type=authorization_code&quot;</span>;</span><br><span class="line">    <span class="comment">// 使用restTemplate发送httpGet请求</span></span><br><span class="line">    String response = restTemplate.getForObject(url, String.class);</span><br><span class="line">    WXResponse wxResponse = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        wxResponse = JSON.parseObject(response, WXResponse.class);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> wxResponse;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="服务器端签发token"><a href="#服务器端签发token" class="headerlink" title="服务器端签发token"></a>服务器端签发token</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping(&quot;/login&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Result <span class="title">login</span><span class="params">(<span class="meta">@RequestBody</span> Map msg)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 获取携带的code</span></span><br><span class="line">    String code = (String) msg.get(<span class="string">&quot;code&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (code == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Result(<span class="keyword">false</span>, StatusCode.ERROR, <span class="string">&quot;参数异常&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 根据code获取openid、sessionKey</span></span><br><span class="line">    WXResponse wxResponse = getWxuserOpenId(code);</span><br><span class="line">    <span class="keyword">if</span> (wxResponse == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Result(<span class="keyword">false</span>, StatusCode.ERROR, <span class="string">&quot;openid获取失败&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    String sessionKey = wxResponse.getSession_key();</span><br><span class="line">    String openid = wxResponse.getOpenid();</span><br><span class="line">    <span class="keyword">if</span> (openid == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Result(<span class="keyword">false</span>, StatusCode.ERROR, <span class="string">&quot;openid获取失败&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 生产token，并返回</span></span><br><span class="line">    String token = jwtUtil.createJWT(loginUser.getId(), loginUser.getNickname(), <span class="string">&quot;user&quot;</span>);</span><br><span class="line">    Map map = <span class="keyword">new</span> HashMap();</span><br><span class="line">    map.put(<span class="string">&quot;token&quot;</span>, token);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> Result(<span class="keyword">true</span>, StatusCode.OK, <span class="string">&quot;登录成功&quot;</span>, map);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="5-补充"><a href="#5-补充" class="headerlink" title="5. 补充"></a>5. 补充</h2><p>理解OAuth 2.0：<a href="http://www.ruanyifeng.com/blog/2014/05/oauth_2_0.html">http://www.ruanyifeng.com/blog/2014/05/oauth_2_0.html</a></p><p>RESTful API 设计指南：<a href="http://www.ruanyifeng.com/blog/2014/05/restful_api.html">www.ruanyifeng.com/blog/2014/05/restful_api.html</a></p><p>JSON Web Token 入门教程：<a href="http://www.ruanyifeng.com/blog/2018/07/json_web_token-tutorial.html">www.ruanyifeng.com/blog/2018/07/json_web_token-tutorial.html</a></p>]]></content>
      
      
      <categories>
          
          <category> 技术应用 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 小程序 </tag>
            
            <tag> 认证机制 </tag>
            
            <tag> jwt </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Springboot实现图片上传并返回URL</title>
      <link href="2020/08/02/Springboot%E5%AE%9E%E7%8E%B0%E5%9B%BE%E7%89%87%E4%B8%8A%E4%BC%A0%E5%B9%B6%E8%BF%94%E5%9B%9EURL/"/>
      <url>2020/08/02/Springboot%E5%AE%9E%E7%8E%B0%E5%9B%BE%E7%89%87%E4%B8%8A%E4%BC%A0%E5%B9%B6%E8%BF%94%E5%9B%9EURL/</url>
      
        <content type="html"><![CDATA[<p>​        在很多时候我们都需要使用图片上传的功能，比如：自定义头像、物品的图片描述、文章的插图等，那么我们该如何使用Springboot来方便快捷实现图片上传呢？我们闲话少说，直接上代码。</p><a id="more"></a><h1 id="Springboot实现图片上传并返回URL"><a href="#Springboot实现图片上传并返回URL" class="headerlink" title="Springboot实现图片上传并返回URL"></a>Springboot实现图片上传并返回URL</h1><h2 id="1-问题引入"><a href="#1-问题引入" class="headerlink" title="1. 问题引入"></a>1. 问题引入</h2><p>​        在很多时候我们都需要使用图片上传的功能，比如：自定义头像、物品的图片描述、文章的插图等，那么我们该如何使用Springboot来方便快捷实现图片上传呢？我们闲话少说，直接上代码。</p><h2 id="2-后端代码"><a href="#2-后端代码" class="headerlink" title="2. 后端代码"></a>2. 后端代码</h2><h3 id="1-创建Maven工程"><a href="#1-创建Maven工程" class="headerlink" title="1. 创建Maven工程"></a>1. 创建Maven工程</h3><p>pom文件依赖</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="2-编写代码"><a href="#2-编写代码" class="headerlink" title="2. 编写代码"></a>2. 编写代码</h3><ol><li><p>启动类</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UploadApplication</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(UploadApplication.class);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>启动类没啥好说的。</p></blockquote></li><li><p>service</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UploadService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> List&lt;String&gt; CONTENT_TYPES =</span><br><span class="line">            Arrays.asList(<span class="string">&quot;image/jpeg&quot;</span>, <span class="string">&quot;image/gif&quot;</span>, <span class="string">&quot;image/png&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 图片上传：</span></span><br><span class="line"><span class="comment">     * 1. 判断文件类型合法性</span></span><br><span class="line"><span class="comment">     * 2. 判断文件内容合法性</span></span><br><span class="line"><span class="comment">     * 3. 保存文件</span></span><br><span class="line"><span class="comment">     * 4. 返回url</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> file</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">upload</span><span class="params">(MultipartFile file)</span> </span>&#123;</span><br><span class="line">        String originalFilename = file.getOriginalFilename();</span><br><span class="line">        <span class="comment">// 获取文件content type，判断是否为图片</span></span><br><span class="line">        String contentType = file.getContentType();</span><br><span class="line">        <span class="keyword">if</span> (!CONTENT_TYPES.contains(contentType)) &#123;</span><br><span class="line">            <span class="comment">// 文件类型不合法</span></span><br><span class="line">            System.out.println(<span class="string">&quot;ERROR，文件类型不合法！&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 读取文件</span></span><br><span class="line">            BufferedImage bufferedImage = ImageIO.read(file.getInputStream());</span><br><span class="line">            <span class="comment">// 判断文件内容合法性</span></span><br><span class="line">            <span class="keyword">if</span> (bufferedImage == <span class="keyword">null</span>) &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;ERROR，文件内容不合法！&quot;</span>);</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 将文件保存到服务器中</span></span><br><span class="line">            file.transferTo(<span class="keyword">new</span> File(<span class="string">&quot;D:\\test\\&quot;</span> + originalFilename));</span><br><span class="line">            <span class="comment">// 返回文件连接</span></span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;http://localhost/&quot;</span> + originalFilename;</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;ERROR，服务器内部错误！&quot;</span>);</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>service层是文件上传逻辑处理的关键，主要流程是：</p><pre><code> 1. 判断文件名是否合法 2. 判断文件内容是否合法 3. 保存文件【处理文件名】 4. 拼接url并返回</code></pre></blockquote></li><li><p>controller</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/upload&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UploadController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UploadService uploadService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 图片上传</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> file</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;image&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Result <span class="title">uploadImage</span><span class="params">(<span class="meta">@RequestParam(&quot;file&quot;)</span> MultipartFile file)</span> </span>&#123;</span><br><span class="line">        String url = <span class="keyword">this</span>.uploadService.upload(file);</span><br><span class="line">        <span class="keyword">if</span> (url == <span class="keyword">null</span> || url.length() == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> Result(<span class="keyword">false</span>, StatusCode.ERROR, <span class="string">&quot;图片上传异常&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Result(<span class="keyword">false</span>, StatusCode.OK, <span class="string">&quot;图片上传成功&quot;</span>, url);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>这里主要知道使用<code>MultipartFile</code>接收上传的文件。</p><p>这里的Result是自定义的规范，不是本问题的重点。</p></blockquote></li></ol><h2 id="3-Nginx代理"><a href="#3-Nginx代理" class="headerlink" title="3. Nginx代理"></a>3. Nginx代理</h2><p>​        有了上面的步骤，我们可以实现文件上传到服务器端的磁盘，接下来我们使用Nginx将访问路径代理到我们存储图片的地方。</p><p>Nginx配置文件</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">listen       8888;</span><br><span class="line">server_name  localhost;</span><br><span class="line"></span><br><span class="line"># 将其它图片代理指向本地图片所在目录</span><br><span class="line">location &#x2F; &#123;</span><br><span class="line">root   D:&#x2F;test;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>上面的配置文件表明了：nginx将所有访问的8888端口代理到了D盘的test目录下。</p></blockquote><h2 id="4-测试"><a href="#4-测试" class="headerlink" title="4. 测试"></a>4. 测试</h2><p>我们使用Postman，以Post方式，在Body中以form-data中使用file类型进行选择图片提交。可以参考： <a href="https://blog.csdn.net/qq_30033537/article/details/105604665">https://blog.csdn.net/qq_30033537/article/details/105604665</a> </p><h2 id="5-总结"><a href="#5-总结" class="headerlink" title="5. 总结"></a>5. 总结</h2><p>​        实现图片上传并不麻烦，写这次博客主要是最近使用了图片上传的功能，有点陌生，写下来以后用到看起来也方便。哈哈哈哈哈哈哈！！！没错，被你们看穿了，我就是来水博客的，兑现之前立下的flag。</p>]]></content>
      
      
      <categories>
          
          <category> 理论学习 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 文件上传 </tag>
            
            <tag> SpringBoot </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>数据结构2-栈和队列</title>
      <link href="2020/07/24/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%842-%E6%A0%88%E5%92%8C%E9%98%9F%E5%88%97/"/>
      <url>2020/07/24/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%842-%E6%A0%88%E5%92%8C%E9%98%9F%E5%88%97/</url>
      
        <content type="html"><![CDATA[<p>数据结构：栈和队列学习。</p><a id="more"></a><h1 id="数据结构2-栈和队列"><a href="#数据结构2-栈和队列" class="headerlink" title="数据结构2-栈和队列"></a>数据结构2-栈和队列</h1><h2 id="1-栈"><a href="#1-栈" class="headerlink" title="1. 栈"></a>1. 栈</h2><ol><li><p>概述</p><p>​    栈也是一种线性结构，和数组相比，是数组操作的子集，规定了只能从一端添加元素，也只能从这一端取出元素，这一端称为栈顶。栈是一种后进先出（LIFO）的数据结构。</p></li><li><p>应用</p><p>undo操作-编辑器</p><p>系统调用栈-os</p><p>括号匹配-编译器</p></li><li><p>实现</p><p>1）定义栈的接口</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> top.tobing.ds.stack;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Stack</span>&lt;<span class="title">E</span>&gt; </span>&#123;</span><br><span class="line"><span class="comment">// 获取栈的大小</span></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">getSize</span><span class="params">()</span></span>;</span><br><span class="line"><span class="comment">// 判断栈是否为空</span></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">isEmpty</span><span class="params">()</span></span>;</span><br><span class="line"><span class="comment">// 讲一个元素压栈</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">push</span><span class="params">(E e)</span></span>;</span><br><span class="line"><span class="comment">// 将栈顶元素弹出</span></span><br><span class="line">    <span class="function">E <span class="title">pop</span><span class="params">()</span></span>;</span><br><span class="line"><span class="comment">// 查看栈顶元素</span></span><br><span class="line">    <span class="function">E <span class="title">peek</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>2）利用之前编写的动态数组</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> top.tobing.ds.stack;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Tobing</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ArrayStack</span>&lt;<span class="title">E</span>&gt; <span class="keyword">implements</span> <span class="title">Stack</span>&lt;<span class="title">E</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Array&lt;E&gt; array;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ArrayStack</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.array = <span class="keyword">new</span> Array&lt;&gt;();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ArrayStack</span><span class="params">(<span class="keyword">int</span> capacity)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.array = <span class="keyword">new</span> Array&lt;&gt;(capacity);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getSize</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> array.getSize();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isEmpty</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> array.isEmpty();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 返回栈的容量</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getCapacity</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> array.getCapacity();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">push</span><span class="params">(E e)</span> </span>&#123;</span><br><span class="line">        array.addLast(e);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> E <span class="title">pop</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> array.removeLast();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> E <span class="title">peek</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> array.getLast();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        StringBuilder sb = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">        sb.append(<span class="string">&quot;Stack: &quot;</span>);</span><br><span class="line">        sb.append(<span class="string">&quot;[&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; array.getSize(); i++) &#123;</span><br><span class="line">            sb.append(array.get(i));</span><br><span class="line">            <span class="keyword">if</span> (i != array.getSize() - <span class="number">1</span>) &#123;</span><br><span class="line">                sb.append(<span class="string">&quot;, &quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        sb.append(<span class="string">&quot;] top&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> sb.toString();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>Array的代码查看数据结构1-数组</p></blockquote></li><li><p>复杂度分析</p><table><thead><tr><th>函数名</th><th>复杂度</th><th>其他说明</th></tr></thead><tbody><tr><td>push</td><td>O(1)均摊</td><td>压栈的时候可能触发resize</td></tr><tr><td>pop</td><td>O(1)均摊</td><td>弹栈的时候可能触发resize</td></tr><tr><td>peek</td><td>O(1)</td><td></td></tr></tbody></table></li><li><p>Java中的栈</p><p>​        <code>Stack</code> 类表示后进先出（LIFO）的对象堆栈。它通过五个操作对类 <code>Vector</code> 进行了扩展  ，允许将向量视为堆栈。它提供了通常的 <code>push</code> 和 <code>pop</code> 操作，以及取堆栈顶点的 <code>peek</code>  方法、测试堆栈是否为空的 <code>empty</code> 方法、在堆栈中查找项并确定到堆栈顶距离的 <code>search</code> 方法。  </p><p>首次创建堆栈时，它不包含项。  </p><p><a href="../../java/util/Deque.html"><code>Deque</code></a> 接口及其实现提供了 LIFO  堆栈操作的更完整和更一致的 set，应该优先使用此 set，而非此类。例如： </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Deque&lt;Integer&gt; stack = <span class="keyword">new</span> ArrayDeque&lt;Integer&gt;();</span><br></pre></td></tr></table></figure></li></ol><h2 id="2-队列"><a href="#2-队列" class="headerlink" title="2. 队列"></a>2. 队列</h2><ol><li><p>概述</p><p>​    队列也是一种线性结构，和数组相比，是数组操作的子集，规定了只能从一端（队尾）添加元素，也只能从另外一端（队首）取出元素，这一端称为栈顶。栈是一种先进先出（FIFO）的数据结构。</p></li><li><p>实现</p><p>1）定义队列接口</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> top.tobing.ds.queue;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Queue</span>&lt;<span class="title">E</span>&gt; </span>&#123;</span><br><span class="line"><span class="comment">// 获取队列大小</span></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">getSize</span><span class="params">()</span></span>;</span><br><span class="line"><span class="comment">// 判断是否为空队列</span></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">isEmpty</span><span class="params">()</span></span>;</span><br><span class="line"><span class="comment">// 入队</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">enqueue</span><span class="params">(E e)</span></span>;</span><br><span class="line"><span class="comment">// 出队</span></span><br><span class="line">    <span class="function">E <span class="title">dequeue</span><span class="params">()</span></span>;</span><br><span class="line"><span class="comment">// 查看队首元素</span></span><br><span class="line">    <span class="function">E <span class="title">getFront</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>2）队列实现1-数组队列</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> top.tobing.ds.queue;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Tobing</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ArrayQueue</span>&lt;<span class="title">E</span>&gt; <span class="keyword">implements</span> <span class="title">Queue</span>&lt;<span class="title">E</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Array&lt;E&gt; array;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ArrayQueue</span><span class="params">(<span class="keyword">int</span> capacity)</span> </span>&#123;</span><br><span class="line">        array = <span class="keyword">new</span> Array&lt;&gt;(capacity);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ArrayQueue</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        array = <span class="keyword">new</span> Array&lt;&gt;();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getSize</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> array.getSize();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isEmpty</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> array.isEmpty();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">enqueue</span><span class="params">(E e)</span> </span>&#123;</span><br><span class="line">        array.addLast(e);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> E <span class="title">dequeue</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> array.removeFirst();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> E <span class="title">getFront</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> array.getFirst();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getCapacity</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> array.getCapacity();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        StringBuilder sb = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">        sb.append(<span class="string">&quot;Queue:  front [&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; array.getSize(); i++) &#123;</span><br><span class="line">            sb.append(array.get(i));</span><br><span class="line">            <span class="keyword">if</span> (i != array.getSize() - <span class="number">1</span>) &#123;</span><br><span class="line">                sb.append(<span class="string">&quot;, &quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        sb.append(<span class="string">&quot;] tail&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> sb.toString();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>2）队列实现2-循环队列</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> top.tobing.ds.queue;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> top.tobing.ds.queue.Queue;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Tobing</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LoopQueue</span>&lt;<span class="title">E</span>&gt; <span class="keyword">implements</span> <span class="title">Queue</span>&lt;<span class="title">E</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> E[] data;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> front, tail;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> size;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">LoopQueue</span><span class="params">(<span class="keyword">int</span> capacity)</span> </span>&#123;</span><br><span class="line">        front = <span class="number">0</span>;</span><br><span class="line">        tail = <span class="number">0</span>;</span><br><span class="line">        size = <span class="number">0</span>;</span><br><span class="line">        data = (E[]) <span class="keyword">new</span> Object[capacity + <span class="number">1</span>];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">LoopQueue</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>(<span class="number">10</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getSize</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.size;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isEmpty</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> front == tail;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">enqueue</span><span class="params">(E e)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> ((tail + <span class="number">1</span>) % data.length == front) &#123;</span><br><span class="line">            resize(getCapacity() * <span class="number">2</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        data[tail] = e;</span><br><span class="line">        size++;</span><br><span class="line">        tail = (tail + <span class="number">1</span>) % data.length;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> E <span class="title">dequeue</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (isEmpty()) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">&quot;Queue is empty.&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        E res = data[front];</span><br><span class="line">        data[front] = <span class="keyword">null</span>;</span><br><span class="line">        front++;</span><br><span class="line">        size--;</span><br><span class="line">        <span class="comment">// 懒汉式：防止复杂度闪烁</span></span><br><span class="line">        <span class="keyword">if</span> (size == getCapacity() / <span class="number">4</span> &amp;&amp; getCapacity() / <span class="number">2</span> != <span class="number">0</span>) &#123;</span><br><span class="line">            resize(getCapacity() / <span class="number">2</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 扩容</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">resize</span><span class="params">(<span class="keyword">int</span> capacity)</span> </span>&#123;</span><br><span class="line">        E[] newData = (E[]) <span class="keyword">new</span> Object[capacity];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; size; i++) &#123;</span><br><span class="line">            newData[i] = data[(i + front) % data.length];</span><br><span class="line">        &#125;</span><br><span class="line">        data = newData;</span><br><span class="line">        front = <span class="number">0</span>;</span><br><span class="line">        tail = size;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> E <span class="title">getFront</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> data[front];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getCapacity</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> data.length - <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        StringBuilder sb = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">        sb.append(<span class="string">&quot;Queue:  front [&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = front; i != tail; i = (i + <span class="number">1</span>) % data.length) &#123;</span><br><span class="line">            sb.append(data[i]);</span><br><span class="line">            <span class="keyword">if</span> ((i + <span class="number">1</span>) % data.length != tail) &#123;</span><br><span class="line">                sb.append(<span class="string">&quot;, &quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        sb.append(<span class="string">&quot;] tail&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> sb.toString();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>复杂度分析</p><p>1）数组复杂度</p><table><thead><tr><th>函数</th><th>复杂度</th><th>其他说明</th></tr></thead><tbody><tr><td>enqueue</td><td>O(1)均摊</td><td>可能触发resize</td></tr><tr><td>dequeue</td><td>O(n）</td><td>可能触发resize</td></tr><tr><td>getFront</td><td>O(1)</td><td></td></tr><tr><td>getCapacity</td><td>O(1)</td><td></td></tr></tbody></table><p>​    从上面的复杂度分析可知，数组方式实现的队列在每次出队之后，要将剩下的所有元素挪动一遍，导致复杂度O(n)，因此我们考虑在不挪动的情况下实现队列。于是便有了循环队列。</p><p>2）循环队列复杂度</p><table><thead><tr><th>函数</th><th>复杂度</th><th>其他说明</th></tr></thead><tbody><tr><td>enqueue</td><td>O(1)均摊</td><td>可能触发resize</td></tr><tr><td>dequeue</td><td>O(1)均摊</td><td>可能触发resize</td></tr><tr><td>resize</td><td>O(n)</td><td></td></tr><tr><td>getFront</td><td>O(1)</td><td></td></tr><tr><td>getCapacity</td><td>O(1)</td><td></td></tr><tr><td>getSize</td><td>O(1)</td><td></td></tr></tbody></table></li><li><p>代码注意点</p><p>​    数组方式实现的队列基本都是在Array上进行封装，Array之前已经分析过，因此我们不在进行赘述，我们主要讨论循环队列的实现。</p><p>循环队列使用front和tail记录了队列的队首和队尾。</p><p>循环队列如果全部利用所有元素，判断<strong>front==tail</strong>会有歧义，因此浪费一个元素消除歧义。</p><p>循环队列通过判断**(tail+1)%data.length==front**来巧妙地判断队列是否满。</p><p>循环队列<strong>入队、出队、扩容</strong>的时候都要维护<strong>front、tail、size</strong>。</p><p>循环队列遍历可以有多种方式，通过判断<strong>下标是否为tail</strong>或者<strong>循环次数是否为size</strong>可以判定循环是否可以结束。</p><p><strong>入队</strong>时注意判断队列是否已满（resize），维护size和tail。</p><p><strong>出队</strong>时注意判断队列是否已经为空，同时也要判断是否要进行resize，维护front和size。</p><p><strong>resize</strong>的时候注意维护front、tail和size。</p></li><li><p>Java中的队列</p><p>​    队列通常（但并非一定）以 FIFO（先进先出）的方式排序各个元素。不过优先级队列和 LIFO  队列（或堆栈）例外，前者根据提供的比较器或元素的自然顺序对元素进行排序，后者按  LIFO（后进先出）的方式对元素进行排序。无论使用哪种排序方式，队列的<em>头</em> 都是调用 <a href="../../java/util/Queue.html#remove()"><code>remove()</code></a> 或 <a href="../../java/util/Queue.html#poll()"><code>poll()</code></a> 所移除的元素。在 FIFO  队列中，所有的新元素都插入队列的<em>末尾</em>。其他种类的队列可能使用不同的元素放置规则。每个 <code>Queue</code> 实现必须指定其顺序属性。  </p></li></ol>]]></content>
      
      
      <categories>
          
          <category> 理论学习 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数据结构 </tag>
            
            <tag> 栈 </tag>
            
            <tag> 队列 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MongoDB初识</title>
      <link href="2020/07/18/MongoDB%E5%88%9D%E8%AF%86/"/>
      <url>2020/07/18/MongoDB%E5%88%9D%E8%AF%86/</url>
      
        <content type="html"><![CDATA[<p>​        MongoDB是一个跨平台、面向文档的数据库，是当前NoSQL中最热门的一种。它介于关系型和非关系型数据库之间，是非关系型数据库中：功能最丰富、最像关系型数据库的产品。它支持的数据结构非常松散，是类似Json的Bson格式，因此可以存储较为复杂的数据。</p><a id="more"></a><h1 id="MongoDB初识"><a href="#MongoDB初识" class="headerlink" title="MongoDB初识"></a>MongoDB初识</h1><h2 id="1-简介"><a href="#1-简介" class="headerlink" title="1. 简介"></a>1. 简介</h2><p>​        MongoDB是一个跨平台、面向文档的数据库，是当前NoSQL中最热门的一种。它介于关系型和非关系型数据库之间，是非关系型数据库中：功能最丰富、最像关系型数据库的产品。它支持的数据结构非常松散，是类似Json的Bson格式，因此可以存储较为复杂的数据。</p><p>​        MongoDB官网： <a href="https://www.mongodb.com/">https://www.mongodb.com/</a> </p><h3 id="1-特点"><a href="#1-特点" class="headerlink" title="1. 特点"></a>1. 特点</h3><p>​        MongoDB最大特点是：支持的查询语言非常强大，语法类似面向对象的查询语句，几乎可以实现所有关系型数据库单表查询的绝大部分功能，而且还支持对数据库建立索引。MongoDB是面向集合的，模式自由的文档型数据库。</p><p>1）面向集合存储，易于存储对象型数据</p><p>2）模式自由</p><p>3）支持动态查询</p><p>4）支持完全索引，包含内部对象</p><p>5）支持复制和故障恢复</p><p>6）使用高效的二进制数据存储，包括大型对象（比如视频等）</p><p>7）支持Python、PHP、Java、Ruby、C、C#、JS等语言的驱动程序。</p><p>8）文件存储格式为BSON（JSON的扩展）</p><h3 id="2-体系结构"><a href="#2-体系结构" class="headerlink" title="2. 体系结构"></a>2. 体系结构</h3><p>​        MongoDB的逻辑结构是一种层次结构，由Document、Collection、Database三部分组成，逻辑结构是面向用户的。</p><p>1）Document：相当关系型数据库表的一行<strong>记录</strong>。</p><p>2）Collection：相当于关系型数据库的一张<strong>表</strong>，可以存储多个Document。</p><p>3）Database：相当于关系型数据库的一个<strong>数据库</strong>，可以存储多个Collection。</p><h3 id="3-数据类型"><a href="#3-数据类型" class="headerlink" title="3. 数据类型"></a>3. 数据类型</h3><table><thead><tr><th>数据类型</th><th>特点</th><th>示例</th></tr></thead><tbody><tr><td>null</td><td>空值、或不存在的值</td><td>{“x”:nul}</td></tr><tr><td>布尔型</td><td>true、false</td><td>{“x”:true}</td></tr><tr><td>数值</td><td>默认使用64浮点型，NumberInt可以定义使用整型</td><td>{“x”:NumberInt(1)}</td></tr><tr><td>字符串</td><td>UTF-8</td><td>{“x”:”呵呵”}</td></tr><tr><td>日期</td><td>毫秒数，不存储时区</td><td>{“x”:new Date()}</td></tr><tr><td>正则表达式</td><td>查询时，可以作为条件</td><td>{“x”:/[abc]/}</td></tr><tr><td>数组</td><td>类别Java</td><td>{“x”:[“a”,”b”]}</td></tr><tr><td>内嵌对象</td><td>文档内可以嵌套其他文档对象</td><td>{“x”:{“y”:3}}</td></tr><tr><td>对象id</td><td>12字节字符串，文档的唯一标识</td><td>{“x”:objectId()}</td></tr><tr><td>二进制数据</td><td>非UTF-8数据</td><td></td></tr><tr><td>代码</td><td>查询和文档中可以包含任何JS代码</td><td>{“x”:function(){…}}</td></tr></tbody></table><h2 id="2-MongoDB简单使用"><a href="#2-MongoDB简单使用" class="headerlink" title="2. MongoDB简单使用"></a>2. MongoDB简单使用</h2><h3 id="1-安装【Windows】"><a href="#1-安装【Windows】" class="headerlink" title="1. 安装【Windows】"></a>1. 安装【Windows】</h3><p>​    1）下载安装文件</p><p>​    2）安装在指定目录</p><p>​    3）将该目录添加到环境变量中 </p><p> <a href="https://docs.mongodb.com/manual/tutorial/install-mongodb-on-windows/">https://docs.mongodb.com/manual/tutorial/install-mongodb-on-windows/</a> </p><h3 id="2-启动"><a href="#2-启动" class="headerlink" title="2. 启动"></a>2. 启动</h3><p>1）新建cmd窗口</p><p>2）使用mongod设置数据库存放目录</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 创建目录</span></span><br><span class="line">md D:\mongodata</span><br><span class="line"><span class="meta">#</span><span class="bash"> 指定目录</span></span><br><span class="line">mongod --dbpath=D:\mongodata</span><br></pre></td></tr></table></figure><p>2）输入mongo，进入mongoDB中</p><p>3）输入exit，退出</p><h3 id="3-Docker下安装MongoDB"><a href="#3-Docker下安装MongoDB" class="headerlink" title="3. Docker下安装MongoDB"></a>3. Docker下安装MongoDB</h3><ol><li><p>拉取镜像</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 搜索镜像</span></span><br><span class="line">docker search mongo</span><br><span class="line"><span class="meta">#</span><span class="bash"> 拉取镜像</span></span><br><span class="line">docker pull mongo</span><br></pre></td></tr></table></figure></li><li><p>创建容器</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 守护式方式创建容器</span></span><br><span class="line">docker run -di --name=my_mongodb -p 27017:27017 mongo</span><br></pre></td></tr></table></figure></li><li><p>远程登录</p><p>​    我们之前安装的MongoDB既是服务器端，也是客户端，因此我们使用windows下的远程连接部署在docker上的。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mongo [docker宿主机IP地址]</span><br></pre></td></tr></table></figure></li></ol><h3 id="4-常用命令"><a href="#4-常用命令" class="headerlink" title="4. 常用命令"></a>4. 常用命令</h3><p>​        在使用客户端连上了docker的mongoDB之后，我们使用起来学习常用命令。</p><ol><li><p>选择和创建数据库</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">use [数据库名称]</span><br></pre></td></tr></table></figure><blockquote><p>与MySQL不同，MongoDB下，当指定的数据库名称不存在，则会自动创建一个数据库。</p></blockquote></li><li><p>插入与查询文档</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 插入文档</span></span><br><span class="line">db.[集合名称].insert(数据);</span><br><span class="line"><span class="meta">#</span><span class="bash"> 查询所有文档</span></span><br><span class="line">db.[集合名称].find();</span><br></pre></td></tr></table></figure></li><li><p>演示</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 创建msgdb数据库</span></span><br><span class="line">use msgdb</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 插入文档信息 包含:context,name</span></span><br><span class="line">db.msg.insert(&#123;content:&quot;你好啊，MongoDB！&quot;,name:&quot;tobing&quot;)&#125;);</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查询所有，查看是否插入成功</span></span><br><span class="line">db.msg.find();</span><br></pre></td></tr></table></figure><p>查询结果</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5f1289f78d22f2d94c6e42de&quot;), &quot;content&quot; : &quot;你好啊，MongoDB，这是一句话&quot;, &quot;username&quot; : &quot;tobing&quot; &#125;</span><br></pre></td></tr></table></figure><blockquote><p>观察查询结果我们发现，文档中多了一条**”_id”<strong>的字段，这相当于关系型数据库中的</strong>主键**。</p><p>当插入文档时没有注定，MongoDB会帮我们自动创建，类型为ObjectID类型。</p><p>我们插入时也可以指定，可以是ObjectID类型或者MongoDB支持的任意类型。</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 添加第二条记录</span></span><br><span class="line">db.spit.insert(&#123;&quot;_id&quot;:&quot;1&quot;,content:&quot;你好啊，赤橙梦魇过&quot;,&quot;username&quot;:&quot;zenyet&quot;&#125;)</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 再次查询所有</span></span><br><span class="line">db.spit.find()</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查询一个：查询_id为1的数据</span></span><br><span class="line">db.spit.findOne(&#123;&quot;_id&quot;:&quot;1&quot;&#125;)</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查询前n条记录</span></span><br><span class="line">db.spit.find().limit(3)</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">查询所有</span></span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5f1289f78d22f2d94c6e42de&quot;), &quot;content&quot; : &quot;你好啊，MongoDB，这是一句话&quot;, &quot;username&quot; : &quot;tobing&quot; &#125;</span><br><span class="line">&#123; &quot;_id&quot; : &quot;1&quot;, &quot;content&quot; : &quot;你好啊，赤橙梦魇过&quot;, &quot;username&quot; : &quot;zenyet&quot; &#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查询一个</span></span><br><span class="line">&#123; &quot;_id&quot; : &quot;1&quot;, &quot;content&quot; : &quot;你好啊，赤橙梦魇过&quot;, &quot;username&quot; : &quot;zenyet&quot; &#125;</span><br></pre></td></tr></table></figure></li><li><p>修改和删除文档</p><p>修改</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.集合名称.update(条件，修改的数据)</span><br></pre></td></tr></table></figure><p>删除</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.集合名称.remove(条件)</span><br></pre></td></tr></table></figure><p>示例</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 更新_id为1的content</span></span><br><span class="line">db.spit.update(&#123;&quot;_id&quot;:&quot;1&quot;&#125;,&#123;$set:&#123;content:&quot;Hello, This is new !&quot;&#125;&#125;)</span><br><span class="line"><span class="meta">#</span><span class="bash"> 删除_id为1的文档</span></span><br><span class="line">db.spit.remove(&#123;&quot;_id&quot;:&quot;1&quot;&#125;)</span><br></pre></td></tr></table></figure><blockquote><p>注意：当不加上<code>$set</code>的时候，会将符合条件的记录的其他字段全部清空。</p></blockquote></li><li><p>统计条数</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 统计所有</span></span><br><span class="line">dp.spit.count()</span><br><span class="line"><span class="meta">#</span><span class="bash"> 统计符合条件</span></span><br><span class="line">dp.spit.count(条件)</span><br></pre></td></tr></table></figure></li><li><p>模糊查询</p><p>MongoDB的模糊查询通过正则表达式方式实现的。格式为：/模糊查询字符串/ </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 查询所有content字段包含tobing的文档</span></span><br><span class="line">db.spit.find(&#123;content:/流量/&#125;)</span><br><span class="line"><span class="meta">#</span><span class="bash"> 查询所有content字段以流量开头的文档</span></span><br><span class="line">db.spit.find(&#123;content:/^流量/&#125;)</span><br></pre></td></tr></table></figure></li><li><p>比较运算符</p><p>&lt;、&gt;、&lt;=、&gt;=操作</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">db.集合名称.find(&#123;&quot;Field&quot;:&#123;$gt:value&#125;&#125;) // 大于：field &gt; value</span><br><span class="line">db.集合名称.find(&#123;&quot;Field&quot;:&#123;$lt:value&#125;&#125;) // 小于：field &lt; value</span><br><span class="line">db.集合名称.find(&#123;&quot;Field&quot;:&#123;$gte:value&#125;&#125;) // 大于等于：field &gt;= value</span><br><span class="line">db.集合名称.find(&#123;&quot;Field&quot;:&#123;$lte:value&#125;&#125;) // 小于等于：field &lt;= value</span><br><span class="line">db.集合名称.find(&#123;&quot;Field&quot;:&#123;$ne:value&#125;&#125;) // 不等于：field != value</span><br></pre></td></tr></table></figure></li><li><p>包含与不包含</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 查询id包含101,102的文档</span></span><br><span class="line">db.spit.find(&#123;id:&#123;$in:[&quot;101&quot;,&quot;102&quot;]&#125;&#125;)</span><br><span class="line"><span class="meta">#</span><span class="bash"> 查询不包含的</span></span><br><span class="line">db.spit.find(&#123;id:&#123;$nin:[&quot;101&quot;,&quot;102&quot;]&#125;&#125;)</span><br></pre></td></tr></table></figure></li><li><p>条件连接</p><p>需要查询同时满足两个条件的时候，使用and</p><p>需要查询满足其中一个条件的时候，用or</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash">and:[&#123;&#125;,&#123;&#125;,&#123;&#125;]</span></span><br><span class="line"></span><br><span class="line"><span class="meta">$</span><span class="bash">or:[&#123;&#125;,&#123;&#125;,...]</span></span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 查询符合id=1且name=<span class="string">&quot;tobing&quot;</span>的文档</span></span><br><span class="line">db.spit.find(&#123;$and:[&#123;&quot;id&quot;:1&#125;,&#123;&quot;name&quot;:&quot;tobing&quot;&#125;]&#125;)</span><br><span class="line"><span class="meta">#</span><span class="bash"> 查询符合id=1或name=<span class="string">&quot;tobing&quot;</span>的文档</span></span><br><span class="line">db.spit.find(&#123;$or:[&#123;&quot;id&quot;:1&#125;,&#123;&quot;name&quot;:&quot;tobing&quot;&#125;]&#125;)</span><br></pre></td></tr></table></figure></li><li><p>列值增长</p><p>可以使用<code>$inc运算符</code>对原有的值进行增加或减少</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.spit.udpate(&#123;_id:&quot;2&quot;&#125;,&#123;$inc:&#123;visits:NumberInt(1)&#125;&#125;)</span><br></pre></td></tr></table></figure></li></ol><h2 id="3-Java操作MongoDB"><a href="#3-Java操作MongoDB" class="headerlink" title="3. Java操作MongoDB"></a>3. Java操作MongoDB</h2><h3 id="1-创建maven、导入依赖坐标"><a href="#1-创建maven、导入依赖坐标" class="headerlink" title="1. 创建maven、导入依赖坐标"></a>1. 创建maven、导入依赖坐标</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mongodb<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mongodb-driver<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.6.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="2-创建测试类"><a href="#2-创建测试类" class="headerlink" title="2. 创建测试类"></a>2. 创建测试类</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> top.tobing.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.mongodb.BasicDBObject;</span><br><span class="line"><span class="keyword">import</span> com.mongodb.MongoClient;</span><br><span class="line"><span class="keyword">import</span> com.mongodb.client.FindIterable;</span><br><span class="line"><span class="keyword">import</span> com.mongodb.client.MongoCollection;</span><br><span class="line"><span class="keyword">import</span> com.mongodb.client.MongoDatabase;</span><br><span class="line"><span class="keyword">import</span> org.bson.Document;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Tobing</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MongoTest</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 创建连接</span></span><br><span class="line">        MongoClient client = <span class="keyword">new</span> MongoClient(<span class="string">&quot;192.168.8.128&quot;</span>);</span><br><span class="line">        <span class="comment">// 打开数据库</span></span><br><span class="line">        MongoDatabase spitdb = client.getDatabase(<span class="string">&quot;spitdb&quot;</span>);</span><br><span class="line">        <span class="comment">// 查询所有</span></span><br><span class="line">        <span class="comment">// testFindAll(spitdb);</span></span><br><span class="line">        <span class="comment">// 条件查询</span></span><br><span class="line">        <span class="comment">// testFindByEx(spitdb);</span></span><br><span class="line">        <span class="comment">// 插入数据</span></span><br><span class="line">        testInsertData(spitdb);</span><br><span class="line">        testFindAll(spitdb);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 关闭连接</span></span><br><span class="line">        client.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">testInsertData</span><span class="params">(MongoDatabase spitdb)</span> </span>&#123;</span><br><span class="line">        MongoCollection&lt;Document&gt; spit = spitdb.getCollection(<span class="string">&quot;spit&quot;</span>);</span><br><span class="line"></span><br><span class="line">        Map&lt;String, Object&gt; map = <span class="keyword">new</span> HashMap&lt;String, Object&gt;();</span><br><span class="line">        map.put(<span class="string">&quot;username&quot;</span>,<span class="string">&quot;张三丰&quot;</span>);</span><br><span class="line">        map.put(<span class="string">&quot;content&quot;</span>,<span class="string">&quot;我是太极创始人，有我拽？&quot;</span>);</span><br><span class="line">        Document document = <span class="keyword">new</span> Document(map);</span><br><span class="line">        spit.insertOne(document);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 条件查询</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> spitdb</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">testFindByEx</span><span class="params">(MongoDatabase spitdb)</span> </span>&#123;</span><br><span class="line">        MongoCollection&lt;Document&gt; spit = spitdb.getCollection(<span class="string">&quot;spit&quot;</span>);</span><br><span class="line">        <span class="comment">// 构造查询条件</span></span><br><span class="line">        BasicDBObject bson = <span class="keyword">new</span> BasicDBObject(<span class="string">&quot;username&quot;</span>, <span class="string">&quot;tobing&quot;</span>);</span><br><span class="line">        FindIterable&lt;Document&gt; documents = spit.find(bson);</span><br><span class="line">        <span class="keyword">for</span> (Document document : documents) &#123;</span><br><span class="line">            System.out.println(</span><br><span class="line">                    document.get(<span class="string">&quot;username&quot;</span>) + <span class="string">&quot;:&quot;</span> + document.get(<span class="string">&quot;content&quot;</span>));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 查询所有</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> spitdb</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">testFindAll</span><span class="params">(MongoDatabase spitdb)</span> </span>&#123;</span><br><span class="line">        MongoCollection&lt;Document&gt; spit = spitdb.getCollection(<span class="string">&quot;spit&quot;</span>);</span><br><span class="line">        FindIterable&lt;Document&gt; documents = spit.find();</span><br><span class="line">        <span class="keyword">for</span> (Document document : documents) &#123;</span><br><span class="line">            System.out.println(</span><br><span class="line">                    document.get(<span class="string">&quot;username&quot;</span>) + <span class="string">&quot;:&quot;</span> + document.get(<span class="string">&quot;content&quot;</span>));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 理论学习 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> MongoDB </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Docker初识</title>
      <link href="2020/07/17/Docker%E5%88%9D%E8%AF%86/"/>
      <url>2020/07/17/Docker%E5%88%9D%E8%AF%86/</url>
      
        <content type="html"><![CDATA[<p>Docker是一个开源项目，诞生与2013年，最初四dotCloud的一个内部业余项目，后来家人Linux，遵从了Apache2.0协议，GitHub上维护。</p><a id="more"></a><h1 id="Docker"><a href="#Docker" class="headerlink" title="Docker"></a>Docker</h1><h2 id="1-Docker简介"><a href="#1-Docker简介" class="headerlink" title="1. Docker简介"></a>1. Docker简介</h2><h3 id="1-什么是Docker"><a href="#1-什么是Docker" class="headerlink" title="1. 什么是Docker"></a>1. 什么是Docker</h3><p>​    Docker是一个开源项目，诞生与2013年，最初四dotCloud的一个内部业余项目，后来家人Linux，遵从了Apache2.0协议，GitHub上维护。基于go语言。</p><p>​    Docker目标是：实现轻量级操作系统虚拟化解决方案。Docker基础是Linux容器技术（LXC）。</p><p>使用Docker语言</p><ol><li><p>上手快</p><p>​    用户只需要几分钟，便可把自己程序<strong>Docker化</strong>。Docker依赖于<strong>写时复制（copy on write）</strong>模型，使得修改应用程序非常迅速。</p><p>​    Docker启动快，拥有很高性能，可充分利用系统资源。</p></li><li><p>职责逻辑分类</p><p>​    使用Docker，开发人员只需要关心容器中运行的应用程序，而运维人员只需关心如何管理容器。Docker设计的目的就是加强开发人员<strong>生产环境与部署环境的一致性</strong>，从而减少因生产、部署环境不一致而导致的问题。</p></li><li><p>快速高效的开发生命周期、</p><p>​    Docker目标之一就是缩短开发、测试、部署的周期，让程序更具有可以移植性，易于构建。</p></li><li><p>鼓励面向服务的架构</p><p>​    Docker鼓励面向服务的体系结构和微服务架构。</p></li></ol><h3 id="2-容器与虚拟机的比较"><a href="#2-容器与虚拟机的比较" class="headerlink" title="2. 容器与虚拟机的比较"></a>2. 容器与虚拟机的比较</h3><p>​    容器在层面上实现虚拟化，直接复用本地的OS。</p><p>​    虚拟机则是在硬件层面上。</p><p>​    因此容器启动速度快，占用体积小。</p><h3 id="3-容器组件"><a href="#3-容器组件" class="headerlink" title="3. 容器组件"></a>3. 容器组件</h3><ol><li><p>Docker服务器与客户端</p><p>​    Docker是C/S架构程序。Docker客户端只需向Docker服务器或守护进程发起请求，服务器或守护进程将完成所有工作并返回结果。</p></li><li><p>Docker镜像与容器</p><p>​    镜像：构建Docker基石。可以通过一个镜像构建多个不同的容器。</p><p>​    容器：容器基于镜像启动，一旦容器启动完成，可以登录容器安装自己需要的软件后服务。</p></li><li><p>注册中心</p><p>​    Docker用注册中心保持用户镜像，分为共有和私有。DockerHub是Docker运营的公共的Registry。</p><p>​    <a href="https://hub.docker.com/">https://hub.docker.com</a></p></li></ol><h2 id="2-Docker安装与启动"><a href="#2-Docker安装与启动" class="headerlink" title="2. Docker安装与启动"></a>2. Docker安装与启动</h2><h3 id="1-安装Docker"><a href="#1-安装Docker" class="headerlink" title="1. 安装Docker"></a>1. 安装Docker</h3><p>​    Docker官方建议在Ubuntu中安装，因为Docker是基于Ubuntu发布的，而且一般Docker出现的问题Ubuntu是最先更新或者打补丁的。在很多版本的CentOS中是不支持更新最新的一些补丁包的。</p><p>​    下面以Centos7.x安装为例</p><ol><li><p>yum包更新到最新</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo yum update</span><br></pre></td></tr></table></figure></li><li><p>装需要的软件包， yum-util 提供yum-config-manager功能，另外两个是devicemapper驱动依赖的</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo yum install -y yum-utils device-mapper-persistent-data 1vm2</span><br></pre></td></tr></table></figure></li><li><p>设置yum源为阿里云</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</span><br></pre></td></tr></table></figure></li><li><p>安装docker</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo yum install docker-ce ## docker-ce是社区版</span><br></pre></td></tr></table></figure></li><li><p>查看docker安装版本</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker -v</span><br></pre></td></tr></table></figure></li></ol><h3 id="2-设置USTC镜像"><a href="#2-设置USTC镜像" class="headerlink" title="2. 设置USTC镜像"></a>2. 设置USTC镜像</h3><p>​    ustc是老牌的linux镜像服务提供者，ustc的docker镜像加速器速度很快。ustc docker mirror的优势之一就是不需要注册，是真正的公共服务。<a href="https://lug.ustc.edu.cn/wiki/mirrors/help/docker">https://lug.ustc.edu.cn/wiki/mirrors/help/docker</a></p><p>安装好docker之后，编辑配置文件</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/doceker/daemon.json</span><br></pre></td></tr></table></figure><p>在文件中添加以下内容</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line"><span class="attr">&quot;registry-mirrors&quot;</span>: [<span class="string">&quot;https://docker.mirrors.ustc.edu.cn&quot;</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-Docker-启动与停止"><a href="#3-Docker-启动与停止" class="headerlink" title="3.Docker 启动与停止"></a>3.Docker 启动与停止</h3><p><strong>systemctl</strong>：系统服务管理器命令</p><p>启动docker</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl start docker</span><br></pre></td></tr></table></figure><p>停止docker</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl stop docker</span><br></pre></td></tr></table></figure><p>重启docker</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart docekr</span><br></pre></td></tr></table></figure><p>查看docker状态</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl status docker</span><br></pre></td></tr></table></figure><p>开机启动</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl enable docker</span><br></pre></td></tr></table></figure><p>查看docker概要</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker info</span><br></pre></td></tr></table></figure><p>查看docker帮助文档</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker --help</span><br></pre></td></tr></table></figure><h2 id="4-常用命令"><a href="#4-常用命令" class="headerlink" title="4. 常用命令"></a>4. 常用命令</h2><h3 id="1-镜像相关"><a href="#1-镜像相关" class="headerlink" title="1. 镜像相关"></a>1. 镜像相关</h3><ol><li><p>查看镜像</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker images</span><br></pre></td></tr></table></figure><p>REPOSITORY：镜像名称</p><p>TAG：镜像标签</p><p>IMAGE ID：镜像ID</p><p>CREATED：镜像创建日期</p><p>SIZE：大小</p><p>镜像都是存在Docker宿主机的**/var/lib/docker**目录下</p></li><li><p>搜索镜像</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker search 镜像名称</span><br></pre></td></tr></table></figure><p>NAME：仓库名称</p><p>DESCRIPTION：镜像描述</p><p>STARS：和GitHub的类似</p><p>OFFICIAL：是否官方</p><p>ATOMATED：自动构建，表该镜像由Docker Hub自动构建流程创建的</p></li><li><p>拉取镜像</p><p>从中央仓库拉取镜像</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull 镜像名称</span><br></pre></td></tr></table></figure></li><li><p>删除镜像</p><p>根据id删除</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker rmi 镜像ID</span><br></pre></td></tr></table></figure><p>删除所有</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker rmi `docker images -q`</span><br></pre></td></tr></table></figure></li></ol><h3 id="2-容器相关"><a href="#2-容器相关" class="headerlink" title="2. 容器相关"></a>2. 容器相关</h3><ol><li><p>查看容器</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 查看正在运行的容器</span></span><br><span class="line">docker ps</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看所有容器</span></span><br><span class="line">docker ps -a</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看最后一次运行的容器</span></span><br><span class="line">docker ps -l</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看停止的容器</span></span><br><span class="line">docker ps -f status=exited</span><br></pre></td></tr></table></figure></li></ol><ol start="2"><li><p>创建与启动容器</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 创建容器命令</span></span><br><span class="line">docker run</span><br><span class="line"></span><br><span class="line">-i ：表示运行容器</span><br><span class="line">-t ：表容器启动会进入其命令行。</span><br><span class="line">--name ： 为容器指定名</span><br><span class="line">-v ：表示目录映射关系，前者宿主机目录、后者映射到宿主机的目录</span><br><span class="line">-d ：创建守护式容器在后台运行（不会自动登录）</span><br><span class="line">-p ：端口映射， 宿主机端口 容器端口</span><br></pre></td></tr></table></figure></li></ol><p>   1）交互式创建容器</p>   <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -it --name=容器名称 镜像名称:标签 /bin/bash</span><br></pre></td></tr></table></figure><p>   2）守护式创建容器</p>   <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker run -di --name=容器名称 镜像名称:标签</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 退出当前容器</span></span><br><span class="line">exit</span><br></pre></td></tr></table></figure><p>   登录守护式创建容器</p>   <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker exec -it 容器名称、容器id /bin/bash</span><br></pre></td></tr></table></figure><ol start="3"><li><p>停止与启动容器</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 停止容器</span></span><br><span class="line">docker stop 容器名称</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 启动容器</span></span><br><span class="line">docker start 容器名称</span><br></pre></td></tr></table></figure></li></ol><ol start="4"><li><p>文件拷贝</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 文件：宿主机--&gt;容器</span></span><br><span class="line">docker cp 需要拷贝的文件或目录 容器名称:容器目录</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 文件：容器--&gt;宿主机</span></span><br><span class="line">docker cp 容器名称:容器目录 需要拷贝的文件或目录</span><br></pre></td></tr></table></figure></li></ol><ol start="5"><li><p>目录挂载</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 将宿主机的myhtml目录与容器的xxx/myhtml命令解析映射</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 修改任意一方，另外一方就会改变</span></span><br><span class="line">docker run -di -v /usr/myhtml:/usr/local/myhtml --name=mycentos3 centos:7</span><br></pre></td></tr></table></figure><p>如果你共享的是多级的目录，可能会出现权限不足的提示。</p><p>这是因为CentOS7中的安全模块selinux把权限禁掉了，我们需要添加参数  –privileged=true  来解决挂载的目录没有权限的问题</p></li></ol><ol start="6"><li><p>查看容器IP地址</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 查看容器运行的各种数据</span></span><br><span class="line">docker inspect 容器名称</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 直接输出容器的IP地址</span></span><br><span class="line">docker inspect --format=&#x27;&#123;&#123;.NetworkSettings.IPAddress&#125;&#125;&#x27;</span><br></pre></td></tr></table></figure></li></ol><ol start="7"><li><p>删除容器 </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 删除指定容器</span></span><br><span class="line">docker rm 容器名称</span><br></pre></td></tr></table></figure></li></ol><h2 id="5-应用部署"><a href="#5-应用部署" class="headerlink" title="5. 应用部署"></a>5. 应用部署</h2><h3 id="1-MySQL"><a href="#1-MySQL" class="headerlink" title="1. MySQL"></a>1. MySQL</h3><ol><li><p>拉取mysql镜像</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull centos/mysql-57-centos7</span><br></pre></td></tr></table></figure></li><li><p>创建容器</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -di --name=ownmysql -p 33306:3306 -e MYSQL_ROOT_PASSWORD=123456 centos/mysql-57-centos7</span><br></pre></td></tr></table></figure><p>-p 端口映射</p><p>-e 添加环境变量 MYSQL_ROOT_PASSWORD  是root用户的登陆密码</p></li><li><p>远程登录</p><p>连接宿主机的ip、端口为33306</p></li></ol><h3 id="2-tomcat部署"><a href="#2-tomcat部署" class="headerlink" title="2. tomcat部署"></a>2. tomcat部署</h3><ol><li><p>拉取镜像</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull tomcat:7-jre7</span><br></pre></td></tr></table></figure></li><li><p>创建容器</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -di --name=mytomcat -p 9000:8080 -v /usr/local/webapps:/usr/local/tomcat/webapps tomcat:7-jre7</span><br></pre></td></tr></table></figure></li></ol><h3 id="3-Nginx部署"><a href="#3-Nginx部署" class="headerlink" title="3. Nginx部署"></a>3. Nginx部署</h3><ol><li><p>拉取镜像</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull nginx</span><br></pre></td></tr></table></figure></li><li><p>创建nginx容器</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -di --name=mynginx -p 80:80 nginx</span><br></pre></td></tr></table></figure></li></ol><h3 id="4-Redis部署"><a href="#4-Redis部署" class="headerlink" title="4. Redis部署"></a>4. Redis部署</h3><ol><li><p>拉取</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull redis</span><br></pre></td></tr></table></figure></li><li><p>部署</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -di --name=myredis -p 6379:6379 redis</span><br></pre></td></tr></table></figure></li></ol><hr><p>待更新</p>]]></content>
      
      
      <categories>
          
          <category> 理论学习 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> docker </tag>
            
            <tag> 容器技术 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>数据结构-数组</title>
      <link href="2020/07/10/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%841-%E6%95%B0%E7%BB%84/"/>
      <url>2020/07/10/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%841-%E6%95%B0%E7%BB%84/</url>
      
        <content type="html"><![CDATA[<p>数据结构数组的的学习笔记。</p><a id="more"></a><h1 id="数据结构-数组"><a href="#数据结构-数组" class="headerlink" title="数据结构-数组"></a>数据结构-数组</h1><h2 id="1-数组概述"><a href="#1-数组概述" class="headerlink" title="1. 数组概述"></a>1. 数组概述</h2><ol><li><p>特点</p><p>顺序存放、可以随机访问。</p></li><li><p>缺点</p><p>数组功能比较弱，考虑封装。</p></li></ol><h2 id="2-封装自己的数组"><a href="#2-封装自己的数组" class="headerlink" title="2. 封装自己的数组"></a>2. 封装自己的数组</h2><ol><li><p>引入</p><p>为了增强数组的功能，我们对数组进行二次封装，虽然Java已经有ArrayList对数组进行了封装，但为了学习，我们对数组进行封装。</p></li><li><p>代码</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> top.tobing.ds.array;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Array</span>&lt;<span class="title">E</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> E[] data;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> size;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 构造函数，传入数组的容量capacity构造Array</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Array</span><span class="params">(<span class="keyword">int</span> capacity)</span> </span>&#123;</span><br><span class="line">        data = (E[]) <span class="keyword">new</span> Object[capacity];</span><br><span class="line">        size = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 默认构造</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Array</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>(<span class="number">10</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取数组的容量</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getCapacity</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> data.length;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取数组的元素个数</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getSize</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> size;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 判断数组是否为空</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isEmpty</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> size == <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 在所有元素后添加一个元素</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addLast</span><span class="params">(E e)</span> </span>&#123;</span><br><span class="line">        add(size, e);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 在使用元素前添加一个元素</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addFirst</span><span class="params">(E e)</span> </span>&#123;</span><br><span class="line">        add(<span class="number">0</span>, e);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 在索引index处添加一个元素</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> index, E e)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (index &lt; <span class="number">0</span> || index &gt; data.length) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">&quot;Add failed. Require index &gt;= 0 and index &lt;= size&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (index == data.length) &#123;</span><br><span class="line">            resize(<span class="number">2</span> * data.length);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = size; i &gt; index; i--) &#123;</span><br><span class="line">            data[i] = data[i - <span class="number">1</span>];</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        data[index] = e;</span><br><span class="line"></span><br><span class="line">        size++;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取index索引位置的值</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> E <span class="title">get</span><span class="params">(<span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (index &lt; <span class="number">0</span> || index &gt;= size) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">&quot;Get failed. Index is illegal.&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> data[index];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 修改index索引出的值为e</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">set</span><span class="params">(<span class="keyword">int</span> index, E e)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (index &lt; <span class="number">0</span> || index &gt;= size) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">&quot;Set failed, Index is illegal.&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        data[index] = e;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 查找数组中是否包含元素e</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">contains</span><span class="params">(E e)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; size; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (data[i].equals(e)) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 查找数组中元素e所在的索引，如果不存在元素e，返回-1</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">find</span><span class="params">(E e)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; size; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (data[i].equals(e)) &#123;</span><br><span class="line">                <span class="keyword">return</span> i;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 删除数组中索引为index位置的元素，返回被删除的元素</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> E <span class="title">remove</span><span class="params">(<span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (index &lt; <span class="number">0</span> || index &gt;= size) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">&quot;Rmove failed. Index is illegal.&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        E temp = data[index];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = index; i &lt; size - <span class="number">1</span>; i++) &#123;</span><br><span class="line">            data[i] = data[i + <span class="number">1</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        size--;</span><br><span class="line">        data[size] = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 懒汉式：避免复杂度震荡</span></span><br><span class="line">        <span class="keyword">if</span> (size == data.length / <span class="number">4</span> &amp;&amp; data.length / <span class="number">2</span> != <span class="number">0</span>) &#123;</span><br><span class="line">            resize(data.length / <span class="number">2</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> temp;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 删除元素第一个元素</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> E <span class="title">removeFirst</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        E temp = remove(<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">return</span> temp;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 删除元素最后一个元素</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> E <span class="title">removeLast</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        E temp = remove(size - <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">return</span> temp;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 删除数组中元素e</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">removeElement</span><span class="params">(E e)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> index = find(e);</span><br><span class="line">        <span class="keyword">if</span> (index != -<span class="number">1</span>) &#123;</span><br><span class="line">            remove(index);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        StringBuilder builder = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">        builder.append(String.format(<span class="string">&quot;Array: size = %d, capacity = %d\n&quot;</span>, size, data.length));</span><br><span class="line">        builder.append(<span class="string">&#x27;[&#x27;</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; data.length; i++) &#123;</span><br><span class="line">            builder.append(data[i]);</span><br><span class="line">            <span class="keyword">if</span> (i != data.length - <span class="number">1</span>) &#123;</span><br><span class="line">                builder.append(<span class="string">&quot;, &quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        builder.append(<span class="string">&quot;]&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> builder.toString();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 将数组的容量变成newCapacity大小</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">resize</span><span class="params">(<span class="keyword">int</span> newCapacity)</span> </span>&#123;</span><br><span class="line">        E[] newData = (E[]) <span class="keyword">new</span> Object[newCapacity];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; size; i++) &#123;</span><br><span class="line">            newData[i] = data[i];</span><br><span class="line">        &#125;</span><br><span class="line">        data = newData;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>代码中的注意点</p><p>泛型数组在通过指定大小创建时要以<code>(E[])Objec[capacity]</code>方式。</p><p>添加add或者删除remove元素的时候要对传入的index进行合法性校验。</p><p>add和remove都是采用覆盖的方式，区别两种的实现：一个是从后往前移，另一个则相反。</p><p>add和remove的同时要维护size，即更新size。</p><p>remove操作时要对size所在的位置置为null，以至于gc回收。</p><p>find操作判断元素是否相等时要使用equals。</p><p>动态数组时，要注意remove的容量调整时机，使用懒汉式可以避免复杂度震荡。</p></li><li><p>复杂度分析</p><table><thead><tr><th>函数名</th><th>复杂度</th><th>其他</th></tr></thead><tbody><tr><td>add(int,E)</td><td>O(n)</td><td>移动挪位</td></tr><tr><td>addFirst</td><td>O(n)</td><td></td></tr><tr><td>addLast</td><td>O(1)、O(n)</td><td>不用挪位、容量变化</td></tr><tr><td>remove(int,E)</td><td>O(n)</td><td>移动覆盖</td></tr><tr><td>removeFirst</td><td>O(n)</td><td></td></tr><tr><td>removeLast</td><td>O(1)、O(n)</td><td>不用覆盖、容量变化</td></tr><tr><td>removeElement(E)</td><td>O(n)</td><td>遍历查找</td></tr><tr><td>contains</td><td>O(n)</td><td></td></tr><tr><td>find</td><td>O(n)</td><td></td></tr><tr><td>get</td><td>O(1)</td><td></td></tr></tbody></table><p>resize复杂度分析：加上容量为n、n+1次addLast，触发resize，纵观2n+1基本操作平均，每次addLast，进行2次基本操作，O(1)。 这次叫做<strong>均摊复杂度</strong>分析。</p><p>addLast和removeLast同时存在是，如果采用饿汉式，即size=capacity/2立马缩减容量，容易引发复<strong>杂度震荡</strong>。因此考虑使用懒汉式。即推迟到size=capacity/4,才将capacity置为原理一半。</p></li></ol><h2 id="3-拓展"><a href="#3-拓展" class="headerlink" title="3. 拓展"></a>3. 拓展</h2><p>查看Java对ArrayList的实现，对比我们的实现。</p>]]></content>
      
      
      <categories>
          
          <category> 理论学习 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数据结构 </tag>
            
            <tag> 数组 - Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>树莓派连接DHT11</title>
      <link href="2020/06/21/%E6%A0%91%E8%8E%93%E6%B4%BE%E8%BF%9E%E6%8E%A5DHT11/"/>
      <url>2020/06/21/%E6%A0%91%E8%8E%93%E6%B4%BE%E8%BF%9E%E6%8E%A5DHT11/</url>
      
        <content type="html"><![CDATA[<p>本文介绍树莓派读取DHT11的温度。</p><a id="more"></a><h1 id="树莓派读取DHT11并输出"><a href="#树莓派读取DHT11并输出" class="headerlink" title="树莓派读取DHT11并输出"></a>树莓派读取DHT11并输出</h1><h2 id="1-工具"><a href="#1-工具" class="headerlink" title="1. 工具"></a>1. 工具</h2><ul><li>树莓派B+</li><li>DHT11、杜邦线</li></ul><h2 id="2-步骤"><a href="#2-步骤" class="headerlink" title="2. 步骤"></a>2. 步骤</h2><ol><li><p>将DHT11连接到树莓派</p><p><img src="https://i.loli.net/2021/01/15/cBELh4gij21HOyF.jpg" class="lazyload" data-srcset="https://i.loli.net/2021/01/15/cBELh4gij21HOyF.jpg" srcset="data:image/png;base64,666" alt="modelB+"></p><p><img src="https://i.loli.net/2021/01/15/52U4KxCB6wcapuj.png" class="lazyload" data-srcset="https://i.loli.net/2021/01/15/52U4KxCB6wcapuj.png" srcset="data:image/png;base64,666" alt="dht11"></p><blockquote><p>将vcc接到5V或3.3V，GND接GND，DATA接到接到GPIO23【不同树莓派的针脚功能可能不一样，自己上网查询对应版本】</p></blockquote></li><li><p>SSH连接树莓派，安装Adafruit库</p><p>获取Adafruit库</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo git clone https://github.com/adafruit/Adafruit_Python_DHT.git</span><br></pre></td></tr></table></figure><p>安装Adafruit</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd Adafruit_Python_DHT</span><br><span class="line">sudo python setup.py install</span><br><span class="line">sudo python3 setup.py install</span><br></pre></td></tr></table></figure></li><li><p>编写代码读取温度</p><p>创建py文件</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo vim TempTest.py</span><br></pre></td></tr></table></figure><p>编写代码</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Adafruit_DHT</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">sensor = Adafruit_DHT.DHT11</span><br><span class="line"><span class="comment"># 定义GIPO针脚</span></span><br><span class="line">gpio = <span class="number">23</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TempDHT11</span>():</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getTempAndHum</span>(<span class="params">self</span>):</span></span><br><span class="line">        humidity, tempertrue = Adafruit_DHT.read_retry(sensor, gpio)</span><br><span class="line">        <span class="keyword">if</span> humidity <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span> <span class="keyword">and</span> tempertrue <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">return</span> humidity, tempertrue</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    temp = TempDHT11()</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        humD, tempD = temp.getTempAndHum();</span><br><span class="line">        <span class="keyword">if</span> tempD <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">            print(<span class="string">&quot;温度：%1f , 湿度：%1f&quot;</span> % (tempD, humD))</span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li><p>运行</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">pi@raspberrypi:~/Adafruit_Python_DHT/examples $ python3 TempTest2.py</span><br><span class="line">温度：31.000000 , 湿度：77.000000</span><br><span class="line">温度：31.000000 , 湿度：77.000000</span><br><span class="line">温度：31.000000 , 湿度：77.000000</span><br><span class="line">温度：31.000000 , 湿度：77.000000</span><br><span class="line">温度：31.000000 , 湿度：77.000000</span><br><span class="line">温度：31.000000 , 湿度：77.000000</span><br><span class="line">温度：31.000000 , 湿度：77.000000</span><br></pre></td></tr></table></figure></li></ol>]]></content>
      
      
      <categories>
          
          <category> 理论学习 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 树莓派 </tag>
            
            <tag> DHT11 </tag>
            
            <tag> 物联网 </tag>
            
            <tag> 实验 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>真相?</title>
      <link href="2020/03/25/%E7%9C%9F%E7%9B%B8/"/>
      <url>2020/03/25/%E7%9C%9F%E7%9B%B8/</url>
      
        <content type="html"><![CDATA[<p>一则视频。</p><a id="more"></a><h1 id="真相是什么？"><a href="#真相是什么？" class="headerlink" title="真相是什么？"></a>真相是什么？</h1><blockquote><p>真相是什么？我们应该相信谁？</p></blockquote><iframe src="//player.bilibili.com/player.html?aid=89827286&bvid=BV1e741177xT&cid=153417264&page=1" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true"> </iframe><br><p>原地址：<a href="https://www.bilibili.com/video/BV1e741177xT/">https://www.bilibili.com/video/BV1e741177xT/</a></p><hr>当然是相信自己人<p>凡事不要随波逐流，要有自己的观点看法，科学地看待问题。</p>]]></content>
      
      
      <categories>
          
          <category> 杂七杂八 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 分享 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ElasticSearch-上</title>
      <link href="2020/02/27/ElasticSearch-%E4%B8%8A/"/>
      <url>2020/02/27/ElasticSearch-%E4%B8%8A/</url>
      
        <content type="html"><![CDATA[<p>Elaticsearch，简称为es， es是一个开源的高扩展的分布式全文检索引擎，它可以近乎实时的存储、检索数据；本 身扩展性很好，可以扩展到上百台服务器，处理PB级别的数据。es也使用Java开发并使用Lucene作为其核心来实 现所有索引和搜索的功能，但是它的目的是通过简单的RESTful API来隐藏Lucene的复杂性，从而让全文搜索变得 简单。</p><a id="more"></a><h1 id="ElasticSearch-上"><a href="#ElasticSearch-上" class="headerlink" title="ElasticSearch-上"></a>ElasticSearch-上</h1><p>Elaticsearch，简称为es， es是一个开源的高扩展的分布式全文检索引擎，它可以近乎实时的存储、检索数据；本 身扩展性很好，可以扩展到上百台服务器，处理PB级别的数据。es也使用Java开发并使用Lucene作为其核心来实 现所有索引和搜索的功能，但是它的目的是通过简单的RESTful API来隐藏Lucene的复杂性，从而让全文搜索变得 简单。</p><h2 id="1-使用ES"><a href="#1-使用ES" class="headerlink" title="1. 使用ES"></a>1. 使用ES</h2><ol><li><p>官网 <a href="https://www.elastic.co/products/elasticsearch">https://www.elastic.co/products/elasticsearch</a></p></li><li><p>解压ES压缩包</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">bin<span class="comment"># 可执行二进制文件</span></span><br><span class="line">config<span class="comment"># 配置信息目录</span></span><br><span class="line">lib<span class="comment"># jar包存放目录</span></span><br><span class="line">logs<span class="comment"># 日志存放目录</span></span><br><span class="line">modules<span class="comment"># 模块存放目录</span></span><br><span class="line">plugins<span class="comment"># 插件安装目录</span></span><br><span class="line">.....</span><br></pre></td></tr></table></figure></li><li><p>启动ES访问</p><p>Windows：elasticsearch.bat</p><p>Linux：elasticsearch.sh</p></li><li><p>启动ES之后</p><p>9300端口：es的tcp通讯端口，集群间和TCPClient都执行该端口。</p><p>9200端口：http协议的RESTful接口。</p><blockquote><p>打开ES之后，在浏览器中访问127.0.0.1:9200，出现下面结果即表示启动成功。</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;4R2QZyN&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;cluster_name&quot;</span>: <span class="string">&quot;elasticsearch&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;cluster_uuid&quot;</span>: <span class="string">&quot;YQsfD7T8TgmT4tQf2RkEhQ&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;version&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;number&quot;</span>: <span class="string">&quot;5.6.8&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;build_hash&quot;</span>: <span class="string">&quot;688ecce&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;build_date&quot;</span>: <span class="string">&quot;2018-02-16T16:46:30.010Z&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;build_snapshot&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">&quot;lucene_version&quot;</span>: <span class="string">&quot;6.6.1&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;tagline&quot;</span>: <span class="string">&quot;You Know, for Search&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><h2 id="2-使用ES可视化插件"><a href="#2-使用ES可视化插件" class="headerlink" title="2. 使用ES可视化插件"></a>2. 使用ES可视化插件</h2><ol><li><p>下载head插件</p><p><a href="https://github.com/mobz/elasticsearch-head">https://github.com/mobz/elasticsearch-head</a></p></li><li><p>解压缩软件</p></li><li><p>下载安装nodejs</p><p><a href="https://nodejs.org/zh-cn/">https://nodejs.org/zh-cn/</a> </p></li><li><p>使用npm安装工具</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 安装grunt</span></span><br><span class="line">npm install -g grunt-cli</span><br><span class="line"><span class="meta">#</span><span class="bash"> 在解压后的header根目录执行下面命令，启动head</span></span><br><span class="line">npm install</span><br><span class="line">grunt server</span><br></pre></td></tr></table></figure></li><li><p>访问测试</p><p>浏览器中输入：<a href="http://localhost:9100测试">http://localhost:9100测试</a></p></li><li><p>配置es的config文件下yml配置文件配置跨域</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">http.cors.enabled:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">http.cors.allow-origin:</span> <span class="string">&quot;*&quot;</span></span><br></pre></td></tr></table></figure><blockquote><p>重启ES</p></blockquote></li></ol><h2 id="3-ES中的术语"><a href="#3-ES中的术语" class="headerlink" title="3. ES中的术语"></a>3. ES中的术语</h2><ol><li><p>概述</p><p>ES是面向文档（Document）的，可以存储整个对象或者文档。然而他不仅存储，还可以索引每个文档的内容，使之可以被搜索。在ES中，你可以对文档进行索引、搜索、排序、过滤。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> ES对比传统关系型数据库</span></span><br><span class="line">关系型数据库  --&gt;Databases   ---&gt;Tables    ---&gt;Rows      ---&gt;Colums</span><br><span class="line">   ES       --&gt;Indices     ---&gt;Types     ---&gt;Documents ---&gt;Fields</span><br></pre></td></tr></table></figure></li><li><p>ES核心概念</p><p><strong>索引Index</strong>：</p><p>​    一个索引就是一个拥有几分相似特征的文档的集合。比如说，你可以有一个客户数据的索引，另一个产品目录的索 引，还有一个订单数据的索引。一个索引由一个名字来标识（必须全部是小写字母的），并且当我们要对对应于这 个索引中的文档进行索引、搜索、更新和删除的时候，都要使用到这个名字。在一个集群中，可以定义任意多的索 引。 </p><p><strong>类型Type</strong>：</p><p>​    在一个索引中，你可以定义一种或多种类型。一个类型是你的索引的一个逻辑上的分类/分区，其语义完全由你来 定。通常，会为具有一组共同字段的文档定义一个类型。比如说，我们假设你运营一个博客平台并且将你所有的数 据存储到一个索引中。在这个索引中，你可以为用户数据定义一个类型，为博客数据定义另一个类型，当然，也可 以为评论数据定义另一个类型。 </p><p><strong>字段Field</strong>：</p><p>​    相当于是数据表的字段，对文档数据根据不同属性进行的分类标识 </p><p><strong>映射mapping</strong>：</p><p>​    mapping是处理数据的方式和规则方面做一些限制，如某个字段的数据类型、默认值、分析器、是否被索引等等， 这些都是映射里面可以设置的，其它就是处理es里面数据的一些使用规则设置也叫做映射，按着最优规则处理数据 对性能提高很大，因此才需要建立映射，并且需要思考如何建立映射才能对性能更好。 </p><p><strong>文档document</strong>：</p><p>​    一个文档是一个可被索引的基础信息单元。比如，你可以拥有某一个客户的文档，某一个产品的一个文档，当然， 也可以拥有某个订单的一个文档。文档以JSON（Javascript Object Notation）格式来表示，而JSON是一个到处存 在的互联网数据交互格式。<br>​    在一个index/type里面，你可以存储任意多的文档。注意，尽管一个文档，物理上存在于一个索引之中，文档必须 被索引/赋予一个索引的type。 </p><p><strong>接近实时NRT</strong>：</p><p>​    Elasticsearch是一个接近实时的搜索平台。这意味着，从索引一个文档直到这个文档能够被搜索到有一个轻微的延 迟（通常是1秒以内） </p><p><strong>集群cluster</strong>：</p><p>​    一个集群就是由一个或多个节点组织在一起，它们共同持有整个的数据，并一起提供索引和搜索功能。一个集群由 一个唯一的名字标识，这个名字默认就是“elasticsearch”。这个名字是重要的，因为一个节点只能通过指定某个集 群的名字，来加入这个集群 </p><p><strong>节点node</strong>：</p><p>​    一个节点是集群中的一个服务器，作为集群的一部分，它存储数据，参与集群的索引和搜索功能。</p><p><strong>分片和复制 shards&amp;replicas</strong>：</p><p>​    一个索引可以存储超出单个结点硬件限制的大量数据。比如，一个具有10亿文档的索引占据1TB的磁盘空间，而任 一节点都没有这样大的磁盘空间；或者单个节点处理搜索请求，响应太慢。为了解决这个问题，Elasticsearch提供 了将索引划分成多份的能力，这些份就叫做分片。当你创建一个索引的时候，你可以指定你想要的分片的数量。每 个分片本身也是一个功能完善并且独立的“索引”，这个“索引”可以被放置到集群中的任何节点上。分片很重要，主 要有两方面的原因： 1）允许你水平分割/扩展你的内容容量。 2）允许你在分片（潜在地，位于多个节点上）之上 进行分布式的、并行的操作，进而提高性能/吞吐量。 </p><p>​    在一个网络/云的环境里，失败随时都可能发生，在某个分片/节点不知怎么的就处于离线状态，或者由于任何原因 消失了，这种情况下，有一个故障转移机制是非常有用并且是强烈推荐的。为此目的，Elasticsearch允许你创建分 片的一份或多份拷贝，这些拷贝叫做复制分片，或者直接叫复制。</p></li></ol><h2 id="4-ES的客户端操作"><a href="#4-ES的客户端操作" class="headerlink" title="4. ES的客户端操作"></a>4. ES的客户端操作</h2><p>操作的三种方式【在postman下测试】</p><blockquote><p>es-head插件</p><p>es提供的RESTful接口直接访问</p><p>ES提供的API访问</p></blockquote><ol><li><p>下载、注册并使用Postman</p><p><a href="https://www.postman.com/downloads/">https://www.postman.com/downloads/</a> </p></li><li><p>创建索引index和映射mapping【同时】</p><blockquote><p>请求url</p></blockquote><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">posthttp://127.0.0.1:9200/index1   -- 可近似认为是数据库名</span><br></pre></td></tr></table></figure><blockquote><p>body</p></blockquote><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">&quot;mappings&quot;:&#123;    -- mapping关键字</span><br><span class="line">&quot;article&quot;:&#123;-- 可近似为数据库表名</span><br><span class="line">&quot;properties&quot;:&#123;-- properties关键字</span><br><span class="line">&quot;id&quot;:&#123;-- 可近似数据库类名</span><br><span class="line">&quot;type&quot;:&quot;long&quot;,</span><br><span class="line">&quot;store&quot;: true,</span><br><span class="line">&quot;index&quot;:&quot;not_analyzed&quot;</span><br><span class="line">&#125;,</span><br><span class="line">&quot;title&quot;:&#123;</span><br><span class="line">&quot;type&quot;:&quot;text&quot;,</span><br><span class="line">&quot;store&quot;: true,</span><br><span class="line">&quot;index&quot;: &quot;analyzed&quot;,</span><br><span class="line">&quot;analyzer&quot;: &quot;standard&quot;</span><br><span class="line">&#125;,</span><br><span class="line">&quot;content&quot;:&#123;</span><br><span class="line">&quot;type&quot;:&quot;text&quot;,</span><br><span class="line">&quot;store&quot;:true,</span><br><span class="line">&quot;index&quot;:&quot;analyzed&quot;,</span><br><span class="line">&quot;analyzer&quot;:&quot;standard&quot;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><ol start="3"><li><p>先创建index再创建mapping</p><p>先创建index，不带body</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">put http://127.0.0.1:9200/index1</span><br></pre></td></tr></table></figure><p>创建mapping</p><blockquote><p>请求url</p></blockquote><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">put http://127.0.0.1:9200/index1/_mapping</span><br></pre></td></tr></table></figure><blockquote><p>body</p></blockquote><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">&quot;tb1&quot;:&#123;</span><br><span class="line">&quot;properties&quot;:&#123;</span><br><span class="line">&quot;id&quot;:&#123;</span><br><span class="line">&quot;type&quot;:&quot;long&quot;,</span><br><span class="line">&quot;store&quot;:&quot;true&quot;</span><br><span class="line">&#125;,</span><br><span class="line">&quot;title&quot;:&#123;</span><br><span class="line">&quot;type&quot;:&quot;text&quot;,</span><br><span class="line">&quot;store&quot;:true,</span><br><span class="line">&quot;index&quot;:true,</span><br><span class="line">&quot;analyzer&quot;:&quot;standard&quot;</span><br><span class="line">&#125;,</span><br><span class="line">&quot;content&quot;:&#123;</span><br><span class="line">&quot;type&quot;:&quot;text&quot;,</span><br><span class="line">&quot;store&quot;:true,</span><br><span class="line">&quot;index&quot;:true,</span><br><span class="line">&quot;analyzer:&quot;standard&quot;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>删除index</p><blockquote><p>请求url</p></blockquote><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">delete http://127.0.0.1:9200/index1  -- 删除索引index1</span><br></pre></td></tr></table></figure></li></ol><ol start="5"><li><p>创建文档document</p><blockquote><p>请求url</p></blockquote><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">post http://127.0.01:9200/index1/tb1/1  --近似给数据库表中插入数据</span><br></pre></td></tr></table></figure><blockquote><p>body</p></blockquote><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">&quot;id&quot;:1,</span><br><span class="line">&quot;title&quot;:&quot;震惊，LOL&quot;,</span><br><span class="line">&quot;content&quot;:&quot;LoL竟然有更新，没错，就是标题党，你来打我啊&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><ol start="6"><li><p>修改文档document</p><blockquote><p>请求url</p></blockquote><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">post http://127.0.01:9200/index1/tb1/1  -- 修改id为1的记录</span><br></pre></td></tr></table></figure><blockquote><p>body</p></blockquote><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">&quot;id&quot;:1,</span><br><span class="line">&quot;title&quot;:&quot;指定修改的标题&quot;,</span><br><span class="line">&quot;content&quot;:&quot;指定修改的内容&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><ol start="7"><li><p>删除文档document</p><blockquote><p>请求url</p></blockquote><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">delete http://127.0.01:9200/index1/tb1/1   -- 删除记录1</span><br></pre></td></tr></table></figure></li></ol><ol start="8"><li><p>查询文档-根据id查询</p><blockquote><p>请求url</p></blockquote><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">get http://127.0.01:9200/index1/tb1/1 </span><br></pre></td></tr></table></figure></li></ol><ol start="9"><li><p>查询文档-querystring查询</p><blockquote><p>请求url</p></blockquote><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">post http://127.0.01:9200/index1/tb1/_search</span><br></pre></td></tr></table></figure><blockquote><p>body</p></blockquote><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">&quot;query&quot;:&#123;</span><br><span class="line">&quot;query_string&quot;:&#123;</span><br><span class="line">&quot;defalut_field&quot;:&quot;title&quot;,</span><br><span class="line">&quot;query&quot;:&quot;英&quot;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><ol start="10"><li><p>查询文档-term查询</p><blockquote><p>请求url</p></blockquote><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">post http://127.0.01:9200/index1/tb1/_search</span><br></pre></td></tr></table></figure><blockquote><p>body</p></blockquote><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">&quot;query&quot;:&#123;</span><br><span class="line">&quot;term&quot;:&#123;</span><br><span class="line">&quot;title&quot;:&quot;震&quot;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><ol start="11"><li><p><strong>总结</strong></p><p>对ES操作可以近似为对数据库的操作。RESTful的风格请求可以近似SQL语句。</p><p>对<strong>索引</strong>的操作—–近似—-&gt;对<strong>数据库</strong>的操作</p><p>对<strong>映射</strong>的操作—–近似—-&gt;对数据库<strong>表</strong>的操作</p><p>对<strong>文档</strong>操作—–近似—-&gt;对数据库<strong>记录</strong>的操作</p></li></ol><h2 id="5-使用中文分词器"><a href="#5-使用中文分词器" class="headerlink" title="5. 使用中文分词器"></a>5. 使用中文分词器</h2><p>ES默认的分词器是不支持中文分词的，如果想给中文分词要是用IKAnalyzer分词器进行分词。</p><ol><li><p>下载IKAnalyzer</p><p> <a href="https://github.com/medcl/elasticsearch-analysis-ik/">https://github.com/medcl/elasticsearch-analysis-ik/</a> </p></li><li><p>解压并安装</p><p>将解压之后的elasticsearch文件夹放在ES安装目录下的plugins，重启服务。</p></li><li><p>测试中文分词器</p><blockquote><p>请求url</p></blockquote><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET localhost:9200/_analyze?analyzer=ik_smart&amp;pretty=true&amp;text=广东省位于中国东南部</span><br></pre></td></tr></table></figure><blockquote><p>如果结果出现广东等词语则表明使用中文分词器成功。</p></blockquote></li></ol><h2 id="6-ES集群"><a href="#6-ES集群" class="headerlink" title="6. ES集群"></a>6. ES集群</h2><p>ES集群是一个P2P类型的分布式系统，除了集群状态管理以外，其他所有请求都可以发送到集群内的任意一台节点上，这个节点可以找到需要转发给哪些节点，并且直接跟这些节点通信。</p><ol><li><p>集群的相关概念</p><p><strong>集群cluster</strong>：一个集群由一个或者多个节点组织在一起，它们共同持有整个的数据，并一起提供索引和搜索功能。一个集群由一个唯一的名字标识，这个名字默认就是“elasticsearch”。这个名字是重要的，因为一个节点只能通过指定某个集群的名字，来加入这个集群</p><p><strong>节点node</strong>：一个节点是集群中的一个服务器，作为集群的一部分，它存储数据，参与集群的索引和搜索功能。和集群类似，一个节点也是由一个名字来标识的，默认情况下，这个名字是一个随机的漫威漫画角色的名字，这个名字会在启动的时候赋予节点</p><p><strong>分片和复制</strong>：Lucene中有介绍</p></li><li><p>搭建集群</p><p>【1】创建文件夹、复制三份es服务。</p><p>​        复制时要确保已经把索引库删除完毕。</p><p>【2】给每台服务配置</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 集群名称，保证唯一</span></span><br><span class="line"><span class="meta">cluster.name</span>: <span class="string">my-elasticsearch</span></span><br><span class="line"><span class="comment"># 节点名称，必须不一样</span></span><br><span class="line"><span class="meta">node.name</span>: <span class="string">node-1</span></span><br><span class="line"><span class="comment"># 所在主机的IP地址</span></span><br><span class="line"><span class="meta">network.host</span>: <span class="string">127.0.0.1</span></span><br><span class="line"><span class="comment"># 服务端口号，同一机器下是，必须不一样</span></span><br><span class="line"><span class="meta">http.port</span>: <span class="string">9200/9201/9202</span></span><br><span class="line"><span class="comment"># 集群间通信端口，同一机器必须不一样</span></span><br><span class="line"><span class="meta">transport.tcp.port</span>: <span class="string">9300/9301/9302</span></span><br><span class="line"><span class="comment"># 设置集群发现机器ip集合</span></span><br><span class="line"><span class="meta">discovery.zen.ping.unicast.hosts</span>: <span class="string">[&quot;127.0.0.1:9300&quot;,&quot;127.0.0.1:9301&quot;,&quot;127.0.0.1:9302&quot;]</span></span><br></pre></td></tr></table></figure><p>【3】启动每台服务</p><p>【4】使用postman添加索引</p><blockquote><p>url</p></blockquote><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PUTlocalhost:9200/blog1</span><br></pre></td></tr></table></figure><blockquote><p>body</p></blockquote><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;mappings&quot;: &#123;</span><br><span class="line">        &quot;article&quot;: &#123;</span><br><span class="line">            &quot;properties&quot;: &#123;</span><br><span class="line">                &quot;id&quot;: &#123;</span><br><span class="line">                &quot;type&quot;: &quot;long&quot;,</span><br><span class="line">                    &quot;store&quot;: true,</span><br><span class="line">                    &quot;index&quot;:&quot;not_analyzed&quot;</span><br><span class="line">                &#125;,</span><br><span class="line">                &quot;title&quot;: &#123;</span><br><span class="line">                &quot;type&quot;: &quot;text&quot;,</span><br><span class="line">                    &quot;store&quot;: true,</span><br><span class="line">                    &quot;index&quot;:&quot;analyzed&quot;,</span><br><span class="line">                    &quot;analyzer&quot;:&quot;standard&quot;</span><br><span class="line">                &#125;,</span><br><span class="line">                &quot;content&quot;: &#123;</span><br><span class="line">                &quot;type&quot;: &quot;text&quot;,</span><br><span class="line">                    &quot;store&quot;: true,</span><br><span class="line">                    &quot;index&quot;:&quot;analyzed&quot;,</span><br><span class="line">                    &quot;analyzer&quot;:&quot;standard&quot;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>【5】使用header查看效果</p></li></ol><h2 id="7-Java操作ES"><a href="#7-Java操作ES" class="headerlink" title="7. Java操作ES"></a>7. Java操作ES</h2><ol><li><p>依赖</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.elasticsearch<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>elasticsearch<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.6.8<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.elasticsearch.client<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>transport<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.6.8<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.logging.log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j-to-slf4j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.9.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.slf4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>slf4j-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.7.24<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.slf4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>slf4j-simple<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.7.21<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.12<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.12<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>创建索引</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 创建索引</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> UnknownHostException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testCreateIndex</span><span class="params">()</span> <span class="keyword">throws</span> UnknownHostException </span>&#123;</span><br><span class="line">    <span class="comment">//创建Client对象</span></span><br><span class="line">    Settings settings = Settings.builder()</span><br><span class="line">        .put(<span class="string">&quot;cluster.name&quot;</span>,<span class="string">&quot;my-elasticsearch&quot;</span>).build();</span><br><span class="line">    TransportClient client = <span class="keyword">new</span> PreBuiltTransportClient(settings)</span><br><span class="line">        .addTransportAddress(<span class="keyword">new</span> InetSocketTransportAddress(InetAddress.getByName(<span class="string">&quot;127.0.0.1&quot;</span>),<span class="number">9300</span>));</span><br><span class="line">    <span class="comment">//创建名称为index1的索引</span></span><br><span class="line">    client.admin().indices().prepareCreate(<span class="string">&quot;index2&quot;</span>).get();</span><br><span class="line">    <span class="comment">//释放资源</span></span><br><span class="line">    client.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><ol start="3"><li><p>创建映射</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testCreateMapping</span><span class="params">()</span> <span class="keyword">throws</span> IOException, ExecutionException, InterruptedException </span>&#123;</span><br><span class="line">    XContentBuilder builder = XContentFactory.jsonBuilder()</span><br><span class="line">        .startObject()</span><br><span class="line">        .startObject(<span class="string">&quot;article&quot;</span>)</span><br><span class="line">        .startObject(<span class="string">&quot;properties&quot;</span>)</span><br><span class="line">        .startObject(<span class="string">&quot;id&quot;</span>)</span><br><span class="line">        .field(<span class="string">&quot;type&quot;</span>,<span class="string">&quot;long&quot;</span>).field(<span class="string">&quot;store&quot;</span>,<span class="string">&quot;yes&quot;</span>)</span><br><span class="line">        .endObject()</span><br><span class="line">        .startObject(<span class="string">&quot;title&quot;</span>)</span><br><span class="line">        .field(<span class="string">&quot;type&quot;</span>,<span class="string">&quot;string&quot;</span>).field(<span class="string">&quot;store&quot;</span>,<span class="string">&quot;yes&quot;</span>).field(<span class="string">&quot;analyzer&quot;</span>,<span class="string">&quot;ik_smart&quot;</span>)</span><br><span class="line">        .endObject()</span><br><span class="line">        .startObject(<span class="string">&quot;content&quot;</span>)</span><br><span class="line">        .field(<span class="string">&quot;type&quot;</span>,<span class="string">&quot;string&quot;</span>).field(<span class="string">&quot;store&quot;</span>,<span class="string">&quot;yes&quot;</span>).field(<span class="string">&quot;analyzer&quot;</span>,<span class="string">&quot;ik_smart&quot;</span>)</span><br><span class="line">        .endObject()</span><br><span class="line">        .endObject()</span><br><span class="line">        .endObject()</span><br><span class="line">        .endObject();</span><br><span class="line">    <span class="comment">// 创建mapping</span></span><br><span class="line">    PutMappingRequest mapping = Requests.putMappingRequest(<span class="string">&quot;index2&quot;</span>)</span><br><span class="line">        .type(<span class="string">&quot;article&quot;</span>).source(builder);</span><br><span class="line">    client.admin().indices().putMapping(mapping).get();</span><br><span class="line">    client.close();</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><ol start="4"><li><p>创建文档</p><blockquote><p>通过XcontentBuilder创建</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">createDocument</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    XContentBuilder xContentBuilder = XContentFactory.jsonBuilder()</span><br><span class="line">        .startObject()</span><br><span class="line">        .field(<span class="string">&quot;id&quot;</span>,<span class="number">1</span>)</span><br><span class="line">        .field(<span class="string">&quot;title&quot;</span>,<span class="string">&quot;震惊！一拳超人竟然....&quot;</span>)</span><br><span class="line">        .field(<span class="string">&quot;content&quot;</span>,<span class="string">&quot;一拳超人竟然出了第二季度动漫，每次就是来蹭热点的，不服来打我啊！哈哈哈&quot;</span>)</span><br><span class="line">        .endObject();</span><br><span class="line">    client.prepareIndex(<span class="string">&quot;index2&quot;</span>,<span class="string">&quot;article&quot;</span>,<span class="string">&quot;1&quot;</span>).setSource(xContentBuilder).get();</span><br><span class="line">    <span class="comment">//释放资源</span></span><br><span class="line">    client.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>通过Jackson转换实体类创建文档</p></blockquote><p>1）创建实体类</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Article</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> String title;</span><br><span class="line">    <span class="keyword">private</span> String content;</span><br><span class="line">    <span class="comment">// getter and setter</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><p>   2）添加Jackson坐标</p>   <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--Jackson--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.8.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-databind<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.8.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-annotations<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.8.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>   3）代码实现</p>   <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">createDocumentByJackson</span><span class="params">()</span> <span class="keyword">throws</span> JsonProcessingException </span>&#123;</span><br><span class="line">    Article article = <span class="keyword">new</span> Article();</span><br><span class="line">    article.setId(<span class="number">2L</span>);</span><br><span class="line">    article.setTitle(<span class="string">&quot;新添加内容标题&quot;</span>);</span><br><span class="line">    article.setContent(<span class="string">&quot;新添加的内容！新添加的内容&quot;</span>);</span><br><span class="line">    ObjectMapper objectMapper = <span class="keyword">new</span> ObjectMapper();</span><br><span class="line">    client.prepareIndex(<span class="string">&quot;index2&quot;</span>,<span class="string">&quot;article&quot;</span>,</span><br><span class="line">                        article.getId().toString()).setSource(objectMapper.writeValueAsString(article).getBytes(),</span><br><span class="line">                                                              XContentType.JSON).get();</span><br><span class="line">    client.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="5"><li><p>查询文档</p><blockquote><p>根据id查询</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">queryDocumentById</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    SearchResponse response = client.prepareSearch(<span class="string">&quot;index2&quot;</span>)</span><br><span class="line">        .setTypes(<span class="string">&quot;article&quot;</span>, <span class="string">&quot;content&quot;</span>)</span><br><span class="line">        .setQuery(QueryBuilders.idsQuery().addIds(<span class="string">&quot;1&quot;</span>))</span><br><span class="line">        .get();</span><br><span class="line"></span><br><span class="line">    SearchHits hits = response.getHits();</span><br><span class="line">    System.out.println(<span class="string">&quot;总记录数：&quot;</span> + hits.getTotalHits());</span><br><span class="line">    <span class="keyword">for</span> (SearchHit hit : hits.getHits()) &#123;</span><br><span class="line">        System.out.println(hit.getSourceAsString());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>根据关键词查找</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">queryDocByKeyWord</span><span class="params">()</span></span>&#123;</span><br><span class="line">    SearchResponse response = client.prepareSearch(<span class="string">&quot;index2&quot;</span>)</span><br><span class="line">        .setTypes(<span class="string">&quot;article&quot;</span>)</span><br><span class="line">        .setQuery(QueryBuilders.termQuery(<span class="string">&quot;title&quot;</span>, <span class="string">&quot;震惊&quot;</span>))</span><br><span class="line">        .get();</span><br><span class="line">    SearchHits hits = response.getHits();</span><br><span class="line"></span><br><span class="line">    System.out.println(<span class="string">&quot;总记录数：&quot;</span> + hits.getTotalHits());</span><br><span class="line">    Iterator&lt;SearchHit&gt; iterator = hits.iterator();</span><br><span class="line">    <span class="keyword">while</span> (iterator.hasNext())&#123;</span><br><span class="line">        SearchHit next = iterator.next();</span><br><span class="line">        System.out.println(next.getSourceAsString());</span><br><span class="line">    &#125;</span><br><span class="line">    client.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>根据字符串模糊查询</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">queryDocByString</span><span class="params">()</span></span>&#123;</span><br><span class="line">    SearchResponse response = client.prepareSearch(<span class="string">&quot;index2&quot;</span>)</span><br><span class="line">        .setTypes(<span class="string">&quot;article&quot;</span>)</span><br><span class="line">        .setQuery(QueryBuilders.queryStringQuery(<span class="string">&quot;震惊党&quot;</span>)).get();</span><br><span class="line"></span><br><span class="line">    SearchHits hits = response.getHits();</span><br><span class="line">    System.out.println(<span class="string">&quot;总记录数：&quot;</span> + hits.getTotalHits());</span><br><span class="line">    Iterator&lt;SearchHit&gt; iterator = hits.iterator();</span><br><span class="line">    <span class="keyword">while</span> (iterator.hasNext())&#123;</span><br><span class="line">        SearchHit next = iterator.next();</span><br><span class="line">        System.out.println(next.getSourceAsString());</span><br><span class="line">        System.out.println(<span class="string">&quot;-----------优雅的分割线------------&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol>]]></content>
      
      
      <categories>
          
          <category> 理论学习 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ElasticSearch </tag>
            
            <tag> 全文检索 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Spring-Security简单使用</title>
      <link href="2020/02/16/Spring-Security%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8/"/>
      <url>2020/02/16/Spring-Security%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8/</url>
      
        <content type="html"><![CDATA[<p>Spring-Security是Spring家族的重要一员。</p><a id="more"></a><h1 id="Spring-Security简单使用"><a href="#Spring-Security简单使用" class="headerlink" title="Spring-Security简单使用"></a>Spring-Security简单使用</h1><h2 id="1-简介"><a href="#1-简介" class="headerlink" title="1.简介"></a>1.简介</h2><p>Spring Security是一个功能强大且高度可定制的身份验证和访问控制框架。它是保护基于spring的应用程序的实际标准。</p><p>Spring Security是一个框架，侧重于为Java应用程序提供身份验证和授权。与所有Spring项目一样，Spring安全性的真正强大之处在于它很容易扩展以满足定制需求</p><h2 id="2-快速入门"><a href="#2-快速入门" class="headerlink" title="2. 快速入门"></a>2. 快速入门</h2><ol><li><p>导入SpringSecurity依赖</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--其他所需依赖--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.security<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-security-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.security.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.security<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-security-config<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.security.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>在web配置文件中添加过滤器</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--.........--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--添加spring-security配置文件的解析--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context-param</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath:spring-security.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">context-param</span>&gt;</span></span><br><span class="line"> <span class="comment">&lt;!--.........--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--添加spring-security所需的过滤器--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>springSecurityFilterChain<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>org.springframework.web.filter.DelegatingFilterProxy<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>springSecurityFilterChain<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!--.........--&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>配置spring-security</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:security</span>=<span class="string">&quot;http://www.springframework.org/schema/security&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">          http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">          http://www.springframework.org/schema/security</span></span></span><br><span class="line"><span class="tag"><span class="string">          http://www.springframework.org/schema/security/spring-security.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 配置不过滤的资源（静态资源及登录相关） --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">security:http</span> <span class="attr">security</span>=<span class="string">&quot;none&quot;</span> <span class="attr">pattern</span>=<span class="string">&quot;/login.html&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">security:http</span> <span class="attr">security</span>=<span class="string">&quot;none&quot;</span> <span class="attr">pattern</span>=<span class="string">&quot;/failer.html&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">security:http</span> <span class="attr">auto-config</span>=<span class="string">&quot;true&quot;</span> <span class="attr">use-expressions</span>=<span class="string">&quot;false&quot;</span> &gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 对所有的路径进行权限控制，只允许ROLE_USER可以访问 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">security:intercept-url</span> <span class="attr">pattern</span>=<span class="string">&quot;/**&quot;</span> <span class="attr">access</span>=<span class="string">&quot;ROLE_USER&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">security:logout</span> <span class="attr">invalidate-session</span>=<span class="string">&quot;true&quot;</span> <span class="attr">logout-url</span>=<span class="string">&quot;/logout&quot;</span></span></span><br><span class="line"><span class="tag">                         <span class="attr">logout-success-url</span>=<span class="string">&quot;/login.jsp&quot;</span> /&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 关闭CSRF,默认是开启的 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">security:csrf</span> <span class="attr">disabled</span>=<span class="string">&quot;true&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">security:http</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--静态配置认证的用户及密码--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">security:authentication-manager</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">security:authentication-provider</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">security:user-service</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">security:user</span> <span class="attr">name</span>=<span class="string">&quot;user&quot;</span> <span class="attr">password</span>=<span class="string">&quot;&#123;noop&#125;user&quot;</span></span></span><br><span class="line"><span class="tag">                               <span class="attr">authorities</span>=<span class="string">&quot;ROLE_USER&quot;</span> /&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">security:user</span> <span class="attr">name</span>=<span class="string">&quot;admin&quot;</span> <span class="attr">password</span>=<span class="string">&quot;&#123;noop&#125;admin&quot;</span></span></span><br><span class="line"><span class="tag">                               <span class="attr">authorities</span>=<span class="string">&quot;ROLE_ADMIN&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">security:user-service</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">security:authentication-provider</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">security:authentication-manager</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>运行Maven工程</p><p>运行工程时，首先会弹出一个要求输入用户名和密码的页面，这是spring-security为我们提供的默认的登录页面，当我们没有指定登录页面时会使用该页面。</p><p>输入用户名：admin，密码：admin时，会提示403，表示权限不足，这是因为上面配置的access角色需要是ROLE_USER</p><p>输入用户名：user，密码：user时，可以正常登录。</p><p>输入错误的用户名或者密码时，会提示账号或者密码错误信息。</p></li></ol><h2 id="3-实战【ssm权限管理系统】"><a href="#3-实战【ssm权限管理系统】" class="headerlink" title="3. 实战【ssm权限管理系统】"></a>3. 实战【ssm权限管理系统】</h2><ol><li><p>导入依赖</p></li><li><p>web配置文件中配置过滤器、spring-security的配置文件解析</p></li><li><p>配置spring-security</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:security</span>=<span class="string">&quot;http://www.springframework.org/schema/security&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">          http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">          http://www.springframework.org/schema/security</span></span></span><br><span class="line"><span class="tag"><span class="string">          http://www.springframework.org/schema/security/spring-security.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--配置不拦截的资源--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">security:http</span> <span class="attr">pattern</span>=<span class="string">&quot;/login.jsp&quot;</span> <span class="attr">security</span>=<span class="string">&quot;none&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">security:http</span> <span class="attr">pattern</span>=<span class="string">&quot;/failer.jsp&quot;</span> <span class="attr">security</span>=<span class="string">&quot;none&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">security:http</span> <span class="attr">pattern</span>=<span class="string">&quot;/css/**&quot;</span> <span class="attr">security</span>=<span class="string">&quot;none&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">security:http</span> <span class="attr">pattern</span>=<span class="string">&quot;/img/**&quot;</span> <span class="attr">security</span>=<span class="string">&quot;none&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">security:http</span> <span class="attr">pattern</span>=<span class="string">&quot;/plugins/**&quot;</span> <span class="attr">security</span>=<span class="string">&quot;none&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--配置具体--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--配值是否使用默认登录页面、不使用sepl表达式--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">security:http</span> <span class="attr">auto-config</span>=<span class="string">&quot;true&quot;</span> <span class="attr">use-expressions</span>=<span class="string">&quot;false&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--配置拦截地址、可访问的角色--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">security:intercept-url</span> <span class="attr">pattern</span>=<span class="string">&quot;/**&quot;</span> <span class="attr">access</span>=<span class="string">&quot;ROLE_USER,ROLE_ADMIN&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--定义跳转页面--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">            login-page=&quot;/login.jsp&quot;    指定默认的登录页面</span></span><br><span class="line"><span class="comment">            login-processing-url=&quot;/login&quot;   指定登录页面登录的处理方法</span></span><br><span class="line"><span class="comment">            default-target-url=&quot;index.jsp&quot;</span></span><br><span class="line"><span class="comment">            authentication-failure-url=&quot;/failer.jsp&quot;    指定失败跳转页面</span></span><br><span class="line"><span class="comment">            authentication-success-forward-url=&quot;/pages/main.jsp&quot;    指定成功跳转页面</span></span><br><span class="line"><span class="comment">        --&gt;</span></span><br><span class="line">        &lt;security:form-login</span><br><span class="line">                login-page=&quot;/login.jsp&quot;</span><br><span class="line">                login-processing-url=&quot;/login&quot;</span><br><span class="line">                default-target-url=&quot;/index.jsp&quot;</span><br><span class="line">                authentication-failure-url=&quot;/failer.jsp&quot;</span><br><span class="line">                authentication-success-forward-url=&quot;/pages/main.jsp&quot;</span><br><span class="line">        /&gt;</span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--关闭跨越请求--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">security:csrf</span> <span class="attr">disabled</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 指定退出 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">security:logout</span> <span class="attr">invalidate-session</span>=<span class="string">&quot;true&quot;</span> <span class="attr">logout-url</span>=<span class="string">&quot;/logout&quot;</span> <span class="attr">logout-success-url</span>=<span class="string">&quot;/login.jsp&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">security:http</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--数据库方式验证--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">security:authentication-manager</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">security:authentication-provider</span> <span class="attr">user-service-ref</span>=<span class="string">&quot;userLoginServiceImpl&quot;</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--配置加密方式--&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">security:authentication-provider</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">security:authentication-manager</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>配置不过滤的元素</p><p>配置可以访问的角色</p><p>配置登录页面、处理登录请求的方法，处理登录成功、登录失败跳转的页面等</p><p>配置处理请求的服务</p></blockquote></li><li><p>将登陆请求的url指向前面定义的<code> login-processing-url</code>参数</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;/login&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span>&gt;</span></span><br><span class="line">     <span class="comment">&lt;!--省略....--&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>创建处理登录请求的接口</p><blockquote><p>创建UserLoginService继承继承自UserDtailsService接口</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserLoginService</span> <span class="keyword">extends</span> <span class="title">UserDetailsService</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>创建UserLoginService的实体类并重写方法</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service(&quot;userLoginServiceImpl&quot;)</span></span><br><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserLoginServiceImpl</span> <span class="keyword">implements</span> <span class="title">UserLoginService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserDao userDao;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> UserDetails <span class="title">loadUserByUsername</span><span class="params">(String username)</span> <span class="keyword">throws</span> UsernameNotFoundException </span>&#123;</span><br><span class="line">        System.out.println(username);</span><br><span class="line">        UserInfo userInfo = userDao.findUserByUsername(username);</span><br><span class="line">        System.out.println(userInfo);</span><br><span class="line">        List&lt;Role&gt; roles = userInfo.getRoles();</span><br><span class="line">        System.out.println(userInfo);</span><br><span class="line">        List&lt;SimpleGrantedAuthority&gt; authorities = getAuthority(roles);</span><br><span class="line">        User user = <span class="keyword">new</span> User(userInfo.getUsername(),<span class="string">&quot;&#123;noop&#125;&quot;</span>+userInfo.getPassword(),<span class="keyword">true</span>,<span class="keyword">true</span>,<span class="keyword">true</span>,<span class="keyword">true</span>,authorities);</span><br><span class="line">        <span class="keyword">return</span> user;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> List&lt;SimpleGrantedAuthority&gt; <span class="title">getAuthority</span><span class="params">(List&lt;Role&gt; roles)</span></span>&#123;</span><br><span class="line">        List&lt;SimpleGrantedAuthority&gt; authorities = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (Role role : roles) &#123;</span><br><span class="line">            authorities.add(<span class="keyword">new</span> SimpleGrantedAuthority(<span class="string">&quot;ROLE_&quot;</span>+role.getRoleName()));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> authorities;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>实战总结</p><p>【依赖以及web配置文件的配置】较为固定没有什么难度，不过给过滤器定义名称时要注意。</p><p>【Spring-security配置文件配置】根据需求定义访问的角色、结束登录请求的地址，登录的挑战等。</p><p>【接口的继承以及实现】记住要实现的接口，以及实现类实现方法的含义。</p></li></ol>]]></content>
      
      
      <categories>
          
          <category> 理论学习 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Spring </tag>
            
            <tag> Spring-Security </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>PageHelper</title>
      <link href="2020/02/13/PageHelper/"/>
      <url>2020/02/13/PageHelper/</url>
      
        <content type="html"><![CDATA[<p>分页插件，可以帮助我们简化分页的逻辑。</p><a id="more"></a><h1 id="PageHelper"><a href="#PageHelper" class="headerlink" title="PageHelper"></a>PageHelper</h1><h2 id="1-简介"><a href="#1-简介" class="headerlink" title="1. 简介"></a>1. 简介</h2><p>PageHelper是国内优秀的开源的mybatis分页插件，支持主流常用的数据库。</p><p>【官网】<a href="https://pagehelper.github.io/">https://pagehelper.github.io/</a></p><h2 id="2-使用方法【Maven】"><a href="#2-使用方法【Maven】" class="headerlink" title="2. 使用方法【Maven】"></a>2. 使用方法【Maven】</h2><ol><li><p>导入依赖</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.pagehelper<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>pagehelper<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>最新版本<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ol><ol start="2"><li><p>配置拦截器插件</p><p>特别注意，新版拦截器是 <code>com.github.pagehelper.PageInterceptor</code>。 <code>com.github.pagehelper.PageHelper</code> 现在是一个特殊的 <code>dialect</code> 实现类，是分页插件的默认实现类，提供了和以前相同的用法。</p></li><li><p>mybatis中xml配置</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">    plugins在配置文件中的位置必须符合要求，否则会报错，顺序如下:</span></span><br><span class="line"><span class="comment">    properties?, settings?,</span></span><br><span class="line"><span class="comment">    typeAliases?, typeHandlers?,</span></span><br><span class="line"><span class="comment">    objectFactory?,objectWrapperFactory?,</span></span><br><span class="line"><span class="comment">    plugins?,</span></span><br><span class="line"><span class="comment">    environments?, databaseIdProvider?, mappers?</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- com.github.pagehelper为PageHelper类所在包名 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugin</span> <span class="attr">interceptor</span>=<span class="string">&quot;com.github.pagehelper.PageInterceptor&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 使用下面的方式配置参数，后面会有所有的参数介绍 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;param1&quot;</span> <span class="attr">value</span>=<span class="string">&quot;value1&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>spring配置文件中配置拦截器插件</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;sqlSessionFactory&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.mybatis.spring.SqlSessionFactoryBean&quot;</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 注意其他配置 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;plugins&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">array</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;com.github.pagehelper.PageInterceptor&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;properties&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">value</span>&gt;</span></span><br><span class="line">            params=value1</span><br><span class="line">          <span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">array</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><p>常用的配置：</p><ul><li>helperDialect：指定数据库，例如MySQL、db2、oracle</li><li>reasonable：分页合理化参数，默认值为 false 。当该参数设置为 true 时， pageNum&lt;=0 时会查询第一 页， pageNum&gt;pages （超过总数时），会查询最后一页。</li></ul></li><li><p>常用方法</p><p><strong>RowBounds方式的调用</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Country&gt; list = sqlSession.selectList(<span class="string">&quot;x.y.selectIf&quot;</span>, <span class="keyword">null</span>, <span class="keyword">new</span> RowBounds(<span class="number">0</span>, <span class="number">10</span>));</span><br></pre></td></tr></table></figure><ul><li><p>使用这种调用方式时，你可以使用RowBounds参数进行分页，这种方式侵入性最小，我们可以看到，通过RowBounds方式调用只是使用了这个参数，并没有增加其他任何内容。</p></li><li><p>分页插件检测到使用了RowBounds参数时，就会对该查询进行<strong>物理分页</strong>。</p></li><li><p>关于这种方式的调用，有两个特殊的参数是针对 <code>RowBounds</code> 的，你可以参看上面的 <strong>场景一</strong> 和 <strong>场景二</strong></p></li><li><p><strong>注：</strong>不只有命名空间方式可以用RowBounds，使用接口的时候也可以增加RowBounds参数，例如： </p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//这种情况下也会进行物理分页查询</span></span><br><span class="line"><span class="function">List&lt;Country&gt; <span class="title">selectAll</span><span class="params">(RowBounds rowBounds)</span></span>;  </span><br></pre></td></tr></table></figure><ul><li><strong>注意：</strong> 由于默认情况下的 <code>RowBounds</code> 无法获取查询总数，分页插件提供了一个继承自 <code>RowBounds</code> 的 <code>PageRowBounds</code>，这个对象中增加了 <code>total</code> 属性，执行分页查询后，可以从该属性得到查询总数。</li></ul></li></ol><p>   <strong>PageHelper.startPage静态方法调用【重点】</strong></p>   <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//获取第1页，10条内容，默认查询总数</span></span><br><span class="line">count PageHelper.startPage(<span class="number">1</span>, <span class="number">10</span>); </span><br><span class="line"><span class="comment">//紧跟着的第一个select方法会被分页</span></span><br><span class="line">List&lt;Country&gt; list = countryMapper.selectIf(<span class="number">1</span>);</span><br></pre></td></tr></table></figure><ul><li>在你需要进行分页的 MyBatis 查询方法前调用 <code>PageHelper.startPage</code> 静态方法即可，紧跟在这个方法后的第一个<strong>MyBatis 查询方法</strong>会被进行分页。</li></ul><h2 id="3-实战【权限系统】"><a href="#3-实战【权限系统】" class="headerlink" title="3. 实战【权限系统】"></a>3. 实战【权限系统】</h2><ol><li><p>导入PageHelper依赖</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--分页查询插件--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.pagehelper<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>pagehelper<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.1.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>spring中配置文件配置</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--配置生产SqlSession的工厂--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;sqlSessionFactory&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.mybatis.spring.SqlSessionFactoryBean&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dataSource&quot;</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--分页插件--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;plugins&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">array</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 传入插件的对象 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;com.github.pagehelper.PageInterceptor&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;properties&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">props</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">&quot;helperDialect&quot;</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">prop</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">&quot;reasonable&quot;</span>&gt;</span>true<span class="tag">&lt;/<span class="name">prop</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">props</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">array</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>service中使用PageHelper.startPage方法</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> List&lt;Orders&gt; <span class="title">findAllByPages</span><span class="params">(<span class="keyword">int</span> start,<span class="keyword">int</span> size)</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">        PageHelper.startPage(start,size);</span><br><span class="line">        <span class="keyword">return</span> ordersDao.findAll();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><blockquote><p>设置开始变化以及每页显示的大小</p><p>start：开始位置</p><p>size： 每页显示的条数</p></blockquote></li><li><p>controller中使用PageInfo封装返回结果</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/findAllByPage.do&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">findAllByPage</span><span class="params">(<span class="meta">@RequestParam(required = true,value = &quot;start&quot;,defaultValue = &quot;1&quot;)</span> <span class="keyword">int</span> start,</span></span></span><br><span class="line"><span class="function"><span class="params">                            <span class="meta">@RequestParam(required = true,value = &quot;size&quot;,defaultValue = &quot;4&quot;)</span> <span class="keyword">int</span> size, Model model)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    List&lt;Orders&gt; all = ordersService.findAllByPages(start,size);</span><br><span class="line">    PageInfo pageInfo = <span class="keyword">new</span> PageInfo(all);</span><br><span class="line">    model.addAttribute(<span class="string">&quot;pageInfo&quot;</span>,pageInfo);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;orders-list&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>   此处将PageHelper根据查询的List结合传入的开始位置以及每页大小封装的PageInfo对象中，返回的到jsp页面中。</p></blockquote></li></ol><h2 id="4-PageInfo"><a href="#4-PageInfo" class="headerlink" title="4. PageInfo"></a>4. PageInfo</h2><blockquote><p>PageInfo对象封装了分页查询的诸多信息。包括查询到的对象集合，页面大小，总数等等。</p></blockquote><p>PageInfo部分源码</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PageInfo</span>&lt;<span class="title">T</span>&gt; <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line">    <span class="comment">//当前页</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> pageNum;</span><br><span class="line">    <span class="comment">//每页的数量</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> pageSize;</span><br><span class="line">    <span class="comment">//当前页的数量</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> size;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//由于startRow和endRow不常用，这里说个具体的用法</span></span><br><span class="line">    <span class="comment">//可以在页面中&quot;显示startRow到endRow 共size条数据&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//当前页面第一个元素在数据库中的行号</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> startRow;</span><br><span class="line">    <span class="comment">//当前页面最后一个元素在数据库中的行号</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> endRow;</span><br><span class="line">    <span class="comment">//总记录数</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">long</span> total;</span><br><span class="line">    <span class="comment">//总页数</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> pages;</span><br><span class="line">    <span class="comment">//结果集</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;T&gt; list;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//前一页</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> prePage;</span><br><span class="line">    <span class="comment">//下一页</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> nextPage;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//是否为第一页</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> isFirstPage = <span class="keyword">false</span>;</span><br><span class="line">    <span class="comment">//是否为最后一页</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> isLastPage = <span class="keyword">false</span>;</span><br><span class="line">    <span class="comment">//是否有前一页</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> hasPreviousPage = <span class="keyword">false</span>;</span><br><span class="line">    <span class="comment">//是否有下一页</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> hasNextPage = <span class="keyword">false</span>;</span><br><span class="line">    <span class="comment">//导航页码数</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> navigatePages;</span><br><span class="line">    <span class="comment">//所有导航页号</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span>[] navigatepageNums;</span><br><span class="line">    <span class="comment">//导航条上的第一页</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> navigateFirstPage;</span><br><span class="line">    <span class="comment">//导航条上的最后一页</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> navigateLastPage;</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 理论学习 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Mybatis </tag>
            
            <tag> PageHelper </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>2019</title>
      <link href="2020/02/03/2019/"/>
      <url>2020/02/03/2019/</url>
      
        <content type="html"><![CDATA[<p>​    正月初九是家乡的年例，但是因为肺炎的原因，本应该是一年中最热闹的一天，在今年却显得格外冷清，希望国家早日战胜这场无硝烟的战役。</p><a id="more"></a><h1 id="2019"><a href="#2019" class="headerlink" title="2019"></a>2019</h1><h2 id="迟到的2019总结"><a href="#迟到的2019总结" class="headerlink" title="迟到的2019总结"></a>迟到的2019总结</h2><p>​    正月初九是家乡的年例，但是因为肺炎的原因，本应该是一年中最热闹的一天，在今年却显得格外冷清，希望国家早日战胜这场无硝烟的战役。</p><p>​    年总结很早就想写了，但是身患重度拖延症的我通过一次一次的借口，成功骗了自己一次又一次，由于今年年例格外冷清（写代码写腻了），趁此机会回顾一下这一年自己发生的事。</p><p>​    首先，在2019年中对我自己大学、乃至接下来的人生轨迹影响最大的莫过于<strong>转专业</strong>成功了。2019.1.25日，我通转专业查询，确认了自己转入了目标的专业，而我的故事也由材料院转到了计科院。作为一个重度的计算机爱好者，从初一有了人生中第一台amd的512MB内存的台式机，我便于计算机接下了梁子。而在初二时，更是无意中搞坏了当时的xp系统，懵懂的我通过wb了解到了可以通过启动盘修复。从此，我与计算机结下了更深的梁子【期间还手欠把CPU针脚弄坏】。也许正因为当时对计算机的喜爱，把学习的注意力转移了，我考大学时被调剂到了材料院。但也是因为对计算机的热爱，成为了我从成功转到计科院的动力。在大一上学期，和寝室的三个志同道合的老哥：基佬，腰缠万贯，大表哥，一起都顺利的转入了计科院。而有幸的是，现在我们仍然在一个寝室。</p><p>​    【大一下】在转入计科院之后，我遇到了很多的新同学，也学习到了很多的新知识。受益于大一上学期的学习习惯，我和寝室的另外两位老哥组成的三剑客从一开始便包揽了教室的第一排，这使得我很快便可以跟上计科院的课程。也得益于在初中高中的计算机知识，我在转专业之后的一个学期内，基本把课程的跟上，即使可能很多专业知识于他们还相差甚远。在大一下期间，对我影响最大的莫过于：了解到别人的强大、认识到了自己的弱点。这个学期，随着对计算机专业知识的学习，发现自己在初中高中学习到的根本就是皮毛，人家通过大一的一学期，早已经远超出了我初中高中几个寒暑假的学习。于是，在大一下结束，我便开始了自己的留校计划。</p><p>​    【暑假】大一下的程序设计综合实践做完后，我又搬起了自己曾无数次徘徊于基础中的基础–Java。得益于教程的优良以及寝室环境的优美，我利用暑假在校的一个月，成功超越了之前初高中无法逾越的壕沟。也这是这一个月，我也开始对自己的学习方式逐渐有了固定套路。在回家之后暑假，尽管经常要带带孩子、打打游戏，但还是保留了学习的习惯，而且效率也不算很低。总体来说，这是一个比较充实的暑假。</p><p>​    【大二上】得益于暑假的学习，大二上的专业课并没有太大困难，这使得我可以花更多的时间在非专业课上，加上自己比较努力，学习上没有遇到很多问题。硬要说学习上有什么问题，那便是物理实验：课时占用多、上课时间反人类、选课反人类、考核反人类。但是总的来说大二上的学习并没有对我造成很大的困扰。</p><p>​    然而，虽然学习上没有遇到很大问题，但在非学习上，我做出了很大的改变。首先就是我鼓起了勇气踏出了那一步，虽然以失败告终，而且也是意料之中，但这样我仍然花了大量时间才走出阴霾。再者，我加入了网信中心，在那里面，除了认识更多的朋友，最重要的便是可以锻炼我的语言表达能力。总之、大二下对我非学习的影响是很大的。</p><p>​    【最后】纵观这一年，也许是运气好，我在学习上没有很多的困扰，最起码没有挂科。在学习之外，我也收获到了很多，认识了自己的不足，也想着要改变。</p><p>​    【期望】在接下来<strong>不平凡</strong>的2020年，我希望自己继续保持积极乐观的心态，走出自己的舒适区。同时希望自己能够养成自己的一技之长。最后更是希望国家和平、安定。</p><p><strong>tobing</strong></p><p><strong>2020.1.2</strong> </p>]]></content>
      
      
      <categories>
          
          <category> 杂七杂八 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 总结 </tag>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Oracle-下</title>
      <link href="2020/01/22/Oracle-%E4%B8%8B/"/>
      <url>2020/01/22/Oracle-%E4%B8%8B/</url>
      
        <content type="html"><![CDATA[<p>Oracle数据库第二弹。</p><a id="more"></a><h1 id="Oracle-下"><a href="#Oracle-下" class="headerlink" title="Oracle-下"></a>Oracle-下</h1><h2 id="1-视图"><a href="#1-视图" class="headerlink" title="1. 视图"></a>1. 视图</h2><blockquote><p>视图就是提供一个查询的窗口，所有数据来自于原表</p></blockquote><ol><li><p>数据准备</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查询语句创建表</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> emp <span class="keyword">as</span> <span class="keyword">select</span> * <span class="keyword">from</span> scott.emp;</span><br></pre></td></tr></table></figure></li><li><p>视图操作</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 创建视图【必须要dba权限】</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">view</span> v_emp <span class="keyword">as</span> <span class="keyword">select</span> ename,job <span class="keyword">from</span> emp;</span><br><span class="line"><span class="comment">-- 查询视图</span></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> v_emp;</span><br><span class="line"><span class="comment">-- 修改视图【不推荐】</span></span><br><span class="line">udpate v_emp <span class="keyword">set</span> job=<span class="string">&#x27;LER&#x27;</span> <span class="keyword">where</span> ename=<span class="string">&#x27;ALLEN&#x27;</span>;</span><br><span class="line"><span class="comment">-- 创建只读视图【一般设置为只读】</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">view</span> v_emp1 <span class="keyword">as</span> <span class="keyword">select</span> ename,job <span class="keyword">from</span> emp <span class="keyword">with</span> <span class="keyword">read</span> <span class="keyword">only</span>;</span><br></pre></td></tr></table></figure><blockquote><p>视图的作用：</p><pre><code>1. 视图可以屏蔽一些敏感字段。   2. 保证总部和分部数据及时统一。</code></pre></blockquote></li></ol><h2 id="2-索引"><a href="#2-索引" class="headerlink" title="2. 索引"></a>2. 索引</h2><blockquote><p>索引就是在表的列上构建一个二叉树，从而达到大大提高查询效率的目的。</p><p>但是索引会影响增删改的效率。</p></blockquote><ol><li><p>单列索引</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 创建单列索引</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">index</span> idx_ename <span class="keyword">on</span> emp(ename);</span><br></pre></td></tr></table></figure><blockquote><p>单列索引触发规则，条件必须是索引列中的原始值。</p><p>单列函数，模糊查询，都会影响索引的触发</p></blockquote></li><li><p>复合索引</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 创建复合索引</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">index</span> idx_enamejob <span class="keyword">on</span> emp(ename,job);</span><br></pre></td></tr></table></figure><blockquote><p>复合索引中第一列为优先检索列。</p><p>如果要触发复合索引，<strong>必须包含有优先索引中的原始值</strong>。</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> emp <span class="keyword">where</span> ename = <span class="string">&#x27;SCOTT&#x27;</span> <span class="keyword">and</span> job=<span class="string">&#x27;xx&#x27;</span>;<span class="comment">-- 触发复合索引</span></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> emp <span class="keyword">where</span> job = <span class="string">&#x27;xx&#x27;</span>;<span class="comment">-- 不触发索引</span></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> emp <span class="keyword">where</span> ename = <span class="string">&quot;SCOTT&quot;</span>;<span class="comment">-- 触发单列索引</span></span><br></pre></td></tr></table></figure></li></ol><h2 id="3-pl-sql编程语言"><a href="#3-pl-sql编程语言" class="headerlink" title="3. pl/sql编程语言"></a>3. pl/sql编程语言</h2><blockquote><p>是对sql语言的扩展，使得sql语言具有过程化编程的特性。</p><p>比一般过程编程语言，更加灵活高效。</p><p>主要用来编写存储过程和存储函数等。</p></blockquote><ol><li><p>声明方法</p><blockquote><p>赋值操作可以使用**:=**，也可以使用into查询语句赋值。</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">declare</span><br><span class="line">-- 变量声明</span><br><span class="line">i number(2) :&#x3D; 10;</span><br><span class="line">s varchar(10) :&#x3D;&#39;tobing&#39;;</span><br><span class="line">ena emp.ename%type;--引用型变量</span><br><span class="line">emprow emp%rowtype;--记录型变量</span><br><span class="line">begin</span><br><span class="line">dbms_output.put_line(i);</span><br><span class="line">dbms_output.put_line(s);</span><br><span class="line">-- 应用型变量赋值</span><br><span class="line">select ename into ena from emp where empno &#x3D; 7788;</span><br><span class="line">-- 记录型变量赋值</span><br><span class="line">select * into emprow from emp where empno &#x3D; 7788;</span><br><span class="line">dbms_output.put_line(emprow.ename||&#39;工作为：&#39;||emprow.job);</span><br><span class="line">end;</span><br></pre></td></tr></table></figure></li><li><p>if判断</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">-- 输入小于18的数字，输入‘less than 18’</span><br><span class="line">-- 输入大于18小于40的数字，输出‘18·40’</span><br><span class="line">-- 输入大于40的数字，输出‘older than 40’</span><br><span class="line">declare</span><br><span class="line">i number(3) :&#x3D;&amp;ii;</span><br><span class="line">begin</span><br><span class="line">if i&lt;18 then</span><br><span class="line">dbms_output.put_line(&#39;less than 18&#39;);</span><br><span class="line">elsif i&lt;40 then</span><br><span class="line">dbms_output.put_line(&#39;18-40&#39;);</span><br><span class="line">else</span><br><span class="line">dbms_output.put_line(&#39;older than 40&#39;);</span><br><span class="line">end if;</span><br><span class="line">end;</span><br></pre></td></tr></table></figure></li><li><p>while循环</p><blockquote><p>循环输出1-10数值</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">declare</span><br><span class="line">i number(1) :&#x3D; 1;</span><br><span class="line">begin</span><br><span class="line">while i&lt;11 loop</span><br><span class="line">dbms_output.put_line(i);</span><br><span class="line">i:&#x3D;i+1;</span><br><span class="line">end loop;</span><br><span class="line">end;</span><br></pre></td></tr></table></figure></li><li><p>exit循环【重点掌握】</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">declare</span><br><span class="line">i number(1) :&#x3D;1;</span><br><span class="line">begin</span><br><span class="line">loop</span><br><span class="line">exit when i&gt;10;</span><br><span class="line">dbms_output.put_line(i);</span><br><span class="line">i:&#x3D;i+1;</span><br><span class="line">end loop</span><br><span class="line">end;</span><br></pre></td></tr></table></figure></li><li><p>for循环</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">declare</span><br><span class="line"></span><br><span class="line">begin</span><br><span class="line">for i in 1..10 loop</span><br><span class="line">dbms_output.put_line(i);</span><br><span class="line">end loop;</span><br><span class="line">end;</span><br></pre></td></tr></table></figure></li><li><p>游标</p><blockquote><p>可以存放多个对象，多行记录</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">-- 输出emp表中所有员工姓名</span><br><span class="line">declare</span><br><span class="line">cursor c1 is select * from emp; -- 存储emp表所有记录</span><br><span class="line">emprow emp%rowtype;-- 存储一行的变量</span><br><span class="line">begin</span><br><span class="line">open c1;</span><br><span class="line">loop</span><br><span class="line">fetch c1 into emprow;-- 取出c1中每行记录，存储到emprow中</span><br><span class="line">exit when c1%nutfound;-- 结束标志</span><br><span class="line">dbms_output.put_line(emprow.ename);-- 输出</span><br><span class="line">end loop;</span><br><span class="line">    close c1;</span><br><span class="line">end;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">-- 给指定部门涨工资</span><br><span class="line">declare</span><br><span class="line">-- 获取指定部门的所有empno</span><br><span class="line">cursor c2(eno emp.deptno%type) is select empno from emp where deptno &#x3D; eno;</span><br><span class="line">-- 用于存储每次获取到的empno</span><br><span class="line">en emp.empno%type;</span><br><span class="line">begin</span><br><span class="line">open c2(10);-- 获取10部门的所有empno</span><br><span class="line">        loop</span><br><span class="line">            fetch c2 into en;-- 循环取出10部门的empno</span><br><span class="line">            exit when c2%notfound;-- 循环结束标志</span><br><span class="line">            update emp set sal&#x3D;sal+10 where cempno&#x3D;en;-- 通过取出的empno进行操作</span><br><span class="line">        end loop;</span><br><span class="line">    close c2;</span><br><span class="line">end;</span><br></pre></td></tr></table></figure></li></ol><h2 id="4-存储过程"><a href="#4-存储过程" class="headerlink" title="4. 存储过程"></a>4. 存储过程</h2><blockquote><p>存储过程就是提前已经编译好的一段pl/sql语言，放置在数据库端，可以直接调用。</p><p>这一段pl/sql一般都是固定步骤的业务。</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">--给指定员工涨100块</span><br><span class="line">--1.定义存储过程</span><br><span class="line">create or replace procedure p1(eno emp.empno%emp)</span><br><span class="line">is</span><br><span class="line">begin</span><br><span class="line">update emp set sal&#x3D;sal+100 where empno &#x3D; eno;</span><br><span class="line">commit</span><br><span class="line">end;</span><br><span class="line"></span><br><span class="line">-- 2.使用存储过程</span><br><span class="line">declare</span><br><span class="line">begin</span><br><span class="line">p1(7788);-- 调用存储过程，相当于给empno为7788的员工工资加100</span><br><span class="line">end;</span><br></pre></td></tr></table></figure><h2 id="5-存储函数"><a href="#5-存储函数" class="headerlink" title="5. 存储函数"></a>5. 存储函数</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">--通过存储函数实现计算指定员工的年薪</span><br><span class="line">--1.定义存储函数</span><br><span class="line">create or replace function f_yearsal(eno emp.emono%type) return number</span><br><span class="line">is </span><br><span class="line">s number(10);</span><br><span class="line">begin</span><br><span class="line">--将查询到的年薪记录在s</span><br><span class="line">select sal*12+nvl(comm,0) into s from emp where empno&#x3D;eno;</span><br><span class="line">--返回s</span><br><span class="line">return s;</span><br><span class="line">end;</span><br><span class="line">--2.使用存储函数</span><br><span class="line">declare </span><br><span class="line"> s number(10);</span><br><span class="line">begin</span><br><span class="line">s:&#x3D;f_yearsal(7788);</span><br><span class="line">dbms_output.put_line(s);</span><br><span class="line">end;</span><br></pre></td></tr></table></figure><blockquote><p>存储过程和存储函数的参数都不能带长度。</p><p>存储函数的返回值不能带长度。</p></blockquote><ol><li>存储过程和存储函数的区别<ol><li>语法区别：关键字不一样，存储函数比存储过程多了两个return</li><li>本质区别：<ul><li>存储函数有返回值，而存储过程没有返回值。</li><li>如果存储过程想实现返回值的业务，必须要使用out类型的参数</li><li>即使是存储过程使用了out类型的参数，其本质也不是真的有了返回值</li><li>而是在存储过程内部给out类型参数赋值，在执行完毕后，我们直接拿到输出参数类型的值。</li></ul></li></ol></li></ol><blockquote><p>可以利用存储函数的特性，封装为一个函数。提供查询语句使用</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 需求：查询员工姓名及其对应部门</span></span><br><span class="line"><span class="comment">-- 1.常规方法</span></span><br><span class="line"><span class="keyword">select</span> e.ename,d.dname</span><br><span class="line"><span class="keyword">from</span> emp e,dept d</span><br><span class="line"><span class="keyword">where</span> e.deptno = d.deptno;</span><br><span class="line"><span class="comment">-- 2. 定义函数+查询</span></span><br><span class="line"><span class="comment">-- 2.1定义存储函数：根据deptno查询dname</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">or</span> <span class="keyword">replace</span> <span class="keyword">function</span> f_dna(eno emp.empno%<span class="keyword">type</span>) <span class="keyword">return</span> dept.dname%<span class="keyword">type</span></span><br><span class="line"><span class="keyword">is</span></span><br><span class="line">dna dept.dname%<span class="keyword">type</span>;<span class="comment">-- 存储查询到的dname</span></span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line"><span class="comment">-- 查询dname，并返回</span></span><br><span class="line"><span class="keyword">select</span> dname <span class="keyword">into</span> dna <span class="keyword">from</span> dept <span class="keyword">where</span> deptno = eno;</span><br><span class="line">return dna;</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"><span class="comment">-- 2.2调用</span></span><br><span class="line"><span class="keyword">select</span> e.ename ,f_dna(e.deptno)</span><br><span class="line"><span class="keyword">from</span> emp e;</span><br></pre></td></tr></table></figure><h2 id="6-out类型"><a href="#6-out类型" class="headerlink" title="6. out类型"></a>6. out类型</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">--使用存储过程来算年薪</span><br><span class="line">--1.定义存储过程</span><br><span class="line">create or replace procedure p_yearsal(eno emp.empno%type,yearsal out number)</span><br><span class="line">is</span><br><span class="line">s number(10);</span><br><span class="line">c emp.comm%type;</span><br><span class="line">begin</span><br><span class="line">select sal*12,nvl(comm,0) into s,c from emp where empno &#x3D; eno;</span><br><span class="line">yearsal &#x3D; s + c;</span><br><span class="line">end;</span><br><span class="line">--2.使用存储过程</span><br><span class="line">declare</span><br><span class="line">yearsal number(10);</span><br><span class="line">begin</span><br><span class="line">p_yearsal(7788,yearsal);</span><br><span class="line">dbms_output.put_line(yearsal);</span><br><span class="line">end;</span><br></pre></td></tr></table></figure><blockquote><p>in和out类型参数的区别是什么？</p><ul><li>凡是涉及到into查询语句赋值或者:=赋值操作的参数，都必须使用out来修饰。</li></ul></blockquote><h2 id="7-触发器"><a href="#7-触发器" class="headerlink" title="7. 触发器"></a>7. 触发器</h2><blockquote><p>触发器就是一个规则，在我们<strong>增删改操作</strong>的时候，只要满足规则，自动触发，无需调用。</p></blockquote><ol><li><p>分类</p><blockquote><p>语句级触发器：不包含for each row的触发器。</p><p>行级触发器：包含了for each row的就是行级触发器。</p><p>加for each row 是为了使用:old或者:new对象或者一行记录</p></blockquote></li><li><p>语句级触发器</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">---需求：插入一条记录，输出一个“新员工入职”</span><br><span class="line">---分析：insert、操作之后、监听的表</span><br><span class="line"></span><br><span class="line">--创建触发器</span><br><span class="line">create or replace trigger t1</span><br><span class="line">after </span><br><span class="line">insert</span><br><span class="line">on person</span><br><span class="line">declare</span><br><span class="line"></span><br><span class="line">begin</span><br><span class="line">dbms_output.put_line(&#39;一个新员工入职&#39;);</span><br><span class="line">end;</span><br><span class="line"></span><br><span class="line">--触发t1</span><br><span class="line">insert into person value(10,&#39;zenyet&#39;);</span><br><span class="line">commit</span><br></pre></td></tr></table></figure></li><li><p>行级触发器</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">---需求：不能给员工降薪</span><br><span class="line">---分析：update、操作之前、监听表</span><br><span class="line"></span><br><span class="line">--创建触发器</span><br><span class="line">create or replace trigger t2</span><br><span class="line">before</span><br><span class="line">update</span><br><span class="line">on person</span><br><span class="line">for each row</span><br><span class="line">declare</span><br><span class="line"></span><br><span class="line">begin</span><br><span class="line">if :old.sal&gt;:new.sal then</span><br><span class="line">--抛出异常阻止执行</span><br><span class="line">raise_application_error(-20001,&#39;不能给员工降薪&#39;);</span><br><span class="line">end if;</span><br><span class="line">end;</span><br><span class="line"></span><br><span class="line">--触发t2</span><br><span class="line">update emp set sal&#x3D;sal-1 where empno&#x3D;7788;</span><br><span class="line">commit;</span><br></pre></td></tr></table></figure><blockquote><p>raise_application_error(-20001~-20999,’错误提示信息’);</p></blockquote></li><li><p>触发器应用</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">---需求：实现主键自增长</span><br><span class="line">---分析：insert、插入之后、监听表</span><br><span class="line"></span><br><span class="line">--创建触发器</span><br><span class="line">create or replace triggle t3</span><br><span class="line">before</span><br><span class="line">insert</span><br><span class="line">on person</span><br><span class="line">for each row</span><br><span class="line">declare</span><br><span class="line"></span><br><span class="line">begin</span><br><span class="line">select s_person.nextval into:new.pid from dual;</span><br><span class="line">end;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">--触发t3</span><br><span class="line">insert into emp(ename) values(&#39;zzz&#39;);</span><br><span class="line">commit;</span><br></pre></td></tr></table></figure></li></ol><h2 id="8-Java操作Oracle"><a href="#8-Java操作Oracle" class="headerlink" title="8. Java操作Oracle"></a>8. Java操作Oracle</h2><blockquote><p>Maven环境下使用Java连接Oracle执行SQL语句。</p></blockquote><ol><li><p>普通SQL语句</p><blockquote><p>pom.xml</p></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--连接oracle--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.oracle<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>ojdbc14<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>10.2.0.4.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.11<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>测试方法</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OJdbcTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 测试直接执行SQL语句</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ojdbcCallTrodiction</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">//1.注册驱动</span></span><br><span class="line">        Class.forName(<span class="string">&quot;oracle.jdbc.driver.OracleDriver&quot;</span>);</span><br><span class="line">        <span class="comment">//2.获取连接</span></span><br><span class="line">        Connection connection = DriverManager.getConnection(<span class="string">&quot;jdbc:oracle:thin:@192.168.106.10:1521:orcl&quot;</span>, <span class="string">&quot;tobing&quot;</span>, <span class="string">&quot;tobing&quot;</span>);</span><br><span class="line">        <span class="comment">//3.获取预处理对象</span></span><br><span class="line">        PreparedStatement pstmt = connection.prepareStatement(<span class="string">&quot;select * from emp where empno=?&quot;</span>);</span><br><span class="line">        <span class="comment">//4.设置参数</span></span><br><span class="line">        pstmt.setObject(<span class="number">1</span>,<span class="number">7788</span>);</span><br><span class="line">        <span class="comment">//5.执行查询</span></span><br><span class="line">        ResultSet rs = pstmt.executeQuery();</span><br><span class="line">        <span class="comment">//6.遍历结果集</span></span><br><span class="line">        <span class="keyword">while</span>(rs.next())&#123;</span><br><span class="line">            String ename = rs.getString(<span class="string">&quot;ename&quot;</span>);</span><br><span class="line">            System.out.println(ename);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//7.关闭资源</span></span><br><span class="line">        rs.close();</span><br><span class="line">        pstmt.close();</span><br><span class="line">        connection.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><ol start="2"><li><p>存储过程</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 调用存储过程</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ojdbcCallProcedure</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    <span class="comment">//1.注册驱动</span></span><br><span class="line">    Class.forName(<span class="string">&quot;oracle.jdbc.driver.OracleDriver&quot;</span>);</span><br><span class="line">    <span class="comment">//2.获取连接</span></span><br><span class="line">    Connection connection = DriverManager.getConnection(<span class="string">&quot;jdbc:oracle:thin:@192.168.106.10:1521:orcl&quot;</span>, <span class="string">&quot;tobing&quot;</span>, <span class="string">&quot;tobing&quot;</span>);</span><br><span class="line">    <span class="comment">//3.获取预处理对象</span></span><br><span class="line">    CallableStatement cstat = connection.prepareCall(<span class="string">&quot;&#123; call p2(?,?) &#125;&quot;</span>);</span><br><span class="line">    <span class="comment">//4.设置参数</span></span><br><span class="line">    cstat.setObject(<span class="number">1</span>,<span class="number">7788</span>);</span><br><span class="line">    cstat.registerOutParameter(<span class="number">2</span>, OracleTypes.NUMBER);</span><br><span class="line">    <span class="comment">//5.执行完毕</span></span><br><span class="line">    cstat.execute();</span><br><span class="line">    System.out.println(<span class="string">&quot;执行完毕&quot;</span>);</span><br><span class="line">    System.out.println(<span class="string">&quot;年薪为：&quot;</span>+cstat.getObject(<span class="number">2</span>));</span><br><span class="line">    <span class="comment">//6.关闭资源</span></span><br><span class="line">    cstat.close();</span><br><span class="line">    connection.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><ol start="3"><li><p>存储函数</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 测试调用存储函数</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ojdbcCallFunction</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    <span class="comment">//1.注册驱动</span></span><br><span class="line">    Class.forName(<span class="string">&quot;oracle.jdbc.driver.OracleDriver&quot;</span>);</span><br><span class="line">    <span class="comment">//2.获取连接</span></span><br><span class="line">    Connection connection = DriverManager.getConnection(<span class="string">&quot;jdbc:oracle:thin:@192.168.106.10:1521:orcl&quot;</span>, <span class="string">&quot;tobing&quot;</span>, <span class="string">&quot;tobing&quot;</span>);</span><br><span class="line">    <span class="comment">//3.获取预处理对象</span></span><br><span class="line">    CallableStatement cstat = connection.prepareCall(<span class="string">&quot;&#123; ?=call f_yearsal(?) &#125;&quot;</span>);</span><br><span class="line">    <span class="comment">//4.设置参数</span></span><br><span class="line">    cstat.setObject(<span class="number">2</span>,<span class="number">7788</span>);</span><br><span class="line">    cstat.registerOutParameter(<span class="number">1</span>, OracleTypes.NUMBER);</span><br><span class="line">    <span class="comment">//5.执行完毕</span></span><br><span class="line">    cstat.execute();</span><br><span class="line">    System.out.println(<span class="string">&quot;执行完毕&quot;</span>);</span><br><span class="line">    System.out.println(<span class="string">&quot;年薪为：&quot;</span>+cstat.getObject(<span class="number">1</span>));</span><br><span class="line">    <span class="comment">//6.关闭资源</span></span><br><span class="line">    cstat.close();</span><br><span class="line">    connection.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>CallableStatment接口</p><blockquote><p>CallableStatement是PreparedStatement子接口，是用于执行 SQL 存储过程的接口。</p><p>JDBC API 提供了一个存储过程 SQL 转义语法，该语法允许对所有 RDBMS  使用标准方式调用存储过程。此转义语法有一个包含结果参数的形式和一个不包含结果参数的形式。如果使用结果参数，则必须将其注册为 OUT  参数。其他参数可用于输入、输出或同时用于二者。参数是根据编号按顺序引用的，第一个参数的编号是 1。 </p><blockquote><p>  {?= call <procedure-name>[(<arg1>,<arg2>, …)]}<br>  {call <procedure-name>[(<arg1>,<arg2>, …)]}</p></blockquote></blockquote></li></ol>]]></content>
      
      
      <categories>
          
          <category> 理论学习 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Oracle </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Oracle-上</title>
      <link href="2020/01/19/Oracle-%E4%B8%8A/"/>
      <url>2020/01/19/Oracle-%E4%B8%8A/</url>
      
        <content type="html"><![CDATA[<p>Oracle学习第一弹。</p><a id="more"></a><h1 id="Oracle-上"><a href="#Oracle-上" class="headerlink" title="Oracle-上"></a>Oracle-上</h1><h2 id="1-基本使用"><a href="#1-基本使用" class="headerlink" title="1. 基本使用"></a>1. 基本使用</h2><ol><li><p>创建表空间，并给表空间指定用户</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--创建表空间</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">tablespace</span> tbspace<span class="comment">--指定表空间名称</span></span><br><span class="line"><span class="keyword">datafile</span> <span class="string">&#x27;c:\tbspace.dbf&#x27;</span><span class="comment">--指定表空间存储文件</span></span><br><span class="line"><span class="keyword">size</span> <span class="number">100</span>m<span class="comment">--指定初始大小</span></span><br><span class="line"><span class="keyword">autoextend</span> <span class="keyword">on</span><span class="comment">--指定自增长</span></span><br><span class="line"><span class="keyword">next</span> <span class="number">10</span>m;<span class="comment">--指定每次自增长大小</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--创建用户</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">user</span> tobing<span class="comment">--指定用户名</span></span><br><span class="line"><span class="keyword">identified</span> <span class="keyword">by</span> tobing<span class="comment">--指定用户密码</span></span><br><span class="line"><span class="keyword">default</span> <span class="keyword">tablespace</span> tbspace; <span class="comment">--指定使用的表</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--给用户授权</span></span><br><span class="line"><span class="comment">--Oracle中常用角色</span></span><br><span class="line">connect<span class="comment">--连接角色（基本角色）</span></span><br><span class="line">resource<span class="comment">--开发者角色</span></span><br><span class="line">dba<span class="comment">--超级管理员角色</span></span><br><span class="line"><span class="keyword">grant</span> dba <span class="keyword">to</span> tobing;<span class="comment">-- 给tobing授权超级管理员角色</span></span><br></pre></td></tr></table></figure></li><li><p>表结构的操作</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--创建表</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> person(<span class="comment">-- 创建person表</span></span><br><span class="line">pid <span class="built_in">number</span>(<span class="number">20</span>),</span><br><span class="line">    pname <span class="built_in">varchar2</span>(<span class="number">10</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">--修改表结构</span></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> person <span class="keyword">add</span> (gender <span class="built_in">number</span>(<span class="number">1</span>));<span class="comment">--添加一行</span></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> person <span class="keyword">modify</span> gender <span class="built_in">char</span>(<span class="number">1</span>);<span class="comment">--修改列类型</span></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> person <span class="keyword">rename</span> <span class="keyword">column</span> gender <span class="keyword">to</span> sex;<span class="comment">--修改类名称</span></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> person <span class="keyword">drop</span> <span class="keyword">column</span> sex;<span class="comment">--删除一列</span></span><br></pre></td></tr></table></figure></li><li><p>表数据的操作</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--查询表中记录</span></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> person;</span><br><span class="line"><span class="comment">---添加一条记录</span></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> person (pid,pname) <span class="keyword">values</span>(<span class="number">1</span>,<span class="string">&#x27;tobing&#x27;</span>);</span><br><span class="line"><span class="keyword">commit</span>;</span><br><span class="line"><span class="comment">---修改一条记录</span></span><br><span class="line"><span class="keyword">update</span> person <span class="keyword">set</span> pname =<span class="string">&#x27;扶上梁&#x27;</span> <span class="keyword">where</span> pid = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">commit</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">--三个删除</span></span><br><span class="line"><span class="comment">---删除表中所有记录</span></span><br><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> person;</span><br><span class="line"><span class="comment">---删除表结构</span></span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> person;</span><br><span class="line"><span class="comment">---先删除表，再创建表效果等于删除表中所有记录</span></span><br><span class="line"><span class="keyword">truncate</span> <span class="keyword">table</span> person;</span><br></pre></td></tr></table></figure><blockquote><ol><li>在对表中数据进行增删改操作的时候，需要手动将事务提交，否则可能会导致操作的丢失。<strong>Oracle的默认事务隔离级别和MySQL是不一样的。</strong></li><li>delete和truncate两种方式删除表中所有数据底层的实现原理是不一样的。delete是直接删除表中的记录，而truncate是<strong>先删除整个表结构</strong>，<strong>然后再创建一样的表结构。</strong></li><li>在<strong>数据量比较大，特别是含有索引的表中，使用truncate方式效率远大于delete方式。</strong></li></ol></blockquote></li><li><p>序列</p><blockquote><p>序列不真的属于任何一张表，但是可以逻辑和表做绑点。</p><p>默认从1开始，依次递增，主要用来主键赋值使用。</p><p><strong>dual：虚表，只是为了补全语法，没有任何意义。</strong></p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">sequence</span> s_person;</span><br><span class="line"><span class="keyword">select</span> s_person.nextval <span class="keyword">from</span> dual;</span><br><span class="line"><span class="comment">--序列使用</span></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> person(pid,pname) <span class="keyword">values</span>(s_person.nextval,<span class="string">&#x27;小明&#x27;</span>);</span><br><span class="line"><span class="keyword">commit</span>;</span><br><span class="line"><span class="comment">--查询效果</span></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> person;</span><br></pre></td></tr></table></figure></li><li><p>scott用户</p><blockquote><p>scott是Oracle提供给初学者研究学习的一张表。</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--解锁scott表</span></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">user</span> scott <span class="keyword">account</span> <span class="keyword">unlock</span>;</span><br><span class="line"><span class="comment">--解锁scoot密码【也可以用于重置密码】</span></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">user</span> scott <span class="keyword">identified</span> <span class="keyword">by</span> tiger;</span><br></pre></td></tr></table></figure></li></ol><h2 id="2-单行函数"><a href="#2-单行函数" class="headerlink" title="2. 单行函数"></a>2. 单行函数</h2><blockquote><p>单行函数作用于一行，放回一个值</p></blockquote><ol><li><p>字符函数</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- upper()：将字符转换为大写</span></span><br><span class="line"><span class="keyword">select</span> <span class="keyword">upper</span>(<span class="string">&quot;tobing&quot;</span>) <span class="keyword">from</span> dual;<span class="comment">-- 输出TOBING</span></span><br><span class="line"><span class="comment">-- lowwer()：将字符转换为小写</span></span><br><span class="line"><span class="keyword">select</span> lowwer(<span class="string">&quot;TOBING&quot;</span>) <span class="keyword">from</span> dual;<span class="comment">-- 输出tobing</span></span><br></pre></td></tr></table></figure></li><li><p>数值函数</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- round(number,n) 将数值保留n位（负数表示小数点前面）四舍五入</span></span><br><span class="line"><span class="keyword">select</span> <span class="keyword">round</span>(<span class="number">12</span>,<span class="number">56</span>,<span class="number">0</span>) <span class="keyword">from</span> dual;<span class="comment">-- 输出13</span></span><br><span class="line"><span class="comment">-- trunc(number,n) 直接将数值截断，保留n位</span></span><br><span class="line"><span class="keyword">select</span> trunc(<span class="number">12</span>,<span class="number">56</span>,<span class="number">0</span>) <span class="keyword">from</span> dual; <span class="comment">-- 输出12</span></span><br><span class="line"><span class="comment">-- mod(number,n) 将number对n取余数</span></span><br><span class="line"><span class="keyword">select</span> <span class="keyword">mod</span>(<span class="number">10</span>,<span class="number">3</span>) <span class="keyword">from</span> dual;<span class="comment">-- 输出1</span></span><br></pre></td></tr></table></figure></li><li><p>日期函数</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查询emp表中所有员工入职距离现在几天</span></span><br><span class="line"><span class="keyword">select</span>  <span class="keyword">sysdate</span>-e.hiredate <span class="keyword">from</span> emp e;</span><br><span class="line"><span class="comment">-- 算出明天此刻</span></span><br><span class="line"><span class="keyword">select</span> <span class="keyword">sysdate</span>+<span class="number">1</span> <span class="keyword">from</span> dual;</span><br><span class="line"><span class="comment">-- 查询emp表中所有员工入职距离现在几月</span></span><br><span class="line"><span class="keyword">select</span> months_between(<span class="keyword">sysdate</span>-e.hiredate)<span class="keyword">from</span> emp e;</span><br><span class="line"><span class="comment">-- 查询emp表中所有员工入职距离现在几年</span></span><br><span class="line"><span class="keyword">select</span> months_between(<span class="keyword">sysdate</span>-e.hiredate)/<span class="number">12</span> <span class="keyword">from</span> emp e;</span><br><span class="line"><span class="comment">-- 查询emp表中所有员工入职距离现在几周</span></span><br><span class="line"><span class="keyword">select</span> <span class="keyword">sysdate</span>-e.hiredate/<span class="number">7</span> <span class="keyword">from</span> emp e;</span><br></pre></td></tr></table></figure></li><li><p>转换函数</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- to_char(date,regex) 日期转字符串</span></span><br><span class="line"><span class="comment">-- fm：表示不用0补位</span></span><br><span class="line"><span class="comment">-- mi：分钟，由于不区分大小写，需要使用mi与mm区别</span></span><br><span class="line"><span class="comment">-- hh24：使用24小时方式显示</span></span><br><span class="line"><span class="keyword">select</span> to_char(<span class="keyword">sysdate</span>,<span class="string">&quot;fm yyyy-mm-dd hh24:mi:ss&quot;</span> ) <span class="keyword">from</span> dual;</span><br><span class="line"><span class="comment">-- to_date(char,regex) 字符串转日期</span></span><br><span class="line"><span class="keyword">select</span> <span class="keyword">to_date</span>(<span class="string">&quot;2018-12-12 12:12:12&quot;</span>,<span class="string">&quot;fm yyyy-mm-dd hh24:mi:ss&quot;</span>) <span class="keyword">from</span> dual;</span><br></pre></td></tr></table></figure></li><li><p>通用函数</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 算出emp表中所有员工的年薪（月新*12+奖金）</span></span><br><span class="line"><span class="comment">-- 存在问题：有点员工奖金为null，直接跟null运算结果是null</span></span><br><span class="line"><span class="comment">-- 如何解决：使用nvl(value,number),如果value为null，使number替换</span></span><br><span class="line"><span class="keyword">select</span> e.sal*<span class="number">12</span>+nvl(e.comm,<span class="number">0</span>) <span class="keyword">from</span> emp e;</span><br></pre></td></tr></table></figure></li></ol><h2 id="3-条件表达式"><a href="#3-条件表达式" class="headerlink" title="3. 条件表达式"></a>3. 条件表达式</h2><ol><li><p>通用用法</p><blockquote><p>适用于Oracle和mysql</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 需求1：给emp表中的员工名称起中文名</span></span><br><span class="line"><span class="keyword">select</span> e.ename,</span><br><span class="line"><span class="keyword">case</span> e.ename</span><br><span class="line"><span class="keyword">when</span> <span class="string">&#x27;SMITH&#x27;</span> <span class="keyword">then</span> <span class="string">&#x27;张三丰&#x27;</span></span><br><span class="line"><span class="keyword">when</span> <span class="string">&#x27;ALLEN&#x27;</span> <span class="keyword">then</span> <span class="string">&#x27;张无忌&#x27;</span></span><br><span class="line"><span class="keyword">when</span> <span class="string">&#x27;WARD&#x27;</span> <span class="keyword">then</span> <span class="string">&#x27;张翠山&#x27;</span></span><br><span class="line"><span class="keyword">else</span> <span class="string">&#x27;无名&#x27;</span> <span class="comment">-- 可以省略</span></span><br><span class="line"><span class="keyword">end</span><span class="comment">-- 结束标记，不要忘记</span></span><br><span class="line"><span class="keyword">from</span> emp e;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 需求2：判断emp表中员工，&gt;3000为高收入，1500-3000为中等收入，其余为低收入</span></span><br><span class="line"><span class="keyword">select</span> e.sal</span><br><span class="line"><span class="keyword">case</span></span><br><span class="line"><span class="keyword">then</span> e.sal&gt;<span class="number">3000</span> <span class="keyword">then</span> <span class="string">&#x27;高收入&#x27;</span></span><br><span class="line"><span class="keyword">then</span> e.sal&gt;<span class="number">1500</span> <span class="keyword">then</span> <span class="string">&#x27;中等收入&#x27;</span></span><br><span class="line"><span class="keyword">else</span> <span class="string">&#x27;低收入&#x27;</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="keyword">from</span> emp e;</span><br></pre></td></tr></table></figure></li><li><p>Oracle特有</p><blockquote><p>oracle中除了取别名，动用单引号</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 需求1：给emp表中的员工名称起中文名</span></span><br><span class="line"><span class="keyword">select</span> e.ename</span><br><span class="line"><span class="keyword">decode</span>(e.name,<span class="string">&#x27;SMITH&#x27;</span>,<span class="string">&#x27;张三丰&#x27;</span>,<span class="string">&#x27;WARD&#x27;</span>,<span class="string">&#x27;张无忌&#x27;</span>,<span class="string">&#x27;无名&#x27;</span>) 中文名</span><br><span class="line"><span class="keyword">from</span> emp e;</span><br></pre></td></tr></table></figure></li></ol><h2 id="4-多行函数"><a href="#4-多行函数" class="headerlink" title="4. 多行函数"></a>4. 多行函数</h2><blockquote><p>多行函数【聚合函数】：作用于多行，返回一个值。</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">count</span>(<span class="number">1</span>) <span class="keyword">from</span> emp;<span class="comment">-- 查询总数量</span></span><br><span class="line"><span class="keyword">select</span> <span class="keyword">max</span>(sal) <span class="keyword">from</span> emp;<span class="comment">-- 查询最高工资</span></span><br><span class="line"><span class="keyword">select</span> <span class="keyword">min</span>(sal) <span class="keyword">from</span> emp; <span class="comment">-- 查询最低工作</span></span><br><span class="line"><span class="keyword">select</span> <span class="keyword">sum</span>(sal) <span class="keyword">from</span> emp;<span class="comment">-- 查询工作总和</span></span><br><span class="line"><span class="keyword">select</span> <span class="keyword">avg</span>(sal) <span class="keyword">from</span> emp;<span class="comment">-- 查询平均工资</span></span><br></pre></td></tr></table></figure><h2 id="5-分组查询"><a href="#5-分组查询" class="headerlink" title="5. 分组查询"></a>5. 分组查询</h2><blockquote><p>分组查询常常可以<strong>结合聚合函数</strong>进行查询</p></blockquote><ol><li><p>查询出每个部门的平均工资</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> e.deptno, <span class="keyword">avg</span>(e.sal) </span><br><span class="line"><span class="keyword">from</span> emp e</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> e.deptno;</span><br></pre></td></tr></table></figure><blockquote><p>分组查询中，<strong>出现在group by后面</strong>的<strong>原始列</strong>才可以出现在select后面。</p><p>分组查询中，<strong>没有出现在group by后面的列</strong>，想在select之后出现，只能加上<strong>聚合函数</strong>。</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> e.deptno, e.sal</span><br><span class="line"><span class="keyword">from</span> emp e</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> e.deptno;</span><br></pre></td></tr></table></figure><blockquote><p><strong>以上写法是错误的</strong>。因为分组后的结果是多行的，无法判断是哪一行的sal。</p></blockquote></li><li><p>查询出平均工资高于2000的部门信息</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> e.deptno,<span class="keyword">avg</span>(e.sal)</span><br><span class="line"><span class="keyword">from</span> emp e</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> e.deptno</span><br><span class="line"><span class="keyword">having</span> <span class="keyword">avg</span>(e.sal)&gt;<span class="number">2000</span>;</span><br></pre></td></tr></table></figure><blockquote><p><strong>having用于过滤分组之后的数据</strong></p></blockquote></li><li><p>查询出每个部门工资高于800的平均工资</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> e.deptno,<span class="keyword">avg</span>(e.sal)</span><br><span class="line"><span class="keyword">from</span> emp e</span><br><span class="line"><span class="keyword">where</span> e.sal&gt;<span class="number">800</span></span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> e.deptno</span><br></pre></td></tr></table></figure><blockquote><p><strong>where用于过滤分组之前的数据</strong></p></blockquote></li><li><p>查询出每个部门员工工资高于800的平均工资且平均工资高于2000的部门</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> e.deptno,e.sal</span><br><span class="line"><span class="keyword">from</span> emp e</span><br><span class="line"><span class="keyword">where</span> e.sal&gt;<span class="number">800</span></span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> e.deptno</span><br><span class="line"><span class="keyword">having</span> <span class="keyword">avg</span>(e.sal)&gt;<span class="number">200</span></span><br></pre></td></tr></table></figure><blockquote><p>where 必须位于group by之前，having 必须位于group by之后</p></blockquote></li></ol><h2 id="6-多表查询"><a href="#6-多表查询" class="headerlink" title="6. 多表查询"></a>6. 多表查询</h2><h3 id="0-笛卡尔积"><a href="#0-笛卡尔积" class="headerlink" title="0. 笛卡尔积"></a>0. 笛卡尔积</h3><blockquote><p>直接的无条件多表查询返回的结果是笛卡尔积（表间数据类的排列组合），笛卡尔积的很多内容往往是无效的，需要通过某些条件进行过滤。</p></blockquote><h3 id="1-内连接和等值连接"><a href="#1-内连接和等值连接" class="headerlink" title="1. 内连接和等值连接"></a>1. 内连接和等值连接</h3><ol><li><p>等值连接</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查询出emp表中员工所有信息（员工的部门信息在dept表中）</span></span><br><span class="line"><span class="keyword">select</span> *</span><br><span class="line"><span class="keyword">from</span> emp e,dept d</span><br><span class="line"><span class="keyword">where</span> e.deptno = d.deptno</span><br></pre></td></tr></table></figure><blockquote><p>使用where作为条件判断关键词。【推荐使用】</p></blockquote></li><li><p>内连接</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查询出emp表中员工所有信息（员工的部门信息在dept表中）</span></span><br><span class="line"><span class="keyword">select</span> *</span><br><span class="line"><span class="keyword">from</span> emp e <span class="keyword">inner</span> <span class="keyword">join</span> dept d</span><br><span class="line"><span class="keyword">on</span> e.deptno = d.deptno</span><br></pre></td></tr></table></figure><blockquote><p>早期的写法，推荐使用等值连接的方式将其替换</p></blockquote></li></ol><h3 id="2-外连接"><a href="#2-外连接" class="headerlink" title="2. 外连接"></a>2. 外连接</h3><blockquote><p>外连接可以解决多表中，要查询某一个表中的所有数据，而该数据与其他表无映射关系时的问题。</p></blockquote><ol><li><p>通用外连接</p><blockquote><p>外连接有左外连接和右外连接之分。左右只是相对的概念。</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查询出所有部门信息，以及部门下的员工【有的部门可能没有对应员工】</span></span><br><span class="line"><span class="keyword">select</span> *</span><br><span class="line"><span class="keyword">from</span> emp e <span class="keyword">right</span> <span class="keyword">join</span> dept d</span><br><span class="line"><span class="keyword">on</span> e.deptno = d.dpetno;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询出所有员工信息，已经员工对应的部门【员工可能没有对应部门】</span></span><br><span class="line"><span class="keyword">select</span> *</span><br><span class="line"><span class="keyword">from</span> emp e <span class="keyword">left</span> <span class="keyword">join</span> dept d</span><br><span class="line"><span class="keyword">on</span> e.deptno = d.deptno;</span><br></pre></td></tr></table></figure></li><li><p>Oracle特有外连接</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查询出所有部门信息，以及部门下的员工【有的部门可能没有对应员工】</span></span><br><span class="line"><span class="keyword">select</span> *</span><br><span class="line"><span class="keyword">from</span> emp e,dept d</span><br><span class="line"><span class="keyword">where</span> e.deptno(+) = d.deptno</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询出所有员工信息，已经员工对应的部门【员工可能没有对应部门】</span></span><br><span class="line"><span class="keyword">select</span> *</span><br><span class="line"><span class="keyword">from</span> emp e,dept d</span><br><span class="line"><span class="keyword">where</span> e.deptno = d.deptno(+)</span><br></pre></td></tr></table></figure><blockquote><p>注意<strong>（+）</strong>的位置</p></blockquote></li></ol><h3 id="3-自连接"><a href="#3-自连接" class="headerlink" title="3. 自连接"></a>3. 自连接</h3><blockquote><p>自连接：就是站在不同角度把一张表看成多张表</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查询出员工姓名，员工领导姓名【员工，员工领导在同一张表】</span></span><br><span class="line"><span class="keyword">select</span> e1.ename,e2.ename</span><br><span class="line"><span class="keyword">from</span> emp e1,emp e2</span><br><span class="line"><span class="keyword">where</span> e1.mgr = e2.empno</span><br><span class="line"><span class="comment">-- 查询出员工姓名，员工部门名称，员工领导姓名，员工领导部门名称</span></span><br><span class="line"><span class="keyword">select</span> e1.enam, d1.dname,e2.ename,d2 dname</span><br><span class="line"><span class="keyword">from</span> emp e1,dept d1,emp e2,dept d2</span><br><span class="line"><span class="keyword">where</span> e1.mgr = e2.empno</span><br><span class="line"><span class="keyword">and</span> e1.deptno = d1.deptno</span><br><span class="line"><span class="keyword">and</span> e2.deptno = d2.deptno;</span><br></pre></td></tr></table></figure><h3 id="3-子查询"><a href="#3-子查询" class="headerlink" title="3. 子查询"></a>3. 子查询</h3><ol><li><p>子查询返回一个值</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--查询与scott一样工资的员工的信息</span></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> emp <span class="keyword">where</span> <span class="keyword">name</span> <span class="keyword">in</span>(</span><br><span class="line">    <span class="keyword">select</span> sal <span class="keyword">from</span> emp <span class="keyword">where</span> <span class="keyword">name</span> =<span class="string">&#x27;scott&#x27;</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure><blockquote><p>为避免scott不唯一导致问题，使用in而不是=</p></blockquote></li><li><p>子查询返回一个集合</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--查询出工资和10号部门任意员工一样的员工信息</span></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> emp <span class="keyword">where</span> sal <span class="keyword">in</span>(</span><br><span class="line"><span class="keyword">select</span> sal <span class="keyword">from</span> emp <span class="keyword">where</span> depton = <span class="number">10</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure></li><li><p>子查询返回一张表</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--查询出每个部门的最低工资，和最低工资员工姓名，和该员工所在部门名称</span></span><br><span class="line"><span class="comment">--1. 查询出每个部门及其对应的最低工资</span></span><br><span class="line"><span class="keyword">select</span> e.deptno,<span class="keyword">min</span>(e.sal)</span><br><span class="line"><span class="keyword">from</span> emp e</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> e.deptno</span><br><span class="line"><span class="comment">--2. 三表联查，得到最后结果</span></span><br><span class="line"><span class="keyword">select</span> </span><br><span class="line">t.deptno,  t.msal  e.ename,  dept.dname</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">(<span class="keyword">select</span> deptno,<span class="keyword">min</span>(e.sal) msal</span><br><span class="line">    <span class="keyword">from</span> emp </span><br><span class="line">    <span class="keyword">group</span> <span class="keyword">by</span> deptno) t,emp e,dept d</span><br><span class="line"><span class="keyword">where</span></span><br><span class="line">t.deptno = e.deptno,</span><br><span class="line"><span class="keyword">and</span> t.msal = e.sal,</span><br><span class="line"><span class="keyword">and</span> e.deptno = d.deptno;</span><br></pre></td></tr></table></figure></li></ol><h3 id="4-分页查询"><a href="#4-分页查询" class="headerlink" title="4. 分页查询"></a>4. 分页查询</h3><ol><li><p>行号rownum</p><blockquote><p>当我们使用select操作的时候，每查询出一行记录，就会在该行上加上一个行号。</p><p>行号从1开始，依次递增，不能跳着走。</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--以下sql语句是先查询出来数据，再排序</span></span><br><span class="line"><span class="comment">--由于查询数据时rownum已经存在，再排序会导致rownum是乱序的</span></span><br><span class="line"><span class="keyword">select</span> <span class="keyword">rownum</span>,e.* <span class="keyword">from</span> emp e <span class="keyword">order</span> <span class="keyword">by</span> sal <span class="keyword">desc</span>;</span><br><span class="line"><span class="comment">--解决办法：嵌套查询</span></span><br><span class="line"><span class="keyword">select</span> </span><br><span class="line"><span class="keyword">rownum</span>,e.*</span><br><span class="line"><span class="keyword">from</span> </span><br><span class="line">(<span class="keyword">select</span> * <span class="keyword">from</span> emp <span class="keyword">order</span> <span class="keyword">by</span> sal <span class="keyword">desc</span>) e;</span><br></pre></td></tr></table></figure></li><li><p>分页查询</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--emp表工资倒序排列后，每页显示5条，查询第2页</span></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span>(</span><br><span class="line"><span class="keyword">select</span> <span class="keyword">rownum</span> rn,tt.* <span class="keyword">from</span>(</span><br><span class="line">    <span class="keyword">select</span> * <span class="keyword">from</span> emp <span class="keyword">order</span> <span class="keyword">by</span> sal <span class="keyword">desc</span></span><br><span class="line">    )tt <span class="keyword">where</span> <span class="keyword">rownum</span>&lt;<span class="number">11</span></span><br><span class="line">)<span class="keyword">where</span> rn&gt;<span class="number">5</span></span><br></pre></td></tr></table></figure><blockquote><p>rownum行号不能写上大于一个正数</p></blockquote></li></ol>]]></content>
      
      
      <categories>
          
          <category> 理论学习 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Oracle </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SpringMVC-3-响应数据与文件上传</title>
      <link href="2020/01/07/SpringMVC-3-%E5%93%8D%E5%BA%94%E6%95%B0%E6%8D%AE%E4%B8%8E%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/"/>
      <url>2020/01/07/SpringMVC-3-%E5%93%8D%E5%BA%94%E6%95%B0%E6%8D%AE%E4%B8%8E%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/</url>
      
        <content type="html"><![CDATA[<p>SpringMVC第三弹。</p><a id="more"></a><h1 id="SpringMVC-3-响应数据与文件上传"><a href="#SpringMVC-3-响应数据与文件上传" class="headerlink" title="SpringMVC-3-响应数据与文件上传"></a>SpringMVC-3-响应数据与文件上传</h1><h2 id="1-响应数据"><a href="#1-响应数据" class="headerlink" title="1. 响应数据"></a>1. 响应数据</h2><blockquote><p>在使用SpringMVC响应数据时，控制器（controller）的返回值可以有三种。</p></blockquote><ol><li><p>字符串</p><blockquote><p>controller方法返回字符串可以指定逻辑视图名，通过视图解析器解析为物理视图地址。</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/sayHello&quot;)</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> String <span class="title">sayHello</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span></span>&#123;</span><br><span class="line">       System.out.println(<span class="string">&quot;sayHello方法执行了&quot;</span>);</span><br><span class="line">       User user = <span class="keyword">new</span> User();</span><br><span class="line">       user.setUsername(<span class="string">&quot;Tobing&quot;</span>);</span><br><span class="line">       user.setPassword(<span class="string">&quot;root&quot;</span>);</span><br><span class="line">       user.setAge(<span class="number">19</span>);</span><br><span class="line">       request.setAttribute(<span class="string">&quot;user&quot;</span>,user);</span><br><span class="line">       <span class="keyword">return</span> <span class="string">&quot;success&quot;</span>;<span class="comment">// 此处转发到success.jsp</span></span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><blockquote><p>执行原理</p></blockquote><p><img src="https://i.loli.net/2021/01/15/YXzq7gKiW96tcGf.png" class="lazyload" data-srcset="https://i.loli.net/2021/01/15/YXzq7gKiW96tcGf.png" srcset="data:image/png;base64,666" alt="字符串响应"></p></li><li><p>void</p><blockquote><p>可以使用<strong>Servlet原生的API</strong>作为控制器参数，通过request和response对象进行<strong>转发</strong>或<strong>重定向</strong></p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/sayVoid&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sayVoid</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;sayVoid方法执行了&quot;</span>);</span><br><span class="line">    <span class="comment">//1.使用request转向页面</span></span><br><span class="line">    <span class="comment">//request.getRequestDispatcher(&quot;/WEB-INF/pages/success.jsp&quot;).forward(request,response);</span></span><br><span class="line">    <span class="comment">//2.通过Response页面重定向</span></span><br><span class="line">    <span class="comment">//response.sendRedirect(&quot;sayHello&quot;);</span></span><br><span class="line">    <span class="comment">//3.通过request直接写入响应结果</span></span><br><span class="line">    response.setCharacterEncoding(<span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line">    response.setContentType(<span class="string">&quot;application/json;charset=utf-8&quot;</span>);</span><br><span class="line">    response.getWriter().write(<span class="string">&quot;Hello World!!!&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>ModelAndView</p><blockquote><p>SpringMVC还提供ModelAndView对象可以用作控制器返回值。</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/testReturnModelAndView&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> ModelAndView <span class="title">testReturnModelAndView</span><span class="params">()</span></span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;testReturnModelAndView方法执行了&quot;</span>);</span><br><span class="line">    ModelAndView mv =  <span class="keyword">new</span> ModelAndView();</span><br><span class="line">    User user = <span class="keyword">new</span> User();</span><br><span class="line">    user.setUsername(<span class="string">&quot;Tobing&quot;</span>);</span><br><span class="line">    user.setPassword(<span class="string">&quot;root&quot;</span>);</span><br><span class="line">    user.setAge(<span class="number">19</span>);</span><br><span class="line">    mv.addObject(<span class="string">&quot;user&quot;</span>,user);</span><br><span class="line">    mv.setViewName(<span class="string">&quot;success&quot;</span>);<span class="comment">// 设置逻辑视图名称，视图解析器会根据名称前往指定视图</span></span><br><span class="line">    <span class="keyword">return</span> mv;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>ModelAndView对象提供addObject方法可以将Object类型的对象封装到request域中。同时提供setViewName方法设置逻辑视图名称，这时视图解析器就可以根据名前往指定视图。</p></blockquote></li><li><p>转发和重定向</p><blockquote><p>controller方法在使用String返回值时，支持使用forward（转发）和redirect（重定向）关键字进行响应。</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;testForwardOrRedirect&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">testForwardOrRedirect</span><span class="params">(HttpServletRequest request)</span></span>&#123;</span><br><span class="line">    User user = <span class="keyword">new</span> User();</span><br><span class="line">    user.setUsername(<span class="string">&quot;actogo&quot;</span>);</span><br><span class="line">    user.setPassword(<span class="string">&quot;root&quot;</span>);</span><br><span class="line">    user.setAge(<span class="number">19</span>);</span><br><span class="line"><span class="comment">//return &quot;forward:/WEB-INF/pages/success.jsp&quot;; // 相当于request.getRequestDispatchet(&quot;url&quot;).forward(request,response);</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;redirect:sayHello&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><h2 id="2-响应json数据"><a href="#2-响应json数据" class="headerlink" title="2. 响应json数据"></a>2. 响应json数据</h2><blockquote><p>前端页面的ajax请求，发送json数据</p></blockquote><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">        $(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">            $(<span class="string">&quot;#btn&quot;</span>).click(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;<span class="comment">// 点击按钮发送ajax请求</span></span></span><br><span class="line"><span class="javascript">                $.ajax(&#123;</span></span><br><span class="line"><span class="javascript">                    url:<span class="string">&quot;user/testJson&quot;</span>,<span class="comment">// 设置请求url</span></span></span><br><span class="line"><span class="javascript">                    <span class="comment">//设置数据类型</span></span></span><br><span class="line"><span class="javascript">                    contentType:<span class="string">&quot;application/json;charset=UTF-8&quot;</span>,</span></span><br><span class="line"><span class="javascript">                    <span class="comment">//设置数据</span></span></span><br><span class="line"><span class="javascript">                    data:<span class="string">&#x27;&#123;&quot;username&quot;:&quot;hehe&quot;,&quot;password&quot;:&quot;123&quot;,&quot;age&quot;:30&#125;&#x27;</span>,</span></span><br><span class="line"><span class="javascript">                    dataType:<span class="string">&quot;json&quot;</span>,<span class="comment">// 数据封装类型</span></span></span><br><span class="line"><span class="javascript">                    type:<span class="string">&quot;post&quot;</span>,<span class="comment">// 数据提交方式</span></span></span><br><span class="line"><span class="javascript">                    success:<span class="function"><span class="keyword">function</span>(<span class="params">data</span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">                        <span class="comment">// data:服务器端响应的json的数据，进行解析</span></span></span><br><span class="line">                        alert(data.username);</span><br><span class="line">                        alert(data.password);</span><br><span class="line">                        alert(data.age);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line"></span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">&quot;btn&quot;</span>&gt;</span>提交<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>后端控制器使用RequestBody注解将json数据封装到指定JavaBean，使用ResponseBody注解将返回的JavaBean封装为json返回。</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;testJson&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@ResponseBody</span> <span class="function">User <span class="title">testJson</span><span class="params">(<span class="meta">@RequestBody</span> User user)</span> </span>&#123;</span><br><span class="line"><span class="comment">// 输出RequestBody封装的JavaBean</span></span><br><span class="line">    System.out.println(user);</span><br><span class="line">    <span class="comment">// 处理数据</span></span><br><span class="line">    user.setUsername(<span class="string">&quot;actogo&quot;</span>);</span><br><span class="line">    user.setAge(<span class="number">20</span>);</span><br><span class="line">    user.setPassword(<span class="string">&quot;root&quot;</span>);</span><br><span class="line">    <span class="comment">// 返回数据</span></span><br><span class="line">    <span class="keyword">return</span> user;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="3-SpringMVC实现文件上传"><a href="#3-SpringMVC实现文件上传" class="headerlink" title="3. SpringMVC实现文件上传"></a>3. SpringMVC实现文件上传</h2>]]></content>
      
      
      
        <tags>
            
            <tag> SpringMVC </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SpringMVC-2-参数绑定与常用注解</title>
      <link href="2020/01/07/SpringMVC-2-%E5%8F%82%E6%95%B0%E7%BB%91%E5%AE%9A%E4%B8%8E%E5%B8%B8%E7%94%A8%E6%B3%A8%E8%A7%A3/"/>
      <url>2020/01/07/SpringMVC-2-%E5%8F%82%E6%95%B0%E7%BB%91%E5%AE%9A%E4%B8%8E%E5%B8%B8%E7%94%A8%E6%B3%A8%E8%A7%A3/</url>
      
        <content type="html"><![CDATA[<p>SpringMVC第二弹。</p><a id="more"></a><h1 id="SpringMVC-2-参数绑定与常用注解"><a href="#SpringMVC-2-参数绑定与常用注解" class="headerlink" title="SpringMVC-2-参数绑定与常用注解"></a>SpringMVC-2-参数绑定与常用注解</h1><h2 id="1-参数绑定"><a href="#1-参数绑定" class="headerlink" title="1. 参数绑定"></a>1. 参数绑定</h2><blockquote><p>表单中的请求参数都是基于键值对的。SpringMVC绑定请求参数的过程是：把<strong>表单的请求参数</strong>作为<strong>控制器中方法的参数</strong>进行绑定。</p><p>SpingMVC请求参数的绑定是自动实现的，但要遵守规范。</p></blockquote><h3 id="1-基本类型参数绑定"><a href="#1-基本类型参数绑定" class="headerlink" title="1. 基本类型参数绑定"></a>1. 基本类型参数绑定</h3><blockquote><p>包含了基本数据类型和String类型</p><p>规范：参数名称必须和控制器方法参数一致，且严格区分大小写。</p></blockquote><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;params/getUsername?username=tobing&quot;</span>&gt;</span>测试普通数据类型绑定<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller(&quot;paramsController&quot;)</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/params&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ParamsController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/getUsername&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getUsername</span><span class="params">(String username)</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;用户名为：&quot;</span>+username);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-POJO类型参数绑定"><a href="#2-POJO类型参数绑定" class="headerlink" title="2. POJO类型参数绑定"></a>2. POJO类型参数绑定</h3><blockquote><p>包含了自定义实体类，以及其中关联的实体类</p><p>规范：参数名称必须和实体类属性名称一致，且控制器方法参数就是实体类。</p></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"> 测试JavaBean类型绑定</span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span> <span class="attr">action</span>=<span class="string">&quot;params/getUser&quot;</span>&gt;</span></span><br><span class="line">    用户名：<span class="tag">&lt;<span class="name">input</span>  <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span>/&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    密码：<span class="tag">&lt;<span class="name">input</span>  <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span>/&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    账户密码：<span class="tag">&lt;<span class="name">input</span>  <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;account.apwd&quot;</span>/&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    账户余额：<span class="tag">&lt;<span class="name">input</span>  <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;account.money&quot;</span>/&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;提交&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// JavaBean</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">    <span class="keyword">private</span> Account account;</span><br><span class="line">    <span class="comment">// setter、getter and toString</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Account</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String apwd;</span><br><span class="line">    <span class="keyword">private</span> Float money;</span><br><span class="line">    <span class="comment">// setter、getter and toString</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Controller</span></span><br><span class="line"><span class="meta">@Controller(&quot;paramsController&quot;)</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/params&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ParamsController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/getUser&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getUser</span><span class="params">(User user)</span></span>&#123;</span><br><span class="line">        System.out.println(user);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-数组和集合类型参数绑定"><a href="#3-数组和集合类型参数绑定" class="headerlink" title="3. 数组和集合类型参数绑定"></a>3. 数组和集合类型参数绑定</h3><blockquote><p>包括了List结构和Map结构</p><p>规范：集合类型请求参数必须在实体类中，且请求参数名称要和实体类的属性名称一致。</p><blockquote><p>List：使用下标</p><p>Map：使用键值对</p></blockquote></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">参数绑定map和list</span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span> <span class="attr">action</span>=<span class="string">&quot;params/getUser&quot;</span>&gt;</span></span><br><span class="line">    用户名：<span class="tag">&lt;<span class="name">input</span>  <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span>/&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    密码：<span class="tag">&lt;<span class="name">input</span>  <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span>/&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    账户密码：<span class="tag">&lt;<span class="name">input</span>  <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;accounts[0].apwd&quot;</span>/&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    账户余额：<span class="tag">&lt;<span class="name">input</span>  <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;accounts[0].money&quot;</span>/&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    账户密码：<span class="tag">&lt;<span class="name">input</span>  <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;accountMap[&#x27;one&#x27;].apwd&quot;</span>/&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    账户余额：<span class="tag">&lt;<span class="name">input</span>  <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;accountMap[&#x27;one&#x27;].money&quot;</span>/&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;提交&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Javabean</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">    <span class="keyword">private</span> Map&lt;String,Account&gt; accountMap;</span><br><span class="line">    <span class="keyword">private</span> List&lt;Account&gt; accounts;</span><br><span class="line"> <span class="comment">// setter、getter and toString</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Account</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String apwd;</span><br><span class="line">    <span class="keyword">private</span> Float money;</span><br><span class="line">    <span class="comment">// setter、getter and toString</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Controller</span></span><br><span class="line"><span class="meta">@Controller(&quot;paramsController&quot;)</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/params&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ParamsController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/getUser&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getUser</span><span class="params">(User user)</span></span>&#123;</span><br><span class="line">        System.out.println(user);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4-自定义类型转换器"><a href="#4-自定义类型转换器" class="headerlink" title="4. 自定义类型转换器"></a>4. 自定义类型转换器</h3><blockquote><ul><li><p>当我们<strong>输入的数据格式不符合自动参数绑定的规范</strong>的时候，SpringMVC并<strong>不能</strong>帮助我们封装参数，会出错。（例如：2019/01/01可以自动封装Date，而2019-01-01会报400错误）</p></li><li><p>此时除了更改数据格式，还可以<strong>使用自定义类型转换器</strong>，把数据封装。</p></li><li><p>自定义类型转换器实际是我们把获取到的数据进行自定义封装。</p></li></ul></blockquote><ol><li><p>使用步骤一：定义实现了Converter接口的实体类</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StringtoDateConverter</span> <span class="keyword">implements</span> <span class="title">Converter</span>&lt;<span class="title">String</span>, <span class="title">Date</span>&gt; </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Date <span class="title">convert</span><span class="params">(String source)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(source==<span class="keyword">null</span>)&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">&quot;没找到数据&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        SimpleDateFormat sdf = <span class="keyword">new</span> SimpleDateFormat(<span class="string">&quot;yyyy-MM-dd&quot;</span>);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> sdf.parse(source);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ParseException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">&quot;日期格式异常！&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>以上类实现了将yyyy-MM-dd格式的字符串转换为Date类型</p></blockquote></li><li><p>在Spring配置文件中配置类型转换器</p><blockquote><p>spring 配置类型转换器的机制是，将自定义的转换器注册到类型转换服务中去。 </p></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--配置转换器--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;conversionServiceFactoryBean&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.context.support.ConversionServiceFactoryBean&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;converters&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">set</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--添加自己实现的转换器--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;top.tobing.utils.StringtoDateConverter&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--配置spring开启mvc注解--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--引用转换器--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mvc:annotation-driven</span> <span class="attr">conversion-service</span>=<span class="string">&quot;conversionServiceFactoryBean&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">mvc:annotation-driven</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ol><h3 id="5-使用ServletAPI对象作为方法参数"><a href="#5-使用ServletAPI对象作为方法参数" class="headerlink" title="5. 使用ServletAPI对象作为方法参数"></a>5. 使用ServletAPI对象作为方法参数</h3><blockquote><ul><li><p>SpringMVC 支持使用原始 ServletAPI 对象作为控制器方法的参数。</p></li><li><p>支持的对象有：HttpServletRequest、HttpServletResponse 、HttpSession、 java.security.Principal 、Locale、InputStream 、OutputStream、 Reader、 Writer </p></li><li><p>使用是直接将对象定义在控制器方法参数中</p></li></ul></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;params/getServletAPI&quot;</span> &gt;</span>获取Servlet原生API<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller(&quot;paramsController&quot;)</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/params&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ParamsController</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取Servlet原生API</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> request</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> response</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/getServletAPI&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getServletAPI</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span></span>&#123;</span><br><span class="line">        System.out.println(request);</span><br><span class="line">        System.out.println(request.getSession());</span><br><span class="line">        System.out.println(response);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="2-常用注解"><a href="#2-常用注解" class="headerlink" title="2. 常用注解"></a>2. 常用注解</h2><h3 id="1-RequestParam"><a href="#1-RequestParam" class="headerlink" title="1. RequestParam"></a>1. RequestParam</h3><ol><li><p>作用：参数绑定时，把不符合规范的参数绑定到控制器方法指定的参数</p></li><li><p>属性：</p><blockquote><p>value：请求参数的名称</p><p>required：请求参数中是否必须提供此参数。默认值：true。（表示必须提供，如果不提供将报错。 ）</p></blockquote></li><li><p>使用</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;annos/testRequestParam?name=tobing&quot;</span>&gt;</span>testRequestParam<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller(&quot;annoController&quot;)</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/annos&quot;)</span></span><br><span class="line"><span class="meta">@SessionAttributes(value = &#123;&quot;username&quot;,&quot;password&quot;&#125;,types = &#123;Integer.class&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AnnoController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/testRequestParam&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">testRequestParam</span><span class="params">(<span class="meta">@RequestParam(&quot;name&quot;)</span> String usernmae)</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;testRequestParam执行了&quot;</span>);</span><br><span class="line">        System.out.println(usernmae);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><blockquote><p>将请求参数name绑定到控制器方法username参数上</p></blockquote></li></ol><h3 id="2-RequestBody"><a href="#2-RequestBody" class="headerlink" title="2. RequestBody"></a>2. RequestBody</h3><ol><li><p>作用：用于获取请求体内容（ key=value&amp;key=value…结构的数据），get 请求方式不适用。 </p></li><li><p>属性：</p><blockquote><p>required：是否必须有请求体。默认值是:true。当取值为 true 时,get 请求方式会报错。如果取值 为 false，get 请求得到是 null。 </p></blockquote></li><li><p>使用：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;annos/testRequestBody&quot;</span>&gt;</span>testRequestBody<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/testRequestBody&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">testRequestBody</span><span class="params">(<span class="meta">@RequestBody</span> String body)</span></span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;testRequestBody执行了&quot;</span>);</span><br><span class="line">    System.out.println(body);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line">   </span><br></pre></td></tr></table></figure></li></ol><h3 id="3-PathVaribale"><a href="#3-PathVaribale" class="headerlink" title="3. PathVaribale"></a>3. PathVaribale</h3><ol><li><p>作用：绑定 url 中的占位符。例如：请求 url 中 /delete/{id}，这个{id}就是 url 占位符。  url 支持占位符是 spring3.0 之后加入的。是 springmvc 支持 rest 风格 URL 的一个重要标志。 </p></li><li><p>属性：</p><blockquote><p>value：用于指定url中占位符名称</p><p>required：是否必须提供占位符</p></blockquote></li><li><p>使用：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;annos/testPathVariable/1024&quot;</span>&gt;</span>testPathVariable<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/testPathVariable/&#123;uid&#125;&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">testPathVariable</span><span class="params">(<span class="meta">@PathVariable(&quot;uid&quot;)</span> String id)</span></span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;testPathVariable执行了&quot;</span>);</span><br><span class="line">    System.out.println(id);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line">   </span><br></pre></td></tr></table></figure></li></ol><h3 id="4-RequestHeader（少用）"><a href="#4-RequestHeader（少用）" class="headerlink" title="4. RequestHeader（少用）"></a>4. RequestHeader（少用）</h3><ol><li><p>作用：获取请求头</p></li><li><p>属性：</p><blockquote><p>value：要获取的消息头名称</p><p>required：是否必须有次消息头</p></blockquote></li><li><p>使用：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;annos/testRequestHeader&quot;</span>&gt;</span>testRequestHeader<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/testRequestHeader&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">testRequestHeader</span><span class="params">(<span class="meta">@RequestHeader(value = &quot;Accept&quot;)</span> String header)</span></span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;testRequestHeader执行了&quot;</span>);</span><br><span class="line">    System.out.println(header);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line">   </span><br></pre></td></tr></table></figure><blockquote><p>获取请求头中的Accept消息</p></blockquote></li></ol><h3 id="5-CookieValue"><a href="#5-CookieValue" class="headerlink" title="5. CookieValue"></a>5. CookieValue</h3><ol><li><p>作用：把指定cookie传到控制器方法参数中</p></li><li><p>属性：</p><blockquote><p>value：指定 cookie 的名称。 </p><p>required：是否必须有此 cookie。</p></blockquote></li><li><p>使用：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;annos/testCookieValue&quot;</span>&gt;</span>testCookieValue<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/testCookieValue&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">testCookieValue</span><span class="params">(<span class="meta">@CookieValue(value = &quot;JSESSIONID&quot;)</span> String cookie)</span></span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;testCookieValue执行了&quot;</span>);</span><br><span class="line">    System.out.println(cookie);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line">   </span><br><span class="line">   </span><br></pre></td></tr></table></figure></li></ol><h3 id="6-ModeAttribute"><a href="#6-ModeAttribute" class="headerlink" title="6. ModeAttribute"></a>6. ModeAttribute</h3><ol><li><p>作用：</p><blockquote><p>可以用于修饰方法和参数。 </p><p>出现在方法上，表示当前方法会在控制器的方法执行之前，先执行。它可以修饰没有返回值的方法，也可 以修饰有具体返回值的方法。  </p><p>出现在参数上，获取指定的数据给参数赋值。 </p></blockquote></li><li><p>属性：</p><blockquote><p>value：用于获取数据的 key。key 可以是 POJO 的属性名称，也可以是 map 结构的 key</p></blockquote></li><li><p>使用场景</p><blockquote><p>当表单提交数据不是完整的实体类数据时，保证没有提交数据的字段使用数据库对象原来的数据。  </p><p>例如：我们在编辑一个用户时，用户有一个创建信息字段，该字段的值是不允许被修改的。在提交表单数 据是肯定没有此字段的内容，一旦更新会把该字段内容置为 null，此时就可以使用此注解解决问题。 </p></blockquote></li><li><p>使用：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;annos/testModelAttribute?username=tobing&quot;</span>&gt;</span>testModelAttribute<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><blockquote><p>修饰在方法上</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/testModelAttribute&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">testModelAttribute</span><span class="params">(User user)</span></span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;testModelAttribut执行了&quot;</span>+user.getUsername());</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@ModelAttribute</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">showModelAttribute</span><span class="params">(User user)</span></span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;showModelAttribut执行了&quot;</span>+user.getUsername());</span><br><span class="line">   </span><br><span class="line">&#125;</span><br><span class="line">   </span><br></pre></td></tr></table></figure><blockquote><blockquote><p>showModelAttribut会先执行</p></blockquote></blockquote><blockquote><p>修饰在参数上：给指定参数赋值（方式一）</p></blockquote><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span> <span class="attr">action</span>=<span class="string">&quot;annos/testModelAttribute&quot;</span>&gt;</span></span><br><span class="line">    用户名：<span class="tag">&lt;<span class="name">input</span>  <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span>/&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    密码：<span class="tag">&lt;<span class="name">input</span>  <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span>/&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;提交&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ModelAttribute</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> User <span class="title">showModel</span><span class="params">(String username,String password)</span></span>&#123;</span><br><span class="line">    User user = <span class="keyword">new</span> User();</span><br><span class="line">    user.setUsername(username);</span><br><span class="line">    user.setPassword(password);</span><br><span class="line">    user.setBirthday(<span class="keyword">new</span> Date());</span><br><span class="line">    System.out.println(<span class="string">&quot;showModel执行了&quot;</span>+user);</span><br><span class="line">    <span class="keyword">return</span> user;</span><br><span class="line">&#125;</span><br><span class="line">   </span><br><span class="line"><span class="meta">@RequestMapping(&quot;/testModelAttribute&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">testModelAttribute</span><span class="params">(User user)</span></span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;testModelAttribut执行了&quot;</span>+user);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line">   </span><br><span class="line">   </span><br></pre></td></tr></table></figure><blockquote><p>修饰在参数上：给指定参数赋值（方式二）</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ModelAttribute</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">showModel</span><span class="params">(String username, Map&lt;String,User&gt; map)</span></span>&#123;</span><br><span class="line">    User user = <span class="keyword">new</span> User();</span><br><span class="line">    user.setUsername(username);</span><br><span class="line">    user.setPassword(<span class="string">&quot;root&quot;</span>);</span><br><span class="line">    user.setBirthday(<span class="keyword">new</span> Date());</span><br><span class="line">    map.put(<span class="string">&quot;u&quot;</span>,user);</span><br><span class="line">&#125;</span><br><span class="line">   </span><br><span class="line"><span class="meta">@RequestMapping(&quot;/testModelAttribute&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">testModelAttribute</span><span class="params">(<span class="meta">@ModelAttribute(&quot;u&quot;)</span> User user)</span></span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;testModelAttribut执行了&quot;</span>+user);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line">   </span><br></pre></td></tr></table></figure></li></ol><h3 id="7-SessionAttribute"><a href="#7-SessionAttribute" class="headerlink" title="7. SessionAttribute"></a>7. SessionAttribute</h3><ol><li><p>作用：用于多次执行控制器方法间的参数共享。 </p></li><li><p>属性：</p><blockquote><p>value：用于指定存入的属性名称 </p><p>type：用于指定存入的数据类型。 </p></blockquote></li><li><p>使用：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;annos/testPut&quot;</span>&gt;</span>存入SessionAttribute<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;annos/testGet&quot;</span>&gt;</span>取出SessionAttribute<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;annos/complete&quot;</span>&gt;</span>删除SessionAttribute<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 存入session</span></span><br><span class="line">   <span class="meta">@RequestMapping(&quot;/testPut&quot;)</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> String <span class="title">testPut</span><span class="params">(Model model)</span></span>&#123;</span><br><span class="line">       model.addAttribute(<span class="string">&quot;username&quot;</span>,<span class="string">&quot;tobing&quot;</span>);</span><br><span class="line">       model.addAttribute(<span class="string">&quot;password&quot;</span>,<span class="string">&quot;root&quot;</span>);</span><br><span class="line">       model.addAttribute(<span class="string">&quot;age&quot;</span>,<span class="number">21</span>);</span><br><span class="line">       <span class="keyword">return</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="comment">// 取出session</span></span><br><span class="line">   <span class="meta">@RequestMapping(&quot;/testGet&quot;)</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> String <span class="title">testGet</span><span class="params">(ModelMap model)</span></span>&#123;</span><br><span class="line">       System.out.println(<span class="string">&quot;&quot;</span>+model.get(<span class="string">&quot;username&quot;</span>)+model.get(<span class="string">&quot;password&quot;</span>)+model.get(<span class="string">&quot;age&quot;</span>));</span><br><span class="line">       <span class="keyword">return</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">   &#125;</span><br><span class="line">   </span><br><span class="line">   <span class="comment">// 删除session</span></span><br><span class="line">   <span class="meta">@RequestMapping(&quot;/complete&quot;)</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> String <span class="title">complete</span><span class="params">(SessionStatus status)</span></span>&#123;</span><br><span class="line">       status.setComplete();</span><br><span class="line">       <span class="keyword">return</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">   &#125;</span><br><span class="line">   </span><br></pre></td></tr></table></figure></li></ol>]]></content>
      
      
      
        <tags>
            
            <tag> SpringMVC </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SpringMVC-1-入门</title>
      <link href="2020/01/07/SpringMVC-1-%E5%85%A5%E9%97%A8/"/>
      <url>2020/01/07/SpringMVC-1-%E5%85%A5%E9%97%A8/</url>
      
        <content type="html"><![CDATA[<p>MVC框架，学习笔记第一弹。</p><a id="more"></a><h1 id="SpringMVC-1-入门"><a href="#SpringMVC-1-入门" class="headerlink" title="SpringMVC-1-入门"></a>SpringMVC-1-入门</h1><h2 id="1-三层架构和MVC"><a href="#1-三层架构和MVC" class="headerlink" title="1. 三层架构和MVC"></a>1. 三层架构和MVC</h2><h3 id="1-三层架构（了解）"><a href="#1-三层架构（了解）" class="headerlink" title="1. 三层架构（了解）"></a>1. 三层架构（了解）</h3><blockquote><ul><li>开发架构一般有两种形式：C/S架构和B/S架构。JavaEE开发中几乎都是C/S架构，在C/S架构中标准的三层架构包括：表现层、业务层、持久层。</li></ul></blockquote><ol><li><p>表现层</p><blockquote><ul><li>即是web层。负责<strong>接收请求</strong>、<strong>响应结果</strong>：通常客户端使用http协议请求web层，web需要接收http请求，完成http响应。</li><li>表现层包含<strong>展示层</strong>和<strong>控制层</strong>：控制层负责接收请求，展示层负责结果展示</li><li>表现层通常依赖业务层。接收到的客户端请求一般会调用业务层处理，并将处理结果响应到客户端。</li><li>表现层一般使用MVC模型</li></ul></blockquote></li><li><p>业务层</p><blockquote><ul><li>即是service层。负责<strong>业务逻辑处理</strong>，web层依赖业务层，但业务层不依赖web层。</li><li>业务层可能会依赖持久层，如果要对数据持久化需要保证事务一致性。</li><li>事务应该放在业务层来控制。</li></ul></blockquote></li><li><p>持久层</p><blockquote><ul><li>即是dao层。负责<strong>数据持久化</strong>，持久层是和数据库交互，对数据库表进行CRUD。</li></ul></blockquote></li></ol><h3 id="2-MVC模型"><a href="#2-MVC模型" class="headerlink" title="2. MVC模型"></a>2. MVC模型</h3><blockquote><p>MVC，Model View Controller，是一种用于设计创建web应用程序表现层的模式。</p></blockquote><ol><li><p>Model（模型）：</p><blockquote><p>通常指数据模型。一般用于封装数据。</p></blockquote></li><li><p>View（视图）：</p><blockquote><p>通常指jsp或HTML。一般是展示数据。通常依据模型数据创建。</p></blockquote></li><li><p>Controller（控制器）：</p><blockquote><p>处理用户交互部分。一般处理程序逻辑。</p></blockquote></li></ol><h2 id="2-SpringMVC概述"><a href="#2-SpringMVC概述" class="headerlink" title="2. SpringMVC概述"></a>2. SpringMVC概述</h2><h3 id="1-SpringMVC是什么"><a href="#1-SpringMVC是什么" class="headerlink" title="1. SpringMVC是什么"></a>1. SpringMVC是什么</h3><blockquote><ul><li>基于 Java 的实现 MVC 设计模型的请求驱动类型的轻量级 Web 框架，属于 Spring       FrameWork 的后续产品。</li><li>SpringMVC 已经成为目前最主流的 MVC 框架之一，并且随着 Spring3.0 的发布，全面超越 Struts2，成 为最优秀的 MVC 框架。 </li><li>它通过一套注解，让一个简单的 Java 类成为处理请求的控制器，而无须实现任何接口。同时它还支持 RESTful 编程风格的请求。</li></ul></blockquote><h3 id="2-SpringMVC在三层架构的位置"><a href="#2-SpringMVC在三层架构的位置" class="headerlink" title="2. SpringMVC在三层架构的位置"></a>2. SpringMVC在三层架构的位置</h3><p><img src="https://i.loli.net/2021/01/15/RDSVA3dHnwQJ5Yp.png" class="lazyload" data-srcset="https://i.loli.net/2021/01/15/RDSVA3dHnwQJ5Yp.png" srcset="data:image/png;base64,666" alt="三层架构"></p><h2 id="3-SpringMVC入门案例"><a href="#3-SpringMVC入门案例" class="headerlink" title="3. SpringMVC入门案例"></a>3. SpringMVC入门案例</h2><blockquote><p>案例需求：初始的jsp页面（index.jsp）上有一个超链接。点击超链接可以跳转的另外的页面(success.jsp)。</p></blockquote><h3 id="1-环境搭建"><a href="#1-环境搭建" class="headerlink" title="1. 环境搭建"></a>1. 环境搭建</h3><ol><li><p>创建Maven工程，选择webapp</p><blockquote><p>添加以下坐标</p></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-context<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-webmvc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.servlet<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>servlet-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.servlet.jsp<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jsp-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>配置web.xml配置文件</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span> <span class="attr">version</span>=<span class="string">&quot;2.4&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns</span>=<span class="string">&quot;http://java.sun.com/xml/ns/j2ee&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://java.sun.com/xml/ns/j2ee http://java.sun.com/xml/ns/j2ee/web-app_2_4.xsd&quot;</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--springmvc核心控制器--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>dispatcherServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--配置Servlet的初始化参数，读取springmvc的配置文件，创建spring容器--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath:springmvc.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 配置Servlet在启动时加载对象--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">load-on-startup</span>&gt;</span>1<span class="tag">&lt;/<span class="name">load-on-startup</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>dispatcherServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>配置springmvc.xml</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:mvc</span>=<span class="string">&quot;http://www.springframework.org/schema/mvc&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;</span></span></span><br><span class="line"><span class="tag"><span class="string">       http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">       http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">       http://www.springframework.org/schema/mvc</span></span></span><br><span class="line"><span class="tag"><span class="string">       http://www.springframework.org/schema/mvc/spring-mvc.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">       http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="tag"><span class="string">       http://www.springframework.org/schema/context/spring-context.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--配置spring创建容器时要扫描的包--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;top.tobing&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--配置视图挤下去类--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;viewResolver&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.web.servlet.view.InternalResourceViewResolver&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;suffix&quot;</span> <span class="attr">value</span>=<span class="string">&quot;.jsp&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;prefix&quot;</span> <span class="attr">value</span>=<span class="string">&quot;/WEB-INF/pages/&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--配置spring开启mvc注解--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:annotation-driven</span>&gt;</span><span class="tag">&lt;/<span class="name">mvc:annotation-driven</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ol><h3 id="2-代码编写"><a href="#2-代码编写" class="headerlink" title="2. 代码编写"></a>2. 代码编写</h3><ol><li><p>编写Controller</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller(&quot;helloController&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/hello&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">transPage</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;页面转跳中.....&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>index页面</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page contentType=&quot;text/html;charset=UTF-8&quot; language=&quot;java&quot; %&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>第一个SpringMVC案例<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h3</span> <span class="attr">align</span>=<span class="string">&quot;center&quot;</span>&gt;</span>SpringMVC入门案例：页面跳转<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">center</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;hello&quot;</span>&gt;</span>点我跳转<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">center</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>跳转的成功页面success</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page contentType=&quot;text/html;charset=UTF-8&quot; language=&quot;java&quot; %&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>页面跳转<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h3</span> <span class="attr">align</span>=<span class="string">&quot;center&quot;</span>&gt;</span>跳转成功<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ol><h3 id="3-启动项目"><a href="#3-启动项目" class="headerlink" title="3. 启动项目"></a>3. 启动项目</h3><h3 id="4-入门案例流程"><a href="#4-入门案例流程" class="headerlink" title="4. 入门案例流程"></a>4. 入门案例流程</h3><p><img src="https://gitee.com/tobing/imagebed/raw/master/03.bmp" class="lazyload" data-srcset="https://gitee.com/tobing/imagebed/raw/master/03.bmp" srcset="data:image/png;base64,666" alt="03"></p><h2 id="4-RequestMapping注解"><a href="#4-RequestMapping注解" class="headerlink" title="4. RequestMapping注解"></a>4. RequestMapping注解</h2><blockquote><p>用于建立<strong>请求URL</strong>和<strong>处理请求方法</strong>的对应关系</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Target(&#123;ElementType.METHOD, ElementType.TYPE&#125;)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="meta">@Mapping</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> RequestMapping &#123;</span><br><span class="line"><span class="comment">// .... </span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol><li><p>注解出现的位置</p><blockquote><p>类：出现在类上，表示请求URL的第一级目录。不写相当于根目录。</p><blockquote><p>/user/….</p><p>/user/….</p></blockquote><p>方法：表请求URL的第二级目录。</p><blockquote><p>/user/save</p><p>/user/update</p></blockquote></blockquote></li><li><p>属性</p><blockquote><p>value=path：指定请求URL</p><p>method：指定请求方法</p><p>params：指定限制请求参数条件。</p><p>headers：指定限制请求头消息的条件</p></blockquote></li><li><p>URL与处理方法的一一对应关系</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h3</span> <span class="attr">align</span>=<span class="string">&quot;center&quot;</span>&gt;</span>SpringMVC入门案例：页面跳转<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">center</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;hello&quot;</span>&gt;</span>点我跳转<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">center</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller(&quot;helloController&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/hello&quot;)</span><span class="comment">// &lt;a href=&quot;a&quot;&gt; ----&gt; /hello</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">transPage</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;页面转跳中.....&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol>]]></content>
      
      
      
        <tags>
            
            <tag> SpringMVC </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>spring-3-基于注解ioc</title>
      <link href="2019/12/23/spring-3-%E5%9F%BA%E4%BA%8E%E6%B3%A8%E8%A7%A3ioc/"/>
      <url>2019/12/23/spring-3-%E5%9F%BA%E4%BA%8E%E6%B3%A8%E8%A7%A3ioc/</url>
      
        <content type="html"><![CDATA[<p>Spring学习第三弹。</p><a id="more"></a><h1 id="spring-3-基于注解Ioc配置"><a href="#spring-3-基于注解Ioc配置" class="headerlink" title="spring-3-基于注解Ioc配置"></a>spring-3-基于注解Ioc配置</h1><h2 id="1-基于注解的Ioc配置"><a href="#1-基于注解的Ioc配置" class="headerlink" title="1. 基于注解的Ioc配置"></a>1. 基于注解的Ioc配置</h2><blockquote><ul><li><p>基于注解和xml的配置实现的功能都是一样的，都是要降低程序间耦合。</p></li><li><p>xml和注解的配置方式都很常用</p></li></ul></blockquote><h3 id="1-环境搭建"><a href="#1-环境搭建" class="headerlink" title="1. 环境搭建"></a>1. 环境搭建</h3><blockquote><p>在pom.xml中添加spring的依赖</p></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-context<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.0.2.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>Maven添加依赖时默认把spring的aop导入。</p></blockquote><h3 id="2-创建service、dao、view类"><a href="#2-创建service、dao、view类" class="headerlink" title="2. 创建service、dao、view类"></a>2. 创建service、dao、view类</h3><blockquote><p>修改bean.xml要扫描的包</p></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:conetext</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/context/spring-context.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--告诉spring容器使用要扫描的包--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;top.tobing&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="3-使用注解"><a href="#3-使用注解" class="headerlink" title="3. 使用注解"></a>3. 使用注解</h3><blockquote><ol><li><p>创建对象</p><ul><li>@Component(value=””)：相当于一个xml配置中的一个bean</li><li>@Controller(value=””)：用于表现层</li><li>@Service(value=””)：用于业务层</li><li>@Repository(value=””)：用于持久层</li></ul><blockquote><p>后面三个注解是第一个注解的衍生，他们4个的作用及属性一模一样。只是提供了更为明确的语义</p></blockquote></li><li><p>注入数据</p><ul><li>@Autowired：自动注入，不依赖setter，只能注入其他bean类型。当有多个类型匹配时，使用要注入的对象变量名称作为bean的id，在ioc容器中中寻找，没找到就报错</li><li>@Qualifier（value=“”）：结合第一个注解使用，可以用于指定bean的id</li><li>@Resource（name=””）：直接按照bean的id注入，只能注入其他bean类型</li><li>@Value（value=””）：注入基本数据类型和String类型</li></ul></li><li><p>改变范围</p><ul><li>@Scope（value=“”）：指定bean作用范围：单例(singleton)、多例(prototype)等。</li></ul></li><li><p>生命周期（了解即可）</p><ul><li>@PostConstruct（）：指定初始化方法</li><li>@PreDestroy（）：指定摧毁方法</li></ul></li></ol></blockquote><ol><li><p>创建对象相关注解</p><blockquote><p>@Component（value=“”）用于创建对象，value指定id，value为空时使用类名首字母小写来作为默认id。Controller、Service、Repository三个注解可以混用。</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//@Component</span></span><br><span class="line"><span class="meta">@Service(&quot;userService01&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title">UserService</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> UserDao userDao ;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;ServiceImpl01&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">save</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        userDao.save();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//////////////////////////////////////////////////////////////</span></span><br><span class="line"><span class="comment">//@Component</span></span><br><span class="line"><span class="meta">@Service(&quot;userService02&quot;)</span><span class="comment">// 不使用默认，使用自定义id</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserServiceImpl1</span> <span class="keyword">implements</span> <span class="title">UserService</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> UserDao userDao ;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;ServiceImpl02&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">save</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        userDao.save();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Client</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 1.加载bean配置文件</span></span><br><span class="line">        ApplicationContext ac = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">&quot;bean.xml&quot;</span>);</span><br><span class="line">        <span class="comment">// 2.获取bean对象</span></span><br><span class="line">        Object obj = ac.getBean(<span class="string">&quot;userService02&quot;</span>);<span class="comment">//改变id可以获取不同对象</span></span><br><span class="line">        System.out.println(obj);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>ServiceImpl02</p></blockquote></li><li><p>注入数据相关注解</p><blockquote><p>Dao层</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Repository(&quot;userDao01&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserDaoImpl</span> <span class="keyword">implements</span> <span class="title">UserDao</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">save</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Dao save!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//////////////////////////////////////////////////</span></span><br><span class="line"><span class="meta">@Repository(&quot;userDao02&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserDaoImpl1</span> <span class="keyword">implements</span> <span class="title">UserDao</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">save</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Dao save!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>Service层</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service(&quot;userService01&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title">UserService</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired()</span></span><br><span class="line">    <span class="comment">//@Qualifier(&quot;userDao02&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> UserDao userDao01 ;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">save</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        userDao01.save();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><ul><li><p>Ioc中存在多个的时候，会自动寻找与属性名相同的id的对象。</p></li><li><p>实际实际汇总常用@Qualifier指定固定id对象。</p></li></ul></blockquote></li></ol><h2 id="2-基于xml的ioc案例"><a href="#2-基于xml的ioc案例" class="headerlink" title="2. 基于xml的ioc案例"></a>2. 基于xml的ioc案例</h2><blockquote><p>要求：使用spring的ioc对account表进行crud</p></blockquote><h3 id="1-创建数据库"><a href="#1-创建数据库" class="headerlink" title="1. 创建数据库"></a>1. 创建数据库</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">DATABASE</span> eesy;<span class="comment">-- 创建数据库</span></span><br><span class="line"><span class="keyword">USE</span> eesy;<span class="comment">-- 使用数据库</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="keyword">account</span>(<span class="comment">-- 创建account表</span></span><br><span class="line"><span class="keyword">id</span> <span class="built_in">INT</span> PRIMARY <span class="keyword">KEY</span> AUTO_INCREMENT,</span><br><span class="line"><span class="keyword">NAME</span> <span class="built_in">VARCHAR</span>(<span class="number">40</span>),</span><br><span class="line">money <span class="built_in">FLOAT</span></span><br><span class="line">);</span><br><span class="line"><span class="comment">-- 在account表中插入3条数据</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="keyword">account</span>(<span class="keyword">NAME</span>,money) <span class="keyword">VALUE</span>(<span class="string">&quot;aaa&quot;</span>,<span class="number">1000</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="keyword">account</span>(<span class="keyword">NAME</span>,money) <span class="keyword">VALUE</span>(<span class="string">&quot;bbb&quot;</span>,<span class="number">3000</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="keyword">account</span>(<span class="keyword">NAME</span>,money) <span class="keyword">VALUE</span>(<span class="string">&quot;ccc&quot;</span>,<span class="number">2000</span>);</span><br></pre></td></tr></table></figure><h3 id="2-创建Maven工程，导入依赖"><a href="#2-创建Maven工程，导入依赖" class="headerlink" title="2. 创建Maven工程，导入依赖"></a>2. 创建Maven工程，导入依赖</h3><blockquote><ol><li>创建maven工程</li><li>在pom.xml中导入要用到的依赖<ul><li>数据库连接池c3p0</li><li>dbutils</li><li>mysql</li><li>junit</li><li>spring-context</li></ul></li></ol></blockquote><blockquote><p>pom.xml</p></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--spring-context--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-context<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.0.2.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--数据库连接池c3p0--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>c3p0<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>c3p0<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.9.1.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--dbutils--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-dbutils<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-dbutils<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.4<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--mysql--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.0.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--junit--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.12<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="3-创建各层接口，实体类"><a href="#3-创建各层接口，实体类" class="headerlink" title="3. 创建各层接口，实体类"></a>3. 创建各层接口，实体类</h3><ol><li><p>实体类domain.Account–&gt;account表    </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Account</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Float money;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li><p>持久层dao–&gt;操作account</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">AccountDao</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">save</span><span class="params">(Account account)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">update</span><span class="params">(Account account)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">delete</span><span class="params">(Integer id)</span></span>;</span><br><span class="line">    <span class="function">List&lt;Account&gt; <span class="title">findAll</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function">Account <span class="title">findById</span><span class="params">(Integer id)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><blockquote><p>dao.impl</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AccountDaoImpl</span> <span class="keyword">implements</span> <span class="title">AccountDao</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> QueryRunner runner; <span class="comment">// 使用dbutils的QueryRunner查询</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setRunner</span><span class="params">(QueryRunner runner)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.runner = runner;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">save</span><span class="params">(Account account)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            runner.update(<span class="string">&quot;insert into account(name,money) values(?,?)&quot;</span>,account.getName(),account.getMoney());</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">(Account account)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            runner.update(<span class="string">&quot;update account set name=? ,money=? where id = ?&quot;</span>,account.getName(),account.getMoney(),account.getId());</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">delete</span><span class="params">(Integer id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            runner.update(<span class="string">&quot;delete from account where id = ?&quot;</span>,id);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Account&gt; <span class="title">findAll</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> runner.query(<span class="string">&quot;select * from account&quot;</span>,<span class="keyword">new</span> BeanListHandler&lt;Account&gt;(Account.class));</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Account <span class="title">findById</span><span class="params">(Integer id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> runner.query(<span class="string">&quot;select * from account where id = ?&quot;</span>, <span class="keyword">new</span> BeanHandler&lt;Account&gt;(Account.class),id);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li><p>业务层service–&gt;调用持久层</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">AccountService</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">save</span><span class="params">(Account account)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">update</span><span class="params">(Account account)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">delete</span><span class="params">(Integer id)</span></span>;</span><br><span class="line">    <span class="function">List&lt;Account&gt; <span class="title">findAll</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function">Account <span class="title">findById</span><span class="params">(Integer id)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li></ol><h3 id="4-基于xml的bean注入"><a href="#4-基于xml的bean注入" class="headerlink" title="4. 基于xml的bean注入"></a>4. 基于xml的bean注入</h3><blockquote><ol><li><p>创建bean.xml</p></li><li><p>通过xml分别给各层的对象进行注入</p></li></ol></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--为持久层对象注入--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;accountService&quot;</span> <span class="attr">class</span>=<span class="string">&quot;top.tobing.service.impl.AccountServiceImpl&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;accountDao&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;accountDao&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--为到注入--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;accountDao&quot;</span> <span class="attr">class</span>=<span class="string">&quot;top.tobing.dao.impl.AccountDaoImpl&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;runner&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;runner&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--为QueryRunner注入--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;runner&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.apache.commons.dbutils.QueryRunner&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">&quot;ds&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dataSource&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--为DataSource注入--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.mchange.v2.c3p0.ComboPooledDataSource&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--数据库连接信息--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driverClass&quot;</span> <span class="attr">value</span>=<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;jdbcUrl&quot;</span> <span class="attr">value</span>=<span class="string">&quot;jdbc:mysql://localhost:3306/eesy&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;user&quot;</span> <span class="attr">value</span>=<span class="string">&quot;root&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;root&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="5-测试各层方法"><a href="#5-测试各层方法" class="headerlink" title="5. 测试各层方法"></a>5. 测试各层方法</h3><blockquote><ul><li>使用ApplicationContext获取注入的对象</li></ul></blockquote><blockquote><p>test.AccountServiceTest</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AccountServiceTest</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        ApplicationContext context = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">&quot;bean.xml&quot;</span>);</span><br><span class="line">        AccountService accountService = context.getBean(<span class="string">&quot;accountService&quot;</span>,AccountService.class);</span><br><span class="line">        <span class="comment">// 1. 查询所有</span></span><br><span class="line"><span class="comment">//        List&lt;Account&gt; accounts = accountService.findAll();</span></span><br><span class="line"><span class="comment">//        for (Account account : accounts) &#123;</span></span><br><span class="line"><span class="comment">//            System.out.println(account);</span></span><br><span class="line"><span class="comment">//        &#125;</span></span><br><span class="line">        <span class="comment">// 2. 根据id查询</span></span><br><span class="line"><span class="comment">//        Account account = accountService.findById(1);</span></span><br><span class="line"><span class="comment">//        System.out.println(account);</span></span><br><span class="line">        <span class="comment">// 3. 保存用户</span></span><br><span class="line"><span class="comment">//        Account acc = new Account();</span></span><br><span class="line"><span class="comment">//        acc.setMoney(12345F);</span></span><br><span class="line"><span class="comment">//        acc.setName(&quot;Tobing&quot;);</span></span><br><span class="line"><span class="comment">//        accountService.save(acc);</span></span><br><span class="line">        <span class="comment">// 4. 更新用户</span></span><br><span class="line"><span class="comment">//        Account acc = new Account();</span></span><br><span class="line"><span class="comment">//        acc.setMoney(22345F);</span></span><br><span class="line"><span class="comment">//        acc.setName(&quot;Tobing&quot;);</span></span><br><span class="line"><span class="comment">//        acc.setId(4);</span></span><br><span class="line"><span class="comment">//        accountService.update(acc);</span></span><br><span class="line">        <span class="comment">// 5. 删除用户</span></span><br><span class="line">        accountService.delete(<span class="number">4</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="6-原理图"><a href="#6-原理图" class="headerlink" title="6. 原理图"></a>6. 原理图</h3><p><img src="https://gitee.com/tobing/imagebed/raw/master/spring-xml-ioc.png" class="lazyload" data-srcset="https://gitee.com/tobing/imagebed/raw/master/spring-xml-ioc.png" srcset="data:image/png;base64,666" alt="spring-xml-ioc"></p><h2 id="3-对以上案例进行基于注解的改造"><a href="#3-对以上案例进行基于注解的改造" class="headerlink" title="3. 对以上案例进行基于注解的改造"></a>3. 对以上案例进行基于注解的改造</h2><h3 id="1-创建新工程"><a href="#1-创建新工程" class="headerlink" title="1. 创建新工程"></a>1. 创建新工程</h3><blockquote><ol><li>复制以上工程的所有代码：test，main，pom.xml</li></ol></blockquote><h3 id="2-更改bean-xml"><a href="#2-更改bean-xml" class="headerlink" title="2. 更改bean.xml"></a>2. 更改bean.xml</h3><blockquote><p>将bean.xml中的约束改为注解的约束。</p><p>同时添加“spring创建容器时扫描的包”。</p></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/context/spring-context.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--告知spring在创建容器的时候要扫描的路径--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;top.tobing&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--为QueryRunner注入--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;runner&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.apache.commons.dbutils.QueryRunner&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">&quot;ds&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dataSource&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--为DataSource注入--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.mchange.v2.c3p0.ComboPooledDataSource&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--数据库连接信息--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driverClass&quot;</span> <span class="attr">value</span>=<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;jdbcUrl&quot;</span> <span class="attr">value</span>=<span class="string">&quot;jdbc:mysql://localhost:3306/eesy&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;user&quot;</span> <span class="attr">value</span>=<span class="string">&quot;root&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;root&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="3-添加注解"><a href="#3-添加注解" class="headerlink" title="3. 添加注解"></a>3. 添加注解</h3><blockquote><p>给持久层、业务层添加注解</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service(&quot;accountService&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AccountServiceImpl</span> <span class="keyword">implements</span> <span class="title">AccountService</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> AccountDao accountDao;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Repository(&quot;accountDao&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AccountDaoImpl</span> <span class="keyword">implements</span> <span class="title">AccountDao</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> QueryRunner runner;</span><br><span class="line">    ....</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="4-运行测试（略）"><a href="#4-运行测试（略）" class="headerlink" title="4. 运行测试（略）"></a>4. 运行测试（略）</h3><h2 id="4-ioc案例存注解改造"><a href="#4-ioc案例存注解改造" class="headerlink" title="4.  ioc案例存注解改造"></a>4.  ioc案例存注解改造</h2><h3 id="0-必须的新注解"><a href="#0-必须的新注解" class="headerlink" title="0. 必须的新注解"></a>0. 必须的新注解</h3><ol><li><p>Configuration：</p><blockquote><ul><li><p>用于指定当前类是一个spring配置类，当创建容器时会从该类加载注解。</p></li><li><p>获取容器时需要使用AnnotationApplicationContext(有Configuration注解的类.class)。</p></li></ul></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringConfiguration</span> </span>&#123;</span><br><span class="line">....</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JdbcConfiguration</span> </span>&#123;</span><br><span class="line">...</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li><p>ComponentScan：</p><blockquote><ul><li><p>用于指定spring在初始化容器时要扫描的包。</p></li><li><p>作用和在spring的bean.xml中的componet-scan一致：</p></li></ul></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;top.tobing&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ComponentScan(value = &quot;top.tobing&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringConfiguration</span> </span>&#123;</span><br><span class="line">.... </span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li><p>Bean：</p><blockquote><p>只能放在方法上，表明将该方法返回的对象放在spring的容器中。</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JdbcConfiguration</span> </span>&#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="meta">@Bean(&quot;runner&quot;)</span></span><br><span class="line">    <span class="meta">@Scope(&quot;prototype&quot;)</span>     <span class="comment">// 指定为非单例</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> QueryRunner <span class="title">getQueryRunner</span><span class="params">(DataSource dataSource)</span></span>&#123;</span><br><span class="line">       .... </span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Bean(&quot;dataSource&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> DataSource <span class="title">getDataSource</span><span class="params">()</span></span>&#123;</span><br><span class="line">    ....</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li><p>PropertySource：</p><blockquote><ul><li><p>用于加载.properties文件中的配置。</p></li><li><p>例如我们配置数据源时可以把数据库相关信息写到properties配置文件中，这时就可以使用该注解指定配置文件的位置。</p></li></ul></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PropertySource(&quot;classpath:jdbc.properties&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JdbcConfiguration</span> </span>&#123;</span><br><span class="line">...</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li></ol><ol start="5"><li><p>@Import：</p><blockquote><ul><li><p>用于导入其他配置类.</p></li><li><p>在引入其他配置类时，可以不用再写@Configuration注解。当然，写上也没有问题。</p></li></ul></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Import(&#123;JdbcConfiguration.class&#125;)</span></span><br><span class="line"><span class="meta">@ComponentScan(value = &quot;top.tobing&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringConfiguration</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li></ol><h3 id="1-复制以上工程"><a href="#1-复制以上工程" class="headerlink" title="1. 复制以上工程"></a>1. 复制以上工程</h3><h3 id="2-添加注解"><a href="#2-添加注解" class="headerlink" title="2. 添加注解"></a>2. 添加注解</h3><blockquote><p>config</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@Import(&#123;JdbcConfiguration.class&#125;)</span><span class="comment">// 导入类</span></span><br><span class="line"><span class="meta">@ComponentScan(value = &quot;top.tobing&quot;)</span><span class="comment">// 指定扫描的包</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringConfiguration</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@PropertySource(&quot;classpath:jdbc.properties&quot;)</span><span class="comment">// 指定配置文件</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JdbcConfiguration</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;jdbc.username&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;jdbc.password&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;jdbc.driver&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String driver;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;jdbc.url&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String url;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取runner</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> dataSource</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean(&quot;runner&quot;)</span><span class="comment">// 将方法返回的对象放在spring容器中</span></span><br><span class="line">    <span class="meta">@Scope(&quot;prototype&quot;)</span>     <span class="comment">// 指定为非单例</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> QueryRunner <span class="title">getQueryRunner</span><span class="params">(DataSource dataSource)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> QueryRunner(dataSource);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取数据源</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean(&quot;dataSource&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> DataSource <span class="title">getDataSource</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            ComboPooledDataSource ds = <span class="keyword">new</span> ComboPooledDataSource();</span><br><span class="line">            ds.setJdbcUrl(<span class="string">&quot;jdbc:mysql://localhost:3306/eesy&quot;</span>);</span><br><span class="line">            ds.setDriverClass(<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>);</span><br><span class="line">            ds.setUser(<span class="string">&quot;root&quot;</span>);</span><br><span class="line">            ds.setPassword(<span class="string">&quot;root&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> ds;</span><br><span class="line">        &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><blockquote><p>持久层</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Repository(&quot;accountDao&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AccountDaoImpl</span> <span class="keyword">implements</span> <span class="title">AccountDao</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span><span class="comment">// 自动注入</span></span><br><span class="line">    <span class="keyword">private</span> QueryRunner runner;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setRunner</span><span class="params">(QueryRunner runner)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.runner = runner;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">save</span><span class="params">(Account account)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            runner.update(<span class="string">&quot;insert into account(name,money) values(?,?)&quot;</span>,account.getName(),account.getMoney());</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">(Account account)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            runner.update(<span class="string">&quot;update account set name=? ,money=? where id = ?&quot;</span>,account.getName(),account.getMoney(),account.getId());</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">delete</span><span class="params">(Integer id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            runner.update(<span class="string">&quot;delete from account where id = ?&quot;</span>,id);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Account&gt; <span class="title">findAll</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> runner.query(<span class="string">&quot;select * from account&quot;</span>,<span class="keyword">new</span> BeanListHandler&lt;Account&gt;(Account.class));</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Account <span class="title">findById</span><span class="params">(Integer id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> runner.query(<span class="string">&quot;select * from account where id = ?&quot;</span>, <span class="keyword">new</span> BeanHandler&lt;Account&gt;(Account.class),id);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><blockquote><p>业务层</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service(&quot;accountService&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AccountServiceImpl</span> <span class="keyword">implements</span> <span class="title">AccountService</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> AccountDao accountDao;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAccountDao</span><span class="params">(AccountDao accountDao)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.accountDao = accountDao;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">save</span><span class="params">(Account account)</span> </span>&#123;</span><br><span class="line">        accountDao.save(account);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">(Account account)</span> </span>&#123;</span><br><span class="line">        accountDao.update(account);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">delete</span><span class="params">(Integer id)</span> </span>&#123;</span><br><span class="line">        accountDao.delete(id);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Account&gt; <span class="title">findAll</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> accountDao.findAll();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Account <span class="title">findById</span><span class="params">(Integer id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> accountDao.findById(id);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><blockquote><p>配置文件jdbc.properties</p></blockquote><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">jdbc.username</span>=<span class="string">root</span></span><br><span class="line"><span class="meta">jdbc.password</span>=<span class="string">root</span></span><br><span class="line"><span class="meta">jdbc.url</span>=<span class="string">jdbc:mysql://localhost:3306/eesy</span></span><br><span class="line"><span class="meta">jdbc.driver</span>=<span class="string">com.mysql.jdbc.Driver</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="3-测试"><a href="#3-测试" class="headerlink" title="3. 测试"></a>3. 测试</h3><blockquote><p>测试类</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AccountServiceTest</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        ApplicationContext context = <span class="keyword">new</span> AnnotationConfigApplicationContext(SpringConfiguration.class);  <span class="comment">// 此处使用注解的方式创建容器</span></span><br><span class="line">        AccountService accountService = context.getBean(<span class="string">&quot;accountService&quot;</span>,AccountService.class); </span><br><span class="line">        <span class="comment">// 1. 查询所有</span></span><br><span class="line">        List&lt;Account&gt; accounts = accountService.findAll();</span><br><span class="line">        <span class="keyword">for</span> (Account account : accounts) &#123;</span><br><span class="line">            System.out.println(account);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> Spring </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>spring-2-入门补充</title>
      <link href="2019/12/11/spring-2-%E5%85%A5%E9%97%A8%E8%A1%A5%E5%85%85/"/>
      <url>2019/12/11/spring-2-%E5%85%A5%E9%97%A8%E8%A1%A5%E5%85%85/</url>
      
        <content type="html"><![CDATA[<p>Spring学习第二弹。</p><a id="more"></a><h1 id="Spring-2-入门补充"><a href="#Spring-2-入门补充" class="headerlink" title="Spring-2-入门补充"></a>Spring-2-入门补充</h1><blockquote><p>基于XML的IOC的细节</p></blockquote><h2 id="1-Spring中工厂的类结构图"><a href="#1-Spring中工厂的类结构图" class="headerlink" title="1. Spring中工厂的类结构图"></a>1. Spring中工厂的类结构图</h2><p><img src="https://gitee.com/tobing/imagebed/raw/master/spring02-framework.png" class="lazyload" data-srcset="https://gitee.com/tobing/imagebed/raw/master/spring02-framework.png" srcset="data:image/png;base64,666" alt="spring02-framework"></p><h3 id="1-BeanFactory和ApplicationContext的区别"><a href="#1-BeanFactory和ApplicationContext的区别" class="headerlink" title="1. BeanFactory和ApplicationContext的区别"></a>1. BeanFactory和ApplicationContext的区别</h3><blockquote><ul><li><p>BeanFactory才是Spring容器中的顶层接口。</p></li><li><p>ApplicationContext是它的子接口</p></li><li><p>创建对象的时间点不一样（区别）</p><ul><li>ApplicationContext：一读取配置文件，默认就会创建对象。有点像立即加载（使用应用在单列设计模式）。</li><li>BeanFactory：什么时候使用，什么时候加载。有点像延迟加载（适合多例场景）。</li></ul></li></ul></blockquote><h3 id="2-ApplicationContext接口的3个实现类"><a href="#2-ApplicationContext接口的3个实现类" class="headerlink" title="2. ApplicationContext接口的3个实现类"></a>2. ApplicationContext接口的3个实现类</h3><blockquote><p>spring中ApplicationContext接口有三个实现类用于3种方式加载配置。</p></blockquote><ol><li><p>类根目录</p><blockquote><p>ClassPathXmlApplicationContext</p><p>资源文件存放在res下。</p></blockquote></li><li><p>磁盘任意目录</p><blockquote><p>FileSystemXMLApplicationContext</p><p>资源配置文件存放在磁盘的其他地方。</p></blockquote></li><li><p>注解</p><blockquote><p>AnnotationConfigApplicationContext</p></blockquote></li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 方式1</span></span><br><span class="line">ApplicationContext ac = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">&quot;bean.xml&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 方式2</span></span><br><span class="line">ApplicationContext ac = <span class="keyword">new</span> FileSystemXmlApplicationContext(<span class="string">&quot;E:\\IdeaProjects\\spring02_introduction\\src\\main\\resources\\bean.xml&quot;</span>);</span><br></pre></td></tr></table></figure><h2 id="2-IOC中bean标签和管理对象细节"><a href="#2-IOC中bean标签和管理对象细节" class="headerlink" title="2. IOC中bean标签和管理对象细节"></a>2. IOC中bean标签和管理对象细节</h2><h4 id="1-bean标签"><a href="#1-bean标签" class="headerlink" title="1. bean标签"></a>1. bean标签</h4><blockquote><p>作用：</p><ul><li>用于配置对象来让spring来创建</li><li>默认情况下调用无参构造，如果没有参数则不能创建成功。</li></ul><p>属性：</p><ul><li>id：给在容器中的对象指定唯一标识</li><li>class：指定类的全限定类名。用来反射创建对象。默认调用无参数构造方法</li><li>init-method：指定类中初始化方法名称</li><li>destroy-method：指定类中销毁方法名称</li><li>scope：指定对象作用的范围<ul><li>singleton：单例（默认）</li><li>prototype：多例</li><li>request：WEB项目中，Spring创建的Bean将其存入request域中</li><li>session：WEB项目中，Spring创建的Bean将其存入session域中</li><li>global session：WEB项目中，如果有多集群（多台服务器）的情况下，将其存入global session中</li></ul></li></ul></blockquote><h4 id="2-bean的作用范围和生命周期"><a href="#2-bean的作用范围和生命周期" class="headerlink" title="2. bean的作用范围和生命周期"></a>2. bean的作用范围和生命周期</h4><blockquote><ul><li><p>单例：scope=“singleton”</p></li><li><p>一个应用只有一个对象的实例。作用范围：整个引用</p></li><li><p>生命周期：</p><ul><li>出生：应用加载，创建容器时，对象被创建。</li><li>活着：容器存在，就一直活着。</li><li>销毁：应用卸载，容器销毁，对象被销毁。</li></ul></li><li><p>多例：scope=”prototype”</p></li><li><p>每次访问对象，都会重新创建对象实例</p></li><li><p>生命周期</p><ul><li>出生：当使用对象时，创建新的对象实例。</li><li>活着：对象被使用，一直活着。</li><li>死亡：长时间没有，java垃圾回收机制回收</li></ul></li></ul></blockquote><h4 id="3-实例化Bean的三种方式"><a href="#3-实例化Bean的三种方式" class="headerlink" title="3. 实例化Bean的三种方式"></a>3. 实例化Bean的三种方式</h4><blockquote><ul><li>无参构造</li><li>静态工厂</li><li>实例工厂</li></ul></blockquote><ol><li><p>使用无参构造（默认）</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title">UserService</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> UserDao userDao = <span class="keyword">new</span> UserDaoImpl();</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">save</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        userDao.save();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;userService&quot;</span> <span class="attr">class</span>=<span class="string">&quot;top.tobing.service.impl.UserServiceImpl&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>使用静态工厂生产对象</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StaticFactory</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> UserServiceImpl <span class="title">createUserService</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> UserServiceImpl();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--静态工厂生产对象--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;staticUserService&quot;</span> <span class="attr">class</span>=<span class="string">&quot;top.tobing.factory.StaticFactory&quot;</span> <span class="attr">factory-method</span>=<span class="string">&quot;createUserService&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>使用实例工厂生产对象</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">InstanceFactory</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> UserServiceImpl <span class="title">createUserService</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> UserServiceImpl();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--实例工厂生产对象--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;instanceUserService&quot;</span> <span class="attr">class</span>=<span class="string">&quot;top.tobing.factory.InstanceFactory&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;userServiceI&quot;</span> <span class="attr">factory-bean</span>=<span class="string">&quot;instanceUserService&quot;</span> <span class="attr">factory-method</span>=<span class="string">&quot;createUserService&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ol><h2 id="3-Spring的依赖注入"><a href="#3-Spring的依赖注入" class="headerlink" title="3. Spring的依赖注入"></a>3. Spring的依赖注入</h2><blockquote><ul><li><p>依赖注入，Dependency Injection（简称DJ）。它是spring框架核心ioc的具体实现。</p></li><li><p>在编写程序时。我们通过Ioc（控制反转）把对象创建的控制权交给了spring。</p></li><li><p>代码中不可能完全没有依赖，IOC解耦只是降低他们的依赖关系，不可能完全消除依赖关系，例如：业务层仍然需要调持久层。</p></li><li><p>在使用了spring之后，我们连通把这种依赖也交给了spring维护。</p></li><li><p>就是说，我们只需让框架把持久层对象传入业务层，而不是我们自己获取。</p></li></ul></blockquote><h3 id="1-构造函数注入"><a href="#1-构造函数注入" class="headerlink" title="1. 构造函数注入"></a>1. 构造函数注入</h3><blockquote><ul><li>通过使用类中构造函数，给成员变量赋值。</li><li>赋值的过程是使用配置文件的方式（如xml），让spring帮我们注入。</li><li>constructor-arg标签</li></ul></blockquote><ol><li><p>重写UserServiceImpl类用于演示依赖注入</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title">UserService</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">    <span class="keyword">private</span> Date birthday;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">UserServiceImpl</span><span class="params">(String name, Integer age, Date birthday)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">        <span class="keyword">this</span>.age = age;</span><br><span class="line">        <span class="keyword">this</span>.birthday = birthday;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">save</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Save method!&quot;</span>+name+<span class="string">&quot;,&quot;</span>+age+<span class="string">&quot;,&quot;</span>+birthday);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>编写bean.xml，给上述service层的对象传值。</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;userService&quot;</span> <span class="attr">class</span>=<span class="string">&quot;top.tobing.service.impl.UserServiceImpl&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;张三&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">&quot;age&quot;</span> <span class="attr">value</span>=<span class="string">&quot;19&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">&quot;birthday&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;bir&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;bir&quot;</span> <span class="attr">class</span>=<span class="string">&quot;java.util.Date&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>通过调用service层UserServiceImpl的save方法看是否注入成功</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserUI</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 1. 使用ApplicationContext接口（获取spring容器）</span></span><br><span class="line">        ApplicationContext ac = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">&quot;bean.xml&quot;</span>);</span><br><span class="line">        UserService userService = (UserService) ac.getBean(<span class="string">&quot;userService&quot;</span>);</span><br><span class="line">        userService.save();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>结果：Save method!张三,19,Wed Dec 11 17:31:25 CST 2019</p></blockquote></li><li><p>依赖注入对应关系</p><p><img src="https://gitee.com/tobing/imagebed/raw/master/spring2-%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5.png" class="lazyload" data-srcset="https://gitee.com/tobing/imagebed/raw/master/spring2-%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5.png" srcset="data:image/png;base64,666" alt="spring2-依赖注入"></p></li><li><p>构造函数依赖注入涉及标签</p><blockquote><ul><li>constructor-arg属性：</li><li>——————————-给谁赋值———————————–</li><li>index：指定参数在构造函数参数列表的索引位置</li><li>type：指定参数在构造函数中的数据类型</li><li>name：指定参数在构造函数中的名称（实际中最常用）</li><li>——————————-赋什么赋值——————————–</li><li>value：基本数据类型和String</li><li>ref：赋值可以是其他bean，也就是说在配置文件中的其他bean</li></ul></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">beans</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;userService&quot;</span> <span class="attr">class</span>=<span class="string">&quot;top.tobing.service.impl.UserServiceImpl&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--给参数列表中，属性名为name的赋值--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;张三&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--给参数列表中，数据类型为Integer的参数赋值--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">type</span>=<span class="string">&quot;java.lang.Integer&quot;</span> <span class="attr">value</span>=<span class="string">&quot;19&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--给参数类表中，索引为2,（即第3个参数）赋值--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--ref用于引用id为bir的另外一个bean--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">index</span>=<span class="string">&quot;2&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;bir&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;bir&quot;</span> <span class="attr">class</span>=<span class="string">&quot;java.util.Date&quot;</span> &gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span>                        </span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ol><h3 id="2-set方法注入"><a href="#2-set方法注入" class="headerlink" title="2. set方法注入"></a>2. set方法注入</h3><blockquote><p>通过类中setter方法注入</p><p>property标签</p></blockquote><ol><li><p>重写UserServiceImpl</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title">UserService</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">    <span class="keyword">private</span> Date birthday;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">// 省略其余setter</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">save</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Save method!&quot;</span>+name+<span class="string">&quot;,&quot;</span>+age+<span class="string">&quot;,&quot;</span>+birthday);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>编写配置文件建议对应关系，注入</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">beans</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;userService&quot;</span> <span class="attr">class</span>=<span class="string">&quot;top.tobing.service.impl.UserServiceImpl&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;age&quot;</span> <span class="attr">value</span>=<span class="string">&quot;20&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;tobing&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;birthday&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;bir&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;bir&quot;</span> <span class="attr">class</span>=<span class="string">&quot;java.util.Date&quot;</span> &gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>测试</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. 使用ApplicationContext接口（获取spring容器）</span></span><br><span class="line">ApplicationContext ac = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">&quot;bean.xml&quot;</span>);</span><br><span class="line"><span class="comment">// 2. 调用方法</span></span><br><span class="line">UserService userService = (UserService) ac.getBean(<span class="string">&quot;userService&quot;</span>);</span><br></pre></td></tr></table></figure><blockquote><p>Save method!tobing,20,Wed Dec 11 18:27:46 CST 2019</p></blockquote></li></ol><h3 id="3-p名称空间注入（本质调用setter方法）"><a href="#3-p名称空间注入（本质调用setter方法）" class="headerlink" title="3. p名称空间注入（本质调用setter方法）"></a>3. p名称空间注入（本质调用setter方法）</h3><blockquote><p>通过在xml中导入p名称空间，使用p：注入属性名称=xxx来注入数据。</p></blockquote><ol><li><p>编写service层（和set方法一致）</p></li><li><p>编写配置文件</p><blockquote><p>注意导入p空间： xmlns:p=”<a href="http://www.springframework.org/schema/p&quot;">http://www.springframework.org/schema/p&quot;</a> </p><p>注意非基本数据类型和String要使用：属性名-ref 来注入。</p></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:p</span>=<span class="string">&quot;http://www.springframework.org/schema/p&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;userService&quot;</span> <span class="attr">class</span>=<span class="string">&quot;top.tobing.service.impl.UserServiceImpl&quot;</span> <span class="attr">p:age</span>=<span class="string">&quot;18&quot;</span> <span class="attr">p:name</span>=<span class="string">&quot;Rongon&quot;</span> <span class="attr">p:birthday-ref</span>=<span class="string">&quot;bir&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;bir&quot;</span> <span class="attr">class</span>=<span class="string">&quot;java.util.Date&quot;</span> &gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ol><h3 id="4-注入集合属性"><a href="#4-注入集合属性" class="headerlink" title="4. 注入集合属性"></a>4. 注入集合属性</h3><blockquote><p>通过setter，给集合成员（数组、List、Set、Map、Properties）传值。</p></blockquote><ol><li><p>给service层添加集合元素用于测试</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title">UserService</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String[] myStrs;</span><br><span class="line">    <span class="keyword">private</span> List&lt;String&gt; myList;</span><br><span class="line">    <span class="keyword">private</span> Set&lt;String&gt; mySet;</span><br><span class="line">    <span class="keyword">private</span> Map&lt;String,String&gt; myMap;</span><br><span class="line">    <span class="keyword">private</span> Properties myPropers;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setMyStrs</span><span class="params">(String[] myStrs)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.myStrs = myStrs;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">// setter</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">save</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(Arrays.toString(myStrs));</span><br><span class="line">        System.out.println(myList);</span><br><span class="line">        System.out.println(mySet);</span><br><span class="line">        System.out.println(myMap);</span><br><span class="line">        System.out.println(myPropers);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><ol start="2"><li><p>编写配置文件</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;userService&quot;</span> <span class="attr">class</span>=<span class="string">&quot;top.tobing.service.impl.UserServiceImpl&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--字符数组--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;myStrs&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">set</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>AAA<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>BBB<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>CCC<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>DDD<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--List--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;myList&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">list</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>List1<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>List2<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>List3<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>List4<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">list</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--Set--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;mySet&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">set</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>Set1<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>Set2<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>Set3<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>Set4<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--Properties--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;myPropers&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">props</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">&quot;testA&quot;</span>&gt;</span>aaa<span class="tag">&lt;/<span class="name">prop</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">&quot;testB&quot;</span>&gt;</span>bbb<span class="tag">&lt;/<span class="name">prop</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">props</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--Map--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;myMap&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">map</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">&quot;mapA&quot;</span> <span class="attr">value</span>=<span class="string">&quot;aaa&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">entry</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">&quot;mapB&quot;</span> <span class="attr">value</span>=<span class="string">&quot;bbb&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">entry</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">&quot;mapC&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">value</span>&gt;</span>CCC<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">entry</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">map</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>测试</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserUI</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 1. 使用ApplicationContext接口（获取spring容器）</span></span><br><span class="line">        ApplicationContext ac = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">&quot;bean.xml&quot;</span>);</span><br><span class="line">        UserService userService = (UserService) ac.getBean(<span class="string">&quot;userService&quot;</span>);</span><br><span class="line">        userService.save();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[AAA, BBB, CCC, DDD]</span><br><span class="line">[List1, List2, List3, List4]</span><br><span class="line">[Set1, Set2, Set3, Set4]</span><br><span class="line">&#123;mapA=aaa, mapB=bbb, mapC=CCC&#125;</span><br><span class="line">&#123;testB=bbb, testA=aaa&#125;</span><br></pre></td></tr></table></figure></li><li><p>注意</p><blockquote><p>在集合数据注入时，同一种集合元素可以共用一种标签，例如：</p><ul><li>List结构：<ul><li>array、list、set</li></ul></li><li>Map结构：<ul><li>map、entry、props、prop</li></ul></li></ul></blockquote></li></ol>]]></content>
      
      
      
        <tags>
            
            <tag> Spring </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>spring-1-入门</title>
      <link href="2019/12/11/spring-1-%E5%85%A5%E9%97%A8/"/>
      <url>2019/12/11/spring-1-%E5%85%A5%E9%97%A8/</url>
      
        <content type="html"><![CDATA[<p>Spring是核心是AOP和IOC，是框架中必不可少的一部分，本文记录了学习笔记。</p><a id="more"></a><h1 id="Spring-1-入门"><a href="#Spring-1-入门" class="headerlink" title="Spring-1-入门"></a>Spring-1-入门</h1><h2 id="1-Spring的优势（先了解、使用中感悟）"><a href="#1-Spring的优势（先了解、使用中感悟）" class="headerlink" title="1. Spring的优势（先了解、使用中感悟）"></a>1. Spring的优势（先了解、使用中感悟）</h2><blockquote><ol><li>方便解耦，简化开发</li><li>AOP编程的支持</li><li>声明式事务的支持</li><li>方便程序的测试</li><li>方便集成各种优秀框架</li><li>降低了JavaEE API的使用难度</li><li>Java源码是经典学习的范例</li></ol></blockquote><h3 id="1-方便解耦，简化开发"><a href="#1-方便解耦，简化开发" class="headerlink" title="1. 方便解耦，简化开发"></a>1. 方便解耦，简化开发</h3><blockquote><p>通过Spring提供的Ioc容器，可以对对象之间的依赖关系交给Spring进行控制，编码硬编码所造成的过度程序耦合。用户不必再为单例模式类、属性文件解析等这些很底层的需求编写代码，可以更加专注于上层的应用。</p></blockquote><h3 id="2-AOP编程的支持"><a href="#2-AOP编程的支持" class="headerlink" title="2. AOP编程的支持"></a>2. AOP编程的支持</h3><blockquote><p>通过Spring的AOP功能，方便进行切面的编程，许多不容易用传统OOP实现的功能可以通过AOP轻松应对。</p></blockquote><h3 id="3-声明式事务的支持"><a href="#3-声明式事务的支持" class="headerlink" title="3. 声明式事务的支持"></a>3. 声明式事务的支持</h3><blockquote><p>从单调的事务管理代码中解脱出来，通过声明式方式灵活的进行事务的管理，提高开发效率和质量</p></blockquote><h3 id="4-方便程序的测试"><a href="#4-方便程序的测试" class="headerlink" title="4. 方便程序的测试"></a>4. 方便程序的测试</h3><blockquote><p>可以用非容器依赖的编程方式进行几乎所有的测试工作，测试不再是昂贵的操作，而是随手可做的事情。</p></blockquote><h3 id="5-方便集成各种优秀框架"><a href="#5-方便集成各种优秀框架" class="headerlink" title="5. 方便集成各种优秀框架"></a>5. 方便集成各种优秀框架</h3><blockquote><p>Spring可以降低各种框架的使用难度，提供了对各种优秀框架（Structs、Hibernate、Hessian、Quartz等）的直接支持</p></blockquote><h3 id="6-降低了JavaEE-API的使用难度"><a href="#6-降低了JavaEE-API的使用难度" class="headerlink" title="6. 降低了JavaEE API的使用难度"></a>6. 降低了JavaEE API的使用难度</h3><blockquote><p>简化了如：JDBC、JavaMail、远程调用等的使用难度（对JavaEE API进行了略微封装），使得API使用难度大大降低。</p></blockquote><h3 id="7-Java源码是经典学习的范例"><a href="#7-Java源码是经典学习的范例" class="headerlink" title="7. Java源码是经典学习的范例"></a>7. Java源码是经典学习的范例</h3><blockquote><p>Spring源代码设计精妙、结构清晰、独具匠心。楚楚体现着对Java设计模式的灵活运用以及对Java技术的高深造诣。是学习的典范。</p></blockquote><h3 id="8-Spring的体系结构"><a href="#8-Spring的体系结构" class="headerlink" title="8. Spring的体系结构"></a>8. Spring的体系结构</h3><p><img src="https://gitee.com/tobing/imagebed/raw/master/spring01-factorystruct.png" class="lazyload" data-srcset="https://gitee.com/tobing/imagebed/raw/master/spring01-factorystruct.png" srcset="data:image/png;base64,666" alt="spring01-factorystruct"></p><h2 id="2-IoC的概念及作用"><a href="#2-IoC的概念及作用" class="headerlink" title="2. IoC的概念及作用"></a>2. IoC的概念及作用</h2><h3 id="1-什么是耦合"><a href="#1-什么是耦合" class="headerlink" title="1.什么是耦合"></a>1.什么是耦合</h3><ol><li><p>耦合度</p><blockquote><ol><li>耦合度，也叫耦合性，是模块间关联程度。在软件工程中体现的是程序与程序之间的依赖程度。（Java中是类与类（或者方法与方法）之间的依赖程度）</li><li>高耦合，耦合越高程序越难以维护。</li><li>低耦合，常与高内聚一起来衡量模块独立程度的标准。</li><li>划分模块的准则是：高内聚、低耦合。</li></ol></blockquote></li></ol><h3 id="2-耦合度的体现"><a href="#2-耦合度的体现" class="headerlink" title="2. 耦合度的体现"></a>2. 耦合度的体现</h3><blockquote><p>程序之间的是必然存在依赖关系的，但是有的依赖是可以通过优化代码来消除的</p></blockquote><ol><li><p>以注册驱动为例，演示优化程序间依赖关系</p><blockquote><p>采用DriverManager的register方法的形式注册驱动</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JdbcDemo01</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">        <span class="comment">//1.注册驱动</span></span><br><span class="line">        DriverManager.registerDriver(<span class="keyword">new</span> com.mysql.jdbc.Driver());</span><br><span class="line">        <span class="comment">//2.获取连接</span></span><br><span class="line">        <span class="comment">//3.获取预处理对象</span></span><br><span class="line">        <span class="comment">//4.获取结果集</span></span><br><span class="line">        <span class="comment">//5.遍历结果集</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><ul><li>分析以上程序可以知道，当com.mysql.jdbc.Driver这个类没有没导入的时候，该程序会在在编译期间就会报错误（注意是Error，而不是异常）</li></ul></blockquote><blockquote><p>以Class.forName，即反射的方式注册驱动</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JdbcDemo01</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">//1.注册驱动</span></span><br><span class="line">        Class.forName(<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>);</span><br><span class="line">        <span class="comment">//2.获取连接</span></span><br><span class="line">        <span class="comment">//3.获取预处理对象</span></span><br><span class="line">        <span class="comment">//4.获取结果集</span></span><br><span class="line">        <span class="comment">//5.遍历结果集</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><ul><li>以反射的方式加载驱动时，只需要传入全限定类名的字符串表现形式，这种形式下，如果没有导入对应的驱动jar包，肯定也无法正常运行。但是在编译的时候却是可以通过的（运行时抛出异常，ClassNotFoundException）。</li></ul></blockquote><blockquote><ul><li>由以上两种方式，我们可以明显看出，第二种方式（即是以反射的形式）加载驱动的耦合度要低于直接创建对象的方式</li></ul></blockquote></li><li><p>以往开发中耦合度较高的程序</p><blockquote><ul><li>界面层要创建业务层对象实现业务</li><li>业务层要创建接口层对象实现dao</li></ul></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AccountServiceImpl</span> <span class="keyword">implements</span> <span class="title">AccountService</span> </span>&#123;  </span><br><span class="line">    <span class="keyword">private</span> AccountDao accountDao = <span class="keyword">new</span> AccountDaoImpl(); <span class="comment">//此处要求存在AccountDaoImpl类</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><h3 id="3-如何解决耦合度（工厂模式、单列模式）"><a href="#3-如何解决耦合度（工厂模式、单列模式）" class="headerlink" title="3. 如何解决耦合度（工厂模式、单列模式）"></a>3. 如何解决耦合度（工厂模式、单列模式）</h3><blockquote><ul><li>以上注册驱动案例中，我们发现以反射的形式加载驱动类时，即是我们把数据库驱动的依赖（dependency）去除，程序仍然能够正常编译。（运行是肯定不行的了）</li><li>但是这种方式也存在一个问题，程序扩展性太差，因为驱动的类名已经写死。当我们需要使用其他数据库时还需要将代码重写编译。</li><li>为了解决以上问题，实际中我们常常使用配置文件。</li></ul></blockquote><ol><li><p>解决办法：创建Bean对象的工厂</p><blockquote><ul><li><p>Bean：在计算机英语中，有可重用组建的含义。</p></li><li><p>JavaBean：用java语言编写的可重用组件。</p><ul><li>JavaBean并不仅仅局限于我们知道的实体类</li><li>JavaBean &gt; 实体类</li><li>JavaBean包含了service和dao等重用性较高的对象</li></ul></li><li><p>使用JavaBean工厂对象</p><ol><li><p>配置文件配置service和dao</p><ul><li>配置的内容：唯一标识 = 全限定类名（key = value）</li></ul></li><li><p>读取配置文件，通过反射来创建对象</p><ul><li>可以使用xml或者properties</li></ul></li></ol></li></ul></blockquote></li></ol><ol start="2"><li><p>使用工厂模式解耦</p><blockquote><ol><li>加载包含全限定类名的配置文件。</li><li>根据配置文件中的全限定类名，以反射的方式创建对象。</li></ol></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> top.tobing.beanfactory;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.util.Properties;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BeanFactory</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Properties pro;</span><br><span class="line">    <span class="comment">// 加载配置文件</span></span><br><span class="line">    <span class="keyword">static</span>&#123;</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            pro = <span class="keyword">new</span> Properties();</span><br><span class="line">            InputStream in = BeanFactory.class.getClassLoader().getResourceAsStream(<span class="string">&quot;bean.properties&quot;</span>);</span><br><span class="line">            pro.load(in);</span><br><span class="line">        &#125;<span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> ExceptionInInitializerError(<span class="string">&quot;没找到配置文件！&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 利用反射获取对象</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title">getBean</span><span class="params">(String beanName)</span></span>&#123;</span><br><span class="line">        Object bean = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            String className = pro.getProperty(beanName);</span><br><span class="line">            bean = Class.forName(className).newInstance();</span><br><span class="line">        &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> bean;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>工厂模式优化</p><blockquote><ul><li>以上代码中，虽然我们已经通过工厂模式降低了三层之间的耦合度，但是我们每次获取Impl对象的时候都要newInstance的方式（调用默认构造方法），主动申请对象。这样申请的对象每次都不一样。</li><li>这种方式的效率低下</li></ul></blockquote><ol><li><p>解决办法</p><blockquote><ol><li>在初始化的时候，加装配置文件。</li><li>通过配置文件的信息，创建容器存储反射创建的对象。</li><li>每次在获取Bean对象的时候通过容器返回</li></ol></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> top.tobing.beanfactory;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.util.Enumeration;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> java.util.Properties;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BeanFactoryPlus</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1. 读取配置文件</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Properties pro;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Map&lt;String,Object&gt; beans;</span><br><span class="line">    <span class="keyword">static</span>&#123;</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            pro = <span class="keyword">new</span> Properties();</span><br><span class="line">            beans = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">            <span class="comment">// 获取配置文件</span></span><br><span class="line">            InputStream in = BeanFactoryPlus.class.getClassLoader().getResourceAsStream(<span class="string">&quot;bean.properties&quot;</span>);</span><br><span class="line">            pro.load(in);</span><br><span class="line">            <span class="comment">// 遍历配置文件信息</span></span><br><span class="line">            Enumeration&lt;Object&gt; keys = pro.keys();</span><br><span class="line">            <span class="keyword">while</span>(keys.hasMoreElements())&#123;</span><br><span class="line">                String beanName = (String)keys.nextElement().toString();</span><br><span class="line">                String className = (String)pro.get(beanName);</span><br><span class="line">                <span class="comment">// 2. 反射创建对象</span></span><br><span class="line">                Object obj = Class.forName(className).newInstance();</span><br><span class="line">                <span class="comment">// 3. 使用容器存储创建对象</span></span><br><span class="line">                beans.put(beanName,obj);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> ExceptionInInitializerError(<span class="string">&quot;配置文件读取异常！&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">// 返回容器中存储的对象</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title">getBean</span><span class="params">(String beanName)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> beans.get(beanName);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li></ol></li></ol><h3 id="4-什么是Ioc？"><a href="#4-什么是Ioc？" class="headerlink" title="4. 什么是Ioc？"></a>4. 什么是Ioc？</h3><blockquote><ul><li>Ioc，全称Inversion of Control，控制反转。可以理解为，把创建对象的权利交给了框架。</li></ul></blockquote><ol><li><p>为何说降低耦合是控制反转？</p><blockquote><ol><li>在创建依赖的对象时，一般的形式是通过new关键字直接创建对象。这种情况要求程序要与资源直接关联（程序对资源有直接控制权）。</li><li>在使用工厂模式解耦的时候，我们通过工厂类作为中间人，将多个资源与程序关联起来。  这时候，我们将程序对资源的控制权交给了工厂。因此成为控制反转。</li></ol></blockquote></li><li><p>Ioc 的作用</p><blockquote><p>降低程序间的耦合度。</p></blockquote></li></ol><h2 id="3-使用Spring的Ioc解决程序耦合度"><a href="#3-使用Spring的Ioc解决程序耦合度" class="headerlink" title="3. 使用Spring的Ioc解决程序耦合度"></a>3. 使用Spring的Ioc解决程序耦合度</h2><blockquote><p>步骤：</p><ol><li>下载spring开发包</li><li>创建业务层接口和实现类</li><li>创建持久层接口和实现类</li><li>基于XML配置（基于Maven）</li><li>获取spring的容器</li><li>通过容器创建对象</li></ol></blockquote><h3 id="1-下载spring开发包"><a href="#1-下载spring开发包" class="headerlink" title="1. 下载spring开发包"></a>1. 下载spring开发包</h3><blockquote><p>Spring官网：<a href="http://www.spring.io/">www.spring.io</a></p><p>Spring开发包下载地址： <a href="https://repo.spring.io/release/org/springframework/spring/">https://repo.spring.io/release/org/springframework/spring/</a> </p></blockquote><ol><li><p>目录结构</p><blockquote><p>下载之后解压得到：spring-framework-5.0.2.RELEASE-dist文件夹</p><p>-spring-framework-5.0.2.RELEASE</p><p>​        -docs：API和开发规范</p><p>​        -libs：jar包和源码</p><p>​        -schema：约束</p></blockquote></li><li><p>开发注意</p><blockquote><ul><li><p>spring5.0.2是基于jdk8编写的，需要jdk8或者以上的版本</p></li><li><p>tomcat需要8.5以上</p></li></ul></blockquote></li></ol><h3 id="2-创建业务层，持久层接口以及对应的实现类"><a href="#2-创建业务层，持久层接口以及对应的实现类" class="headerlink" title="2. 创建业务层，持久层接口以及对应的实现类"></a>2. 创建业务层，持久层接口以及对应的实现类</h3><ol><li><p>资源框架</p><p><img src="https://gitee.com/tobing/imagebed/raw/master/spring01-source.png" class="lazyload" data-srcset="https://gitee.com/tobing/imagebed/raw/master/spring01-source.png" srcset="data:image/png;base64,666" alt="spring01-source"></p></li><li><p>代码</p><blockquote><p>视图层</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserUI</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        UserService userService = <span class="keyword">new</span> UserServiceImpl();</span><br><span class="line">        userService.save();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>业务层</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserService</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">save</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title">UserService</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> UserDao userDao = <span class="keyword">new</span> UserDaoImpl();</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">save</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        userDao.save();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>持久层</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserDao</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">save</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserDaoImpl</span> <span class="keyword">implements</span> <span class="title">UserDao</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">save</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;UserDao--&gt; 查询用户&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><h3 id="3-创建spring依赖（导入jar包）"><a href="#3-创建spring依赖（导入jar包）" class="headerlink" title="3.  创建spring依赖（导入jar包）"></a>3.  创建spring依赖（导入jar包）</h3><blockquote><p>pom.xml文件下添加spring的依赖</p></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-context<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.0.2.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="4-添加bean配置文件"><a href="#4-添加bean配置文件" class="headerlink" title="4. 添加bean配置文件"></a>4. 添加bean配置文件</h3><blockquote><ol><li><p>在资源目录下创建bean.xml文件</p></li><li><p>在spring参考文档(Spring Framework Documentation)core中找到bean.xml约束</p></li><li><p>配置service和dao</p></li></ol></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--service配置--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;userService&quot;</span> <span class="attr">class</span>=<span class="string">&quot;top.tobing.service.impl.UserServiceImpl&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--dao配置--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;userDao&quot;</span> <span class="attr">class</span>=<span class="string">&quot;top.tobing.dao.impl.UserDaoImpl&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="5-测试配置是否已经成功"><a href="#5-测试配置是否已经成功" class="headerlink" title="5. 测试配置是否已经成功"></a>5. 测试配置是否已经成功</h3><blockquote><p>将视图层，业务层和持久层的调用从new改为使用spring提供的Ioc</p></blockquote><blockquote><ol><li>获取ApplicationContext对象</li><li>通过该对象的getBean获取对象</li></ol></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserUI</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 1. 使用ApplicationContext接口（获取spring容器）</span></span><br><span class="line">        ApplicationContext ac = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">&quot;bean.xml&quot;</span>);</span><br><span class="line">        <span class="comment">// 2. 根据bean的id获取对象</span></span><br><span class="line">        UserService userService = (UserService) ac.getBean(<span class="string">&quot;userService&quot;</span>);</span><br><span class="line">        UserDao userDao = ac.getBean(<span class="string">&quot;userDao&quot;</span>,UserDao.class);</span><br><span class="line">        System.out.println(userDao);</span><br><span class="line">        System.out.println(userService);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 理论学习 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Spring </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Mybatis-7-注解开发</title>
      <link href="2019/11/30/Mybatis-7-%E6%B3%A8%E8%A7%A3%E5%BC%80%E5%8F%91/"/>
      <url>2019/11/30/Mybatis-7-%E6%B3%A8%E8%A7%A3%E5%BC%80%E5%8F%91/</url>
      
        <content type="html"><![CDATA[<p>Mybatis学习第七弹。</p><a id="more"></a><h1 id="Mybatis-7-注解开发"><a href="#Mybatis-7-注解开发" class="headerlink" title="Mybatis-7-注解开发"></a>Mybatis-7-注解开发</h1><blockquote><p>注解开发可以减少xml配置文件的编写。</p></blockquote><h2 id="1-Mybatis中常用的注解"><a href="#1-Mybatis中常用的注解" class="headerlink" title="1. Mybatis中常用的注解"></a>1. Mybatis中常用的注解</h2><blockquote><p>@Insert：新增操作</p><p>@Update：更新操作</p><p>@Delete：删除操作</p><p>@Select：查询操作</p><p>@Result：结果集的封装</p><p>@Results：与Result一起使用，实现多个结果集封装</p><p>@ResultMap：实现引用@Results定义的封装</p><p>@One：一对一的结果集封装</p><p>@Many：一对多结果集封装</p><p>@SelectProvider：动态SQL映射</p><p>@CacheNamespace：二级缓存配置</p></blockquote><h2 id="2-注解开发入门"><a href="#2-注解开发入门" class="headerlink" title="2. 注解开发入门"></a>2. 注解开发入门</h2><blockquote><ol><li>根据数据库表封装实体类</li><li>使用注解方式开发持久层接口</li><li>修改SqlMapConfig.xml配置文件</li><li>测试</li></ol></blockquote><h3 id="1-根据数据库封装实体类"><a href="#1-根据数据库封装实体类" class="headerlink" title="1. 根据数据库封装实体类"></a>1. 根据数据库封装实体类</h3><blockquote><p>封装User表</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="keyword">private</span> Date birthday;</span><br><span class="line">    <span class="keyword">private</span> String sex;</span><br><span class="line">    <span class="keyword">private</span> String address;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-使用注解方式开发持久层接口"><a href="#2-使用注解方式开发持久层接口" class="headerlink" title="2. 使用注解方式开发持久层接口"></a>2. 使用注解方式开发持久层接口</h3><blockquote><ul><li>把resources下xml配置文件删除</li><li>把SqlMapConfig下的mappers下的Mapper引用改为持久层接口的全限定类名。</li><li>使用注解开发</li></ul></blockquote><ol><li><p>更改mapper</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">class</span>=<span class="string">&quot;top.tobing.dao.UserDao&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>注解开发</p><blockquote><p>根据id查询数据</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserDao</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Select(&quot;Select * from user where id = #&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">findById</span><span class="params">(<span class="keyword">int</span> id)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><h3 id="3-测试"><a href="#3-测试" class="headerlink" title="3. 测试"></a>3. 测试</h3><blockquote><p>检验注解开发是否能够正常查询出来数据</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">findByIdTest</span><span class="params">()</span></span>&#123;</span><br><span class="line">      User user = userDao.findById(<span class="number">44</span>);</span><br><span class="line">      System.out.println(user);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><blockquote><p>结果：User{id=44, username=’CacheTest’, birthday=null, sex=’男’, address=’英国’}</p></blockquote><h2 id="3-使用注解实现简单CRUD"><a href="#3-使用注解实现简单CRUD" class="headerlink" title="3. 使用注解实现简单CRUD"></a>3. 使用注解实现简单CRUD</h2><blockquote><ol><li>使用注解开发实现简单的CRUD</li><li>使用注解配置：数据库列名和实体类属性名的一一对应（非常规）</li></ol></blockquote><ol><li><p>创建实体类</p><blockquote><p>此处故意使得实体类属性名和数据库列名不匹配</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 对应数据库的列名</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> userId;<span class="comment">// ===&gt;id</span></span><br><span class="line">    <span class="keyword">private</span> String userName;<span class="comment">// ===&gt;username</span></span><br><span class="line">    <span class="keyword">private</span> Date userBirthday;<span class="comment">// ===&gt;birthday</span></span><br><span class="line">    <span class="keyword">private</span> String userSex;<span class="comment">// ===&gt;sex</span></span><br><span class="line">    <span class="keyword">private</span> String userAddress;<span class="comment">// ===&gt;address</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>在UserDao中添加用于对User进行CRUD的抽象方法</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserDao</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 查询所有用户</span></span><br><span class="line">    <span class="meta">@Select(&quot;select * from user&quot;)</span></span><br><span class="line">    <span class="meta">@Results(id = &quot;userMap&quot;,value = &#123;// 建立数据库列和实体类字段名的一一对应</span></span><br><span class="line"><span class="meta">        @Result(id = true,column = &quot;id&quot;,property = &quot;userId&quot;),</span></span><br><span class="line"><span class="meta">            @Result(column = &quot;username&quot;,property = &quot;userName&quot;),</span></span><br><span class="line"><span class="meta">            @Result(column = &quot;sex&quot;,property = &quot;userSex&quot;),</span></span><br><span class="line"><span class="meta">            @Result(column = &quot;address&quot;,property = &quot;userAddress&quot;),</span></span><br><span class="line"><span class="meta">            @Result(column = &quot;birthday&quot;,property = &quot;userBirthday&quot;)</span></span><br><span class="line"><span class="meta">    &#125;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;User&gt; <span class="title">findAll</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 更加Id查询用户</span></span><br><span class="line">    <span class="meta">@Select(&quot;Select * from user where id = #&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="meta">@ResultMap(&quot;userMap&quot;)</span>       <span class="comment">// 使用userMap封装</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">findById</span><span class="params">(Integer id)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 保存用户信息</span></span><br><span class="line">    <span class="meta">@Insert(&quot;insert into user values(#&#123;userId&#125;,#&#123;userName&#125;,#&#123;userBirthday&#125;,#&#123;userSex&#125;,#&#123;userAddress&#125;)&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">saveUser</span><span class="params">(User user)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 更新用户信息</span></span><br><span class="line">    <span class="meta">@Update(&quot;update user set username=#&#123;userName&#125;,sex=#&#123;userSex&#125;,address=#&#123;userAddress&#125; where id = #&#123;userId&#125;&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">updateUser</span><span class="params">(User user)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 查询总记录数</span></span><br><span class="line">    <span class="meta">@Select(&quot;Select count(*) from user&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">findTotal</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 根据用户名模糊查询</span></span><br><span class="line">    <span class="meta">@Select(&quot;Select * from user where username like #&#123;username&#125;&quot;)</span></span><br><span class="line">    <span class="meta">@ResultMap(&quot;userMap&quot;)</span>       <span class="comment">// 使用userMap封装</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;User&gt; <span class="title">findByName</span><span class="params">(String username)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><ul><li>此处由于数据库列名和实体类的字段名不对应，需要通过使用注解@Results和@Result来建立数据库列名和实体类字段名的一一对应关系。</li><li>在需要封装结果集的地方使用注解@ResultMap引用自定义的封装。</li></ul></blockquote></li><li><p>测试建议</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserDaoTest</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> InputStream in;</span><br><span class="line">    <span class="keyword">private</span> SqlSessionFactory factory;</span><br><span class="line">    <span class="keyword">private</span> SqlSession session;</span><br><span class="line">    <span class="keyword">private</span> UserDao userDao;</span><br><span class="line">    <span class="meta">@Before</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//1.读取配置文件</span></span><br><span class="line">            in = Resources.getResourceAsStream(<span class="string">&quot;SqlMapConfig.xml&quot;</span>);</span><br><span class="line">            <span class="comment">//2.创建工厂类</span></span><br><span class="line">            factory =<span class="keyword">new</span> SqlSessionFactoryBuilder().build(in);</span><br><span class="line">            <span class="comment">//3.生产SqlSession对象</span></span><br><span class="line">            session = factory.openSession();</span><br><span class="line">            <span class="comment">//4.获取代理对象</span></span><br><span class="line">            userDao = session.getMapper(UserDao.class);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@After</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">destory</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        session.commit();</span><br><span class="line">        session.close();</span><br><span class="line">        in.close();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">findByIdTest</span><span class="params">()</span></span>&#123;</span><br><span class="line">        User user = userDao.findById(<span class="number">44</span>);</span><br><span class="line">        System.out.println(user);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 查询所有用户</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">findAllTest</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        List&lt;User&gt; users = userDao.findAll();</span><br><span class="line">        <span class="keyword">for</span> (User user : users) &#123;</span><br><span class="line">            System.out.println(user);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 保存用户信息</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">saveUser</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        User u = <span class="keyword">new</span> User();</span><br><span class="line">        u.setUserAddress(<span class="string">&quot;水帘洞&quot;</span>);</span><br><span class="line">        u.setUserBirthday(<span class="keyword">new</span> Date());</span><br><span class="line">        u.setUserName(<span class="string">&quot;孙悟空&quot;</span>);</span><br><span class="line">        u.setUserSex(<span class="string">&quot;男&quot;</span>);</span><br><span class="line">        <span class="keyword">int</span> res = userDao.saveUser(u);</span><br><span class="line">        System.out.println(res);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 更新用户信息</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updateUser</span><span class="params">()</span></span>&#123;</span><br><span class="line">        User u = <span class="keyword">new</span> User();</span><br><span class="line">        u.setUserName(<span class="string">&quot;孙悟饭&quot;</span>);</span><br><span class="line">        u.setUserAddress(<span class="string">&quot;水帘洞&quot;</span>);</span><br><span class="line">        u.setUserBirthday(<span class="keyword">new</span> Date());</span><br><span class="line">        u.setUserSex(<span class="string">&quot;男&quot;</span>);</span><br><span class="line">        u.setUserId(<span class="number">47</span>);</span><br><span class="line">        <span class="keyword">int</span> res = userDao.updateUser(u);</span><br><span class="line">        System.out.println(res);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 查询总记录数</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">findTotal</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">int</span> total = userDao.findTotal();</span><br><span class="line">        System.out.println(total);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 根据用户名模糊查询</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">findByName</span><span class="params">()</span></span>&#123;</span><br><span class="line">        List&lt;User&gt; users = userDao.findByName(<span class="string">&quot;%张%&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span> (User user : users) &#123;</span><br><span class="line">            System.out.println(user);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><h2 id="4-使用注解查询复杂关系"><a href="#4-使用注解查询复杂关系" class="headerlink" title="4. 使用注解查询复杂关系"></a>4. 使用注解查询复杂关系</h2><h3 id="1-注解说明"><a href="#1-注解说明" class="headerlink" title="1. 注解说明"></a>1. 注解说明</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Results(id = &#x27;&#x27; value = &#123;</span></span><br><span class="line"><span class="meta">    @Result(),</span></span><br><span class="line"><span class="meta">    @Result(),</span></span><br><span class="line"><span class="meta">    ...</span></span><br><span class="line"><span class="meta">    &#125;)</span></span><br></pre></td></tr></table></figure><ol><li><p>Results</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Results &#123;</span><br><span class="line">  <span class="function">String <span class="title">id</span><span class="params">()</span> <span class="keyword">default</span> &quot;&quot;</span>;<span class="comment">// 指定主键</span></span><br><span class="line">  Result[] value() <span class="keyword">default</span> &#123;&#125;;<span class="comment">// 指定类名和属性的对应关系（Result注解）</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>Result</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Result &#123;</span><br><span class="line">  <span class="function"><span class="keyword">boolean</span> <span class="title">id</span><span class="params">()</span> <span class="keyword">default</span> <span class="keyword">false</span></span>;<span class="comment">// 是否为主键</span></span><br><span class="line"></span><br><span class="line">  <span class="function">String <span class="title">column</span><span class="params">()</span> <span class="keyword">default</span> &quot;&quot;</span>;<span class="comment">// 数据库列名</span></span><br><span class="line"></span><br><span class="line">  <span class="function">String <span class="title">property</span><span class="params">()</span> <span class="keyword">default</span> &quot;&quot;</span>;<span class="comment">// 实体类属性名</span></span><br><span class="line"></span><br><span class="line">  <span class="function">One <span class="title">one</span><span class="params">()</span> <span class="keyword">default</span> @One</span>;<span class="comment">// 使用@One注解</span></span><br><span class="line"></span><br><span class="line">  <span class="function">Many <span class="title">many</span><span class="params">()</span> <span class="keyword">default</span> @Many</span>;<span class="comment">// 使用@Many注解</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>One</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> One &#123;</span><br><span class="line">    <span class="function">String <span class="title">select</span><span class="params">()</span> <span class="keyword">default</span> &quot;&quot;</span>;<span class="comment">// 指定用于多表查询的sqlMapper</span></span><br><span class="line"><span class="comment">// 覆盖全局的配置参数lazyLoadingEnable</span></span><br><span class="line">    <span class="function">FetchType <span class="title">fetchType</span><span class="params">()</span> <span class="keyword">default</span> FetchType.DEFAULT</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>Many</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Many &#123;</span><br><span class="line">  <span class="function">String <span class="title">select</span><span class="params">()</span> <span class="keyword">default</span> &quot;&quot;</span>; <span class="comment">// 指定用于多表查询的sqlMapper</span></span><br><span class="line">  <span class="function">FetchType <span class="title">fetchType</span><span class="params">()</span> <span class="keyword">default</span> FetchType.DEFAULT</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>总结</p><blockquote><ul><li><p>@One</p><ul><li><p>指定一对一</p></li><li><p>代替了&lt;assocation&gt;标签，是多表查询的关键。</p></li><li><p>用于指定查询返回单一对象</p></li></ul></li><li><p>@Many</p><ul><li>指定一对多</li><li>代替了&lt;Collection&gt;，是多表查询的关键</li><li>用于指定查询返回集合对象</li></ul></li></ul></blockquote></li></ol><h3 id="2-使用注解开发一对一的复制关系映射"><a href="#2-使用注解开发一对一的复制关系映射" class="headerlink" title="2. 使用注解开发一对一的复制关系映射"></a>2. 使用注解开发一对一的复制关系映射</h3><blockquote><p>需求：加载账号时，加载用户信息。（可根据情况延迟加载）</p></blockquote><ol><li><p>创建Account类和User类</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Account类</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Account</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> uid;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">double</span> money;</span><br><span class="line">    <span class="keyword">private</span> User user;<span class="comment">// 与账号一一对应的用户</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// User类</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> userId;</span><br><span class="line">    <span class="keyword">private</span> String userName;</span><br><span class="line">    <span class="keyword">private</span> Date userBirthday;</span><br><span class="line">    <span class="keyword">private</span> String userSex;</span><br><span class="line">    <span class="keyword">private</span> String userAddress;</span><br><span class="line">    <span class="keyword">private</span> List&lt;Account&gt; accounts;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><ol start="2"><li><p>添加Account持久层dao并使用注解配置</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">AccountDao</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Select(&quot;select * from account&quot;)</span></span><br><span class="line">    <span class="meta">@Results(id=&quot;accountMap&quot;, value = &#123;</span></span><br><span class="line"><span class="meta">            @Result(id = true,column = &quot;id&quot;,property = &quot;id&quot;),</span></span><br><span class="line"><span class="meta">            @Result(column = &quot;uid&quot;,property = &quot;uid&quot;),</span></span><br><span class="line"><span class="meta">            @Result(column = &quot;money&quot;,property = &quot;money&quot;),</span></span><br><span class="line"><span class="meta">            @Result(column = &quot;uid&quot;,// 参数</span></span><br><span class="line"><span class="meta">                    property = &quot;user&quot;,// 封装的参数</span></span><br><span class="line"><span class="meta">                    one=@One(select=&quot;top.tobing.dao.UserDao.findById&quot;,// 调用UserDao.findById实现延迟查询</span></span><br><span class="line"><span class="meta">                    fetchType= FetchType.LAZY)// 延迟加载</span></span><br><span class="line"><span class="meta">            )</span></span><br><span class="line"><span class="meta">    &#125;)</span></span><br><span class="line">    <span class="function">List&lt;Account&gt; <span class="title">findAll</span><span class="params">()</span></span>;<span class="comment">// 查询所有方法</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li></ol><ol start="3"><li><p>添加User持久层dao并使用注解配置</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserDao</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 查询所有用户</span></span><br><span class="line">    <span class="meta">@Select(&quot;select * from user&quot;)</span></span><br><span class="line">    <span class="meta">@Results(id = &quot;userMap&quot;,value = &#123;       // 建立数据库列和实体类字段名的一一对应</span></span><br><span class="line"><span class="meta">        @Result(id = true,column = &quot;id&quot;,property = &quot;userId&quot;),</span></span><br><span class="line"><span class="meta">            @Result(column = &quot;username&quot;,property = &quot;userName&quot;),</span></span><br><span class="line"><span class="meta">            @Result(column = &quot;sex&quot;,property = &quot;userSex&quot;),</span></span><br><span class="line"><span class="meta">            @Result(column = &quot;address&quot;,property = &quot;userAddress&quot;),</span></span><br><span class="line"><span class="meta">            @Result(column = &quot;birthday&quot;,property = &quot;userBirthday&quot;)</span></span><br><span class="line"><span class="meta">    &#125;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;User&gt; <span class="title">findAll</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 更加Id查询用户</span></span><br><span class="line">    <span class="meta">@Select(&quot;Select * from user where id = #&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="meta">@ResultMap(&quot;userMap&quot;)</span>       <span class="comment">// 使用userMap封装</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">findById</span><span class="params">(Integer id)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><ol start="4"><li><p>测试数据</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">findAllTest</span><span class="params">()</span></span>&#123;</span><br><span class="line">     List&lt;Account&gt; accounts = accountDao.findAll();</span><br><span class="line">     <span class="keyword">for</span> (Account account : accounts) &#123;</span><br><span class="line">         System.out.println(<span class="string">&quot;-------------------------&quot;</span>);</span><br><span class="line">         System.out.println(account);</span><br><span class="line">         System.out.println(account.getUser());</span><br><span class="line">     &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure></li></ol><ol start="5"><li><p>测试延迟加载</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">lazyLoadingTest</span><span class="params">()</span></span>&#123;</span><br><span class="line">    List&lt;Account&gt; accounts = accountDao.findAll();</span><br><span class="line">    <span class="keyword">for</span> (Account account : accounts) &#123;</span><br><span class="line">        System.out.println(account.getMoney());</span><br><span class="line">        System.out.println(account.getId());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">   </span><br></pre></td></tr></table></figure></li></ol><h3 id="3-使用注解开发一对多的复杂关系映射"><a href="#3-使用注解开发一对多的复杂关系映射" class="headerlink" title="3. 使用注解开发一对多的复杂关系映射"></a>3. 使用注解开发一对多的复杂关系映射</h3><blockquote><p>需求：查询用户信息，按需查询其账号信息。（延迟加载）</p></blockquote><ol><li><p>User中加入List&lt;Account&gt;</p></li><li><p>编写User持久层接口并使用注解配置</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserDao</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 查询所有用户</span></span><br><span class="line">    <span class="meta">@Select(&quot;select * from user&quot;)</span></span><br><span class="line">    <span class="meta">@Results(id = &quot;userMap&quot;,value = &#123;       // 建立数据库列和实体类字段名的一一对应</span></span><br><span class="line"><span class="meta">        @Result(id = true,column = &quot;id&quot;,property = &quot;userId&quot;),</span></span><br><span class="line"><span class="meta">            @Result(column = &quot;username&quot;,property = &quot;userName&quot;),</span></span><br><span class="line"><span class="meta">            @Result(column = &quot;sex&quot;,property = &quot;userSex&quot;),</span></span><br><span class="line"><span class="meta">            @Result(column = &quot;address&quot;,property = &quot;userAddress&quot;),</span></span><br><span class="line"><span class="meta">            @Result(column = &quot;birthday&quot;,property = &quot;userBirthday&quot;),</span></span><br><span class="line"><span class="meta">            @Result(column = &quot;id&quot;,property = &quot;accounts&quot;,many = @Many(</span></span><br><span class="line"><span class="meta">                    select = &quot;top.tobing.dao.AccountDao.findByUid&quot;,</span></span><br><span class="line"><span class="meta">                    fetchType = FetchType.LAZY</span></span><br><span class="line"><span class="meta">            ))</span></span><br><span class="line"><span class="meta">    &#125;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;User&gt; <span class="title">findAll</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><ol start="3"><li><p>编写Account持久层接口并使用注解配置</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">AccountDao</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Select(&quot;select * from account&quot;)</span></span><br><span class="line">    <span class="meta">@Results(id=&quot;accountMap&quot;, value = &#123;</span></span><br><span class="line"><span class="meta">            @Result(id = true,column = &quot;id&quot;,property = &quot;id&quot;),</span></span><br><span class="line"><span class="meta">            @Result(column = &quot;uid&quot;,property = &quot;uid&quot;),</span></span><br><span class="line"><span class="meta">            @Result(column = &quot;money&quot;,property = &quot;money&quot;),</span></span><br><span class="line"><span class="meta">            @Result(column = &quot;uid&quot;,</span></span><br><span class="line"><span class="meta">                    property = &quot;user&quot;,</span></span><br><span class="line"><span class="meta">                    one=@One(select=&quot;top.tobing.dao.UserDao.findById&quot;,</span></span><br><span class="line"><span class="meta">                    fetchType= FetchType.LAZY)</span></span><br><span class="line"><span class="meta">            )</span></span><br><span class="line"><span class="meta">    &#125;)</span></span><br><span class="line">    <span class="function">List&lt;Account&gt; <span class="title">findAll</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Select(&quot;select * from account where uid = #&#123;uid&#125;&quot;)</span></span><br><span class="line">    <span class="meta">@ResultMap(&quot;accountMap&quot;)</span></span><br><span class="line">    <span class="function">List&lt;Account&gt; <span class="title">findByUid</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li></ol><ol start="4"><li><p>添加测试方法</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">findAllTest</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    List&lt;User&gt; users = userDao.findAll();</span><br><span class="line">    <span class="keyword">for</span> (User user : users) &#123;</span><br><span class="line">        System.out.println(user.getUserName());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><h2 id="5-注解实现开启二级缓存"><a href="#5-注解实现开启二级缓存" class="headerlink" title="5. 注解实现开启二级缓存"></a>5. 注解实现开启二级缓存</h2><h3 id="1-SqlMapConfig配置"><a href="#1-SqlMapConfig配置" class="headerlink" title="1. SqlMapConfig配置"></a>1. SqlMapConfig配置</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span> &gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">settings</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;cacheEnable&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">settings</span>&gt;</span></span><br><span class="line">   ......</span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="2-持久层注解开启二级缓存"><a href="#2-持久层注解开启二级缓存" class="headerlink" title="2. 持久层注解开启二级缓存"></a>2. 持久层注解开启二级缓存</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@CacheNamespace(blocking =true)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserDao</span> </span>&#123;</span><br><span class="line">    .....</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 理论学习 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Mybatis </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Mybatis-6-延迟加载</title>
      <link href="2019/11/30/Mybatis-6-%E5%BB%B6%E8%BF%9F%E5%8A%A0%E8%BD%BD/"/>
      <url>2019/11/30/Mybatis-6-%E5%BB%B6%E8%BF%9F%E5%8A%A0%E8%BD%BD/</url>
      
        <content type="html"><![CDATA[<p>Mybatis学习第六弹。</p><a id="more"></a><h1 id="Mybatis-6-延迟加载与缓存"><a href="#Mybatis-6-延迟加载与缓存" class="headerlink" title="Mybatis-6-延迟加载与缓存"></a>Mybatis-6-延迟加载与缓存</h1><h2 id="1-延迟加载"><a href="#1-延迟加载" class="headerlink" title="1. 延迟加载"></a>1. 延迟加载</h2><h3 id="1-什么是延迟加载"><a href="#1-什么是延迟加载" class="headerlink" title="1. 什么是延迟加载"></a>1. 什么是延迟加载</h3><blockquote><ol><li>延迟加载机制是为了避免一些无谓的性能开销而提出来的，所谓延迟加载就是当在真正需要数据的时候，才真正执行数据加载操作。</li><li>延迟加载(lazy load)是(也称为懒加载)。</li></ol></blockquote><h3 id="2-为什么要使用延迟加载"><a href="#2-为什么要使用延迟加载" class="headerlink" title="2. 为什么要使用延迟加载"></a>2. 为什么要使用延迟加载</h3><blockquote><ol><li>实际开发中一张表往往关联着其他表，但每次查询不一定要用到其他表。</li><li>查询一张表比查询多张表速度要快，可以大大提高查询速度。</li></ol></blockquote><h3 id="3-延迟加载存在的问题"><a href="#3-延迟加载存在的问题" class="headerlink" title="3. 延迟加载存在的问题"></a>3. 延迟加载存在的问题</h3><blockquote><p>由于是用到了数据才去加载，所以在用户大量使用查询的时候，会导致查询结果较慢。</p></blockquote><h3 id="4-延迟加载应用示例"><a href="#4-延迟加载应用示例" class="headerlink" title="4. 延迟加载应用示例"></a>4. 延迟加载应用示例</h3><ol><li><p>场景</p><ol><li><p>Account和User表</p><table><thead><tr><th align="center">表名</th><th align="center">列名1</th><th align="center">列名2</th><th align="center">列名3</th><th align="center">列名4</th><th align="center">列名5</th></tr></thead><tbody><tr><td align="center">Account</td><td align="center">id</td><td align="center">uid</td><td align="center">money</td><td align="center"></td><td align="center"></td></tr><tr><td align="center">User</td><td align="center">id</td><td align="center">username</td><td align="center">birthday</td><td align="center">sex</td><td align="center">address</td></tr></tbody></table><blockquote><ol><li><p>User可以有多个Account（即是一对多）。</p></li><li><p>Account通过uid与唯一的User关联。</p></li></ol></blockquote></li><li><p>需求</p><blockquote><ol><li>在通过查询Account时，不直接查询出其中的User。</li><li>在需要使用User信息部分（例如：调用getUser模拟使用User信息）时，才实行加载。</li></ol></blockquote></li></ol></li><li><p>分析</p><blockquote><ol><li>Account中有User的属性用于关联User表查询的信息。</li><li>不调用其中的getUser方法的时候不查询User的数据（延迟加载）。</li><li>在Account的dao.xml配置返回值的时候将resultMap中的association添加select明确是使用延迟加载来查询User属性。</li></ol></blockquote><p><img src="https://gitee.com/tobing/imagebed/raw/master/my-6-1.png" class="lazyload" data-srcset="https://gitee.com/tobing/imagebed/raw/master/my-6-1.png" srcset="data:image/png;base64,666" alt="延迟加载"></p></li><li><p>编码</p><ol><li><p>给Account实体类中添加唯一User属性</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Account</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> uid;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">double</span> money;</span><br><span class="line">    <span class="keyword">private</span> User user; <span class="comment">// 唯一user</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol></li></ol><ol start="2"><li><p>在UserDao中添加根据id查询唯一User的抽象方法findById。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserDao</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">findById</span><span class="params">(Integer uid)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><ol start="3"><li><p>在AccountDao中添加findAll查询所有的方法。</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">public interface AccountDao &#123;</span><br><span class="line">    public List<span class="tag">&lt;<span class="name">Account</span>&gt;</span> findAll();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><ol start="4"><li><p>在AccountDao.xml中Mapper下添加关联findAll查询方法的配置。</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;top.tobing.dao.AccountDao&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;accountMap&quot;</span> <span class="attr">type</span>=<span class="string">&quot;top.tobing.domain.Account&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;aid&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;uid&quot;</span> <span class="attr">property</span>=<span class="string">&quot;uid&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;money&quot;</span> <span class="attr">property</span>=<span class="string">&quot;money&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">&quot;user&quot;</span> <span class="attr">javaType</span>=<span class="string">&quot;top.tobing.domain.User&quot;</span></span></span><br><span class="line"><span class="tag">                     <span class="attr">select</span>=<span class="string">&quot;top.tobing.dao.UserDao.findById&quot;</span> <span class="attr">column</span>=<span class="string">&quot;uid&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">association</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findAll&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;accountMap&quot;</span>&gt;</span></span><br><span class="line">        select * from account;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>此步骤在association中包含了select，可以实现按需加载User。</p></blockquote></li><li><p>在UserDao.xml中添加关联findById的方法。</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;top.tobing.dao.UserDao&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findById&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;top.tobing.domain.User&quot;</span>&gt;</span></span><br><span class="line">        select * from user where id = #&#123;uid&#125;;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>在测试方法中测试是否实现延迟加载</p><blockquote><p>不调用getUser等，与User信息相关的方法。</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">findAllTest</span><span class="params">()</span></span>&#123;</span><br><span class="line">      List&lt;Account&gt; accounts = accountDao.findAll();</span><br><span class="line">      <span class="keyword">for</span> (Account account : accounts) &#123;</span><br><span class="line">          System.out.println(account.getMoney());</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><blockquote><p>查询结果</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">2019-11-28 12:18:36,346 224    [           main] DEBUG ansaction.jdbc.JdbcTransaction  - Opening JDBC Connection</span><br><span class="line">2019-11-28 12:18:36,578 456    [           main] DEBUG source.pooled.PooledDataSource  - Created connection 1038677529.</span><br><span class="line">2019-11-28 12:18:36,578 456    [           main] DEBUG ansaction.jdbc.JdbcTransaction  - Setting autocommit to <span class="literal">false</span> on JDBC Connection [com.mysql.jdbc.JDBC4Connection@3de8f619]</span><br><span class="line">2019-11-28 12:18:36,582 460    [           main] DEBUG .tobing.dao.AccountDao.findAll  - ==&gt;  Preparing: select * from account; </span><br><span class="line">2019-11-28 12:18:36,617 495    [           main] DEBUG .tobing.dao.AccountDao.findAll  - ==&gt; Parameters: </span><br><span class="line">2019-11-28 12:18:36,673 551    [           main] DEBUG .tobing.dao.AccountDao.findAll  - &lt;==      Total: 6</span><br><span class="line">20000.0</span><br><span class="line">40000.0</span><br><span class="line">30000.0</span><br><span class="line">21000.0</span><br><span class="line">40000.0</span><br><span class="line">50000.0</span><br><span class="line">2019-11-28 12:18:36,675 553    [           main] DEBUG ansaction.jdbc.JdbcTransaction  - Resetting autocommit to <span class="literal">true</span> on JDBC Connection [com.mysql.jdbc.JDBC4Connection@3de8f619]</span><br><span class="line">2019-11-28 12:18:36,675 553    [           main] DEBUG ansaction.jdbc.JdbcTransaction  - Closing JDBC Connection [com.mysql.jdbc.JDBC4Connection@3de8f619]</span><br><span class="line">2019-11-28 12:18:36,676 554    [           main] DEBUG source.pooled.PooledDataSource  - Returned connection 1038677529 to pool.</span><br></pre></td></tr></table></figure><blockquote><p>只查询了一次。</p></blockquote></li></ol><pre><code>  &gt; id为42时，调用getUser方法  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">findAllTest</span><span class="params">()</span></span>&#123;</span><br><span class="line">      List&lt;Account&gt; accounts = accountDao.findAll();</span><br><span class="line">      <span class="keyword">for</span> (Account account : accounts) &#123;</span><br><span class="line">          System.out.println(account.getMoney());</span><br><span class="line">          <span class="keyword">if</span>(account.getUid()==<span class="number">42</span>)&#123;  <span class="comment">// 只有id为42才查询。</span></span><br><span class="line">              System.out.println(account.getUser());</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>  &gt; 只有id为42，才去执行查询User表（调用UserDao.xml中的findById）  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">User&#123;id=42, username=<span class="string">&#x27;Rongon&#x27;</span>, birthday=null, sex=<span class="string">&#x27;男&#x27;</span>, address=<span class="string">&#x27;江苏&#x27;</span>&#125;</span><br><span class="line">30000.0</span><br><span class="line">21000.0</span><br><span class="line">40000.0</span><br><span class="line">50000.0</span><br><span class="line">User&#123;id=42, username=<span class="string">&#x27;Rongon&#x27;</span>, birthday=null, sex=<span class="string">&#x27;男&#x27;</span>, address=<span class="string">&#x27;江苏&#x27;</span>&#125;</span><br></pre></td></tr></table></figure></code></pre><h3 id="5-练习：以第4为例，实现查询用户User表，延迟加载用户的Account信息。"><a href="#5-练习：以第4为例，实现查询用户User表，延迟加载用户的Account信息。" class="headerlink" title="5. 练习：以第4为例，实现查询用户User表，延迟加载用户的Account信息。"></a>5. 练习：以第4为例，实现查询用户User表，延迟加载用户的Account信息。</h3><ol><li><p>User表中添加关联的Account的字段。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="keyword">private</span> Date birthday;</span><br><span class="line">    <span class="keyword">private</span> String sex;</span><br><span class="line">    <span class="keyword">private</span> String address;</span><br><span class="line">    <span class="keyword">private</span> List&lt;Account&gt; accounts;<span class="comment">// 用户对应的多个账号</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><ol start="2"><li><p>AccountDao接口中添加按照uid查询多个Account的方法</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">AccountDao</span> </span>&#123;</span><br><span class="line">    <span class="function">List&lt;Account&gt; <span class="title">findAllByUid</span><span class="params">(Integer uid)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><ol start="3"><li><p>UserDao接口中添加按照查询所有的方法\</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserDao</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;User&gt; <span class="title">findAllAccount</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><ol start="4"><li><p>AccountDao.xml中添加AccountDao接口对应的方法的配置</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findAllByUid&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;top.tobing.domain.Account&quot;</span>&gt;</span></span><br><span class="line">     select * from account where uid = #&#123;id&#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ol><ol start="5"><li><p>UserDao.xml中添加UserDao接口对应的方法配置。</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;top.tobing.dao.UserDao&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;userMap&quot;</span> <span class="attr">type</span>=<span class="string">&quot;top.tobing.domain.User&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;username&quot;</span> <span class="attr">property</span>=<span class="string">&quot;username&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;birthday&quot;</span> <span class="attr">property</span>=<span class="string">&quot;birthday&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;address&quot;</span> <span class="attr">property</span>=<span class="string">&quot;address&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;sex&quot;</span> <span class="attr">property</span>=<span class="string">&quot;sex&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">&quot;accounts&quot;</span> <span class="attr">javaType</span>=<span class="string">&quot;List&quot;</span></span></span><br><span class="line"><span class="tag">   <span class="attr">select</span>=<span class="string">&quot;top.tobing.dao.AccountDao.findAllByUid&quot;</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">association</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findAllAccount&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;userMap&quot;</span>&gt;</span></span><br><span class="line">        select * from user;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">    </span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>注意：</p><ol><li>association中的javaType是account对应的数据类型（List<Account>）</li><li>association中的column参数是传给top/tobing/AccountDao.xml中的findAllByUid对应的mapper.</li></ol></blockquote></li><li><p>检验是否实现延迟查询</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">2019-11-28 16:21:04,172 501    [           main] DEBUG ing.dao.UserDao.findAllAccount  - ==&gt;  Preparing: select * from user; </span><br><span class="line">2019-11-28 16:21:04,207 536    [           main] DEBUG ing.dao.UserDao.findAllAccount  - ==&gt; Parameters: </span><br><span class="line">2019-11-28 16:21:04,261 590    [           main] DEBUG ing.dao.UserDao.findAllAccount  - &lt;==      Total: 6</span><br><span class="line">Tobing</span><br><span class="line">男</span><br><span class="line">==============================</span><br><span class="line">Rongon</span><br><span class="line">男</span><br><span class="line">==============================</span><br><span class="line">Zenyet</span><br><span class="line">男</span><br><span class="line">==============================</span><br><span class="line">尼古拉斯</span><br><span class="line">男</span><br><span class="line">==============================</span><br><span class="line">张无忌</span><br><span class="line">男</span><br><span class="line">==============================</span><br><span class="line">张三丰</span><br><span class="line">男</span><br><span class="line">==============================</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">2019-11-28 16:21:44,570 217    [           main] DEBUG ansaction.jdbc.JdbcTransaction  - Opening JDBC Connection</span><br><span class="line">2019-11-28 16:21:44,776 423    [           main] DEBUG source.pooled.PooledDataSource  - Created connection 1314838582.</span><br><span class="line">2019-11-28 16:21:44,776 423    [           main] DEBUG ansaction.jdbc.JdbcTransaction  - Setting autocommit to <span class="literal">false</span> on JDBC Connection [com.mysql.jdbc.JDBC4Connection@4e5ed836]</span><br><span class="line">2019-11-28 16:21:44,779 426    [           main] DEBUG ing.dao.UserDao.findAllAccount  - ==&gt;  Preparing: select * from user; </span><br><span class="line">2019-11-28 16:21:44,816 463    [           main] DEBUG ing.dao.UserDao.findAllAccount  - ==&gt; Parameters: </span><br><span class="line">2019-11-28 16:21:44,868 515    [           main] DEBUG ing.dao.UserDao.findAllAccount  - &lt;==      Total: 6</span><br><span class="line">Tobing</span><br><span class="line">男</span><br><span class="line">2019-11-28 16:21:44,869 516    [           main] DEBUG ng.dao.AccountDao.findAllByUid  - ==&gt;  Preparing: select * from account <span class="built_in">where</span> uid = ?; </span><br><span class="line">2019-11-28 16:21:44,870 517    [           main] DEBUG ng.dao.AccountDao.findAllByUid  - ==&gt; Parameters: 41(Integer)</span><br><span class="line">2019-11-28 16:21:44,871 518    [           main] DEBUG ng.dao.AccountDao.findAllByUid  - &lt;==      Total: 1</span><br><span class="line">[Account&#123;id=1, uid=41, money=20000.0&#125;]</span><br><span class="line">==============================</span><br><span class="line">Rongon</span><br><span class="line">男</span><br><span class="line">2019-11-28 16:21:44,880 527    [           main] DEBUG ng.dao.AccountDao.findAllByUid  - ==&gt;  Preparing: select * from account <span class="built_in">where</span> uid = ?; </span><br><span class="line">2019-11-28 16:21:44,881 528    [           main] DEBUG ng.dao.AccountDao.findAllByUid  - ==&gt; Parameters: 42(Integer)</span><br><span class="line">2019-11-28 16:21:44,882 529    [           main] DEBUG ng.dao.AccountDao.findAllByUid  - &lt;==      Total: 2</span><br><span class="line">[Account&#123;id=2, uid=42, money=40000.0&#125;, Account&#123;id=6, uid=42, money=50000.0&#125;]</span><br><span class="line">==============================</span><br><span class="line">Zenyet</span><br><span class="line">男</span><br><span class="line">2019-11-28 16:21:44,882 529    [           main] DEBUG ng.dao.AccountDao.findAllByUid  - ==&gt;  Preparing: select * from account <span class="built_in">where</span> uid = ?; </span><br><span class="line">2019-11-28 16:21:44,883 530    [           main] DEBUG ng.dao.AccountDao.findAllByUid  - ==&gt; Parameters: 43(Integer)</span><br><span class="line">2019-11-28 16:21:44,883 530    [           main] DEBUG ng.dao.AccountDao.findAllByUid  - &lt;==      Total: 1</span><br><span class="line">[Account&#123;id=3, uid=43, money=30000.0&#125;]</span><br><span class="line">==============================</span><br></pre></td></tr></table></figure></li></ol><h3 id="6-总结"><a href="#6-总结" class="headerlink" title="6. 总结"></a>6. 总结</h3><ol><li><p>与之前的立即相比。延迟加载在要延迟加载的association中添加了select、column等属性。</p><blockquote><p>select:用于指定调用那个方法执行查询延迟加载部分内容。</p><p>column：用于指定查询延迟加载部分的参数。</p><p>javaType：要合实体类一一对应。</p></blockquote></li><li><p>所谓延迟加载，在此处的体现是，根据需求，决定是否调用其他的方法（该方法可以实现查询延迟加载的部分数据）。</p></li></ol><h2 id="2-Mybatis中的缓存"><a href="#2-Mybatis中的缓存" class="headerlink" title="2.Mybatis中的缓存"></a>2.Mybatis中的缓存</h2><h3 id="1-缓存"><a href="#1-缓存" class="headerlink" title="1. 缓存"></a>1. 缓存</h3><blockquote><ol><li>What：存储在内存中临时数据。</li><li>Why：减少和数据库交互次数，提高执行效率。</li><li>When：<ol><li>使用缓存：数据经常查询、数据不经常改变、数据正确性对最终结果影响不大。</li><li>不使用缓存：数据经常改变、数据正确性对最终结果影响很大（例如：商品库存、银行汇率、股市牌价等）</li></ol></li></ol></blockquote><h3 id="2-Mybatis中缓存机制"><a href="#2-Mybatis中缓存机制" class="headerlink" title="2. Mybatis中缓存机制"></a>2. Mybatis中缓存机制</h3><blockquote><ol><li>一级缓存：<ul><li>是指Mybatis中SqlSession对象的缓存</li><li>当我们执行查询后，查询的结果会存入到SqlSession对象提供的一块区域中（一个Map）。</li><li>当我们查询同样的数据时，Mybatis会先去SqlSession中的区域找，如果存在直接拿来用。</li><li>因为一级缓存保存在SqlSession，所以当SqlSession对象消失，一级缓存自动消失。</li></ul></li><li>二级缓存：<ul><li>是指存储在SqlSessionFactory对象的缓存。由同一个SqlSessionFactory对象创建的SqlSession共享其缓存。</li><li>Mybatis默认不开启二级缓存</li><li>SqlSession执行相同Mapper映射下sql，执行commit提交，将会清空Mapper映射下的二级缓存</li><li></li></ul></li></ol></blockquote><p><img src="https://gitee.com/tobing/imagebed/raw/master/my-6-2.png" class="lazyload" data-srcset="https://gitee.com/tobing/imagebed/raw/master/my-6-2.png" srcset="data:image/png;base64,666" alt="缓存机制"></p><h3 id="3-一级缓存"><a href="#3-一级缓存" class="headerlink" title="3. 一级缓存"></a>3. 一级缓存</h3><blockquote><ul><li><p>Mybatis中默认开启一级缓存</p></li><li><p>验证步骤</p><ol><li>创建User、UserDao、UserDao.xml</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="keyword">private</span> Date birthday;</span><br><span class="line">    <span class="keyword">private</span> String sex;</span><br><span class="line">    <span class="keyword">private</span> String address;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><ol start="2"><li><p>UserDao中添加一个用于查询的查询方法</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserDao</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">findById</span><span class="params">(<span class="keyword">int</span> id)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><ol start="3"><li><p>UserDao.xml配置查询的SQL语句</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;top.tobing.dao.UserDao&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findById&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;top.tobing.domain.User&quot;</span>&gt;</span></span><br><span class="line">        select * from user where id = #&#123;id&#125; ;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>验证缓存查询结果</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">findByIdTest</span><span class="params">()</span></span>&#123;</span><br><span class="line">     User user = userDao.findById(<span class="number">44</span>);  <span class="comment">// 第一次查询</span></span><br><span class="line">     System.out.println(user);</span><br><span class="line">     User user1 = userDao.findById(<span class="number">44</span>);  <span class="comment">// 第二次查询</span></span><br><span class="line">     System.out.println(user1);</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">DEBUG op.tobing.dao.UserDao.findById  - ==&gt;  Preparing: select * from user <span class="built_in">where</span> id = ? ; </span><br><span class="line">DEBUG op.tobing.dao.UserDao.findById  - ==&gt; Parameters: 44(Integer)</span><br><span class="line">DEBUG op.tobing.dao.UserDao.findById  - &lt;==      Total: 1</span><br><span class="line">top.tobing.domain.User@7fd7a283</span><br><span class="line">top.tobing.domain.User@7fd7a283</span><br></pre></td></tr></table></figure><blockquote><p>两次查询出来的对象地址相同</p></blockquote></li><li><p>验证清楚缓存</p><blockquote><p>调用clearCache、close等方法。</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">findByIdTest</span><span class="params">()</span></span>&#123;</span><br><span class="line">        User user = userDao.findById(<span class="number">44</span>);  <span class="comment">// 第一次查询</span></span><br><span class="line">        System.out.println(user);</span><br><span class="line">        <span class="comment">// 再次获取session</span></span><br><span class="line"><span class="comment">//        session.close();</span></span><br><span class="line"><span class="comment">//        session = factory.openSession();</span></span><br><span class="line"><span class="comment">//        userDao = session.getMapper(UserDao.class);</span></span><br><span class="line">        <span class="comment">// 另外一种方式清空数据</span></span><br><span class="line">       session.clearCache();</span><br><span class="line"></span><br><span class="line">        User user1 = userDao.findById(<span class="number">44</span>);  <span class="comment">// 第二次查询</span></span><br><span class="line">        System.out.println(user1);</span><br></pre></td></tr></table></figure><blockquote><p>结果查询了两次</p></blockquote><blockquote><p>调用了commit更新等操作。</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">firstCacheTest</span><span class="params">()</span></span>&#123;</span><br><span class="line">     User user = userDao.findById(<span class="number">44</span>);  <span class="comment">// 第一次查询</span></span><br><span class="line">     System.out.println(user);</span><br><span class="line">     user.setUsername(<span class="string">&quot;CacheTest&quot;</span>);</span><br><span class="line">     userDao.updateUser(user);</span><br><span class="line">     user = userDao.findById(<span class="number">44</span>);</span><br><span class="line">     System.out.println(user);</span><br><span class="line">     System.out.println(<span class="string">&quot;--------------&quot;</span>);</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><blockquote><p>此处也会跳过缓存，直接查询。</p></blockquote></li></ol></blockquote><h3 id="4-二级缓存"><a href="#4-二级缓存" class="headerlink" title="4. 二级缓存"></a>4. 二级缓存</h3><blockquote><p>同一个SqlSessionFactory得到的SqlSession可以共享二级缓存数据。</p></blockquote><blockquote><p>使用步骤：</p><ol><li>SqlMapConfig中开启二级缓存</li><li>Mapper中开启二级缓存</li><li>statement中使用二级缓存</li></ol></blockquote><ol><li><p>SQLMapConfig开启二级缓存</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--开启二级缓存--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">settings</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;cacheEnable&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">settings</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ol><ol start="2"><li><p>Mapper中开启二级缓存、statement使用二级缓存</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;top.tobing.dao.UserDao&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--Mapper开启缓存--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">cache</span>&gt;</span><span class="tag">&lt;/<span class="name">cache</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--查询时使用缓存--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findById&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;top.tobing.domain.User&quot;</span> <span class="attr">useCache</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">        select * from user where id = #&#123;id&#125; ;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>检验结果</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">secondCacheTest</span><span class="params">()</span></span>&#123;</span><br><span class="line">    SqlSession sqlSession1 = factory.openSession();</span><br><span class="line">    UserDao userDao1 = sqlSession1.getMapper(UserDao.class);</span><br><span class="line">    User user1 = userDao1.findById(<span class="number">44</span>);</span><br><span class="line">    System.out.println(user1);</span><br><span class="line">    sqlSession1.close();</span><br><span class="line">   </span><br><span class="line">    SqlSession sqlSession2 = factory.openSession();</span><br><span class="line">    UserDao userDao2 = sqlSession2.getMapper(UserDao.class);</span><br><span class="line">    User user2 = userDao2.findById(<span class="number">44</span>);</span><br><span class="line">    System.out.println(user2);</span><br><span class="line">    sqlSession2.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>结果显示查询了一次。</p></blockquote></li></ol><h3 id="5-总结"><a href="#5-总结" class="headerlink" title="5. 总结"></a>5. 总结</h3><blockquote><ul><li>缓存是可以数据库开销。</li><li>Mybatis中有两种缓存：一级缓存和二级缓存</li><li>一级缓存作用范围在SqlSession中，SqlSession，commit（增删改）会清空缓存。</li><li>二级缓存作用范围在SqlSessionFactory，即是一个SqlSessionFactory生产出来的SqlSession共享同一二级缓存。</li><li>二级缓存会随着同一mapper任意一个SqlSession进行了commit而清空</li><li>一级缓存不需要手动开启。</li><li>二级缓存需要设置SqlMapConfig、Mapper、和要查询的方法。</li></ul></blockquote>]]></content>
      
      
      <categories>
          
          <category> 理论学习 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Mybatis </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Mybatis-5-多表查询2</title>
      <link href="2019/11/23/Mybatis-5-%E5%A4%9A%E8%A1%A8%E6%9F%A5%E8%AF%A22/"/>
      <url>2019/11/23/Mybatis-5-%E5%A4%9A%E8%A1%A8%E6%9F%A5%E8%AF%A22/</url>
      
        <content type="html"><![CDATA[<p>Mybatis学习第五弹。</p><a id="more"></a><h1 id="Mybatis-5-多表查询2"><a href="#Mybatis-5-多表查询2" class="headerlink" title="Mybatis-5-多表查询2"></a>Mybatis-5-多表查询2</h1><h2 id="1-多对多"><a href="#1-多对多" class="headerlink" title="1. 多对多"></a>1. 多对多</h2><h3 id="1-开发步骤"><a href="#1-开发步骤" class="headerlink" title="1. 开发步骤"></a>1. 开发步骤</h3><blockquote><ol><li>建表</li><li>创建Maven工程</li><li>添加坐标文件</li><li>编写SqlMapConfig文件</li><li>创建实体类</li><li>创建实体类对应的Dao</li><li>创建Dao对应的配置文件</li><li>编写测试类</li></ol></blockquote><h3 id="1-建表"><a href="#1-建表" class="headerlink" title="1. 建表"></a>1. 建表</h3><blockquote><ol><li>模拟用户角色</li><li>分析：一个用户有多个角色（一个人有学生、儿子、朋友等角色），一个角色可以赋予给多个用户（学生可以是很多人等）</li></ol></blockquote><blockquote><ol start="3"><li>创建三张表：Role表、User表、用户角色管理表</li></ol></blockquote><p><img src="https://gitee.com/tobing/imagebed/raw/master/my-5-table.png" class="lazyload" data-srcset="https://gitee.com/tobing/imagebed/raw/master/my-5-table.png" srcset="data:image/png;base64,666" alt="my-5-table"></p><h3 id="2-创建Maven工程（略）"><a href="#2-创建Maven工程（略）" class="headerlink" title="2. 创建Maven工程（略）"></a>2. 创建Maven工程（略）</h3><h3 id="3-添加坐标文件"><a href="#3-添加坐标文件" class="headerlink" title="3. 添加坐标文件"></a>3. 添加坐标文件</h3><blockquote><p>给pom文件添加：mysql，mybatis，dom4j，log4j，junit等坐标。</p></blockquote><h3 id="4-编写SqlMapConfig文件"><a href="#4-编写SqlMapConfig文件" class="headerlink" title="4. 编写SqlMapConfig文件"></a>4. 编写SqlMapConfig文件</h3><blockquote><p>在resources文件夹下创建<code>SqlMapConfig.xml</code>，添加约束，编写MySQL的配置。</p></blockquote><h3 id="5-创建实体类"><a href="#5-创建实体类" class="headerlink" title="5. 创建实体类"></a>5. 创建实体类</h3><blockquote><p>根据创建的表，创建对应实体类User、Role</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 用户表</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="keyword">private</span> Date birthday;</span><br><span class="line">    <span class="keyword">private</span> String sex;</span><br><span class="line">    <span class="keyword">private</span> String address;</span><br><span class="line">    <span class="comment">// 存放多一个用户多个角色</span></span><br><span class="line">   <span class="keyword">private</span> List&lt;Role&gt; roles;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 角色表</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Role</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> String roleName;</span><br><span class="line">    <span class="keyword">private</span> String roleDesc;</span><br><span class="line">    <span class="keyword">private</span> List&lt;User&gt; users;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="6-创建实体类对应的Dao"><a href="#6-创建实体类对应的Dao" class="headerlink" title="6. 创建实体类对应的Dao"></a>6. 创建实体类对应的Dao</h3><blockquote><p>根据需求编写抽象方法</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">RoleDao</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 查询所有角色</span></span><br><span class="line">    <span class="function">List&lt;Role&gt; <span class="title">findAll</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserDao</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 查询所有用户</span></span><br><span class="line">    <span class="function">List&lt;User&gt; <span class="title">findAll</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="7-创建Dao对应配置文件"><a href="#7-创建Dao对应配置文件" class="headerlink" title="7. 创建Dao对应配置文件"></a>7. 创建Dao对应配置文件</h3><blockquote><p>resources下创建top/tobing/dao(与包名对应)目录，在目录下创建dao对应配置文件</p></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;top.tobing.dao.UserDao&quot;</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!--数据库表名与对应实体类一致--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findAll&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;top.tobing.domain.User&quot;</span>&gt;</span></span><br><span class="line">        SELECT * from user;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;top.tobing.dao.RoleDao&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--建立数据库【表列名】以及对应的【实体类字段】关系--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;roleMap&quot;</span> <span class="attr">type</span>=<span class="string">&quot;top.tobing.domain.Role&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;role_name&quot;</span> <span class="attr">property</span>=<span class="string">&quot;roleName&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;role_desc&quot;</span> <span class="attr">property</span>=<span class="string">&quot;roleDesc&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--数据库表名与对应实体类不一致--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findAll&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;roleMap&quot;</span>&gt;</span></span><br><span class="line">        SELECT * from role ;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li>注意：由于Role表与数据库的表名称不一致，因此需要通过建立resutlMap关联数据库表列名和实体类字段名称。</li></ul><p><img src="https://gitee.com/tobing/imagebed/raw/master/my-5-resultMap%E5%AF%B9%E5%BA%94%E5%85%B3%E7%B3%BB.png" class="lazyload" data-srcset="https://gitee.com/tobing/imagebed/raw/master/my-5-resultMap%E5%AF%B9%E5%BA%94%E5%85%B3%E7%B3%BB.png" srcset="data:image/png;base64,666" alt="resultMap对应关系"></p><h3 id="8-编写测试类测试"><a href="#8-编写测试类测试" class="headerlink" title="8. 编写测试类测试"></a>8. 编写测试类测试</h3><blockquote><p>test目录下，创建top.tobing.test包，创建对应Dao的测试类</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 通用初始化</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RoleDaoTest</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> InputStream in;</span><br><span class="line">    <span class="keyword">private</span> SqlSession session;</span><br><span class="line">    <span class="keyword">private</span> RoleDao roleDao;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 初始化方法</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Before</span>   <span class="comment">// 在方法执行前执行</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            <span class="comment">//1.读取配置文件</span></span><br><span class="line">            in = Resources.getResourceAsStream(<span class="string">&quot;SqlMapConfig.xml&quot;</span>);</span><br><span class="line">            <span class="comment">//2.创建工厂类</span></span><br><span class="line">            SqlSessionFactory factory =<span class="keyword">new</span> SqlSessionFactoryBuilder().build(in);</span><br><span class="line">            <span class="comment">//3.生产SqlSession对象</span></span><br><span class="line">            session = factory.openSession();</span><br><span class="line">            <span class="comment">//4.获取代理对象</span></span><br><span class="line">            roleDao = session.getMapper(RoleDao.class);</span><br><span class="line">        &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 释放资源</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@After</span>  <span class="comment">// 在方法执行之后执行</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">destroy</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        session.commit(); <span class="comment">// 此处记得提交事务</span></span><br><span class="line">        session.close();</span><br><span class="line">        in.close();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// RoleDao</span></span><br><span class="line"> <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">findAll</span><span class="params">()</span></span>&#123;</span><br><span class="line">        List&lt;Role&gt; roles = roleDao.findAll();</span><br><span class="line">        <span class="keyword">for</span> (Role role : roles) &#123;</span><br><span class="line">            System.out.println(role);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查询结果</span></span><br><span class="line">Role&#123;id=1, roleName=<span class="string">&#x27;院长&#x27;</span>, roleDesc=<span class="string">&#x27;管理整个学院&#x27;</span>&#125;</span><br><span class="line">Role&#123;id=2, roleName=<span class="string">&#x27;总裁&#x27;</span>, roleDesc=<span class="string">&#x27;管理整个公司&#x27;</span>&#125;</span><br><span class="line">Role&#123;id=3, roleName=<span class="string">&#x27;校长&#x27;</span>, roleDesc=<span class="string">&#x27;管理整个学院&#x27;</span>&#125;</span><br></pre></td></tr></table></figure><h3 id="9-案例实现多对多查询"><a href="#9-案例实现多对多查询" class="headerlink" title="9. 案例实现多对多查询"></a>9. 案例实现多对多查询</h3><ol><li><p>开发步骤</p><blockquote><ol><li>业务需求</li><li>根据业务需求分析出SQL语句</li><li>编写Dao、Dao配置文件</li><li>测试方法</li><li>检验结果</li></ol></blockquote></li><li><p>需求一</p><blockquote><p>需求：实现查询所有角色，包含其对应的用户信息</p></blockquote><ol><li>编写SQL</li></ol><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">r.*,</span><br><span class="line">u.id uid,<span class="comment">-- 给id起别名，防止查询得到的表的结果冲突</span></span><br><span class="line">u.username,</span><br><span class="line">u.birthday,</span><br><span class="line">u.sex,</span><br><span class="line">u.address</span><br><span class="line"><span class="keyword">FROM</span> </span><br><span class="line"><span class="keyword">role</span> r</span><br><span class="line"><span class="keyword">INNER</span> <span class="keyword">JOIN</span> </span><br><span class="line">user_role ur</span><br><span class="line"><span class="keyword">ON</span> (ur.rid = r.id)</span><br><span class="line"><span class="keyword">INNER</span> <span class="keyword">JOIN</span> </span><br><span class="line"><span class="keyword">USER</span> u</span><br><span class="line"><span class="keyword">ON</span> (ur.uid = u.id )<span class="comment">-- 条件</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><ol start="2"><li>编写Dao接口</li></ol><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">public interface RoleDao &#123;</span><br><span class="line">    List<span class="tag">&lt;<span class="name">Role</span>&gt;</span> findAll();</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ol start="3"><li>编写Dao对应配置文件</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">&lt;mapper namespace=<span class="string">&quot;top.tobing.dao.RoleDao&quot;</span>&gt;</span><br><span class="line">    &lt;!--建立数据库【表列名】以及对应的【实体类字段】关系--&gt;</span><br><span class="line">    &lt;resultMap id=<span class="string">&quot;roleMap&quot;</span> type=<span class="string">&quot;top.tobing.domain.Role&quot;</span>&gt;</span><br><span class="line">        &lt;id column=<span class="string">&quot;id&quot;</span> property=<span class="string">&quot;id&quot;</span>/&gt;</span><br><span class="line">        &lt;result column=<span class="string">&quot;role_name&quot;</span> property=<span class="string">&quot;roleName&quot;</span>/&gt;</span><br><span class="line">        &lt;result column=<span class="string">&quot;role_desc&quot;</span> property=<span class="string">&quot;roleDesc&quot;</span>/&gt;</span><br><span class="line">        &lt;collection property=<span class="string">&quot;users&quot;</span> ofType=<span class="string">&quot;top.tobing.domain.User&quot;</span>&gt;</span><br><span class="line">            &lt;id column=<span class="string">&quot;uid&quot;</span> property=<span class="string">&quot;id&quot;</span>/&gt;</span><br><span class="line">            &lt;result column=<span class="string">&quot;username&quot;</span> property=<span class="string">&quot;username&quot;</span>/&gt;</span><br><span class="line">            &lt;result column=<span class="string">&quot;birthday&quot;</span> property=<span class="string">&quot;birthday&quot;</span>/&gt;</span><br><span class="line">            &lt;result column=<span class="string">&quot;sex&quot;</span> property=<span class="string">&quot;sex&quot;</span>/&gt;</span><br><span class="line">            &lt;result column=<span class="string">&quot;address&quot;</span> property=<span class="string">&quot;address&quot;</span>/&gt;</span><br><span class="line">        &lt;/collection&gt;</span><br><span class="line">    &lt;/resultMap&gt;</span><br><span class="line">    &lt;!--数据库表名与对应实体类一致--&gt;</span><br><span class="line">    &lt;select id=<span class="string">&quot;findAll&quot;</span> resultMap=<span class="string">&quot;roleMap&quot;</span>&gt;</span><br><span class="line">    SELECT</span><br><span class="line">        r.id,</span><br><span class="line">        r.`role_desc`,</span><br><span class="line">        r.`role_name`,</span><br><span class="line">        u.id uid,-- 给id起别名，防止查询得到的表的结果冲突</span><br><span class="line">        u.username,</span><br><span class="line">        u.birthday,</span><br><span class="line">        u.sex,</span><br><span class="line">        u.address</span><br><span class="line">    FROM</span><br><span class="line">        role r</span><br><span class="line">    INNER JOIN</span><br><span class="line">        user_role ur</span><br><span class="line">    ON (ur.rid = r.id)</span><br><span class="line">    INNER JOIN</span><br><span class="line">        USER u</span><br><span class="line">    ON (ur.uid = u.id )</span><br><span class="line">    &lt;/select&gt;</span><br><span class="line">&lt;/mapper&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ol start="4"><li>测试</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">findAll</span><span class="params">()</span></span>&#123;</span><br><span class="line">      List&lt;Role&gt; roles = roleDao.findAll();</span><br><span class="line">      <span class="keyword">for</span> (Role role : roles) &#123;</span><br><span class="line">          System.out.println(<span class="string">&quot;-------------------------&quot;</span>);</span><br><span class="line">          System.out.println(role);</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line">   </span><br></pre></td></tr></table></figure><ol start="5"><li>检测结果</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">-------------------------</span><br><span class="line">Role&#123;id=1, roleName=<span class="string">&#x27;院长&#x27;</span>, roleDesc=<span class="string">&#x27;管理整个学院&#x27;</span>, users=[User&#123;id=41, username=<span class="string">&#x27;Tobing&#x27;</span>, birthday=null, sex=<span class="string">&#x27;男&#x27;</span>, address=<span class="string">&#x27;四川&#x27;</span>, roles=null&#125;, User&#123;id=45, username=<span class="string">&#x27;张无忌&#x27;</span>, birthday=null, sex=<span class="string">&#x27;男&#x27;</span>, address=<span class="string">&#x27;广东&#x27;</span>, roles=null&#125;]&#125;</span><br><span class="line">-------------------------</span><br><span class="line">Role&#123;id=2, roleName=<span class="string">&#x27;总裁&#x27;</span>, roleDesc=<span class="string">&#x27;管理整个公司&#x27;</span>, users=[User&#123;id=41, username=<span class="string">&#x27;Tobing&#x27;</span>, birthday=null, sex=<span class="string">&#x27;男&#x27;</span>, address=<span class="string">&#x27;四川&#x27;</span>, roles=null&#125;]&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li><p>需求二</p><blockquote><p>查询所有的用户，包含其角色</p></blockquote><ol><li><p>SQL语句</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">u.*,</span><br><span class="line">r.<span class="string">`id`</span>,</span><br><span class="line">r.<span class="string">`role_desc`</span>,</span><br><span class="line">r.<span class="string">`role_name`</span></span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line"><span class="keyword">USER</span> u</span><br><span class="line"><span class="keyword">INNER</span> <span class="keyword">JOIN</span> </span><br><span class="line">user_role ur</span><br><span class="line"><span class="keyword">ON</span> (ur.uid = u.<span class="string">`id`</span>)</span><br><span class="line"><span class="keyword">INNER</span> <span class="keyword">JOIN</span> </span><br><span class="line"><span class="keyword">role</span> r</span><br><span class="line"><span class="keyword">ON</span> (r.<span class="string">`id`</span> = ur.<span class="string">`rid`</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li><p>Dao接口</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserDao</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 查询所有用户</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">List&lt;User&gt; <span class="title">findAll</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li><p>Dao接口配置文件</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;top.tobing.dao.UserDao&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;userMap&quot;</span> <span class="attr">type</span>=<span class="string">&quot;top.tobing.domain.User&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;username&quot;</span> <span class="attr">property</span>=<span class="string">&quot;username&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;birthday&quot;</span> <span class="attr">property</span>=<span class="string">&quot;birthday&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;sex&quot;</span> <span class="attr">property</span>=<span class="string">&quot;sex&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;address&quot;</span> <span class="attr">property</span>=<span class="string">&quot;address&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">&quot;roles&quot;</span> <span class="attr">ofType</span>=<span class="string">&quot;top.tobing.domain.Role&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;role_desc&quot;</span> <span class="attr">property</span>=<span class="string">&quot;roleDesc&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;role_name&quot;</span> <span class="attr">property</span>=<span class="string">&quot;roleName&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">collection</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--数据库表名与对应实体类一致--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findAll&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;userMap&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">SELECT</span><br><span class="line">u.*,</span><br><span class="line">r.`id`,</span><br><span class="line">r.`role_desc`,</span><br><span class="line">r.`role_name`</span><br><span class="line">FROM</span><br><span class="line">USER u</span><br><span class="line">INNER JOIN</span><br><span class="line">user_role ur</span><br><span class="line">ON (ur.uid = u.`id`)</span><br><span class="line">INNER JOIN</span><br><span class="line">role r</span><br><span class="line">ON (r.`id` = ur.`rid`)</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li><p>测试</p></li><li><p>检验</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">-------------</span><br><span class="line">User&#123;id&#x3D;41, username&#x3D;&#39;Tobing&#39;, birthday&#x3D;null, sex&#x3D;&#39;男&#39;, address&#x3D;&#39;四川&#39;, roles&#x3D;[Role&#123;id&#x3D;41, roleName&#x3D;&#39;院长&#39;, roleDesc&#x3D;&#39;管理整个学院&#39;, users&#x3D;null&#125;]&#125;</span><br><span class="line">-------------</span><br><span class="line">User&#123;id&#x3D;45, username&#x3D;&#39;张无忌&#39;, birthday&#x3D;null, sex&#x3D;&#39;男&#39;, address&#x3D;&#39;广东&#39;, roles&#x3D;[Role&#123;id&#x3D;45, roleName&#x3D;&#39;院长&#39;, roleDesc&#x3D;&#39;管理整个学院&#39;, users&#x3D;null&#125;]&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li></ol></li></ol><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><blockquote><ol><li>多表查询的难点在于把需求转换为SQL语句</li><li>把SQL写出来，根据查询得到的数据，可以轻易写出Dao.xml配置文件。</li></ol></blockquote>]]></content>
      
      
      <categories>
          
          <category> 理论学习 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Mybatis </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Mybatis-4-多表查询1</title>
      <link href="2019/11/23/Mybatis-4-%E5%A4%9A%E8%A1%A8%E6%9F%A5%E8%AF%A21/"/>
      <url>2019/11/23/Mybatis-4-%E5%A4%9A%E8%A1%A8%E6%9F%A5%E8%AF%A21/</url>
      
        <content type="html"><![CDATA[<p>Mybatis学习第四弹。</p><a id="more"></a><h1 id="Mybatis-4-多表查询1"><a href="#Mybatis-4-多表查询1" class="headerlink" title="Mybatis-4-多表查询1"></a>Mybatis-4-多表查询1</h1><blockquote><p> 表之间的关系：多对一、一对多、多对多。</p></blockquote><h2 id="Mybatis中多表查询的步骤"><a href="#Mybatis中多表查询的步骤" class="headerlink" title="Mybatis中多表查询的步骤"></a>Mybatis中多表查询的步骤</h2><ol><li><p>建表</p></li><li><p>构建对应的实体类</p></li><li><p>建立对应的配置文件</p></li><li><p>实现配置：查询A表时可以得到A中包含B表的信息，反之亦然。</p></li></ol><h2 id="1-一对一方式一"><a href="#1-一对一方式一" class="headerlink" title="1. 一对一方式一"></a>1. 一对一方式一</h2><blockquote><p>需求：查询使用账户信息，关联查询下单的用户信息。    </p></blockquote><ol><li><p>建表</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 创建user表</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> <span class="keyword">USER</span> ;<span class="comment">-- 如果存在则删除该表</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="keyword">USER</span>(</span><br><span class="line"><span class="keyword">id</span> <span class="built_in">INT</span> PRIMARY <span class="keyword">KEY</span> AUTO_INCREMENT,</span><br><span class="line">username <span class="built_in">VARCHAR</span>(<span class="number">32</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> ,</span><br><span class="line">birthday <span class="built_in">DATE</span>,</span><br><span class="line">sex <span class="built_in">CHAR</span>(<span class="number">1</span>) ,</span><br><span class="line">address <span class="built_in">VARCHAR</span>(<span class="number">256</span>)</span><br><span class="line">);</span><br><span class="line"><span class="comment">-- 创建account表</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> <span class="keyword">account</span>;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="keyword">account</span>(</span><br><span class="line"><span class="keyword">id</span> <span class="built_in">INT</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> PRIMARY <span class="keyword">KEY</span> AUTO_INCREMENT,</span><br><span class="line">uid <span class="built_in">INT</span> ,</span><br><span class="line">money <span class="keyword">DOUBLE</span>,</span><br><span class="line"><span class="keyword">FOREIGN</span> <span class="keyword">KEY</span>(uid) <span class="keyword">REFERENCES</span> <span class="keyword">USER</span>(<span class="keyword">id</span>)</span><br><span class="line">);</span><br><span class="line"><span class="comment">-- 给user添加数据</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="keyword">USER</span> <span class="keyword">VALUES</span></span><br><span class="line">(<span class="number">41</span>,<span class="string">&#x27;Tobing&#x27;</span>,<span class="literal">NULL</span>,<span class="string">&#x27;男&#x27;</span>,<span class="string">&#x27;四川&#x27;</span>),</span><br><span class="line">(<span class="literal">NULL</span>,<span class="string">&#x27;Rongon&#x27;</span>,<span class="literal">NULL</span>,<span class="string">&#x27;男&#x27;</span>,<span class="string">&#x27;江苏&#x27;</span>),</span><br><span class="line">(<span class="literal">NULL</span>,<span class="string">&#x27;Zenyet&#x27;</span>,<span class="literal">NULL</span>,<span class="string">&#x27;男&#x27;</span>,<span class="string">&#x27;广东&#x27;</span>),</span><br><span class="line">(<span class="literal">NULL</span>,<span class="string">&#x27;尼古拉斯&#x27;</span>,<span class="literal">NULL</span>,<span class="string">&#x27;男&#x27;</span>,<span class="string">&#x27;英国&#x27;</span>);</span><br><span class="line"><span class="comment">-- 给account添加数据</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="keyword">account</span> <span class="keyword">VALUES</span></span><br><span class="line">(<span class="number">1</span>,<span class="number">41</span>,<span class="number">20000</span>),(<span class="number">2</span>,<span class="number">42</span>,<span class="number">40000</span>),</span><br><span class="line">(<span class="number">3</span>,<span class="number">43</span>,<span class="number">30000</span>),(<span class="number">4</span>,<span class="number">44</span>,<span class="number">21000</span>);</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="https://gitee.com/tobing/imagebed/raw/master/my-4-table.png" class="lazyload" data-srcset="https://gitee.com/tobing/imagebed/raw/master/my-4-table.png" srcset="data:image/png;base64,666" alt="my-4-table"></p></li><li><p>构建实体类</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// account表实体类</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Account</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> uid;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">double</span> money;</span><br><span class="line"> <span class="comment">//setter and getter .....    </span></span><br><span class="line">    <span class="comment">//toString</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// User表实体类</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="keyword">private</span> Date birthday;</span><br><span class="line">    <span class="keyword">private</span> String sex;</span><br><span class="line">    <span class="keyword">private</span> String address;</span><br><span class="line"><span class="comment">//setter and getter .....    </span></span><br><span class="line">    <span class="comment">//toString</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 一对一多表查询结果的实体类</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AccountUser</span> <span class="keyword">extends</span> <span class="title">Account</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> uid;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">double</span> money;</span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="keyword">private</span> String address;</span><br><span class="line">    <span class="comment">//setter and getter .....    </span></span><br><span class="line">    <span class="comment">//toString</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>建立配置文件</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserDao</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;User&gt; <span class="title">findAll</span><span class="params">()</span></span>;<span class="comment">// 查询所有的用户</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">findById</span><span class="params">(<span class="keyword">int</span> id)</span></span>;<span class="comment">// 通过id查询用户</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;top.tobing.dao.UserDao&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findAll&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;top.tobing.domain.User&quot;</span>&gt;</span></span><br><span class="line">        SELECT * from user ;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findById&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;top.tobing.domain.User&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;java.lang.Integer&quot;</span>&gt;</span></span><br><span class="line">        select * from user where id = #&#123;id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">AccountDao</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;AccountUser&gt; <span class="title">findAll</span><span class="params">()</span></span>;<span class="comment">// 多表查询用户以及账户信息</span></span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;top.tobing.dao.AccountDao&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findAll&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;top.tobing.domain.AccountUser&quot;</span>&gt;</span></span><br><span class="line">         SELECT account.*,user.username,user.address FROM account,USER WHERE account.uid = user.id;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>执行操作</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">// 申请资源</span></span><br><span class="line"><span class="comment">// 释放资源</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">findAllTest</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">       <span class="comment">//5.执行查询语句</span></span><br><span class="line">       List&lt;AccountUser&gt; accountUsers = accountDao.findAll();</span><br><span class="line">       <span class="comment">//6.遍历输出</span></span><br><span class="line">       <span class="keyword">for</span>(AccountUser au:accountUsers)&#123;</span><br><span class="line">           System.out.println(au);</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><blockquote><p>关键：写出多表查询的SQL语句，根据sql语句编写配置文件。</p></blockquote></li></ol><h2 id="2-方式二一对一"><a href="#2-方式二一对一" class="headerlink" title="2. 方式二一对一"></a>2. 方式二一对一</h2><blockquote><ol><li>建表</li><li>构建实体类</li><li>编写Dao接口</li><li>编写接口对应的配置文件</li><li>使用Test查询</li></ol></blockquote><ol start="2"><li><p>构建实体类</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="keyword">private</span> Date birthday;</span><br><span class="line">    <span class="keyword">private</span> String sex;</span><br><span class="line">    <span class="keyword">private</span> String address;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Account</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> uid;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">double</span> money;</span><br><span class="line">    <span class="keyword">private</span> User user;<span class="comment">// 使用内置User对象的方式存放User数据</span></span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li><p>编写AccountDao接口</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 将多表查询到的数据直接封装到Account中</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> List&lt;Account&gt; <span class="title">findAllAccount</span><span class="params">()</span></span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li><p>编写接口对应的配置文件:AccountDao.xml</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;top.tobing.dao.AccountDao&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--Account内建User存储数据--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--建立对应关系--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;account&quot;</span> <span class="attr">type</span>=<span class="string">&quot;top.tobing.domain.Account&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--对应着Account表中的id，uid，money基本类型属性--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;aid&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;uid&quot;</span> <span class="attr">property</span>=<span class="string">&quot;uid&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;money&quot;</span> <span class="attr">property</span>=<span class="string">&quot;money&quot;</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--联系着表的实体类属性--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">&quot;user&quot;</span> <span class="attr">javaType</span>=<span class="string">&quot;top.tobing.domain.User&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;username&quot;</span> <span class="attr">property</span>=<span class="string">&quot;username&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;sex&quot;</span> <span class="attr">property</span>=<span class="string">&quot;sex&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;birthday&quot;</span> <span class="attr">property</span>=<span class="string">&quot;birthday&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;address&quot;</span> <span class="attr">property</span>=<span class="string">&quot;address&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">association</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findAllAccount&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;account&quot;</span>&gt;</span></span><br><span class="line">        select</span><br><span class="line">            u.*,a.id as aid,a.uid,a.money</span><br><span class="line">        from</span><br><span class="line">            account a,user u</span><br><span class="line">        where</span><br><span class="line">            a.uid = u.id;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><blockquote><p>resultMap 标签可以建立查询的列名和实体类的属性名称不一致时建立对应关系。从而实现封装。</p></blockquote><blockquote><p>说明</p></blockquote><p><img src="https://gitee.com/tobing/imagebed/raw/master/my-4-resultMap.png" class="lazyload" data-srcset="https://gitee.com/tobing/imagebed/raw/master/my-4-resultMap.png" srcset="data:image/png;base64,666" alt="resultMap"></p></li><li><p>使用Test查询测试</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">findAllAccountTest</span><span class="params">()</span></span>&#123;</span><br><span class="line">    List&lt;Account&gt; list = accountDao.findAllAccount();</span><br><span class="line">    <span class="keyword">for</span> (Account account : list) &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;------------------------------&quot;</span>);</span><br><span class="line">        System.out.println(account.getUser());</span><br><span class="line">        System.out.println(account);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">   </span><br></pre></td></tr></table></figure></li><li><p>运行结果</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">------------------------------</span><br><span class="line">User&#123;id=41, username=<span class="string">&#x27;Tobing&#x27;</span>, birthday=null, sex=<span class="string">&#x27;男&#x27;</span>, address=<span class="string">&#x27;四川&#x27;</span>&#125;</span><br><span class="line">Account&#123;id=1, uid=41, money=20000.0&#125;</span><br><span class="line">------------------------------</span><br><span class="line">User&#123;id=42, username=<span class="string">&#x27;Rongon&#x27;</span>, birthday=null, sex=<span class="string">&#x27;男&#x27;</span>, address=<span class="string">&#x27;江苏&#x27;</span>&#125;</span><br><span class="line">Account&#123;id=2, uid=42, money=40000.0&#125;</span><br><span class="line">------------------------------</span><br><span class="line">User&#123;id=43, username=<span class="string">&#x27;Zenyet&#x27;</span>, birthday=null, sex=<span class="string">&#x27;男&#x27;</span>, address=<span class="string">&#x27;广东&#x27;</span>&#125;</span><br><span class="line">Account&#123;id=3, uid=43, money=30000.0&#125;</span><br><span class="line">------------------------------</span><br><span class="line">User&#123;id=44, username=<span class="string">&#x27;尼古拉斯&#x27;</span>, birthday=null, sex=<span class="string">&#x27;男&#x27;</span>, address=<span class="string">&#x27;英国&#x27;</span>&#125;</span><br><span class="line">Account&#123;id=4, uid=44, money=21000.0&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li></ol><h2 id="3-一对多"><a href="#3-一对多" class="headerlink" title="3. 一对多"></a>3. 一对多</h2><blockquote><p>需求：在User定义Accounts属性，用于存储一个用户的多个账号。</p></blockquote><blockquote><p>步骤：</p><ol><li>修改User</li><li>修改UserDao接口</li><li>修改UserDao配置文件【重点】</li><li>编写测试方法</li></ol></blockquote><ol><li><p>修改User类：给User类添加多个account的属性</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="keyword">private</span> Date birthday;</span><br><span class="line">    <span class="keyword">private</span> String sex;</span><br><span class="line">    <span class="keyword">private</span> String address;</span><br><span class="line">    <span class="keyword">private</span> List&lt;Account&gt; accounts; <span class="comment">// 新添加的accounts属性，用于存储一个用户的多个账号</span></span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li></ol><ol start="2"><li><p>修改UserDao接口：新添加查询User类，包含accounts。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 新添加用于查询的方法</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> List&lt;User&gt; <span class="title">findAllAccounts</span><span class="params">()</span></span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li></ol><ol start="3"><li><p>修改UserDao配置文件：添加封装accounts的配置文件【重点】</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;top.tobing.dao.UserDao&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--定义User结果集--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;userAccountsMap&quot;</span> <span class="attr">type</span>=<span class="string">&quot;top.tobing.domain.User&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;username&quot;</span> <span class="attr">property</span>=<span class="string">&quot;username&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;birthday&quot;</span> <span class="attr">property</span>=<span class="string">&quot;birthday&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;sex&quot;</span> <span class="attr">property</span>=<span class="string">&quot;sex&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;address&quot;</span> <span class="attr">property</span>=<span class="string">&quot;address&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">&quot;accounts&quot;</span> <span class="attr">ofType</span>=<span class="string">&quot;top.tobing.domain.Account&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;aid&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;uid&quot;</span> <span class="attr">property</span>=<span class="string">&quot;uid&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;money&quot;</span> <span class="attr">property</span>=<span class="string">&quot;money&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">collection</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findAllAccounts&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;userAccountsMap&quot;</span>&gt;</span></span><br><span class="line">        select</span><br><span class="line">            u.id,</span><br><span class="line">            u.username,</span><br><span class="line">            u.birthday,</span><br><span class="line">            u.sex,</span><br><span class="line">            u.address,</span><br><span class="line">            account.id,</span><br><span class="line">            account.uid,</span><br><span class="line">            account.money</span><br><span class="line">        from</span><br><span class="line">            user u</span><br><span class="line">        left join account on u.id = account.uid</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><blockquote><ul><li>collection 标签<ul><li>用于建立【一对多】中集合元素属性的对应关系。</li><li>此处定义了用户关联的账户信息【关联账户查询结果集】</li><li>ofType属性：指定结合元素的数据类型</li></ul></li></ul></blockquote><blockquote><p>分析</p></blockquote><p><img src="https://gitee.com/tobing/imagebed/raw/master/my-4-oneToNresultMap.png" class="lazyload" data-srcset="https://gitee.com/tobing/imagebed/raw/master/my-4-oneToNresultMap.png" srcset="data:image/png;base64,666" alt="oneToNresultMap"></p></li><li><p>测试</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">findAllAccountsTest</span><span class="params">()</span></span>&#123;</span><br><span class="line">       List&lt;User&gt; allAccounts = userDao.findAllAccounts();</span><br><span class="line">       <span class="keyword">for</span> (User allAccount : allAccounts) &#123;</span><br><span class="line">           System.out.println(<span class="string">&quot;------------------------&quot;</span>);</span><br><span class="line">           System.out.println(allAccount);</span><br><span class="line">           System.out.println(allAccount.getAccounts());</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br><span class="line">   </span><br></pre></td></tr></table></figure><blockquote><p>运行结果</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">------------------------</span><br><span class="line">User&#123;id=41, username=<span class="string">&#x27;Tobing&#x27;</span>, birthday=null, sex=<span class="string">&#x27;男&#x27;</span>, address=<span class="string">&#x27;四川&#x27;</span>&#125;</span><br><span class="line">[Account&#123;id=0, uid=41, money=20000.0&#125;]</span><br><span class="line">------------------------</span><br><span class="line">User&#123;id=42, username=<span class="string">&#x27;Rongon&#x27;</span>, birthday=null, sex=<span class="string">&#x27;男&#x27;</span>, address=<span class="string">&#x27;江苏&#x27;</span>&#125;</span><br><span class="line">[Account&#123;id=0, uid=42, money=40000.0&#125;, Account&#123;id=0, uid=42, money=50000.0&#125;]</span><br><span class="line">------------------------</span><br><span class="line">User&#123;id=43, username=<span class="string">&#x27;Zenyet&#x27;</span>, birthday=null, sex=<span class="string">&#x27;男&#x27;</span>, address=<span class="string">&#x27;广东&#x27;</span>&#125;</span><br><span class="line">[Account&#123;id=0, uid=43, money=30000.0&#125;]</span><br><span class="line">------------------------</span><br><span class="line">User&#123;id=44, username=<span class="string">&#x27;尼古拉斯&#x27;</span>, birthday=null, sex=<span class="string">&#x27;男&#x27;</span>, address=<span class="string">&#x27;英国&#x27;</span>&#125;</span><br><span class="line">[Account&#123;id=0, uid=44, money=21000.0&#125;, Account&#123;id=0, uid=44, money=40000.0&#125;]</span><br><span class="line">------------------------</span><br><span class="line">User&#123;id=46, username=<span class="string">&#x27;张三丰&#x27;</span>, birthday=null, sex=<span class="string">&#x27;男&#x27;</span>, address=<span class="string">&#x27;蜀山&#x27;</span>&#125;</span><br><span class="line">[]</span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li><p>总结</p><blockquote><p>无论是一对多还是一对一，编写时关键点在于能把SQL写出，再把SQL语句转换到配置文件中。</p></blockquote></li></ol>]]></content>
      
      
      <categories>
          
          <category> 理论学习 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Mybatis </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Mybatis-3-动态SQL</title>
      <link href="2019/11/23/Mybatis-3-%E5%8A%A8%E6%80%81SQL/"/>
      <url>2019/11/23/Mybatis-3-%E5%8A%A8%E6%80%81SQL/</url>
      
        <content type="html"><![CDATA[<p>Mybatis学习第三弹。</p><a id="more"></a><h1 id="Mybatis-3-动态SQL"><a href="#Mybatis-3-动态SQL" class="headerlink" title="Mybatis-3-动态SQL"></a>Mybatis-3-动态SQL</h1><h3 id="if标签"><a href="#if标签" class="headerlink" title="if标签"></a>if标签</h3><blockquote><p>当我们传入的条件是多个，且不同条件查询语句不同的时候常常使用if</p></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findByUser&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;top.tobing.domain.User&quot;</span>&gt;</span></span><br><span class="line">        select * from user where 1=1 </span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;username !=null and username!=&#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">            and username = #&#123;username&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;address!=null and address!=&#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">            and address like #&#123;address&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="where标签"><a href="#where标签" class="headerlink" title="where标签"></a>where标签</h3><blockquote><p> 简化了 1 = 1</p></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findByUser&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;top.tobing.domain.User&quot;</span>&gt;</span></span><br><span class="line">        select * from user</span><br><span class="line">        <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;username !=null and username!=&#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">                and username = #&#123;username&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;address!=null and address!=&#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">                and address like #&#123;address&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="foreach标签"><a href="#foreach标签" class="headerlink" title="foreach标签"></a>foreach标签</h3><blockquote><p>诸如：select * from user id in（1,2,….） …..的语句</p></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findByIds&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;top.tobing.domain.User&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;top.tobing.domain.QueryVo&quot;</span>&gt;</span></span><br><span class="line">    select * from user</span><br><span class="line">    <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;ids!=null and ids.size()&gt;0&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">&quot;ids&quot;</span> <span class="attr">open</span>=<span class="string">&quot; id in (&quot;</span> <span class="attr">close</span>=<span class="string">&quot;)&quot;</span> <span class="attr">item</span>=<span class="string">&quot;id&quot;</span> <span class="attr">separator</span>=<span class="string">&quot;,&quot;</span>&gt;</span></span><br><span class="line">                #&#123;id&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>foreach的标签：</p><ol><li>collection：代表要遍历的集合元素，编写时不能写#{}</li><li>open：代表语句开始的部分</li><li>close：代表语句结束的部分</li><li>separator：遍历元素之间的分隔符</li><li>item：代表遍历集合的每个元素的变量名</li></ol></blockquote><h3 id="定义代码片段"><a href="#定义代码片段" class="headerlink" title="定义代码片段"></a>定义代码片段</h3><blockquote><p>当重复的语句过多的时候，可以自定义代码片段</p></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">sql</span> <span class="attr">id</span>=<span class="string">&quot;idySql&quot;</span>&gt;</span></span><br><span class="line">select * from user</span><br><span class="line"><span class="tag">&lt;/<span class="name">sql</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>引用自定义的代码片段：include标签</p></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findByUser&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;top.tobing.domain.User&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">&quot;diySql&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">include</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;username !=null and username!=&#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">            and username = #&#123;username&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;address!=null and address!=&#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">            and address like #&#123;address&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="案例演示"><a href="#案例演示" class="headerlink" title="案例演示"></a>案例演示</h3><ul><li><p>UserDao.xml配置文件</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!------------------------------定义变量-----------------------------&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">sql</span> <span class="attr">id</span>=<span class="string">&quot;diySql&quot;</span>&gt;</span></span><br><span class="line">    select * from user </span><br><span class="line"><span class="tag">&lt;/<span class="name">sql</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-----------------------------使用where和if标签动态查询------------------------------&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findByUser&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;top.tobing.domain.User&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">&quot;diySql&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;username !=null and username!=&#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">            and username = #&#123;username&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;address!=null and address!=&#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">            and address like #&#123;address&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-----------------------------使用foreach动态查询------------------------------&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findByIds&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;top.tobing.domain.User&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;top.tobing.domain.QueryVo&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">&quot;diySql&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;user!=null&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;user.username!=null and user.username!=&#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">                and username = #&#123;user.username&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;ids!=null and ids.size()&gt;0&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">&quot;ids&quot;</span> <span class="attr">open</span>=<span class="string">&quot; id in (&quot;</span> <span class="attr">close</span>=<span class="string">&quot;)&quot;</span> <span class="attr">item</span>=<span class="string">&quot;id&quot;</span> <span class="attr">separator</span>=<span class="string">&quot;,&quot;</span>&gt;</span></span><br><span class="line">                #&#123;id&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>测试方法</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">findByOvTest</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    User u = <span class="keyword">new</span> User();</span><br><span class="line">    u.setUsername(<span class="string">&quot;小二王&quot;</span>);</span><br><span class="line">    QueryVo ov = <span class="keyword">new</span> QueryVo();</span><br><span class="line">    ov.setUser(u);</span><br><span class="line">    List&lt;User&gt; users = userDao.findByOv(ov);</span><br><span class="line">    <span class="keyword">for</span> (User user : users) &#123;</span><br><span class="line">        System.out.println(user);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">  </span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">findByUserTest</span><span class="params">()</span></span>&#123;</span><br><span class="line">    User u = <span class="keyword">new</span> User();</span><br><span class="line">    u.setUsername(<span class="string">&quot;小二王&quot;</span>);</span><br><span class="line">    u.setAddress(<span class="string">&quot;%上海%&quot;</span>);</span><br><span class="line">    List&lt;User&gt; users = userDao.findByUser(u);</span><br><span class="line">    <span class="keyword">for</span> (User user : users) &#123;</span><br><span class="line">        System.out.println(user);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">  </span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">findByIdsTest</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">//User u = new User();</span></span><br><span class="line">    <span class="comment">//u.setUsername(&quot;小二王&quot;);</span></span><br><span class="line">    List&lt;Integer&gt; ids = <span class="keyword">new</span> ArrayList&lt;Integer&gt;();</span><br><span class="line">    ids.add(<span class="number">42</span>);</span><br><span class="line">    ids.add(<span class="number">58</span>);</span><br><span class="line">    ids.add(<span class="number">48</span>);</span><br><span class="line">    QueryVo ov = <span class="keyword">new</span> QueryVo();</span><br><span class="line">    <span class="comment">//ov.setUser(u);</span></span><br><span class="line">    ov.setIds(ids);</span><br><span class="line">    List&lt;User&gt; users = userDao.findByIds(ov);</span><br><span class="line">    <span class="keyword">for</span> (User user : users) &#123;</span><br><span class="line">        System.out.println(user);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul>]]></content>
      
      
      <categories>
          
          <category> 理论学习 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Mybatis </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Mybatis-2-CRUD</title>
      <link href="2019/11/23/Mybatis-2-CRUD/"/>
      <url>2019/11/23/Mybatis-2-CRUD/</url>
      
        <content type="html"><![CDATA[<p>Mybatis学习第二弹。</p><a id="more"></a><h1 id="Mybatis-2-简单CRUD"><a href="#Mybatis-2-简单CRUD" class="headerlink" title="Mybatis-2-简单CRUD"></a>Mybatis-2-简单CRUD</h1><ul><li><p>步骤</p><ol><li>创建Maven工程</li><li>关联坐标</li><li>编写实体类和持久层接口</li><li>编写SqlMapConfig.xml</li><li>编写映射配置文件</li><li>编写测试类</li><li>添加其他查询功能</li></ol></li><li><p>使用要求</p><blockquote><ol><li>持久层接口和持久层接口的映射配置必须在相同包下</li><li>持久层映射中mapper标签的namespace属性取值必须是持久层接口的全限定类名。</li><li>SQL语句的配置标签：select、insert、delete、update的id属性必须和持久层接口的方法名相同。</li></ol></blockquote></li></ul><h4 id="1-创建Maven工程"><a href="#1-创建Maven工程" class="headerlink" title="1. 创建Maven工程"></a>1. 创建Maven工程</h4><h4 id="2-导入坐标"><a href="#2-导入坐标" class="headerlink" title="2. 导入坐标"></a>2. 导入坐标</h4><ul><li><p>pom.xml</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.1.6<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.4.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>dom4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>dom4j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.6<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.12<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.10<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ul><h4 id="3-编写实体类和持久层接口"><a href="#3-编写实体类和持久层接口" class="headerlink" title="3. 编写实体类和持久层接口"></a>3. 编写实体类和持久层接口</h4><ul><li><p>在main-&gt;java下讲解domain和dao包</p></li><li><p>domain-&gt;User实体类</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> top.tobing.domain;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="keyword">private</span> Date birthday;</span><br><span class="line">    <span class="keyword">private</span> String sex;</span><br><span class="line">    <span class="keyword">private</span> String address;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// getter and setter.....</span></span><br><span class="line">        </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> .....</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>dao-&gt;UserDao持久层接口</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> top.tobing.dao;</span><br><span class="line"><span class="keyword">import</span> top.tobing.domain.User;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserDao</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;User&gt; <span class="title">findAll</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li></ul><h4 id="4-编写SqlMapConfig-xml"><a href="#4-编写SqlMapConfig-xml" class="headerlink" title="4. 编写SqlMapConfig.xml"></a>4. 编写SqlMapConfig.xml</h4><ul><li><p>SqlMapConfig.xml用于配置数据库相关信息。以及关联UserDao的配置文件。</p></li><li><p>在resources目下新建SQLMapConfig.xml文件</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">configuration</span></span></span><br><span class="line"><span class="meta">        <span class="meta-keyword">PUBLIC</span> <span class="meta-string">&quot;-//mybatis.org//DTD Config 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="meta-string">&quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span> &gt;</span></span><br><span class="line">    <span class="comment">&lt;!--连接数据库环境--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">environments</span> <span class="attr">default</span>=<span class="string">&quot;mysql&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">environment</span> <span class="attr">id</span>=<span class="string">&quot;mysql&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">transactionManager</span> <span class="attr">type</span>=<span class="string">&quot;JDBC&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">transactionManager</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">&quot;POOLED&quot;</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--连接数据库信息--&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driver&quot;</span> <span class="attr">value</span>=<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;jdbc:mysql://localhost:3306/ee50&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;root&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;root&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">environment</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">environments</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">&quot;top/tobing/dao/UserDao.xml&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ul><h4 id="5-编写映射配置文件"><a href="#5-编写映射配置文件" class="headerlink" title="5. 编写映射配置文件"></a>5. 编写映射配置文件</h4><ul><li><p>每一个Dao接口对应一个映射配置文件</p></li><li><p>在resources下创建UserDao三级目录top-&gt;tobing-&gt;dao（记住要一级一级创建，不能和包一样创建）</p></li><li><p>在dao目录下创建UserDao.xml</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="line">&lt;!DOCTYPE mapper</span><br><span class="line">        PUBLIC <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span><br><span class="line">        <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span><br><span class="line">        </span><br><span class="line">&lt;mapper namespace=<span class="string">&quot;top.tobing.dao.UserDao&quot;</span>&gt;</span><br><span class="line">    &lt;select id=<span class="string">&quot;findAll&quot;</span> resultType=<span class="string">&quot;top.tobing.domain.User&quot;</span>&gt;</span><br><span class="line">        SELECT * from user ;</span><br><span class="line">    &lt;/select&gt;</span><br><span class="line">&lt;/mapper&gt;</span><br></pre></td></tr></table></figure><ul><li>namespace：要绑定Dao接口</li><li>id：指定Dao接口中的方法</li><li>resultType：设置返回值类型（全限定类名）</li></ul></li></ul><h4 id="6-编写测试类"><a href="#6-编写测试类" class="headerlink" title="6. 编写测试类"></a>6. 编写测试类</h4><ul><li><p>test-&gt;java下创建top.tobing.test包，并创建UserDaoTest测试类用于测试是否可用。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> top.tobing.test;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.io.Resources;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSession;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSessionFactory;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSessionFactoryBuilder;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"><span class="keyword">import</span> top.tobing.dao.UserDao;</span><br><span class="line"><span class="keyword">import</span> top.tobing.domain.User;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserDaoTest</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">findAllTest</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="comment">//1.读取配置文件</span></span><br><span class="line">        InputStream in = Resources.getResourceAsStream(<span class="string">&quot;SqlMapConfig.xml&quot;</span>);</span><br><span class="line">        <span class="comment">//2.创建工厂类</span></span><br><span class="line">        SqlSessionFactory factory =<span class="keyword">new</span> SqlSessionFactoryBuilder().build(in);</span><br><span class="line">        <span class="comment">//3.生产SqlSession对象</span></span><br><span class="line">        SqlSession session = factory.openSession();</span><br><span class="line">        <span class="comment">//4.获取代理对象</span></span><br><span class="line">        UserDao userDao = session.getMapper(UserDao.class);</span><br><span class="line">        <span class="comment">//5.执行查询语句</span></span><br><span class="line">        List&lt;User&gt; users = userDao.findAll();</span><br><span class="line">        <span class="comment">//6.遍历输出</span></span><br><span class="line">        <span class="keyword">for</span>(User user:users)&#123;</span><br><span class="line">            System.out.println(user);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//7.关闭资源</span></span><br><span class="line">        session.close();</span><br><span class="line">        in.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li></ul><h4 id="7-其他CRUD操作"><a href="#7-其他CRUD操作" class="headerlink" title="7. 其他CRUD操作"></a>7. 其他CRUD操作</h4><ol><li>到Dao接口中添加新方法</li><li>同时在UserDao.xml中管理方法，编写Sql 语句</li><li>在UserDaoTest中添加新的对应的测试方法</li></ol><h5 id="1-Dao接口中添加新方法"><a href="#1-Dao接口中添加新方法" class="headerlink" title="1. Dao接口中添加新方法"></a>1. Dao接口中添加新方法</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> User <span class="title">findById</span><span class="params">(<span class="keyword">int</span> id)</span></span>;</span><br></pre></td></tr></table></figure><h5 id="2-UserDao-xml中绑定该方法，编写Sql语句"><a href="#2-UserDao-xml中绑定该方法，编写Sql语句" class="headerlink" title="2. UserDao.xml中绑定该方法，编写Sql语句"></a>2. UserDao.xml中绑定该方法，编写Sql语句</h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;top.tobing.dao.UserDao&quot;</span>&gt;</span></span><br><span class="line">  ......</span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findById&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;top.tobing.domain&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;java.lang.Integer&quot;</span>&gt;</span></span><br><span class="line">        select * from user where id = #&#123;id&#125;;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure><h5 id="3-在UserDaoTest中添加对应的测试方法"><a href="#3-在UserDaoTest中添加对应的测试方法" class="headerlink" title="3. 在UserDaoTest中添加对应的测试方法"></a>3. 在UserDaoTest中添加对应的测试方法</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">findById</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">      <span class="comment">//1.读取配置文件</span></span><br><span class="line">      InputStream in = Resources.getResourceAsStream(<span class="string">&quot;SqlMapConfig.xml&quot;</span>);</span><br><span class="line">      <span class="comment">//2.创建工厂类</span></span><br><span class="line">      SqlSessionFactory factory =<span class="keyword">new</span> SqlSessionFactoryBuilder().build(in);</span><br><span class="line">      <span class="comment">//3.生产SqlSession对象</span></span><br><span class="line">      SqlSession session = factory.openSession();</span><br><span class="line">      <span class="comment">//4.获取代理对象</span></span><br><span class="line">      UserDao userDao = session.getMapper(UserDao.class);</span><br><span class="line">      <span class="comment">//5.执行查询语句</span></span><br><span class="line">      User user = userDao.findById(<span class="number">49</span>);</span><br><span class="line">      <span class="comment">//6.输出</span></span><br><span class="line">      System.out.println(user);</span><br><span class="line">      <span class="comment">//7.关闭资源</span></span><br><span class="line">      session.close();</span><br><span class="line">      in.close();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="8-优化"><a href="#8-优化" class="headerlink" title="8. 优化"></a>8. 优化</h4><ul><li><p>由UserDaoTest中的代码可以看出，在每次创建测试类的时候都要读取配置文件，创建工厂类，获取SqlSession对象等，重复代码较多，因此考虑抽取共性部分将其封装为两个方法。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> InputStream in;</span><br><span class="line"><span class="keyword">private</span> SqlSession session;</span><br><span class="line"><span class="keyword">private</span> UserDao userDao;</span><br><span class="line">  </span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 初始化方法</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Before</span>   <span class="comment">// 在方法执行前执行</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">try</span>&#123;</span><br><span class="line">        <span class="comment">//1.读取配置文件</span></span><br><span class="line">        in = Resources.getResourceAsStream(<span class="string">&quot;SqlMapConfig.xml&quot;</span>);</span><br><span class="line">        <span class="comment">//2.创建工厂类</span></span><br><span class="line">        SqlSessionFactory factory =<span class="keyword">new</span> SqlSessionFactoryBuilder().build(in);</span><br><span class="line">        <span class="comment">//3.生产SqlSession对象</span></span><br><span class="line">        session = factory.openSession();</span><br><span class="line">        <span class="comment">//4.获取代理对象</span></span><br><span class="line">        userDao = session.getMapper(UserDao.class);</span><br><span class="line">    &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">  </span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 释放资源</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@After</span>  <span class="comment">// 在方法执行之后执行</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">destroy</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    session.commit(); <span class="comment">// 此处记得提交事务</span></span><br><span class="line">    session.close();</span><br><span class="line">    in.close();</span><br><span class="line">&#125;</span><br><span class="line">  </span><br></pre></td></tr></table></figure></li></ul><h4 id="9-批量CRUD"><a href="#9-批量CRUD" class="headerlink" title="9. 批量CRUD"></a>9. 批量CRUD</h4><ul><li>步骤<ol><li>UserDao</li><li>UserDao.xml</li><li>UsetDaoTest</li></ol></li></ul><h5 id="1-UserDao添加方法"><a href="#1-UserDao添加方法" class="headerlink" title="1. UserDao添加方法"></a>1. UserDao添加方法</h5><ul><li>java.top.tobing.dao.UserDao</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 保存用户</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">save</span><span class="params">(User user)</span></span>;</span><br><span class="line"><span class="comment">// 更新用户</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">updateUser</span><span class="params">(User user)</span></span>;</span><br><span class="line"><span class="comment">//根据Id删除用户</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">deleteUser</span><span class="params">(Integer serId)</span></span>;</span><br><span class="line"><span class="comment">// 根据用户名模糊查找</span></span><br><span class="line"><span class="function">List&lt;User&gt; <span class="title">findByName</span><span class="params">(String name)</span></span>;</span><br><span class="line"><span class="comment">// 查找用户记录条数</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">findTotal</span><span class="params">()</span></span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h5 id="2-UserDao-xml修改配置"><a href="#2-UserDao-xml修改配置" class="headerlink" title="2. UserDao.xml修改配置"></a>2. UserDao.xml修改配置</h5><ul><li>resources-&gt;top/tobing/dao/UserDao.xml</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!---------------------------------------save-------------------------------------&gt;</span></span><br><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">注意！在传入参数的时候，在sql语句中获取User的属性的时候，要以getAbc的方法为准，也就是说。要获取User中的getAbc()对应获取的属性，就填写#&#123;abc&#125;，即是getAbc方法去掉get并将首字母小写。</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;save&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;top.tobing.domain.User&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--此处配置使用与保持添加之后自增长id--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">selectKey</span> <span class="attr">keyColumn</span>=<span class="string">&quot;id&quot;</span> <span class="attr">keyProperty</span>=<span class="string">&quot;id&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;int&quot;</span>&gt;</span></span><br><span class="line">        select last_insert_id();</span><br><span class="line">    <span class="tag">&lt;/<span class="name">selectKey</span>&gt;</span></span><br><span class="line">    INSERT into user(username,address,sex,birthday)values(#&#123;username&#125;,#&#123;address&#125;,#&#123;sex&#125;,#&#123;birthday&#125;);</span><br><span class="line"><span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!---------------------------------------updateUser-------------------------------------&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;updateUser&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;top.tobing.domain.User&quot;</span>&gt;</span></span><br><span class="line">    update user set username=#&#123;username&#125;,address=#&#123;address&#125;,sex=#&#123;sex&#125;,birthday=#&#123;birthday&#125; where id = #&#123;id&#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!---------------------------------------deleteUser-------------------------------------&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">delete</span> <span class="attr">id</span>=<span class="string">&quot;deleteUser&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;java.lang.Integer&quot;</span>&gt;</span></span><br><span class="line">    delete from user where id = #&#123;id&#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">delete</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!---------------------------------------findByName-------------------------------------&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findByName&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;top.tobing.domain.User&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;java.lang.String&quot;</span>&gt;</span></span><br><span class="line">    SELECT * from user where username like #&#123;username&#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!---------------------------------------findTotal-------------------------------------&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findTotal&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;java.lang.Integer&quot;</span>&gt;</span></span><br><span class="line">    select count(*) from user;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h5 id="3-编写对应测试方法测试"><a href="#3-编写对应测试方法测试" class="headerlink" title="3. 编写对应测试方法测试"></a>3. 编写对应测试方法测试</h5><ul><li>test-&gt;java-&gt;top.tobing.test-&gt;UserDaoTest</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updateUserTest</span><span class="params">()</span></span>&#123;</span><br><span class="line">    User user = <span class="keyword">new</span> User();</span><br><span class="line">    user.setUsername(<span class="string">&quot;张翠山&quot;</span>);</span><br><span class="line">    user.setAddress(<span class="string">&quot;广东省广州市&quot;</span>);</span><br><span class="line">    user.setSex(<span class="string">&quot;男&quot;</span>);</span><br><span class="line">    user.setId(<span class="number">50</span>);</span><br><span class="line">    user.setBirthday(<span class="keyword">new</span> Date());</span><br><span class="line">    UserDao userDao = session.getMapper(UserDao.class);</span><br><span class="line">    userDao.updateUser(user);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteUserTest</span><span class="params">()</span></span>&#123;</span><br><span class="line">    userDao.deleteUser(<span class="number">51</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">findByIdTest</span><span class="params">()</span></span>&#123;</span><br><span class="line">    User user = userDao.findById(<span class="number">49</span>);</span><br><span class="line">    System.out.println(user);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">findByNameTest</span><span class="params">()</span></span>&#123;</span><br><span class="line">    List&lt;User&gt; users = userDao.findByName(<span class="string">&quot;%王%&quot;</span>);</span><br><span class="line">    <span class="keyword">for</span> (User user : users) &#123;</span><br><span class="line">        System.out.println(user);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">findTotlaTest</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> total = userDao.findTotal();</span><br><span class="line">    System.out.println(<span class="string">&quot;数据条数为：&quot;</span>+total);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="细节"><a href="#细节" class="headerlink" title="细节"></a>细节</h4><ul><li><p>在sql语句中使用#{}字符：</p><ul><li><p>它代表占位符，相当于原来 jdbc 部分所学prepareStatment的<code>?</code>，都是用于执行语句时替换实际的数据。    具体的数据是由#{}里面的内容决定的。 </p></li><li><p>使用的是ognl表达式</p></li><li><p>ognl表达式</p><blockquote><ol><li><p>是Apache提供的一种表达式语言，全称是：Object Graphic Navigation Language 对象图导航语言。</p></li><li><p>一定的语法格式来获取数据：#{对象.对象}</p></li></ol></blockquote></li></ul></li><li><p>parameterType配置参数</p><ul><li>基 本类 型和 String 我 们可 以直接 写类型 名称 ，也 可以 使用包 名 . 类名的 方式 ，例如 ： java.lang.String。  </li><li>实体类类型（自定义），目前我们只能使用全限定类名</li><li>是 mybaits 在加载时已经把常用的数据类型注册了别名，从而我们在使用时可以不写包名， 而我们的是实体类并没有注册别名，所以必须写全限定类名。</li></ul></li><li><p>resultType配置</p><ul><li>resultMap 标签可以建立查询的列名和实体类的属性名称不一致时建立对应关系。从而实现封装。 </li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 建立 User 实体和数据库表的对应关系</span></span><br><span class="line"><span class="comment">type 属性：指定实体类的全限定类名  </span></span><br><span class="line"><span class="comment">id 属性：给定一个唯一标识，是给查询 select 标签引用用的。</span></span><br><span class="line"><span class="comment"> --&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">&quot;top.tobing.domain.User&quot;</span> <span class="attr">id</span>=<span class="string">&quot;userMap&quot;</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;userId&quot;</span>/&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;username&quot;</span> <span class="attr">property</span>=<span class="string">&quot;userName&quot;</span>/&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;sex&quot;</span> <span class="attr">property</span>=<span class="string">&quot;userSex&quot;</span>/&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;address&quot;</span> <span class="attr">property</span>=<span class="string">&quot;userAddress&quot;</span>/&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;birthday&quot;</span> <span class="attr">property</span>=<span class="string">&quot;userBirthday&quot;</span>/&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span> </span><br><span class="line">id 标签：用于指定主键字段 </span><br><span class="line">result 标签：用于指定非主键字段 </span><br><span class="line">column 属性：用于指定数据库列名 </span><br><span class="line">property 属性：用于指定实体类属性名称 </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li><p>SqlMapConfig.xml配置文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">-properties（属性）  </span><br><span class="line">--property </span><br><span class="line">-settings（全局配置参数）  </span><br><span class="line">--setting </span><br><span class="line">-typeAliases（类型别名）  </span><br><span class="line">--typeAliase  </span><br><span class="line">--package </span><br><span class="line">-typeHandlers（类型处理器） </span><br><span class="line">-objectFactory（对象工厂） </span><br><span class="line">-plugins（插件） </span><br><span class="line">-environments（环境集合属性对象）  </span><br><span class="line">--environment（环境子属性对象）   </span><br><span class="line">            ---transactionManager（事务管理）   </span><br><span class="line">            ---dataSource（数据源） </span><br><span class="line">-mappers（映射器）  </span><br><span class="line">    --mapper  </span><br><span class="line">    --package</span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li><p>properties（属性）配置的两种方式</p><ul><li>直接定义</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span> </span><br><span class="line"> <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;jdbc.driver&quot;</span> <span class="attr">value</span>=<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>/&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;jdbc.url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;jdbc:mysql://localhost:3306/eesy&quot;</span>/&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;jdbc.username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;root&quot;</span>/&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;jdbc.password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;1234&quot;</span>/&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li>引用定义</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 配置连接数据库的信息    </span></span><br><span class="line"><span class="comment">    resource 属性：用于指定 properties配置文件的位置，要求配置文件必须在类路径下     resource=&quot;jdbcConfig.properties&quot; </span></span><br><span class="line"><span class="comment">      url 属性：    </span></span><br><span class="line"><span class="comment">    URL： Uniform Resource Locator 统一资源定位符     http://localhost:8080/mystroe/CategoryServlet  URL </span></span><br><span class="line"><span class="comment">        协议  主机   端口   URI    </span></span><br><span class="line"><span class="comment">    URI：Uniform Resource Identifier 统一资源标识符     </span></span><br><span class="line"><span class="comment">                /mystroe/CategoryServlet </span></span><br><span class="line"><span class="comment">                它是可以在 web 应用中唯一定位一个资源的路径 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">properties</span> <span class="attr">url</span>=<span class="string">&quot;file:///D:/IdeaProjects/day02_eesy_01mybatisCRUD/src/main/resources/jdbcConfig.prop erties&quot;</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">&quot;POOLED&quot;</span>&gt;</span>   </span><br><span class="line">     <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driver&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.driver&#125;&quot;</span>/&gt;</span>   </span><br><span class="line">     <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.url&#125;&quot;</span>/&gt;</span>   </span><br><span class="line">     <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.username&#125;&quot;</span>/&gt;</span>   </span><br><span class="line">     <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.password&#125;&quot;</span>/&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li><p>typeAliases(类型别名)</p><ul><li> Mybatis 支持的默认别名，我们也可以采用自定义别名方式来开发</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">typeAliases</span>&gt;</span>  </span><br><span class="line">    <span class="comment">&lt;!-- 单个别名定义 --&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">typeAlias</span> <span class="attr">alias</span>=<span class="string">&quot;user&quot;</span> <span class="attr">type</span>=<span class="string">&quot;top.tobing.domain.User&quot;</span>/&gt;</span>  </span><br><span class="line">    <span class="comment">&lt;!-- 批量别名定义，扫描整个包下的类，别名为类名（首字母大写或小写都可以） --&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">&quot;top.tobing.domain&quot;</span>/&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">&quot; 其它包 &quot;</span>/&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">typeAliases</span>&gt;</span> </span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li><p>mappers（映射器）<em>尚未弄懂</em></p><ul><li><p>resource：使用相对于类路径的资源</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">&quot;top/tobing/dao/IUserDao.xml&quot;</span> /&gt;</span> </span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li><p>class：使用mapper接口类路径</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">class</span>=<span class="string">&quot;top.tobing.dao.UserDao&quot;</span>/&gt;</span> </span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li><p>name：注册指定包下的使用Mapper接口</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">&quot;top.tobing.mybatis.mapper&quot;</span>/&gt;</span> </span><br><span class="line"></span><br></pre></td></tr></table></figure></li></ul></li></ul></li></ul>]]></content>
      
      
      <categories>
          
          <category> 理论学习 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Mybatis </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MySQL-4-多表查询与事务</title>
      <link href="2019/11/23/MySQL-4-%E5%A4%9A%E8%A1%A8%E6%9F%A5%E8%AF%A2%E4%B8%8E%E4%BA%8B%E5%8A%A1/"/>
      <url>2019/11/23/MySQL-4-%E5%A4%9A%E8%A1%A8%E6%9F%A5%E8%AF%A2%E4%B8%8E%E4%BA%8B%E5%8A%A1/</url>
      
        <content type="html"><![CDATA[<p>MySQL学习第四弹。</p><a id="more"></a><h1 id="MySQL-4-多表查询与事务"><a href="#MySQL-4-多表查询与事务" class="headerlink" title="MySQL-4-多表查询与事务"></a>MySQL-4-多表查询与事务</h1><h2 id="1-多表查询"><a href="#1-多表查询" class="headerlink" title="1. 多表查询"></a>1. 多表查询</h2><ul><li><p>语法</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span></span><br><span class="line">[列名列表]</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">[表名列表]</span><br><span class="line"><span class="keyword">where</span></span><br><span class="line">.....</span><br></pre></td></tr></table></figure></li><li><p>案例准备：两张表，部门表、员工表</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 创建部门表</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> dept(</span><br><span class="line"><span class="keyword">id</span> <span class="built_in">int</span> primary <span class="keyword">key</span> auto_increment, <span class="comment">-- id 主键 自增长</span></span><br><span class="line">    <span class="keyword">name</span> <span class="built_in">varchar</span>(<span class="number">20</span>)</span><br><span class="line">);</span><br><span class="line"><span class="comment">-- 创建员工表</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> emp(</span><br><span class="line"><span class="keyword">id</span> <span class="built_in">int</span> primary <span class="keyword">key</span> auto_increment, <span class="comment">-- id 主键 自增长</span></span><br><span class="line"><span class="keyword">name</span> <span class="built_in">varchar</span>(<span class="number">20</span>),<span class="comment">-- 姓名</span></span><br><span class="line">gender <span class="built_in">char</span>(<span class="number">1</span>),<span class="comment">-- 性别</span></span><br><span class="line">salary <span class="keyword">double</span>,<span class="comment">-- 薪资</span></span><br><span class="line">join_date <span class="built_in">date</span>,<span class="comment">-- 入职时间</span></span><br><span class="line">dept_id <span class="built_in">int</span>,</span><br><span class="line"><span class="keyword">foreign</span> <span class="keyword">key</span>(dept_id) <span class="keyword">references</span> dept(<span class="keyword">id</span>) <span class="comment">-- 外键，关联dept表中的id</span></span><br><span class="line">);</span><br><span class="line"><span class="comment">-- 给部门表添加信息</span></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> dept(<span class="keyword">name</span>) <span class="keyword">values</span>(<span class="string">&#x27;开发部&#x27;</span>),(<span class="string">&#x27;市场部&#x27;</span>),(<span class="string">&#x27;财务部&#x27;</span>);</span><br><span class="line"><span class="comment">-- 给员工表插入数据</span></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> emp(<span class="keyword">name</span>,gender,salary,join_date,dept_id) <span class="keyword">values</span></span><br><span class="line">(<span class="string">&#x27;Tobing&#x27;</span>,<span class="string">&#x27;男&#x27;</span>,<span class="number">10000</span>,<span class="string">&#x27;2018-10-01&#x27;</span>,<span class="number">1</span>),</span><br><span class="line">(<span class="string">&#x27;Rongon&#x27;</span>,<span class="string">&#x27;男&#x27;</span>,<span class="number">12000</span>,<span class="string">&#x27;2018-10-01&#x27;</span>,<span class="number">2</span>),</span><br><span class="line">(<span class="string">&#x27;Zenyet&#x27;</span>,<span class="string">&#x27;男&#x27;</span>,<span class="number">13000</span>,<span class="string">&#x27;2018-11-01&#x27;</span>,<span class="number">1</span>),</span><br><span class="line">(<span class="string">&#x27;Actogo&#x27;</span>,<span class="string">&#x27;男&#x27;</span>,<span class="number">10000</span>,<span class="string">&#x27;2018-10-02&#x27;</span>,<span class="number">2</span>),</span><br><span class="line">(<span class="string">&#x27;尼古拉斯&#x27;</span>,<span class="string">&#x27;男&#x27;</span>,<span class="number">10000</span>,<span class="string">&#x27;2018-10-01&#x27;</span>,<span class="number">3</span>);</span><br></pre></td></tr></table></figure></li><li><p>笛卡尔积</p><blockquote><ul><li>每张表中元素的排列组合。</li><li>例如，集合A（n条数据）和集合B（m条数据），其笛卡尔积为m * n条</li></ul></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- emp有3条数据</span></span><br><span class="line"><span class="comment">-- dept有5条数据</span></span><br><span class="line"><span class="comment">-- 以下语句查询为两表的笛卡尔积，一共15条数据</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> emp,dept; </span><br></pre></td></tr></table></figure><blockquote><p>笛卡尔积得出的数据很多都是无用的，实际中常常根据需求消除数据。</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查询emp表中每个员工的姓名，id，薪资以及部门。</span></span><br><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line"> <span class="comment">-- 查询emp表中的id、nam、salary以及dept表中的name</span></span><br><span class="line">emp.id,emp.name,emp.<span class="string">`salary`</span>,dept.<span class="string">`name`</span> </span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">emp,dept  <span class="comment">-- 此处通常可以起别名</span></span><br><span class="line"><span class="keyword">WHERE</span> emp.<span class="string">`dept_id`</span>= dept.id;</span><br></pre></td></tr></table></figure></li><li><p>多表查询的分类</p><blockquote><ol><li>内连接查询：显示、隐式</li><li>外连接查询：左外连接、右外连接</li></ol></blockquote><ol><li><p>隐式内连接：使用where消除无用数据</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 以上笛卡尔积实例代码就是隐式外连接</span></span><br><span class="line"><span class="keyword">select</span></span><br><span class="line">[列名列表]</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">表<span class="number">1</span>，表<span class="number">2.</span>..</span><br><span class="line"><span class="keyword">where</span></span><br><span class="line">.....</span><br></pre></td></tr></table></figure></li><li><p>显示内连接</p><blockquote><p>语法</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> 字段列表 <span class="keyword">from</span> 表<span class="number">1</span> [<span class="keyword">inner</span>] <span class="keyword">join</span> 表<span class="number">2</span> <span class="keyword">on</span> 条件</span><br></pre></td></tr></table></figure><blockquote><p>示例</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span>  * <span class="keyword">FROM</span> emp <span class="keyword">JOIN</span> dept <span class="keyword">ON</span> emp.<span class="string">`dept_id`</span>=dept.<span class="string">`id`</span>;</span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> dept <span class="keyword">JOIN</span> emp <span class="keyword">ON</span> emp.<span class="string">`dept_id`</span> = dept.id;</span><br><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">dept.<span class="string">`name`</span> ,emp.<span class="string">`name`</span>, emp.<span class="string">`salary`</span> </span><br><span class="line"><span class="keyword">FROM</span> </span><br><span class="line">dept </span><br><span class="line"><span class="keyword">JOIN</span> </span><br><span class="line">emp </span><br><span class="line"><span class="keyword">ON</span> </span><br><span class="line">emp.<span class="string">`dept_id`</span> = dept.id;</span><br></pre></td></tr></table></figure></li><li><p>内连接查询</p><blockquote><ol><li>需要那些表的数据</li><li>条件是什么</li><li>查询什么字段</li></ol></blockquote></li></ol><p>​        </p><ol start="4"><li><p>左外连接：查询【左表】中的所有数据，以及右表中与左表【交集部分】</p><blockquote><p>语法</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> 字段列表 <span class="keyword">from</span> 表<span class="number">1</span> <span class="keyword">left</span> [<span class="keyword">outer</span>] <span class="keyword">join</span> 表<span class="number">2</span> <span class="keyword">on</span> 条件;</span><br></pre></td></tr></table></figure><blockquote><p>示例：查emp表中的所有员工【存在部门为null】，以及每个员工对应的部门。</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 此处是可以查出dept_id 为null的员工</span></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> emp <span class="keyword">left</span> <span class="keyword">join</span> dept <span class="keyword">on</span> emp.dept_id = dept.id;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li><p>右外连接：查询【右表】中的所有数据，以及左表中与右表【交集部分】</p></li></ol></li><li><p>子查询</p><blockquote><p>查询中嵌套查询，嵌套查询就称为子查询</p><ol><li>子查询结果为单行单列</li><li>子查询结果为多行单列</li><li>子查询结果为多行多列</li></ol></blockquote><ol><li><p>子查询结果为单行单列【用于条件】</p><blockquote><p>需求：查询所有大于平均薪资的员工</p><p>结果用于条件。</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> </span><br><span class="line"><span class="keyword">name</span>,salary </span><br><span class="line"><span class="keyword">from</span> </span><br><span class="line">emp </span><br><span class="line"><span class="keyword">where</span> </span><br><span class="line">salary &gt; (<span class="keyword">select</span> <span class="keyword">avg</span>(salary) <span class="keyword">from</span> emp); </span><br><span class="line"><span class="comment">-- 以上语句==&gt; avg.. 得到平均，在使用where查询</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li><p>子查询结果为多行单列【使用in，用于条件】</p><blockquote><p>需求：查询财务表和市场部所有员工</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span></span><br><span class="line">* </span><br><span class="line"><span class="keyword">from</span> </span><br><span class="line">emp </span><br><span class="line"><span class="keyword">where</span></span><br><span class="line">dept_id </span><br><span class="line"><span class="keyword">in</span></span><br><span class="line">(<span class="keyword">select</span> <span class="keyword">id</span> <span class="keyword">from</span> dept <span class="keyword">where</span> <span class="keyword">name</span> <span class="keyword">in</span>(<span class="string">&#x27;财务部&#x27;</span>,<span class="string">&#x27;市场部&#x27;</span>)); <span class="comment">-- 得到财务部和市场部的id</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li><p>子查询结果为多行多列【用于虚拟表参与查询】</p><blockquote><p>需求：查询入职时间为2019-10-01之后的员工信息和部门信息</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span></span><br><span class="line">* </span><br><span class="line"><span class="keyword">from</span> </span><br><span class="line">dept t1,</span><br><span class="line">    (<span class="keyword">select</span> * <span class="keyword">from</span> emp <span class="keyword">where</span> emp.join_date &gt; <span class="string">&#x27;2018-10-01&#x27;</span>) t2 <span class="comment">-- 起别名</span></span><br><span class="line"><span class="keyword">where</span> </span><br><span class="line">t1.id = t2.dept_id</span><br><span class="line"></span><br></pre></td></tr></table></figure><blockquote><p>从员工入职时间大于2018-10-01的【表t2】中，以及【dept表】中。查询两个id对应的信息。</p><p>t2是子查询得到的多行多列的，可以理解为一张新表</p></blockquote><ul><li><p>以上代码也可以通过内连接来实现相同功能。</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> dept,emp <span class="keyword">where</span> emp.join_date &gt; <span class="string">&#x27;2018-10-01&#x27;</span> <span class="keyword">and</span> emp.dept_id = dept.id;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li></ul></li></ol></li></ul><h2 id="2-多表查询案例"><a href="#2-多表查询案例" class="headerlink" title="2. 多表查询案例"></a>2. 多表查询案例</h2><blockquote><ol><li>创建三张表</li><li>添加数据</li><li>根据需求查询</li></ol></blockquote><ol><li><p>创建4张表：部门表dept、职务表job、工作等级表和员工表</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 创建部门表</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> dept(</span><br><span class="line"><span class="keyword">id</span> <span class="built_in">int</span> primary <span class="keyword">key</span> auto_increment,</span><br><span class="line">    dname <span class="built_in">varchar</span>(<span class="number">50</span>),<span class="comment">-- 部门名称</span></span><br><span class="line">    loc <span class="built_in">varchar</span>(<span class="number">50</span>)<span class="comment">-- 工作地点</span></span><br><span class="line">);</span><br><span class="line"><span class="comment">-- 创建职务表</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> job(</span><br><span class="line"><span class="keyword">id</span> <span class="built_in">int</span> primary <span class="keyword">key</span>,</span><br><span class="line">    jname <span class="built_in">varchar</span>(<span class="number">20</span>), <span class="comment">-- 职务名称</span></span><br><span class="line">    description <span class="built_in">varchar</span>(<span class="number">50</span>) <span class="comment">-- 职务描述</span></span><br><span class="line">);</span><br><span class="line"><span class="comment">-- 创建员工表</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> emp(</span><br><span class="line"><span class="keyword">id</span> <span class="built_in">int</span> primary <span class="keyword">key</span> auto_increment,</span><br><span class="line">    ename <span class="built_in">varchar</span>(<span class="number">50</span>), <span class="comment">-- 员工姓名</span></span><br><span class="line">    job_id <span class="built_in">int</span>,<span class="comment">-- 职务id</span></span><br><span class="line">    mgr <span class="built_in">int</span>, <span class="comment">-- 上级领导</span></span><br><span class="line">    joindate <span class="built_in">date</span>, <span class="comment">-- 入职日期</span></span><br><span class="line">    salary <span class="keyword">double</span>,<span class="comment">-- 薪资</span></span><br><span class="line">    bonus <span class="keyword">double</span>,<span class="comment">-- 奖金</span></span><br><span class="line">    dept_id <span class="built_in">int</span>,<span class="comment">-- 部门编号</span></span><br><span class="line">    <span class="keyword">constraint</span> emp_jobid_ref_job_id_fk <span class="keyword">foreign</span> <span class="keyword">key</span> (job_id) <span class="keyword">references</span> job(<span class="keyword">id</span>),</span><br><span class="line">    <span class="keyword">foreign</span> <span class="keyword">key</span>(job_id) <span class="keyword">references</span> job(<span class="keyword">id</span>) <span class="comment">-- 简写外键</span></span><br><span class="line">);</span><br><span class="line"><span class="comment">-- 创建工资等级表</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> salarygrade(</span><br><span class="line">grade <span class="built_in">int</span> primary <span class="keyword">key</span>, <span class="comment">-- 等级</span></span><br><span class="line">    losalary <span class="built_in">int</span>,<span class="comment">-- 最高工资</span></span><br><span class="line">    hisalary <span class="built_in">int</span><span class="comment">-- 最低工资</span></span><br><span class="line">);</span><br><span class="line"></span><br></pre></td></tr></table></figure></li></ol><ol start="2"><li><p>分别给4张表添加数据</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 添加4个部门</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> dept(<span class="keyword">id</span>,dname,loc) <span class="keyword">VALUES</span> </span><br><span class="line">(<span class="number">10</span>,<span class="string">&#x27;教研部&#x27;</span>,<span class="string">&#x27;北京&#x27;</span>),</span><br><span class="line">(<span class="number">20</span>,<span class="string">&#x27;学工部&#x27;</span>,<span class="string">&#x27;上海&#x27;</span>),</span><br><span class="line">(<span class="number">30</span>,<span class="string">&#x27;销售部&#x27;</span>,<span class="string">&#x27;广州&#x27;</span>),</span><br><span class="line">(<span class="number">40</span>,<span class="string">&#x27;财务部&#x27;</span>,<span class="string">&#x27;深圳&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 添加4个职务</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> job (<span class="keyword">id</span>, jname, description) <span class="keyword">VALUES</span></span><br><span class="line">(<span class="number">1</span>, <span class="string">&#x27;董事长&#x27;</span>, <span class="string">&#x27;管理整个公司，接单&#x27;</span>),</span><br><span class="line">(<span class="number">2</span>, <span class="string">&#x27;经理&#x27;</span>, <span class="string">&#x27;管理部门员工&#x27;</span>),</span><br><span class="line">(<span class="number">3</span>, <span class="string">&#x27;销售员&#x27;</span>, <span class="string">&#x27;向客人推销产品&#x27;</span>),</span><br><span class="line">(<span class="number">4</span>, <span class="string">&#x27;文员&#x27;</span>, <span class="string">&#x27;使用办公软件&#x27;</span>);</span><br><span class="line">            </span><br><span class="line"><span class="comment">-- 添加员工</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> emp(<span class="keyword">id</span>,ename,job_id,mgr,joindate,salary,bonus,dept_id) <span class="keyword">VALUES</span> </span><br><span class="line">(<span class="number">1001</span>,<span class="string">&#x27;孙悟空&#x27;</span>,<span class="number">4</span>,<span class="number">1004</span>,<span class="string">&#x27;2000-12-17&#x27;</span>,<span class="string">&#x27;8000.00&#x27;</span>,<span class="literal">NULL</span>,<span class="number">20</span>),</span><br><span class="line">(<span class="number">1002</span>,<span class="string">&#x27;卢俊义&#x27;</span>,<span class="number">3</span>,<span class="number">1006</span>,<span class="string">&#x27;2001-02-20&#x27;</span>,<span class="string">&#x27;16000.00&#x27;</span>,<span class="string">&#x27;3000.00&#x27;</span>,<span class="number">30</span>),</span><br><span class="line">(<span class="number">1003</span>,<span class="string">&#x27;林冲&#x27;</span>,<span class="number">3</span>,<span class="number">1006</span>,<span class="string">&#x27;2001-02-22&#x27;</span>,<span class="string">&#x27;12500.00&#x27;</span>,<span class="string">&#x27;5000.00&#x27;</span>,<span class="number">30</span>),</span><br><span class="line">(<span class="number">1004</span>,<span class="string">&#x27;唐僧&#x27;</span>,<span class="number">2</span>,<span class="number">1009</span>,<span class="string">&#x27;2001-04-02&#x27;</span>,<span class="string">&#x27;29750.00&#x27;</span>,<span class="literal">NULL</span>,<span class="number">20</span>),</span><br><span class="line">(<span class="number">1005</span>,<span class="string">&#x27;李逵&#x27;</span>,<span class="number">4</span>,<span class="number">1006</span>,<span class="string">&#x27;2001-09-28&#x27;</span>,<span class="string">&#x27;12500.00&#x27;</span>,<span class="string">&#x27;14000.00&#x27;</span>,<span class="number">30</span>),</span><br><span class="line">(<span class="number">1006</span>,<span class="string">&#x27;宋江&#x27;</span>,<span class="number">2</span>,<span class="number">1009</span>,<span class="string">&#x27;2001-05-01&#x27;</span>,<span class="string">&#x27;28500.00&#x27;</span>,<span class="literal">NULL</span>,<span class="number">30</span>),</span><br><span class="line">(<span class="number">1007</span>,<span class="string">&#x27;刘备&#x27;</span>,<span class="number">2</span>,<span class="number">1009</span>,<span class="string">&#x27;2001-09-01&#x27;</span>,<span class="string">&#x27;24500.00&#x27;</span>,<span class="literal">NULL</span>,<span class="number">10</span>),</span><br><span class="line">(<span class="number">1008</span>,<span class="string">&#x27;猪八戒&#x27;</span>,<span class="number">4</span>,<span class="number">1004</span>,<span class="string">&#x27;2007-04-19&#x27;</span>,<span class="string">&#x27;30000.00&#x27;</span>,<span class="literal">NULL</span>,<span class="number">20</span>),</span><br><span class="line">(<span class="number">1009</span>,<span class="string">&#x27;罗贯中&#x27;</span>,<span class="number">1</span>,<span class="literal">NULL</span>,<span class="string">&#x27;2001-11-17&#x27;</span>,<span class="string">&#x27;50000.00&#x27;</span>,<span class="literal">NULL</span>,<span class="number">10</span>),</span><br><span class="line">(<span class="number">1010</span>,<span class="string">&#x27;吴用&#x27;</span>,<span class="number">3</span>,<span class="number">1006</span>,<span class="string">&#x27;2001-09-08&#x27;</span>,<span class="string">&#x27;15000.00&#x27;</span>,<span class="string">&#x27;0.00&#x27;</span>,<span class="number">30</span>),</span><br><span class="line">(<span class="number">1011</span>,<span class="string">&#x27;沙僧&#x27;</span>,<span class="number">4</span>,<span class="number">1004</span>,<span class="string">&#x27;2007-05-23&#x27;</span>,<span class="string">&#x27;11000.00&#x27;</span>,<span class="literal">NULL</span>,<span class="number">20</span>),</span><br><span class="line">(<span class="number">1012</span>,<span class="string">&#x27;李逵&#x27;</span>,<span class="number">4</span>,<span class="number">1006</span>,<span class="string">&#x27;2001-12-03&#x27;</span>,<span class="string">&#x27;9500.00&#x27;</span>,<span class="literal">NULL</span>,<span class="number">30</span>),</span><br><span class="line">(<span class="number">1013</span>,<span class="string">&#x27;小白龙&#x27;</span>,<span class="number">4</span>,<span class="number">1004</span>,<span class="string">&#x27;2001-12-03&#x27;</span>,<span class="string">&#x27;30000.00&#x27;</span>,<span class="literal">NULL</span>,<span class="number">20</span>),</span><br><span class="line">(<span class="number">1014</span>,<span class="string">&#x27;关羽&#x27;</span>,<span class="number">4</span>,<span class="number">1007</span>,<span class="string">&#x27;2002-01-23&#x27;</span>,<span class="string">&#x27;13000.00&#x27;</span>,<span class="literal">NULL</span>,<span class="number">10</span>);</span><br><span class="line"><span class="comment">-- 添加工资等级</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> salarygrade(grade,losalary,hisalary) <span class="keyword">VALUES</span> </span><br><span class="line">(<span class="number">1</span>,<span class="number">7000</span>,<span class="number">12000</span>),</span><br><span class="line">(<span class="number">2</span>,<span class="number">12010</span>,<span class="number">14000</span>),</span><br><span class="line">(<span class="number">3</span>,<span class="number">14010</span>,<span class="number">20000</span>),</span><br><span class="line">(<span class="number">4</span>,<span class="number">20010</span>,<span class="number">30000</span>),</span><br><span class="line">(<span class="number">5</span>,<span class="number">30010</span>,<span class="number">99990</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li><p>按照需求查询从三张表中查询相应数据</p><blockquote><ol><li>查询所有员工信息。查询员工编号，员工姓名，工资，职务名称，职务描述</li></ol></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span>  <span class="comment">-- 2. 分析需要查询的数据</span></span><br><span class="line">emp.id,</span><br><span class="line">emp.ename,</span><br><span class="line">emp.salary,</span><br><span class="line">job.jname,</span><br><span class="line">job.description</span><br><span class="line"><span class="keyword">from</span><span class="comment">-- 1. 分析需要使用的表</span></span><br><span class="line">emp,</span><br><span class="line">job</span><br><span class="line"><span class="keyword">where</span><span class="comment">-- 3. 分析查询数据的条件</span></span><br><span class="line">emp.job_id = job.id;</span><br><span class="line"></span><br></pre></td></tr></table></figure><blockquote><ol start="2"><li>查询员工编号，员工姓名，工资，职务名称，职务描述，部门名称，部门位置</li></ol></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="comment">-- 2. 分析查询的数据</span></span><br><span class="line">emp.ename,</span><br><span class="line">emp.salary,</span><br><span class="line">job.jname,</span><br><span class="line">job.description,</span><br><span class="line">dept.dname,</span><br><span class="line">dept.loc</span><br><span class="line"><span class="keyword">from</span> <span class="comment">-- 1. 分析需要的表</span></span><br><span class="line">emp,</span><br><span class="line">job,</span><br><span class="line">dept</span><br><span class="line"><span class="keyword">where</span> <span class="comment">-- 3. 分析查询条件</span></span><br><span class="line">emp.job_id = job.id <span class="keyword">and</span> emp.dept_id = dept.id;</span><br><span class="line"></span><br></pre></td></tr></table></figure><blockquote><ol start="3"><li>查询员工姓名，工资，工资等级</li></ol></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="comment">-- 2. 分析显示的数据</span></span><br><span class="line">emp.ename,</span><br><span class="line">emp.salary,</span><br><span class="line">salarygrade.grade</span><br><span class="line"><span class="keyword">from</span>  <span class="comment">-- 1.分析需要表</span></span><br><span class="line">emp,</span><br><span class="line">salarygrade</span><br><span class="line"><span class="keyword">where</span> <span class="comment">-- 3. 分析条件【重点，难点】</span></span><br><span class="line">emp.salary &gt;= salarygrade.losalary <span class="keyword">and</span> emp.salary &lt;= salarygrade.hisalary</span><br><span class="line"><span class="comment">-- emp.salary BETWEEN salarygrade.losalary and salarygrade.hisalary</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><blockquote><ol start="4"><li>查询员工姓名，工资，职务名称，职务描述，部门名称，部门位置，工资等级</li></ol></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="comment">-- 2. 分析显示的数据</span></span><br><span class="line">emp.ename,</span><br><span class="line">emp.salary,</span><br><span class="line">job.description,</span><br><span class="line">job.jname,</span><br><span class="line">dept.loc,</span><br><span class="line">salarygrade.grade</span><br><span class="line"><span class="keyword">from</span>  <span class="comment">-- 1.分析需要表</span></span><br><span class="line">emp,</span><br><span class="line">job,</span><br><span class="line">salarygrade,</span><br><span class="line">dept</span><br><span class="line"><span class="keyword">where</span> <span class="comment">-- 3. 分析条件【重点，难点】</span></span><br><span class="line">emp.salary &gt;= salarygrade.losalary <span class="keyword">and</span> emp.salary &lt;= salarygrade.hisalary <span class="keyword">and</span> emp.job_id = job.id <span class="keyword">and</span> emp.dept_id = dept.id;</span><br><span class="line"><span class="comment">-- emp.salary BETWEEN salarygrade.losalary and salarygrade.hisalary</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><blockquote><ol start="5"><li>查询出部门编号、部门名称、部门位置、部门人数</li></ol><p>条件分析：</p><pre><code>      1. 先统计出emp表中的每个部门的人数。          2. 根据统计部门人数的表，以及部门表查询出结果</code></pre></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> </span><br><span class="line">dept.id,</span><br><span class="line">dept.dname,</span><br><span class="line">dept.loc,</span><br><span class="line">t2.total</span><br><span class="line"><span class="keyword">from</span>  </span><br><span class="line">dept t1,</span><br><span class="line">(<span class="keyword">select</span> dept_id,<span class="keyword">count</span>(<span class="keyword">id</span>) total <span class="keyword">from</span> emp <span class="keyword">group</span> <span class="keyword">by</span> dept_id) t2  <span class="comment">-- 辅助表</span></span><br><span class="line"><span class="keyword">where</span> </span><br><span class="line">t1.id = t2.dept_id;</span><br><span class="line"></span><br></pre></td></tr></table></figure><blockquote><ol start="6"><li>查询所有员工的姓名及其直接上级的姓名,没有领导的员工也需要查询</li></ol></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 不可以查出空</span></span><br><span class="line"><span class="keyword">select</span> </span><br><span class="line">t1.ename,</span><br><span class="line">t1.mgr,</span><br><span class="line">t2.id,</span><br><span class="line">t2.ename</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">emp t1,</span><br><span class="line">emp t2</span><br><span class="line"><span class="keyword">where</span> t1.mgr = t2.id;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 可以查出空</span></span><br><span class="line"><span class="keyword">select</span> </span><br><span class="line">t1.ename,</span><br><span class="line">t1.mgr,</span><br><span class="line">t2.id,</span><br><span class="line">t2.ename</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">emp t1</span><br><span class="line"><span class="keyword">left</span> <span class="keyword">join</span> emp t2</span><br><span class="line"><span class="keyword">on</span> t1.mgr = t2.id;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li></ol><h2 id="3-事务"><a href="#3-事务" class="headerlink" title="3. 事务"></a>3. 事务</h2><ol><li><p>引入</p><ul><li><p>在实际开发中，一个业务操作通常包含了多次数据库的操作。例如：转账。</p></li><li><p>创建表、添加数据</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 创建账号表</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> <span class="keyword">account</span>(</span><br><span class="line"><span class="keyword">id</span> <span class="built_in">int</span> primary <span class="keyword">key</span> auto_increment,</span><br><span class="line">    <span class="keyword">name</span> <span class="built_in">varchar</span>(<span class="number">10</span>),</span><br><span class="line">    balance <span class="keyword">double</span></span><br><span class="line">);</span><br><span class="line"><span class="comment">-- 添加数据</span></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">account</span> <span class="keyword">values</span>(<span class="number">1</span>,<span class="string">&quot;Tobing&quot;</span>,<span class="number">1000</span>),(<span class="literal">null</span>,<span class="string">&quot;Zenyet&quot;</span>,<span class="number">1000</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li><p>模拟转账【正常情况】</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 1.Tobing - 500</span></span><br><span class="line"><span class="keyword">update</span> <span class="keyword">account</span> <span class="keyword">set</span> balance = balance - <span class="number">500</span> <span class="keyword">where</span> <span class="keyword">name</span> = <span class="string">&#x27;Tobing&#x27;</span>;</span><br><span class="line"><span class="comment">-- 2.Zenyet + 500</span></span><br><span class="line"><span class="keyword">update</span> <span class="keyword">account</span> <span class="keyword">set</span> balance = balance + <span class="number">500</span> <span class="keyword">where</span> <span class="keyword">name</span> = <span class="string">&#x27;Zenyet&#x27;</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li><p>模拟转账【出现异常】</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 1.Tobing - 500</span></span><br><span class="line"><span class="keyword">update</span> <span class="keyword">account</span> <span class="keyword">set</span> balance = balance - <span class="number">500</span> <span class="keyword">where</span> <span class="keyword">name</span> = <span class="string">&#x27;Tobing&#x27;</span>;</span><br><span class="line">出现异常</span><br><span class="line"><span class="comment">-- 2.Zenyet + 500</span></span><br><span class="line"><span class="keyword">update</span> <span class="keyword">account</span> <span class="keyword">set</span> balance = balance + <span class="number">500</span> <span class="keyword">where</span> <span class="keyword">name</span> = <span class="string">&#x27;Zenyet&#x27;</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure><blockquote><p>此时会出现Tobing已经减掉500，而Zenyet却没有加上500。500凭空消失了</p></blockquote></li><li><p>有以上案例我们可以看出</p><blockquote><ol><li>在实际开发中，一个事务往往包含了多次的数据库操作（本例中转账就包含了两个步骤），如果其中一个步骤出现了异常，往往会导致结果出现异常。</li><li>而数据库通过使用事务这一操作。将若干的数据库操作，定义在一个事务中，如果事务中任意语句执行出现异常，可以选择进行rollback，是数据库回滚到事务开始状态。如果执行没有问题，则可以commit，提交事务。</li></ol></blockquote><p><img src="E:\Code\Personal_website\tobing\source_posts\assets\事务.png" class="lazyload" data-srcset="E:\Code\Personal_website\tobing\source_posts\assets\事务.png" srcset="data:image/png;base64,666" alt="事务"></p></li></ul></li></ol><ol start="2"><li><p>事务提交的分类</p><blockquote><ol><li>手动提交：MySQL默认自动提交，一条DML自动提交一次事务。</li><li>自动提交：Oracle默认手动提交，先开启事务，然后再提交</li></ol></blockquote><ol><li><p>MySQL中修改事务默认的提交方式。</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查看事务提交的方式</span></span><br><span class="line"><span class="keyword">select</span> @@autocommit;</span><br><span class="line"><span class="comment">-- 修改默认提交方式 1代表自动提价 | 0代表手动提交</span></span><br><span class="line"><span class="keyword">set</span> @@autocommit = <span class="number">0</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li><p>事务的四大特征【重点】</p><blockquote><ol><li>原子性：是不可分割的最小单位，事务中的所有操作要么同时成功，要么同时失败。</li><li>持久性：事务commit或者rollback，数据库都会持久化保存数据</li><li>隔离性：多个事务之间相互独立</li><li>一致性：事务操作前后，数据总量不变。</li></ol></blockquote></li><li><p>事务的隔离级别</p><ol><li><p>引入：多个事务之间隔离，相互独立。但是如果多个事务操作同一数据，会引发一些问题，设置隔离级别可以解决这些问题。</p></li><li><p>引发的问题</p><ol><li>脏读：一个事务读取到另外一个事务没有提交（commit）的数据。</li><li>虚读（不可重复读）：同一事务中，两次读到的数据不一样。</li><li>幻读：一个事务操作数据表中的所有记录，另一个事务添加了一条数据，则第一个事务查询不到自己的修改。</li></ol></li><li><p>隔离级别</p><ol><li><p>read uncommitted（读未提交）</p><ul><li>产生：脏读、不可重复读、幻读。</li></ul></li><li><p>read committed（读已提交）：</p><ul><li>产生：不可重复读、幻读。</li></ul></li><li><p>repeatable read（可重复读）：</p><ul><li>产生：幻读。</li></ul></li><li><p>serializable（串行化）：</p><ul><li>解决所有</li></ul></li><li><p>注意</p><ul><li>隔离级别从小到大安全性越来越高，但是效率越来越低</li><li>通常在特殊场景才会修改 隔离级别。一般使用默认隔离级别</li><li>Oracle默认read committed</li><li>MySQL默认repeatable read</li></ul></li><li><p>隔离级别操作</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查询隔离级别</span></span><br><span class="line"><span class="keyword">select</span> @@tx_isolation;</span><br><span class="line"><span class="comment">-- 修改隔离级别</span></span><br><span class="line"><span class="keyword">set</span> <span class="keyword">global</span> <span class="keyword">transaction</span> <span class="keyword">isolation</span> <span class="keyword">level</span> [隔离级别字符串]</span><br><span class="line"></span><br></pre></td></tr></table></figure></li></ol></li></ol></li></ol></li></ol>]]></content>
      
      
      <categories>
          
          <category> 理论学习 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> MySQL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MySQL-3-数据库的设计</title>
      <link href="2019/11/23/MySQL-3-%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E8%AE%BE%E8%AE%A1/"/>
      <url>2019/11/23/MySQL-3-%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E8%AE%BE%E8%AE%A1/</url>
      
        <content type="html"><![CDATA[<p>MySQL学习第三弹。</p><a id="more"></a><h1 id="MySQL-3-数据库的设计"><a href="#MySQL-3-数据库的设计" class="headerlink" title="MySQL-3-数据库的设计"></a>MySQL-3-数据库的设计</h1><h2 id="1-表之间的关系"><a href="#1-表之间的关系" class="headerlink" title="1. 表之间的关系"></a>1. 表之间的关系</h2><h3 id="1-分类"><a href="#1-分类" class="headerlink" title="1. 分类"></a>1. 分类</h3><blockquote><ol><li>一对一<ul><li>人和身份证</li><li>一个人只有一个身份证，一个身份证对应一个人</li></ul></li><li>一对多<ul><li>部门和员工</li><li>一个部门有多个员工，而多个员工对应一个部门</li></ul></li><li>多对多<ul><li>学生和课程</li><li>一个学生可以选多门课程，一个课程可以被多个学生选择</li></ul></li></ol></blockquote><h3 id="2-实现"><a href="#2-实现" class="headerlink" title="2. 实现"></a>2. 实现</h3><ol><li><p>一对多：例如，部门和员工</p><blockquote><p>实现方式：在【多】的一方建立外键，指向【一】的一方的主键。</p></blockquote><p><img src="https://gitee.com/tobing/imagebed/raw/master/image-20210115121413016.png" class="lazyload" data-srcset="https://gitee.com/tobing/imagebed/raw/master/image-20210115121413016.png" srcset="data:image/png;base64,666" alt="image-20210115121413016"></p></li><li><p>多对多：例如，学生和课程</p><blockquote><p>实现方式：借助第三张中间表。表中至少包含两个字段，这两个字段作为第三张表的外键，分别指向两张表的主键</p></blockquote><p><img src="https://gitee.com/tobing/imagebed/raw/master/NToN.png" class="lazyload" data-srcset="https://gitee.com/tobing/imagebed/raw/master/NToN.png" srcset="data:image/png;base64,666" alt="NToN"></p></li><li><p>一对一：人和身份证</p><blockquote><p>实现方式：在任意一方添加唯一约束的主键，指向另外一方。</p><p>注意：实际中很少这种情况，既然存在一对一，为何不把它们放在同一张表中呢？</p></blockquote><p><img src="https://gitee.com/tobing/imagebed/raw/master/oneToone.png" class="lazyload" data-srcset="https://gitee.com/tobing/imagebed/raw/master/oneToone.png" srcset="data:image/png;base64,666" alt="oneToone"></p></li></ol><h3 id="3-旅游线路的分析"><a href="#3-旅游线路的分析" class="headerlink" title="3. 旅游线路的分析"></a>3. 旅游线路的分析</h3><ul><li><p>旅游线路表、线路分类表、用户表</p><blockquote><p>线路分类下有很多条旅游线路，一条旅游线路可以被多个用户收藏，一个用户可以收藏多条线路。</p></blockquote></li><li><p>分析：</p><p><img src="https://gitee.com/tobing/imagebed/raw/master/traveldemo.png" class="lazyload" data-srcset="https://gitee.com/tobing/imagebed/raw/master/traveldemo.png" srcset="data:image/png;base64,666" alt="traveldemo"></p></li><li><p>代码实现：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 旅游分类表</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> tab_categroy(</span><br><span class="line">cid <span class="built_in">INT</span> PRIMARY <span class="keyword">KEY</span> AUTO_INCREMENT,<span class="comment">-- 主键，自增长</span></span><br><span class="line">cname <span class="built_in">VARCHAR</span>(<span class="number">100</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">UNIQUE</span>  <span class="comment">-- cname 非空，唯一</span></span><br><span class="line">);</span><br><span class="line"><span class="comment">-- 旅游线路表</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> tab_route(</span><br><span class="line">rid <span class="built_in">INT</span> PRIMARY <span class="keyword">KEY</span> AUTO_INCREMENT,  <span class="comment">-- 主键，自增长</span></span><br><span class="line">rname <span class="built_in">VARCHAR</span>(<span class="number">100</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">UNIQUE</span>,  <span class="comment">-- rname 非空，唯一</span></span><br><span class="line">price <span class="keyword">DOUBLE</span>, </span><br><span class="line">rdate <span class="built_in">DATE</span>,</span><br><span class="line">cid <span class="built_in">INT</span>, <span class="comment">-- 外键</span></span><br><span class="line">    <span class="comment">-- 将cid与tab_categroy中的cid关联</span></span><br><span class="line"><span class="keyword">FOREIGN</span> <span class="keyword">KEY</span>(cid) <span class="keyword">REFERENCES</span> tab_categroy(cid)</span><br><span class="line">);</span><br><span class="line"><span class="comment">-- 用户表</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> tab_user(</span><br><span class="line">uid <span class="built_in">INT</span> PRIMARY <span class="keyword">KEY</span> AUTO_INCREMENT,  <span class="comment">-- 主键，自增长</span></span><br><span class="line">username <span class="built_in">VARCHAR</span>(<span class="number">100</span>) <span class="keyword">UNIQUE</span> <span class="keyword">NOT</span> <span class="literal">NULL</span>, </span><br><span class="line"><span class="keyword">PASSWORD</span> <span class="built_in">VARCHAR</span>(<span class="number">30</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line"><span class="keyword">NAME</span> <span class="built_in">VARCHAR</span>(<span class="number">100</span>),</span><br><span class="line">birthday <span class="built_in">DATE</span>,</span><br><span class="line">sex <span class="built_in">CHAR</span>(<span class="number">1</span>) <span class="keyword">DEFAULT</span> <span class="string">&#x27;男&#x27;</span>,            <span class="comment">-- 性别，默认男</span></span><br><span class="line">telephone <span class="built_in">VARCHAR</span>(<span class="number">11</span>),</span><br><span class="line">email <span class="built_in">VARCHAR</span>(<span class="number">100</span>)</span><br><span class="line">);</span><br><span class="line"><span class="comment">-- 收藏（连接用户与线路）</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> tab_favorite(</span><br><span class="line">rid <span class="built_in">INT</span>,</span><br><span class="line"><span class="built_in">DATE</span> DATETIME,<span class="comment">-- 关联时间</span></span><br><span class="line">uid <span class="built_in">INT</span>,</span><br><span class="line">PRIMARY <span class="keyword">KEY</span>(rid,uid),</span><br><span class="line"><span class="keyword">FOREIGN</span> <span class="keyword">KEY</span>(rid) <span class="keyword">REFERENCES</span> tab_route(rid), <span class="comment">-- rid关联tab_route中的rid</span></span><br><span class="line"><span class="keyword">FOREIGN</span> <span class="keyword">KEY</span>(uid) <span class="keyword">REFERENCES</span> tab_user(uid)   <span class="comment">-- uid关联tab_user中的uid</span></span><br><span class="line">);</span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li><p>SQLyog架构设计器显示</p><p><img src="https://gitee.com/tobing/imagebed/raw/master/demo.png" class="lazyload" data-srcset="https://gitee.com/tobing/imagebed/raw/master/demo.png" srcset="data:image/png;base64,666" alt="demo"></p></li></ul><h2 id="2-范式（略）"><a href="#2-范式（略）" class="headerlink" title="2. 范式（略）"></a>2. 范式（略）</h2>]]></content>
      
      
      <categories>
          
          <category> 理论学习 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> MySQL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MySQL-2-基本操作</title>
      <link href="2019/11/15/MySQL-2-%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C/"/>
      <url>2019/11/15/MySQL-2-%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C/</url>
      
        <content type="html"><![CDATA[<p>MySQL复习第二弹。</p><a id="more"></a><h1 id="MySQL-2-基本操作"><a href="#MySQL-2-基本操作" class="headerlink" title="MySQL-2-基本操作"></a>MySQL-2-基本操作</h1><h3 id="1-DDL：操作数据库、表"><a href="#1-DDL：操作数据库、表" class="headerlink" title="1. DDL：操作数据库、表"></a>1. DDL：操作数据库、表</h3><ol><li><p>操作数据库：CRUD</p><ol><li><p>C（Create）：创建</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 创建数据库</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">database</span> [数据库名称];</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">database</span> <span class="keyword">if</span> <span class="keyword">not</span> <span class="keyword">exists</span> [数据库名称];<span class="comment">-- 创建并判断是否存在</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">database</span> [数据库名称] <span class="built_in">character</span> <span class="keyword">set</span> [字符集名称];  <span class="comment">-- 创建并指定字符集</span></span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 创建db4数据库，判断是否存在，并指定字符集为gbk</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">database</span> <span class="keyword">if</span> <span class="keyword">not</span> <span class="keyword">exists</span> db4 <span class="built_in">character</span> <span class="keyword">set</span> gbk;</span><br></pre></td></tr></table></figure></li><li><p>R（Retrieve）：查询</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查询所有数据库名称</span></span><br><span class="line"><span class="keyword">show</span> <span class="keyword">databases</span>;</span><br><span class="line"><span class="comment">-- 查询某一个数据库的字符集：查询某一个数据库的创建语句</span></span><br><span class="line"><span class="keyword">show</span> <span class="keyword">create</span> <span class="keyword">database</span> [数据库名称]</span><br></pre></td></tr></table></figure></li><li><p>U（Update）：修改</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 修改数据库字符集</span></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">database</span> [数据库名称] <span class="built_in">character</span> <span class="keyword">set</span> [字符集名称]</span><br></pre></td></tr></table></figure></li><li><p>D（Delete）：删除</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 删除数据库</span></span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">database</span> [数据库名称];</span><br><span class="line"><span class="comment">-- 判断存在，存在再删除</span></span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">database</span> <span class="keyword">if</span> <span class="keyword">exists</span> [数据库名称];</span><br></pre></td></tr></table></figure></li><li><p>使用数据库</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查询当前使用的数据库名称</span></span><br><span class="line"><span class="keyword">select</span> <span class="keyword">database</span>();</span><br><span class="line"><span class="comment">-- 使用数据库</span></span><br><span class="line"><span class="keyword">use</span> [数据库名称];</span><br></pre></td></tr></table></figure></li></ol></li><li><p>操作表</p><ol><li><p>C（Create）：创建</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 创建表</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> [表名] (</span><br><span class="line">列名 数据类型,</span><br><span class="line">    列名 数据类型,</span><br><span class="line">    ...</span><br><span class="line"><span class="comment">-- 最后一个没有逗号</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure><blockquote><ul><li>int：整数</li><li>double：浮点</li><li>date：日期（年月日），yyyy-MM-dd</li><li>datetime：（年月日时分秒） yyyy-MM-dd HH:mm:ss</li><li>timestamp：时间戳类型 包含年月日时分秒  yyyy-MM-dd（默认为当前系统时间）</li><li>varchar：字符串</li></ul></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 复制表</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> [表名] <span class="keyword">like</span> [被复制的表] </span><br></pre></td></tr></table></figure></li><li><p>R（Retrieve）：查询</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查询当前数据库下所有的表</span></span><br><span class="line"><span class="keyword">show</span> <span class="keyword">tables</span>;</span><br><span class="line"><span class="comment">-- 查指定的表结构</span></span><br><span class="line">desc [表名]</span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li><p>U（Update）：修改</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 修改表名</span></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> [表名] <span class="keyword">rename</span> <span class="keyword">to</span> [新的表名]</span><br><span class="line"><span class="comment">-- 修改表的字符集</span></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> [表名] <span class="built_in">character</span> <span class="keyword">set</span> [字符集名称]</span><br><span class="line"><span class="comment">-- 添加一列</span></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> [表名] <span class="keyword">add</span> [列名] [数据类型]</span><br><span class="line"><span class="comment">-- 修改列名称 类型</span></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> [表名] <span class="keyword">change</span> [列名] [新列名] [新数据类型]</span><br><span class="line"><span class="comment">-- 删除列</span></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> [表名] <span class="keyword">drop</span> [列名]</span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li><p>D（Delete）：删除</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 删除表</span></span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> [表名];</span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> <span class="keyword">if</span> <span class="keyword">exists</span> [表名];</span><br><span class="line"></span><br></pre></td></tr></table></figure></li></ol></li></ol><h3 id="2-DML：修改表中的数据"><a href="#2-DML：修改表中的数据" class="headerlink" title="2. DML：修改表中的数据"></a>2. DML：修改表中的数据</h3><ol><li><p>添加数据：insert</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 插入</span></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> 表名(列名<span class="number">1</span>，列名<span class="number">2</span>，列名<span class="number">3.</span>...) <span class="keyword">values</span>(值<span class="number">1</span>，值<span class="number">2</span>，值<span class="number">3.</span>..);</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> 表名 <span class="keyword">values</span>(值<span class="number">1</span>，值<span class="number">2</span>，....);</span><br><span class="line"></span><br></pre></td></tr></table></figure><blockquote><ol><li>列名要和值一一对应。</li><li>如果表名后，不定义列名，则给所有的列添加值。</li><li>除了数学类型，其他类型需要使用引号（单双都可以）引起来。</li></ol></blockquote></li><li><p>删除数据：delete</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> [表名] [<span class="keyword">where</span> 条件]</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 删除所有记录</span></span><br><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> [表名]; <span class="comment">-- 不推荐使用。有多少天记录就输出第三条记录（按记录删除）</span></span><br><span class="line"><span class="keyword">truncate</span> <span class="keyword">table</span> [表名]<span class="comment">-- 推荐使用，效率更高，先删除表，如果在创建一张的表（按表删除）</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><blockquote><ol><li>如果不加条件，则删除表中所有记录</li></ol></blockquote></li><li><p>修改数据：update</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">update</span> [表名] <span class="keyword">set</span> [列<span class="number">1</span>] = [列<span class="number">1</span>], [列<span class="number">2</span>] = [值<span class="number">2</span>] .... [<span class="keyword">where</span> 条件]</span><br><span class="line"></span><br></pre></td></tr></table></figure><blockquote><p>注意：如果不加任何条件，表中使用记录都会被更改。</p></blockquote></li></ol><h3 id="3-DQL：查询表中记录"><a href="#3-DQL：查询表中记录" class="headerlink" title="3. DQL：查询表中记录"></a>3. DQL：查询表中记录</h3><ul><li><p>格式</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span></span><br><span class="line">    [字段列表]</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">    [表名列表]</span><br><span class="line"><span class="keyword">where</span></span><br><span class="line">    [条件列表]</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span></span><br><span class="line">    [分组字段]</span><br><span class="line"><span class="keyword">having</span></span><br><span class="line">    [分组之后的条件]</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span></span><br><span class="line">    [排序]</span><br><span class="line"><span class="keyword">limit</span></span><br><span class="line">    [分页限定]</span><br><span class="line"></span><br></pre></td></tr></table></figure></li></ul><ul><li><p>普通字段查询</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 多字段查询</span></span><br><span class="line"><span class="keyword">select</span> 字段<span class="number">1</span>，字段<span class="number">2.</span>.. <span class="keyword">from</span> [表名];</span><br><span class="line"><span class="comment">-- 查询所有字段</span></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> [表名];</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 去除重复distinct</span></span><br><span class="line"><span class="keyword">select</span> <span class="keyword">distinct</span> [列名] <span class="keyword">from</span> [表名];</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询结果运行</span></span><br><span class="line"><span class="keyword">select</span> *,(列<span class="number">1</span>+列<span class="number">2</span>) <span class="keyword">form</span> [表名]<span class="comment">-- 显示该表所有数据，并将列1和列2的也相加显示（不限于相加）</span></span><br><span class="line"><span class="keyword">select</span> *,(列<span class="number">1</span>+列<span class="number">2</span>) <span class="keyword">as</span> [新列名] <span class="keyword">from</span> [表名] <span class="comment">-- 将新加的类列名设置为【新列名】</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><blockquote><p>as : 起别名</p></blockquote></li><li><p>条件查询</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">where [条件]</span><br><span class="line"></span><br></pre></td></tr></table></figure><blockquote><ul><li>运算符</li></ul><p>&lt;、&gt;</p><p>between…and</p><p>in(集合)</p><p>like:模糊查询</p><p>​    _：单个任意字符</p><p>​    %：多个任意字符</p><p>is null</p><p>and 或 &amp;&amp;</p><p>or 或 ||</p><p>not 或 ！</p></blockquote></li><li><p>排序查询</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">order by [子句]</span><br><span class="line">order by 排序字段1，排序方式1，排序字段2，排序方式2....</span><br><span class="line"></span><br></pre></td></tr></table></figure><blockquote><p>asc：默认，升序排序</p><p>desc：降序排序</p></blockquote></li><li><p>聚合函数：将一列数据作为一个整体，降序纵向计算。（例如：求和）</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">count</span>(列名) <span class="keyword">from</span> [表名] <span class="comment">-- 给某一列求个数</span></span><br><span class="line"><span class="keyword">select</span> <span class="keyword">count</span>(<span class="keyword">ifnull</span>([列名],<span class="number">0</span>)) <span class="keyword">from</span> [表名]</span><br><span class="line"></span><br></pre></td></tr></table></figure><blockquote><ol><li>count：计算个数<ul><li>一般选择非空的列，主键</li><li>count(*)</li></ul></li><li>max：计算最大值</li><li>min：计算最小值</li><li>sum：计算和</li><li>avg：计算平均值</li></ol><p>注意：使用时排查null值，一般选择非空列</p></blockquote></li><li><p>分组查询 group by</p></li></ul><ul><li><p>常用于对某个具有相同特征的整体进行操作</p><blockquote><p>注意：分组之后，查询的字段只能写聚合函数和分组字段。否则没有意义</p><p>having和where的区别</p><ul><li>where在分组之前进行限定，如果不满足条件，不参与分组。where之后不可以跟聚合函数。</li><li>having在分组后进行限定，如果不满足，则不会被查询出来。having可以进行聚合函数的判断。</li></ul></blockquote></li><li><p>分页查询 limit</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 模拟每页显示3条内容</span></span><br><span class="line"><span class="comment">-- 显示从0开始的3条记录</span></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> [表名] <span class="keyword">limit</span> <span class="number">0</span>,<span class="number">3</span>;  <span class="comment">-- 第一页</span></span><br><span class="line"><span class="comment">-- 显示从3开始的3条记录</span></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> [表名] <span class="keyword">limit</span> <span class="number">3</span>,<span class="number">3</span>;  <span class="comment">-- 第二页</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><blockquote><p>注意：limit是Mysql的方言</p></blockquote></li></ul><h3 id="4-limit案例"><a href="#4-limit案例" class="headerlink" title="4. limit案例"></a>4. limit案例</h3><ul><li><p>创建学生表</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> student3(  <span class="comment">-- 创建学生表</span></span><br><span class="line"><span class="keyword">id</span> <span class="built_in">INT</span>,<span class="comment">-- id</span></span><br><span class="line"><span class="keyword">NAME</span> <span class="built_in">VARCHAR</span>(<span class="number">20</span>), <span class="comment">-- 姓名</span></span><br><span class="line">age <span class="built_in">INT</span>,  <span class="comment">-- 年龄</span></span><br><span class="line">sex <span class="built_in">VARCHAR</span>(<span class="number">10</span>),  <span class="comment">-- 性别</span></span><br><span class="line">address <span class="built_in">VARCHAR</span>(<span class="number">30</span>), <span class="comment">-- 地址</span></span><br><span class="line">math <span class="keyword">DOUBLE</span>,         <span class="comment">-- 数学成绩</span></span><br><span class="line">english <span class="keyword">DOUBLE</span>       <span class="comment">-- 英语成绩</span></span><br><span class="line">);</span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li><p>插入数据</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> student3 <span class="keyword">VALUES</span></span><br><span class="line">(<span class="number">1</span>,<span class="string">&quot;张三丰&quot;</span>,<span class="number">20</span>,<span class="string">&#x27;男&#x27;</span>,<span class="string">&#x27;长安&#x27;</span>,<span class="number">77</span>,<span class="number">99</span>),</span><br><span class="line">(<span class="number">2</span>,<span class="string">&quot;张无忌&quot;</span>,<span class="number">25</span>,<span class="string">&#x27;男&#x27;</span>,<span class="string">&#x27;西安&#x27;</span>,<span class="number">99</span>,<span class="number">45</span>),</span><br><span class="line">(<span class="number">3</span>,<span class="string">&quot;张翠山&quot;</span>,<span class="number">28</span>,<span class="string">&#x27;男&#x27;</span>,<span class="string">&#x27;武汉&#x27;</span>,<span class="number">99</span>,<span class="number">12</span>),</span><br><span class="line">(<span class="number">4</span>,<span class="string">&quot;孙悟空&quot;</span>,<span class="number">33</span>,<span class="string">&#x27;男&#x27;</span>,<span class="string">&#x27;花果山&#x27;</span>,<span class="number">44</span>,<span class="number">99</span>),</span><br><span class="line">(<span class="number">5</span>,<span class="string">&quot;猪八戒&quot;</span>,<span class="number">50</span>,<span class="string">&#x27;男&#x27;</span>,<span class="string">&#x27;高老庄&#x27;</span>,<span class="number">99</span>,<span class="number">24</span>),</span><br><span class="line">(<span class="number">6</span>,<span class="string">&quot;白骨精&quot;</span>,<span class="number">22</span>,<span class="string">&#x27;女&#x27;</span>,<span class="string">&#x27;蚕丝洞&#x27;</span>,<span class="number">99</span>,<span class="number">88</span>),</span><br><span class="line">(<span class="number">7</span>,<span class="string">&quot;蜘蛛精&quot;</span>,<span class="number">23</span>,<span class="string">&#x27;女&#x27;</span>,<span class="string">&#x27;蜘蛛洞&#x27;</span>,<span class="number">98</span>,<span class="number">99</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li><p>使用limit分页显示查询</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 每页显示5条记录</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> student3 <span class="keyword">LIMIT</span> <span class="number">0</span>,<span class="number">5</span>;</span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> student3 <span class="keyword">LIMIT</span> <span class="number">5</span>,<span class="number">5</span>;</span><br><span class="line"><span class="comment">-- 当查询第一页时，可以省略开始的页码</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> student3 <span class="keyword">LIMIT</span> <span class="number">5</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li></ul><h3 id="5-约束"><a href="#5-约束" class="headerlink" title="5. 约束"></a>5. 约束</h3><ul><li><p>约束是对表中的数据进行限定，保证数据的正确性，有效性和完整性。</p></li><li><p>分类</p><ol><li>主键约束：primary key</li><li>非空约束：not null</li><li>唯一约束：unique</li><li>外键约束：foreign key</li></ol></li><li><p>非空约束：not null,值不能为null</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 创建表时，添加约束</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> student(</span><br><span class="line"><span class="keyword">id</span> <span class="built_in">int</span>;</span><br><span class="line">    name varchar(20) not null  <span class="comment">-- name属性不能为空</span></span><br><span class="line">);</span><br><span class="line"><span class="comment">-- 创建表之后，添加约束</span></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> student <span class="keyword">modify</span> <span class="keyword">name</span> <span class="built_in">varchar</span>(<span class="number">20</span>) <span class="keyword">not</span> <span class="literal">null</span>;</span><br><span class="line"><span class="comment">-- 删除name的非空约束</span></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> student <span class="keyword">modify</span> <span class="keyword">name</span> <span class="built_in">varchar</span>(<span class="number">20</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li><p>唯一约束：unique，值不能重复</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 创建表时，添加唯一约束</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> student(</span><br><span class="line"><span class="keyword">id</span> <span class="built_in">int</span>;</span><br><span class="line">id_key varchar(20) unique; <span class="comment">-- id_key值唯一</span></span><br><span class="line">);</span><br><span class="line"></span><br></pre></td></tr></table></figure><blockquote><p>在Mysql中，唯一约束限定的列可以有多个null。</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 删除唯一约束</span></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> student <span class="keyword">drop</span> <span class="keyword">index</span> id_key; <span class="comment">-- 删除id_key列的唯一约束</span></span><br><span class="line"><span class="comment">-- 创建表后，添加唯一约束</span></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> student <span class="keyword">modify</span> id_key <span class="built_in">varchar</span>(<span class="number">20</span>) nuique;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li><p>主键约束：primary key</p><blockquote><ol><li>主键非空且唯一。</li><li>一张表只能有一个字段为主键。</li><li>主键就是表中记录的唯一标识。</li></ol></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 创建表时，添加主键</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> <span class="keyword">user</span>(</span><br><span class="line"><span class="keyword">id</span> <span class="built_in">int</span> primary <span class="keyword">key</span>; <span class="comment">-- id为主键</span></span><br><span class="line">    username varchar(20);</span><br><span class="line">);</span><br><span class="line"><span class="comment">-- 删除主键</span></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> <span class="keyword">user</span> <span class="keyword">drop</span> primary <span class="keyword">key</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure><blockquote><p>注意：删除主键并不是：alter table user modify primary key;</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 自增长（常常与主键一起使用）</span></span><br><span class="line"><span class="comment">-- 创建表时，指定自增长</span></span><br><span class="line">crete table user(</span><br><span class="line">id int primary key auto_increament,<span class="comment">-- 主键，自增长</span></span><br><span class="line">    name varchar(20)</span><br><span class="line">);</span><br><span class="line"><span class="comment">-- 删除自增长</span></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> <span class="keyword">user</span> <span class="keyword">modify</span> <span class="keyword">id</span> <span class="built_in">int</span>;</span><br><span class="line"><span class="comment">-- 添加自增长</span></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> <span class="keyword">user</span> <span class="keyword">modify</span> <span class="keyword">id</span> <span class="built_in">int</span> auto_increament;  </span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li><p>外键约束：foreign key，使得表与表之间产生关系。（保证了数据的完整性）</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 创建表时添加</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> [表名](</span><br><span class="line">...</span><br><span class="line">    外键列</span><br><span class="line">    <span class="keyword">constraint</span> 外键名称 <span class="keyword">foreign</span> <span class="keyword">key</span> (外键列名称) <span class="keyword">references</span> 主表名称(主列表名称)</span><br><span class="line">);</span><br><span class="line"><span class="comment">-- 删除外键</span></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> [表名] <span class="keyword">drop</span> <span class="keyword">foreign</span> <span class="keyword">key</span> [外键名称]; <span class="comment">-- 注意此处使用drop而非modify</span></span><br><span class="line"><span class="comment">-- 创建表后，添加外键</span></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> [表名] <span class="keyword">add</span> <span class="keyword">constraint</span> [外键名称] foreien <span class="keyword">key</span> (外键字段名称) <span class="keyword">references</span> [主表名称](主表列名称);</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure></li></ul><h3 id="6-外键约束案例"><a href="#6-外键约束案例" class="headerlink" title="6. 外键约束案例"></a>6. 外键约束案例</h3><ul><li><p>引入</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> emp (<span class="keyword">NAME</span>,age,dep_name,dep_location) <span class="keyword">VALUES</span></span><br><span class="line">(<span class="string">&#x27;张三&#x27;</span>,<span class="number">20</span>,<span class="string">&#x27;研发部&#x27;</span>,<span class="string">&#x27;广州&#x27;</span>),</span><br><span class="line">(<span class="string">&#x27;李四&#x27;</span>,<span class="number">21</span>,<span class="string">&#x27;研发部&#x27;</span>,<span class="string">&#x27;广州&#x27;</span>),</span><br><span class="line">(<span class="string">&#x27;赵六&#x27;</span>,<span class="number">24</span>,<span class="string">&#x27;销售部&#x27;</span>,<span class="string">&#x27;深圳&#x27;</span>),</span><br><span class="line">(<span class="string">&#x27;王五&#x27;</span>,<span class="number">15</span>,<span class="string">&#x27;销售部&#x27;</span>,<span class="string">&#x27;深圳&#x27;</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">+----+--------+------+-----------+--------------+</span><br><span class="line">| id | name   | age  | dep_name  | dep_location |</span><br><span class="line">+----+--------+------+-----------+--------------+</span><br><span class="line">|  1 | 张三   |   20 | 研发部   | 广州         |</span><br><span class="line">|  2 | 李四   |   21 | 研发部   | 广州         |</span><br><span class="line">|  3 | 赵六   |   24 | 销售部    | 深圳         |</span><br><span class="line">|  4 | 王五   |   15 | 销售部    | 深圳         |</span><br><span class="line">+----+--------+------+-----------+--------------+</span><br><span class="line"></span><br></pre></td></tr></table></figure><blockquote><p>观察以上的数据可以看出，在部门和工作地址存在很多冗余的数据。</p></blockquote></li><li><p>改进：引用外表</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 创建部门表</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> department(</span><br><span class="line"><span class="keyword">id</span> <span class="built_in">INT</span> PRIMARY <span class="keyword">KEY</span> AUTO_INCREMENT, <span class="comment">-- 主键，自增长</span></span><br><span class="line">dep_name <span class="built_in">VARCHAR</span>(<span class="number">20</span>),</span><br><span class="line">dep_location <span class="built_in">VARCHAR</span>(<span class="number">20</span>)</span><br><span class="line">);</span><br><span class="line"><span class="comment">-- 创建员工表</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> employee(</span><br><span class="line"><span class="keyword">id</span> <span class="built_in">INT</span> PRIMARY <span class="keyword">KEY</span> AUTO_INCREMENT,</span><br><span class="line"><span class="keyword">NAME</span> <span class="built_in">VARCHAR</span>(<span class="number">20</span>),</span><br><span class="line">age <span class="built_in">INT</span>,</span><br><span class="line">dep_id <span class="built_in">INT</span> <span class="comment">-- 对应department表的主键</span></span><br><span class="line">);</span><br><span class="line"><span class="comment">-- 添加数据</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> department <span class="keyword">VALUES</span></span><br><span class="line">(<span class="literal">NULL</span>,<span class="string">&#x27;销售部&#x27;</span>,<span class="string">&#x27;深圳&#x27;</span>),</span><br><span class="line">(<span class="literal">NULL</span>,<span class="string">&#x27;研发部&#x27;</span>,<span class="string">&#x27;广州&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> employee <span class="keyword">VALUES</span></span><br><span class="line">(<span class="literal">NULL</span>,<span class="string">&#x27;张三丰&#x27;</span>,<span class="number">20</span>,<span class="number">1</span>),</span><br><span class="line">(<span class="literal">NULL</span>,<span class="string">&#x27;张无忌&#x27;</span>,<span class="number">21</span>,<span class="number">1</span>),</span><br><span class="line">(<span class="literal">NULL</span>,<span class="string">&#x27;猪八戒&#x27;</span>,<span class="number">33</span>,<span class="number">2</span>),</span><br><span class="line">(<span class="literal">NULL</span>,<span class="string">&#x27;孙悟空&#x27;</span>,<span class="number">33</span>,<span class="number">2</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure><blockquote><p>把部门和地址拆分出来之后，数据的冗余量下降了，但是会存在新的问题</p><ul><li><p>什么问题？</p><ul><li>如果明天研发部取消了，直接从部门表中删除了研发部这条记录，但是删除的时候并不知道还有其他的员工记录关联了该记录。这就会导致数据不完整。</li></ul></li><li><p>如何解决？</p><ul><li>外键约束</li></ul></li></ul></blockquote></li><li><p>使用外键约束保证数据完整性</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 格式</span></span><br><span class="line">constraint 外键名称 foreign key (外键列名称) references 主键名称(主列表名称)</span><br><span class="line"><span class="comment">-- 创建employee表给其添加外键约束</span></span><br><span class="line"><span class="comment">-- 创建员工表</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> employee(</span><br><span class="line"><span class="keyword">id</span> <span class="built_in">INT</span> PRIMARY <span class="keyword">KEY</span> AUTO_INCREMENT,</span><br><span class="line"><span class="keyword">NAME</span> <span class="built_in">VARCHAR</span>(<span class="number">20</span>),</span><br><span class="line">age <span class="built_in">INT</span>,</span><br><span class="line">dep_id <span class="built_in">INT</span> <span class="comment">-- 对应department表的主键</span></span><br><span class="line">    <span class="keyword">constraint</span> emp_dep_fk <span class="keyword">foreign</span> <span class="keyword">key</span> (dep_id) <span class="keyword">references</span> department(<span class="keyword">id</span>)  <span class="comment">-- 给dep_int 添加到department表的外键约束</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 试图删除部门表中的id为1的部门</span></span><br><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> department <span class="keyword">where</span> <span class="keyword">id</span> = <span class="number">1</span></span><br><span class="line"><span class="comment">-- 执行时报以下错误</span></span><br><span class="line">Cannot <span class="keyword">delete</span> <span class="keyword">or</span> <span class="keyword">update</span> a <span class="keyword">parent</span> <span class="keyword">row</span>: a <span class="keyword">foreign</span> <span class="keyword">key</span> <span class="keyword">constraint</span> fails (<span class="string">`db8100`</span>.<span class="string">`employee`</span>, <span class="keyword">CONSTRAINT</span> <span class="string">`emp_dep_fk`</span> <span class="keyword">FOREIGN</span> <span class="keyword">KEY</span> (<span class="string">`dep_id`</span>) <span class="keyword">REFERENCES</span> <span class="string">`department`</span> (<span class="string">`id`</span>))</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>此时，部门表已经和员工表建立了关系</p><p><img src="https://gitee.com/tobing/imagebed/raw/master/mysql-2-rela.png" class="lazyload" data-srcset="https://gitee.com/tobing/imagebed/raw/master/mysql-2-rela.png" srcset="data:image/png;base64,666" alt="mysql-2-rela"></p></li></ul><h3 id="7-外键约束-级联"><a href="#7-外键约束-级联" class="headerlink" title="7. 外键约束-级联"></a>7. 外键约束-级联</h3><ul><li><p>引入</p><blockquote><p>当我们在使用外键连接了不同的表的时候，当我们要改动被关联表中的被关联的列的时候（如上图中，要改动department中的id的记录，如果直接修改department的记录，就会报错，因为id列的记录还被employee表的记录关联着，直接修改会导致出现数据丢失。）</p></blockquote></li><li><p>解决办法</p><ol><li><p>传统办法，条件更改，把所有关联要被修改的（外键记录）的都改为null，更改外键记录之后，在通过条件把以上修改的设置为新的记录。</p></li><li><p>级联</p><p>修改的时候把所有关联着该外键记录的值一同更新。</p><p>语法：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Alter</span> <span class="keyword">table</span> [表名] <span class="keyword">add</span> <span class="keyword">constraint</span> [外键名称] </span><br><span class="line"><span class="keyword">foreign</span> <span class="keyword">key</span> (外键字段名称)<span class="keyword">references</span> [主表名称](主表列名称) <span class="keyword">on</span> <span class="keyword">update</span> <span class="keyword">cascade</span> <span class="keyword">on</span> <span class="keyword">delete</span> cascdae;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li>级联更新：on update cascade</li><li>级联删除：on delete cascade （谨慎使用，如果不注意容易导致删除很多数据）</li></ul></li></ol></li></ul>]]></content>
      
      
      <categories>
          
          <category> 理论学习 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> MySQL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MySQL-1-概述</title>
      <link href="2019/11/15/MySQL-1-%E6%A6%82%E8%BF%B0/"/>
      <url>2019/11/15/MySQL-1-%E6%A6%82%E8%BF%B0/</url>
      
        <content type="html"><![CDATA[<p>本文是对MySQL的复习笔记。</p><a id="more"></a><h1 id="MySQL-1-概述"><a href="#MySQL-1-概述" class="headerlink" title="MySQL-1-概述"></a>MySQL-1-概述</h1><h2 id="1-数据库引入"><a href="#1-数据库引入" class="headerlink" title="1. 数据库引入"></a>1. 数据库引入</h2><ol><li><p>常见不同存放数据介质的比较</p><table><thead><tr><th>存储位置</th><th>优点</th><th>缺点</th></tr></thead><tbody><tr><td>内存</td><td>速度快</td><td>断电丢失</td></tr><tr><td>硬盘</td><td>永久保存</td><td>操作数据不方便</td></tr><tr><td>数据库</td><td>永久保存、查询速度快、易于管理数据</td><td>占用资源，收费</td></tr></tbody></table></li><li><p>何为数据库</p><ol><li>存储数据的仓库</li><li>本质上是一个文件系统，还是以文件的方式存放在服务器中。</li><li>所有的关系型数据库都可以使用通用的SQL（ 指结构化查询语言，全称是 Structured Query Language。 ）语句对其进行管理</li></ol></li><li><p>常见数据库</p><ul><li>MySQL：免费开源，小型的数据库，MySQL被sun收购，sun被Oracle收购。6.X开始收费。</li><li>Oracle：收费大型数据库（收费单位：万）</li><li>DB2：IBM，收费，常用于银行系统。</li><li>SQL Server：微软收费数据库。C#和.net语言常用</li><li>SQLite：嵌入式小型数据库，手机端。如：Android</li></ul></li></ol><h2 id="2-数据库安装与使用"><a href="#2-数据库安装与使用" class="headerlink" title="2. 数据库安装与使用"></a>2. 数据库安装与使用</h2><h4 id="1-安装"><a href="#1-安装" class="headerlink" title="1. 安装"></a>1. 安装</h4><ul><li>下载<a href="https://dev.mysql.com/downloads/mysql/5.7.html">Mysql5.X</a></li><li>自行百度</li></ul><h4 id="2-卸载"><a href="#2-卸载" class="headerlink" title="2. 卸载"></a>2. 卸载</h4><ol><li>服务</li><li>找到名称为：<code>MySql</code>关闭</li><li>程序与功能中卸载</li><li>删除MySQL中的所有文件</li><li>删除C盘中<code>ProgramDate</code>目录关于MySQL的目录，且该目录为隐藏文件。</li></ol><h4 id="3-MySQL服务启动"><a href="#3-MySQL服务启动" class="headerlink" title="3.  MySQL服务启动"></a>3.  MySQL服务启动</h4><ul><li>搜索：服务</li><li>找到：名称为MySQL，开启</li></ul><h4 id="4-MySQL登录与退出"><a href="#4-MySQL登录与退出" class="headerlink" title="4. MySQL登录与退出"></a>4. MySQL登录与退出</h4><ul><li><p>登录</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql -u[用户名] -p[密码]       # 显式输入密码</span><br><span class="line">mysql -u[用户名] -p # 直接回车   # 隐式输入密码</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">E:\Code\Personal_website\tobing&gt;mysql -uroot -p</span><br><span class="line">Enter password: ****   # *号代替了密码</span><br></pre></td></tr></table></figure></li><li><p>退出：<code>exit</code> <code>quit</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; exit </span><br><span class="line">Bye</span><br><span class="line"></span><br><span class="line">mysql&gt; quit</span><br><span class="line">Bye</span><br></pre></td></tr></table></figure></li></ul><h4 id="5-MySQL图形化软件"><a href="#5-MySQL图形化软件" class="headerlink" title="5. MySQL图形化软件"></a>5. MySQL图形化软件</h4><ul><li><code>SQLyog</code></li></ul><h4 id="6-MySQL目录结构"><a href="#6-MySQL目录结构" class="headerlink" title="6. MySQL目录结构"></a>6. MySQL目录结构</h4><ul><li>bin：所有MySQL可执行文件，如mysql.exe。</li><li>data：存放系统必须的数据库</li><li>MySQLInstanceConfig.exe：数据库配置向导</li><li><code>C:\ProgramData\MySQL\MySQL Server 5.5\data</code>：隐藏文件夹，存放自定义的数据库</li></ul><h4 id="7-数据库管理系统"><a href="#7-数据库管理系统" class="headerlink" title="7. 数据库管理系统"></a>7. 数据库管理系统</h4><ul><li><p>数据库管理系统：DataBase Management System，DBMS。指一种操作和管理数据库的大型软件，用于建 立、使用和维护数据库，对数据库进行统一管理和控制，以保证数据库的安全性和完整性。用户通过数据库管理 系统访问数据库中表内的数据 </p></li><li><p>数据库管理程序(DBMS)可以管理多个数据库，一般开发人员会针对每一个应用创建一个数据库。为保存应用 中实体的数据，一般会在数据库创建多个表，以保存程序中实体 User 的数据。 </p></li><li><p>数据库管理系统、数据库和表的关系 图</p><p><img src="https://gitee.com/tobing/imagebed/raw/master/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F-%E6%95%B0%E6%8D%AE%E5%BA%93%E5%92%8C%E8%A1%A8%E7%9A%84%E5%85%B3%E7%B3%BB-1572069432517.png" class="lazyload" data-srcset="https://gitee.com/tobing/imagebed/raw/master/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F-%E6%95%B0%E6%8D%AE%E5%BA%93%E5%92%8C%E8%A1%A8%E7%9A%84%E5%85%B3%E7%B3%BB-1572069432517.png" srcset="data:image/png;base64,666" alt="数据库管理系统-数据库和表的关系"></p><ul><li>一个数据库服务器可以有多个数据库</li><li>一个数据库可以有多张表</li><li>一张表包含多条记录</li></ul></li></ul><h2 id="3-数据库语法初识"><a href="#3-数据库语法初识" class="headerlink" title="3. 数据库语法初识"></a>3. 数据库语法初识</h2><h4 id="1-SQL是什么"><a href="#1-SQL是什么" class="headerlink" title="1. SQL是什么"></a>1. SQL是什么</h4><ul><li>SQL：Structured Query Language 结构化查询语言 </li></ul><h4 id="2-SQL的作用"><a href="#2-SQL的作用" class="headerlink" title="2. SQL的作用"></a>2. SQL的作用</h4><ul><li><p>是一种所有关系型数据库的查询规范，不同的数据库都支持。 </p></li><li><p>通用的数据库操作语言，可以用在不同的数据库中。 </p></li><li><p>不同的数据库 SQL 语句有一些区别 </p><p><img src="https://gitee.com/tobing/imagebed/raw/master/SQL%E4%B8%8EMySQL.png" class="lazyload" data-srcset="https://gitee.com/tobing/imagebed/raw/master/SQL%E4%B8%8EMySQL.png" srcset="data:image/png;base64,666" alt="SQL与MySQL"></p></li></ul><h4 id="3-SQL语句分类"><a href="#3-SQL语句分类" class="headerlink" title="3. SQL语句分类"></a>3. SQL语句分类</h4><ul><li>DDL：数据定义语言（Data Definition Language ）<ul><li>建表，建库</li></ul></li><li><code>DML</code>：数据操纵语言（Data Manipulation Language）<ul><li>对表中记录增删改查</li></ul></li><li><code>DQL</code>：数据查询语言（Data Query Language）<ul><li>查询表中数据</li></ul></li><li>DCL：数据控制语言（Data Control Language）<ul><li>用户权限</li></ul></li></ul><h4 id="4-MySQL方言"><a href="#4-MySQL方言" class="headerlink" title="4. MySQL方言"></a>4. MySQL方言</h4><ul><li><p>每条语句以分号结尾，如果在 SQLyog 中不是必须加的。 </p></li><li><p>SQL 中不区分大小写，关键字中认为大写和小写是一样的  </p></li><li><p>3中注释</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">-- 这是注释</span><br><span class="line">&#x2F;*  这也是注释 *&#x2F;</span><br><span class="line"># 这还是注释</span><br></pre></td></tr></table></figure></li></ul>]]></content>
      
      
      <categories>
          
          <category> 理论学习 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> MySQL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JDBC的封装</title>
      <link href="2019/11/04/JDBC%E7%9A%84%E5%B0%81%E8%A3%85/"/>
      <url>2019/11/04/JDBC%E7%9A%84%E5%B0%81%E8%A3%85/</url>
      
        <content type="html"><![CDATA[<p>本文对JDBC进行介绍。</p><a id="more"></a><h1 id="JDBC的封装"><a href="#JDBC的封装" class="headerlink" title="JDBC的封装"></a>JDBC的封装</h1><h3 id="1-引入"><a href="#1-引入" class="headerlink" title="1. 引入"></a>1. 引入</h3><ul><li>即是使用了获取连接的工具类，简化了获取连接的操作。但是在编写程序查询数据库的时候，仍然需要编写较为繁杂的语句，封装结果，释放资源等。因此就有人将这些流程封装为工具包，提供给别人使用。让我们编写代码的时候，只需要关注SQL语句的执行。</li></ul><h3 id="2-Spring-JDBC"><a href="#2-Spring-JDBC" class="headerlink" title="2. Spring JDBC"></a>2. Spring JDBC</h3><ul><li><p>Spring框架对JDBC的简单封装，提供了JDBCTemplate对象简化JDBC的开发。</p></li><li><p>开发步骤</p><blockquote><ol><li><p>导入jar包</p></li><li><p>创建依赖于DataSource的JdbcTemplate对象。</p></li><li><p>调用JdbcTemplate的方法完成CRUD</p></li></ol></blockquote></li><li><p>JDBCTemplate提供的方法</p><blockquote><ul><li><p>update()：执行DML。增、删、改。</p></li><li><p>queryForMap()：查询结果集，封装为map集合。列名为key，值为value</p><ul><li>此方法的返回值长度只能是1。</li></ul></li><li><p>queryForList()：将查询的结果封装为List。</p><ul><li>此方法将每条记录封装为Map，然后将Map封装到List中。</li></ul></li><li><p>query()：查询结果，将结果封装为JavaBean</p><ul><li>RowMapper参数（一个接口）<ul><li>可以直接自己实现。</li><li>一般我们使用BeanPropertyRowMapper实现类。可以完成数据到JavaBean的自动封装</li><li>new BeanPropertyRowMapper&lt;类型&gt;(类型.class)</li></ul></li></ul></li><li><p>queryForObject()：查询结果，将结果封装为对象</p><ul><li>一般用于聚合函数的查询。例如：求和函数</li></ul></li></ul></blockquote></li><li><p>案例：</p><blockquote><ol><li>导包（连接池，数据库驱动，JdbcTemplate包等）</li><li>创建Template对象</li><li>CRUD（以account为例）<ol><li>修改1号数据的 balance 为 200000</li><li>添加一条记录</li><li>删除刚才添加的记录</li><li>查询id为1的记录，将其封装为Map集合</li><li>查询所有记录，将其封装为List</li><li>查询所有记录，将其封装为Emp对象的List集合</li><li>查询总记录数</li></ol></li></ol></blockquote><ul><li><p>account表</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">| id | name   | balance |</span><br><span class="line">+----+--------+---------+</span><br><span class="line">|  1 | tobing |   99600 |</span><br><span class="line">|  2 | acto   |  100400 |</span><br><span class="line">|  6 | rongon |  199900 |</span><br></pre></td></tr></table></figure></li><li><p>account对应的Account类</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> top.tobing.domain;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Account</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Double balance;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//getter and setter</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li><p>JdbcTemplate测试类</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> top.tobing.jdbctemplate;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"><span class="keyword">import</span> org.springframework.jdbc.core.BeanPropertyRowMapper;</span><br><span class="line"><span class="keyword">import</span> org.springframework.jdbc.core.JdbcTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.jdbc.core.RowMapper;</span><br><span class="line"><span class="keyword">import</span> top.tobing.domain.Account;</span><br><span class="line"><span class="keyword">import</span> top.tobing.utils.JDBCUtils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.sql.ResultSet;</span><br><span class="line"><span class="keyword">import</span> java.sql.SQLException;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">采用测试类的方式完成CRUD任务</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JdbcTemplateDemo01</span> </span>&#123;</span><br><span class="line">    <span class="comment">//1. 修改1号数据的 balance 为 200000</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test01</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="comment">// 获取JdbcTemplate</span></span><br><span class="line">        JdbcTemplate template = <span class="keyword">new</span> JdbcTemplate(JDBCUtils.getDataSource());</span><br><span class="line">        <span class="comment">// 编写SQL语句</span></span><br><span class="line">        String sql = <span class="string">&quot;update account set balance = ? where id = 1&quot;</span>;</span><br><span class="line">        <span class="keyword">int</span> i = template.update(sql, <span class="number">300000</span>);</span><br><span class="line">        System.out.println(i);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//2. 添加一条记录</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test02</span><span class="params">()</span></span>&#123;</span><br><span class="line">        JdbcTemplate template = <span class="keyword">new</span> JdbcTemplate(JDBCUtils.getDataSource());</span><br><span class="line">        String sql = <span class="string">&quot;insert into account values(null,?,?)&quot;</span>;</span><br><span class="line">        <span class="keyword">int</span> i = template.update(sql, <span class="string">&quot;ggo&quot;</span>, <span class="number">200000</span>);</span><br><span class="line">        System.out.println(i);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//3. 删除刚才添加的记录</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test03</span><span class="params">()</span></span>&#123;</span><br><span class="line">        JdbcTemplate template = <span class="keyword">new</span> JdbcTemplate(JDBCUtils.getDataSource());</span><br><span class="line">        String sql = <span class="string">&quot;delete from account where id = ?&quot;</span>;</span><br><span class="line">        <span class="keyword">int</span> i = template.update(sql, <span class="number">8</span>);</span><br><span class="line">        System.out.println(i);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//4. 查询id为1的记录，将其封装为Map集合</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test04</span><span class="params">()</span></span>&#123;</span><br><span class="line">        JdbcTemplate template = <span class="keyword">new</span> JdbcTemplate(JDBCUtils.getDataSource());</span><br><span class="line">        String sql = <span class="string">&quot;select * from account where id = 1&quot;</span>;</span><br><span class="line">        Map&lt;String, Object&gt; map = template.queryForMap(sql);</span><br><span class="line">        System.out.println(map);</span><br><span class="line">        <span class="comment">// &#123;id=1, name=tobing, balance=300000.0&#125;</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//5. 查询所有记录，将其封装为List</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test05</span><span class="params">()</span></span>&#123;</span><br><span class="line">        JdbcTemplate template = <span class="keyword">new</span> JdbcTemplate(JDBCUtils.getDataSource());</span><br><span class="line">        String sql = <span class="string">&quot;select * from account&quot;</span>;</span><br><span class="line">        List&lt;Map&lt;String, Object&gt;&gt; maps = template.queryForList(sql);</span><br><span class="line">        <span class="keyword">for</span> (Map&lt;String, Object&gt; map : maps) &#123;</span><br><span class="line">            System.out.println(map);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//6. 查询所有记录，将其封装为Emp对象的List集合</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test06</span><span class="params">()</span></span>&#123;</span><br><span class="line">        JdbcTemplate template = <span class="keyword">new</span> JdbcTemplate(JDBCUtils.getDataSource());</span><br><span class="line">        String sql = <span class="string">&quot;select * from account&quot;</span>;</span><br><span class="line">        List&lt;Account&gt; list = template.query(sql, <span class="keyword">new</span> RowMapper&lt;Account&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> Account <span class="title">mapRow</span><span class="params">(ResultSet rs, <span class="keyword">int</span> i)</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">                Account a = <span class="keyword">new</span> Account();</span><br><span class="line">                <span class="keyword">int</span> id = rs.getInt(<span class="string">&quot;id&quot;</span>);</span><br><span class="line">                String name = rs.getString(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">                <span class="keyword">double</span> balance = rs.getDouble(<span class="string">&quot;balance&quot;</span>);</span><br><span class="line">                a.setId(id);</span><br><span class="line">                a.setBalance(balance);</span><br><span class="line">                a.setName(name);</span><br><span class="line">                <span class="keyword">return</span> a;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">for</span> (Account a : list) &#123;</span><br><span class="line">            System.out.println(a);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//6_1. 查询所有记录，将其封装为Emp对象的List集合</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test0601</span><span class="params">()</span></span>&#123;</span><br><span class="line">        JdbcTemplate template = <span class="keyword">new</span> JdbcTemplate(JDBCUtils.getDataSource());</span><br><span class="line">        String sql = <span class="string">&quot;select * from account&quot;</span>;</span><br><span class="line">        List&lt;Account&gt; accounts = template.query(sql, <span class="keyword">new</span> BeanPropertyRowMapper&lt;Account&gt;(Account.class));</span><br><span class="line">        <span class="keyword">for</span> (Account account : accounts) &#123;</span><br><span class="line">            System.out.println(account);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//7. 查询总记录数</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test07</span><span class="params">()</span></span>&#123;</span><br><span class="line">        JdbcTemplate template = <span class="keyword">new</span> JdbcTemplate(JDBCUtils.getDataSource());</span><br><span class="line">        String sql = <span class="string">&quot;select count(id) from account&quot;</span>;</span><br><span class="line">        Long sum = template.queryForObject(sql, Long.class);</span><br><span class="line">        System.out.println(sum);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li></ul></li></ul>]]></content>
      
      
      <categories>
          
          <category> 理论学习 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JDBC </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>数据库连接池技术</title>
      <link href="2019/11/04/%E6%95%B0%E6%8D%AE%E5%BA%93%E8%BF%9E%E6%8E%A5%E6%B1%A0%E6%8A%80%E6%9C%AF/"/>
      <url>2019/11/04/%E6%95%B0%E6%8D%AE%E5%BA%93%E8%BF%9E%E6%8E%A5%E6%B1%A0%E6%8A%80%E6%9C%AF/</url>
      
        <content type="html"><![CDATA[<p>池化技术是提供系统资源利用率必不可少的，接下来接受数据库连接池。</p><a id="more"></a><h1 id="数据库连接池技术"><a href="#数据库连接池技术" class="headerlink" title="数据库连接池技术"></a>数据库连接池技术</h1><h3 id="1-引入"><a href="#1-引入" class="headerlink" title="1. 引入"></a>1. 引入</h3><ul><li>在对数据库进行操作的时候，每次执行不同操作，都要去申请连接对象，这样频繁地向系统申请资源会花费大量时间。因此人们引入了池子的概念：一开始就申请多个连接对象，并把这些连接对象放在池子中（容器），每次用的时候就从池子中拿，用完就放回池子中。</li></ul><h3 id="2-概念"><a href="#2-概念" class="headerlink" title="2. 概念"></a>2. 概念</h3><ul><li>本质上就是一个存放了多个<code>连接对象</code>的容器（集合）。</li></ul><h3 id="3-好处"><a href="#3-好处" class="headerlink" title="3. 好处"></a>3. 好处</h3><ol><li>节约系统资源</li><li>用户获取连接对象更加高效</li></ol><h3 id="4-标准"><a href="#4-标准" class="headerlink" title="4. 标准"></a>4. 标准</h3><ul><li><p>Java对连接池定义了规范（即是接口），那就是<code>javax.sql.DataSource接口</code>。</p></li><li><p><code>DataSource</code>：A factory for connections to the physical data source that this  <code>DataSource</code> object represents. An alternative to the  <code>DriverManager</code> facility, a <code>DataSource</code> object is the  preferred means of getting a connection. An object that implements the  <code>DataSource</code> interface will typically be registered with a naming  service based on the Java™ Naming and Directory (JNDI) API.</p></li><li><p>连接池：一个<code>DataSource</code>对象代表了一个物理的连接数据库的连接的生产工厂。除了<code>DriverManager</code>功能外，<code>DataSource</code>是首选。</p><blockquote><ul><li>Connection getConnection()：Attempts to establish a connection with the data source that  this <code>DataSource</code> object represents.</li><li>Connection.close()：从连接池中获取到的Connection对象在调用close方法的时候会把该对象归还到连接池中。</li></ul></blockquote></li></ul><h3 id="5-实现"><a href="#5-实现" class="headerlink" title="5. 实现"></a>5. 实现</h3><ul><li>一般我们不会实现，有数据库厂商实现。</li><li>有很多开源的连接池技术：C3P0、Druid（阿里巴巴提供）</li></ul><h3 id="6-第三方连接池的使用：C3P0"><a href="#6-第三方连接池的使用：C3P0" class="headerlink" title="6. 第三方连接池的使用：C3P0"></a>6. 第三方连接池的使用：C3P0</h3><ul><li><p>开发步骤</p><blockquote><ol><li>导入c3p0提供的实现jar包、依赖jar包、数据库驱动包<ul><li>c3p0-0.9.5.2.jar：实现jar包</li><li>mchange-commons-java-0.2.12.jar：依赖jar包</li><li>mysql-connector-java-5.1.37-bin.jar：数据库驱动包</li></ul></li><li>定义配置文件<ul><li>c3p0-config.xml</li></ul></li><li>创建核心对象：</li><li>获取连接</li></ol></blockquote></li></ul><ol><li><p>在项目中新建<code>libs</code>文件夹用于存放jar包。</p></li><li><p>将配置文件放在classpath下，即是项目的src目录下。</p></li><li><p>修改配置文件</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">c3p0-config</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 使用默认的配置读取连接池对象 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">default-config</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driverClass&quot;</span>&gt;</span>com.mysql.jdbc.Driver<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--连接数据库的url--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;jdbcUrl&quot;</span>&gt;</span>jdbc:mysql://localhost:3306/db8100<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--用户名--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;user&quot;</span>&gt;</span>root<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--密码--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span>&gt;</span>root<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 初始的连接个数 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;initialPoolSize&quot;</span>&gt;</span>5<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--最大连接对象数--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;maxPoolSize&quot;</span>&gt;</span>10<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--超时时间--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;checkoutTimeout&quot;</span>&gt;</span>3000<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">default-config</span>&gt;</span></span><br><span class="line">     <span class="comment">&lt;!--自定义的配置--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">named-config</span> <span class="attr">name</span>=<span class="string">&quot;otherc3p0&quot;</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driverClass&quot;</span>&gt;</span>com.mysql.jdbc.Driver<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;jdbcUrl&quot;</span>&gt;</span>jdbc:mysql://localhost:3306/db8100<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;user&quot;</span>&gt;</span>root<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span>&gt;</span>root<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;initialPoolSize&quot;</span>&gt;</span>5<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;maxPoolSize&quot;</span>&gt;</span>8<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;checkoutTimeout&quot;</span>&gt;</span>1000<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">named-config</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">c3p0-config</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>创建核心对象</p></li><li><p>获取连接</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> top.tobing.c3p0;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.mchange.v2.c3p0.ComboPooledDataSource;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.sql.DataSource;</span><br><span class="line"><span class="keyword">import</span> java.sql.Connection;</span><br><span class="line"><span class="keyword">import</span> java.sql.SQLException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JdbcPoolDemo01</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">        <span class="comment">// 创建核心对象ComboPooledDataSource</span></span><br><span class="line">        <span class="comment">// 使用默认配置</span></span><br><span class="line">        <span class="comment">//DataSource ds = new ComboPooledDataSource();</span></span><br><span class="line">        <span class="comment">// 指定配置</span></span><br><span class="line">        DataSource ds = <span class="keyword">new</span> ComboPooledDataSource(<span class="string">&quot;otherc3p0&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 获取连接对象</span></span><br><span class="line">        Connection conn = ds.getConnection();</span><br><span class="line"></span><br><span class="line">        System.out.println(conn);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li></ol><h3 id="7-Druid的使用"><a href="#7-Druid的使用" class="headerlink" title="7. Druid的使用"></a>7. Druid的使用</h3><ul><li><p>开发步骤</p><blockquote><ol><li>导入jar包<ul><li>druid-1.0.9.jar</li><li>mysql-connector-java-5.1.37-bin.jar：数据库驱动包</li></ul></li><li>定义配置文件<ul><li>druid.properties</li></ul></li><li>加载配置文件</li><li>获取连接池对象：通过工厂类DruidDataSourceFactory获取</li><li>获取连接</li></ol></blockquote></li></ul><ol><li><p>创建项目，创建libs目录，导入jar包</p></li><li><p>编写配置文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">driverClassName=com.mysql.jdbc.Driver</span><br><span class="line">url=jdbc:mysql://127.0.0.1:3306/db3</span><br><span class="line">username=root</span><br><span class="line">password=root</span><br><span class="line">initialSize=5</span><br><span class="line">maxActive=10</span><br><span class="line">maxWait=3000</span><br></pre></td></tr></table></figure></li><li><p>获取连接池对象</p></li><li><p>获取连接</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> top.tobing.druid;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.druid.pool.DruidDataSourceFactory;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.sql.DataSource;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.sql.Connection;</span><br><span class="line"><span class="keyword">import</span> java.util.Properties;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DruidDemo01</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">//1. 导入jar包</span></span><br><span class="line">        <span class="comment">//2. 定义配置文件</span></span><br><span class="line">        <span class="comment">//3. 加载配置文件</span></span><br><span class="line">        Properties pro = <span class="keyword">new</span> Properties();</span><br><span class="line">        InputStream in = DruidDemo01.class.getClassLoader().getResourceAsStream(<span class="string">&quot;druid.properties&quot;</span>);</span><br><span class="line">        pro.load(in);</span><br><span class="line">        <span class="comment">//4. 获取连接池对象</span></span><br><span class="line">        DataSource ds = DruidDataSourceFactory.createDataSource(pro);</span><br><span class="line">        <span class="comment">//5. 获取连接</span></span><br><span class="line">        Connection conn = ds.getConnection();</span><br><span class="line">        System.out.println(conn);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><h3 id="8-Druid工具类的抽取"><a href="#8-Druid工具类的抽取" class="headerlink" title="8.Druid工具类的抽取"></a>8.Druid工具类的抽取</h3><ul><li><p>考虑到即使使用类连接池技术，但在回去连接的时候步骤仍然比较繁琐，因此将其封装为工具类</p><blockquote><ol><li>定义JDBCUtils类</li><li>提供静态代码块用于加载配置文件，初始化连接池对象</li><li>提供方法<ol><li>获取连接</li><li>释放资源</li><li>获取连接池</li></ol></li></ol></blockquote></li><li><p>工具类代码</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> top.tobing.utils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.druid.pool.DruidDataSourceFactory;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.sql.DataSource;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.sql.Connection;</span><br><span class="line"><span class="keyword">import</span> java.sql.ResultSet;</span><br><span class="line"><span class="keyword">import</span> java.sql.SQLException;</span><br><span class="line"><span class="keyword">import</span> java.sql.Statement;</span><br><span class="line"><span class="keyword">import</span> java.util.Properties;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JDBCUtils</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> DataSource ds = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 加载配置文件</span></span><br><span class="line">            Properties pro = <span class="keyword">new</span> Properties();</span><br><span class="line">            pro.load(JDBCUtils.class.getClassLoader().getResourceAsStream(<span class="string">&quot;druid.properties&quot;</span>));</span><br><span class="line">            ds = DruidDataSourceFactory.createDataSource(pro);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取连接对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> SQLException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Connection <span class="title">getConnection</span><span class="params">()</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> ds.getConnection();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 释放资源</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> conn</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> stat</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> rs</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">close</span><span class="params">(Connection conn, Statement stat, ResultSet rs)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(conn!=<span class="keyword">null</span>)&#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                conn.close(); <span class="comment">// 归还连接</span></span><br><span class="line">            &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(stat!=<span class="keyword">null</span>)&#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                stat.close();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(rs!=<span class="keyword">null</span>)&#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                rs.close();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">close</span><span class="params">(Connection conn,Statement stat)</span></span>&#123;</span><br><span class="line">        close(conn,stat,<span class="keyword">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li><p>测试工具类代码</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> top.tobing.druid;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> top.tobing.utils.JDBCUtils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.sql.Connection;</span><br><span class="line"><span class="keyword">import</span> java.sql.PreparedStatement;</span><br><span class="line"><span class="keyword">import</span> java.sql.SQLException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DruidDemo02</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">        <span class="comment">//1.获取连接</span></span><br><span class="line">        Connection conn = JDBCUtils.getConnection();</span><br><span class="line">        <span class="comment">//2.定义sql语句</span></span><br><span class="line">        String sql = <span class="string">&quot;insert into account values(null,?,?)&quot;</span>;</span><br><span class="line">        <span class="comment">//3.获取pstat对象</span></span><br><span class="line">        PreparedStatement pstat = conn.prepareStatement(sql);</span><br><span class="line">        <span class="comment">//4.配置参数</span></span><br><span class="line">        pstat.setString(<span class="number">1</span>,<span class="string">&quot;rongon&quot;</span>);</span><br><span class="line">        pstat.setDouble(<span class="number">2</span>,<span class="number">199900</span>);</span><br><span class="line">        <span class="comment">//5.执行查询</span></span><br><span class="line">        <span class="keyword">int</span> row = pstat.executeUpdate();</span><br><span class="line">        System.out.println(row);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul>]]></content>
      
      
      <categories>
          
          <category> 理论学习 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数据库连接池 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JDBC复习</title>
      <link href="2019/11/02/JDBC%E5%A4%8D%E4%B9%A0/"/>
      <url>2019/11/02/JDBC%E5%A4%8D%E4%B9%A0/</url>
      
        <content type="html"><![CDATA[<p>本文是对JDBC复习的笔记</p><a id="more"></a><h1 id="JDBC复习"><a href="#JDBC复习" class="headerlink" title="JDBC复习"></a>JDBC复习</h1><h4 id="1-引入"><a href="#1-引入" class="headerlink" title="1. 引入"></a>1. 引入</h4><ul><li>回顾操作数据库（MySQL）的常用方式<ul><li>第三方客户端：SQLyog等</li><li>MySQL自带命令行</li><li>Java访问（JDBC）</li></ul></li></ul><h4 id="2-JDBC"><a href="#2-JDBC" class="headerlink" title="2. JDBC"></a>2. JDBC</h4><ul><li><p>JDBC（ Java Database Connectivity ）： 是Java语言中用来规范客户端程序如何来访问数据库的应用程序接口，提供了诸如查询和更新数据库中数据的方法。 每个<code> 数据库厂商</code>根据自家数据库的通信格式编写好自己数据库的驱动。所以我们只需要会调用 <code>JDBC 接口中的方法</code>即可，<code>数据库驱动由数据库厂商提供</code>。 </p></li><li><p>JDBC的好处：</p><ol><li><p>开发访问数据库的程序，只需要会调用 JDBC 接口中的方法即可，不用关注类是如何实现的。</p></li><li><p>用同一套 Java 代码，进行少量的修改就可以访问其他 JDBC 支持的数据库 </p><p><img src="https://gitee.com/tobing/imagebed/raw/master/JDBC%E6%8E%A5%E5%8F%A3.png" class="lazyload" data-srcset="https://gitee.com/tobing/imagebed/raw/master/JDBC%E6%8E%A5%E5%8F%A3.png" srcset="data:image/png;base64,666" alt="JDBC接口"></p></li></ol></li><li><p>JDBC常用的的包</p><ul><li><code>java.sql</code>：所有与JDBC访问数据相关的接口和类</li><li><code>javax.sql</code>：数据库拓展包，提供数据库额外功。比如：连接池</li><li><code>数据库驱动jar</code>：数据库厂商基于JDBC接口的实现类。使用哪个就下载哪个。</li></ul></li><li><p>JDBC核心API</p><ul><li>DriverManager：The basic service for managing a set of JDBC drivers.<ul><li>管理和注册数据库驱动</li><li>得到数据库连接对象</li></ul></li><li>Connection接口：A connection (session) with a specific database.<ul><li>一个连接对象，可以用于创建Statement和PrepareStatement对象</li></ul></li><li>Statement接口：The object used for executing a static SQL statement and  returning the results it produces.</li><li>PreparedStatement接口：An object that represents a precompiled SQL statement.</li><li>ResultSet接口：A table of data representing a database result set, which is  usually generated by executing a statement that queries the database.</li></ul></li></ul><h4 id="3-Connection接口"><a href="#3-Connection接口" class="headerlink" title="3. Connection接口"></a>3. Connection接口</h4><ul><li><p>Connection 接口，具体的实现类由数据库的厂商实现，代表一个连接对象。</p></li><li><p>提供了获取Statement的方法</p><blockquote><ul><li>Statement createStatement()：Creates a Statement object for sending SQL statements to the database.</li></ul></blockquote></li></ul><h4 id="4-Statement接口"><a href="#4-Statement接口" class="headerlink" title="4. Statement接口"></a>4. Statement接口</h4><ul><li><p>Statement接口，The object used for executing a static SQL statement and  returning the results it produces.</p><blockquote><ul><li>int executeUpdate(String sql)  ：Executes the given SQL statement, which may be an INSERT, UPDATE, or DELETE statement or an SQL statement that returns nothing, such as an SQL DDL statement.</li></ul><ul><li>ResultSet executeQuery(String sql)  ：Executes the given SQL statement, which returns a single ResultSet object.</li></ul></blockquote></li></ul><h4 id="5-ResultSet接口"><a href="#5-ResultSet接口" class="headerlink" title="5. ResultSet接口"></a>5. ResultSet接口</h4><ul><li><p>ResultSet接口，封装数据库查询的结果集，对结果集进行下半年了，读取每一条记录。</p></li><li><p>A table of data representing a database result set, which is usually generated  by executing a statement that queries the database.</p><blockquote><ul><li><p>boolean next()：Moves the cursor forward one row from its current  position.</p></li><li><p>数据类型 getXxx()：</p></li><li><p>通过字段名，参数是String类型，返回不同类型</p></li><li><p>通过列号，参数是整数，从1开始，返回不同类型</p></li></ul></blockquote></li><li><p>常用数据类型转换表</p><table><thead><tr><th>SQL 类型</th><th>Jdbc对应方法</th><th>返回类型</th></tr></thead><tbody><tr><td>BIT(1) bit(n)</td><td>getBoolean()</td><td>boolean</td></tr><tr><td>TINYINT</td><td>getByte()</td><td>byte</td></tr><tr><td>SMALLINT</td><td>getShort()</td><td>short</td></tr><tr><td>INT</td><td>getInt()</td><td>int</td></tr><tr><td>BIGINT</td><td>getLong()</td><td>long</td></tr><tr><td>CHAR,VARCHAR</td><td>getString()</td><td>String</td></tr><tr><td>Text(Clob) Blob</td><td>getClob getBlob()</td><td>Clob Blob</td></tr><tr><td>DATE</td><td>getDate()</td><td>java.sql.Date</td></tr><tr><td>TIME</td><td>getTime()</td><td>java.sql.Time</td></tr><tr><td>TIMESTAMP</td><td>getTimestamp()</td><td>java.sql.Timestamp</td></tr></tbody></table><blockquote><p>java.sql.Date、Time、Timestamp，三个共同父类是：java.util.Date</p></blockquote></li></ul><h4 id="6-获取Statement"><a href="#6-获取Statement" class="headerlink" title="6. 获取Statement"></a>6. 获取Statement</h4><ul><li>下载MySQL驱动jar包</li><li>创建工程，导入驱动jar包</li><li>编写业务逻辑</li></ul><ol><li><p>下载MySQL驱动jar包</p><ul><li>解压下载的<code>mysql-connector-java-5.1.48.zip</code>，把其中的jar包导入项目中</li></ul></li><li><p>创建工程，导入驱动jar包。</p><ol><li><p>创建Java项目</p></li><li><p>导入jar</p><p><img src="../images../image-20191101220159197.png" class="lazyload" data-srcset="../images../image-20191101220159197.png" srcset="data:image/png;base64,666" alt="image-20191101220159197"></p></li></ol></li><li><p>创建测试类<code>JDBCDemo01.java</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> top.tobing.demo01;</span><br><span class="line"><span class="keyword">import</span> ...</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JDBCDemo01</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ClassNotFoundException, SQLException </span>&#123;</span><br><span class="line">        <span class="comment">// 加载驱动</span></span><br><span class="line">        Class.forName(<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>);</span><br><span class="line">        <span class="comment">// 得到MySQL数据库的连接对象</span></span><br><span class="line">        String url = <span class="string">&quot;jdbc:mysql://localhost:3306/db8100&quot;</span>;</span><br><span class="line">        <span class="comment">// 通过数据库地址、用户名、密码得到一个连接</span></span><br><span class="line">        Connection connection = DriverManager.getConnection(url, <span class="string">&quot;root&quot;</span>, <span class="string">&quot;root&quot;</span>);</span><br><span class="line">        <span class="comment">// 输出连接</span></span><br><span class="line">        System.out.println(connection); <span class="comment">// com.mysql.jdbc.JDBC4Connection@42d8062c</span></span><br><span class="line">        <span class="comment">// 获取Statement</span></span><br><span class="line">        Statement statement = connection.createStatement();</span><br><span class="line">        <span class="comment">// 输出Statement</span></span><br><span class="line">        System.out.println(statement); <span class="comment">// com.mysql.jdbc.StatementImpl@6043cd28</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><ol><li><p>Class.forName(数据库驱动实现类) :加载和注册数据库驱动，数据库驱动由 mysql 厂商 “com.mysql.jdbc.Driver” </p></li><li><p>连接数据库的4个参数：用户名、密码、url、驱动类全限定类名。</p></li><li><p>连接数据库URL：协议名:子协议://IP地址:端口号?参数=参数值</p><ul><li>jdbc:mysql://localhost:3306/test ?characterEncdoing = utf-8</li></ul></li></ol></blockquote></li></ol><h4 id="7-执行DDL操作"><a href="#7-执行DDL操作" class="headerlink" title="7. 执行DDL操作"></a>7. 执行DDL操作</h4><ul><li><p>访问数据库通用步骤</p><p><img src="https://gitee.com/tobing/imagebed/raw/master/db.png" class="lazyload" data-srcset="https://gitee.com/tobing/imagebed/raw/master/db.png" srcset="data:image/png;base64,666" alt="db"></p></li><li><p>要创建的表</p><table><thead><tr><th>字段</th><th>类型</th></tr></thead><tbody><tr><td>id</td><td>int</td></tr><tr><td>name</td><td>varchar(20)</td></tr><tr><td>gender</td><td>tinyint(1)</td></tr><tr><td>birthday</td><td>date</td></tr></tbody></table></li><li><p>详细代码</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> top.tobing.demo01;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.sql.Connection;</span><br><span class="line"><span class="keyword">import</span> java.sql.DriverManager;</span><br><span class="line"><span class="keyword">import</span> java.sql.SQLException;</span><br><span class="line"><span class="keyword">import</span> java.sql.Statement;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JDBCDemo2</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Connection conn = <span class="keyword">null</span>;</span><br><span class="line">        Statement stat = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            <span class="comment">// 获取数据库连接对象</span></span><br><span class="line">            conn = DriverManager.getConnection(<span class="string">&quot;jdbc:mysql:///db8100&quot;</span>,<span class="string">&quot;root&quot;</span>,<span class="string">&quot;root&quot;</span>);</span><br><span class="line">            <span class="comment">// 通过连接对象获取执行SQL语句的Statement对象</span></span><br><span class="line">            stat = conn.createStatement();</span><br><span class="line">            <span class="comment">// Statement对象执行语句</span></span><br><span class="line">            stat.executeUpdate(<span class="string">&quot;create table student (id int PRIMARY key auto_increment, name varchar(20) not null &quot;</span> +</span><br><span class="line">                    <span class="string">&quot;,gender boolean,birthday date )&quot;</span>);</span><br><span class="line">            <span class="comment">// 执行完毕</span></span><br><span class="line">            System.out.println(<span class="string">&quot;执行完毕&quot;</span>);</span><br><span class="line">        &#125;<span class="keyword">catch</span>(Exception e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="comment">// 关闭资源</span></span><br><span class="line">            <span class="keyword">if</span>(stat!=<span class="keyword">null</span>)&#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    stat.close();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(conn!=<span class="keyword">null</span>)&#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    conn.close();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h4 id="8-执行DML操作"><a href="#8-执行DML操作" class="headerlink" title="8. 执行DML操作"></a>8. 执行DML操作</h4><ul><li><p>向student表中添加4条记录</p><table><thead><tr><th>id</th><th>name</th><th>gender</th><th>birthday</th></tr></thead><tbody><tr><td>1</td><td>张无忌</td><td>1</td><td>1993-03-24</td></tr><tr><td>2</td><td>张三丰</td><td>1</td><td>1993-03-24</td></tr><tr><td>3</td><td>张翠山</td><td>0</td><td>1993-03-24</td></tr><tr><td>4</td><td>赵四</td><td>1</td><td>1993-03-24</td></tr></tbody></table></li><li><p>步骤：</p><ol><li>创建连接对象</li><li>创建Statement语句对象</li><li>执行SQL查询语句：</li><li>返回影响行数</li><li>释放资源</li></ol></li><li><p>代码</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> top.tobing.demo01;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> ...</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JDBCDemo03</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">        <span class="comment">//1. 创建连接对象</span></span><br><span class="line">        Connection conn = DriverManager.getConnection(<span class="string">&quot;jdbc:mysql:///db8100&quot;</span>, <span class="string">&quot;root&quot;</span>, <span class="string">&quot;root&quot;</span>);</span><br><span class="line">        <span class="comment">//2. 创建Statement语句对象</span></span><br><span class="line">        Statement stat = conn.createStatement();</span><br><span class="line">        <span class="comment">//3. 执行SQL查询语句：</span></span><br><span class="line">        <span class="comment">//4. 返回影响行数</span></span><br><span class="line">        <span class="keyword">int</span> count = <span class="number">0</span>; <span class="comment">// 记录改变的行数</span></span><br><span class="line">        count += stat.executeUpdate(<span class="string">&quot;insert into student values (null,&#x27;张三丰&#x27;,1,&#x27;1993-03-24&#x27;)&quot;</span>);</span><br><span class="line">        count += stat.executeUpdate(<span class="string">&quot;insert into student values (null,&#x27;张无忌&#x27;,1,&#x27;1993-03-24&#x27;)&quot;</span>);</span><br><span class="line">        count += stat.executeUpdate(<span class="string">&quot;insert into student values (null,&#x27;张翠山&#x27;,1,&#x27;1993-03-24&#x27;)&quot;</span>);</span><br><span class="line">        count += stat.executeUpdate(<span class="string">&quot;insert into student values (null,&#x27;张敏&#x27;,0,&#x27;1993-03-24&#x27;)&quot;</span>);</span><br><span class="line">        <span class="comment">//5. 释放资源</span></span><br><span class="line">        rs.close()</span><br><span class="line">        stat.close();</span><br><span class="line">        conn.close();</span><br><span class="line">        System.out.println(<span class="string">&quot;一个影响了&quot;</span>+count+<span class="string">&quot;行&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>使用完毕以后要关闭结果集 ResultSet，再关闭 Statement，再关闭 Connection </p></blockquote></li></ul><h4 id="9-执行DQL语句"><a href="#9-执行DQL语句" class="headerlink" title="9. 执行DQL语句"></a>9. 执行DQL语句</h4><ul><li><p>查询student表中的数据</p></li><li><p>步骤：</p><ol><li>得到连接对象</li><li>得到执行Statement对象</li><li>执行查询操作得到结果集ResultSet</li><li>变量结果集内容</li><li>输出内容</li><li>关闭资源</li></ol></li><li><p>代码</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> top.tobing.demo01;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.sql.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JDBCDemo04</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">        <span class="comment">//1. 得到连接对象</span></span><br><span class="line">        Connection conn = DriverManager.getConnection(<span class="string">&quot;jdbc:mysql:///db8100&quot;</span>, <span class="string">&quot;root&quot;</span>, <span class="string">&quot;root&quot;</span>);</span><br><span class="line">        <span class="comment">//2. 得到执行Statement对象</span></span><br><span class="line">        Statement stat = conn.createStatement();</span><br><span class="line">        <span class="comment">//3. 执行查询操作得到结果集ResultSet</span></span><br><span class="line">        ResultSet rs = stat.executeQuery(<span class="string">&quot;select * from student&quot;</span>);</span><br><span class="line">        <span class="comment">//4. 变量结果集内容</span></span><br><span class="line">        <span class="comment">//5. 输出内容</span></span><br><span class="line">        <span class="keyword">while</span>(rs.next())&#123;</span><br><span class="line">            <span class="keyword">int</span> id = rs.getInt(<span class="string">&quot;id&quot;</span>);</span><br><span class="line">            String name = rs.getString(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">            <span class="keyword">boolean</span> gender = rs.getBoolean(<span class="string">&quot;gender&quot;</span>);</span><br><span class="line">            Date birthday = rs.getDate(<span class="string">&quot;birthday&quot;</span>);</span><br><span class="line">            System.out.println(<span class="string">&quot;编号：&quot;</span>+id+<span class="string">&quot;\t姓名：&quot;</span>+name+<span class="string">&quot;\t性别：&quot;</span>+gender+<span class="string">&quot;\t生日：&quot;</span>+birthday);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//6. 关闭资源</span></span><br><span class="line">        stat.close();</span><br><span class="line">        conn.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li><p>输出结果</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">编号：1姓名：张三丰性别：<span class="literal">true</span>生日：1993-03-24</span><br><span class="line">编号：2姓名：张无忌性别：<span class="literal">true</span>生日：1993-03-24</span><br><span class="line">编号：3姓名：张翠山性别：<span class="literal">true</span>生日：1993-03-24</span><br><span class="line">编号：4姓名：张敏性别：<span class="literal">false</span>生日：1993-03-24</span><br></pre></td></tr></table></figure></li></ul><h4 id="10-工具类的封装"><a href="#10-工具类的封装" class="headerlink" title="10. 工具类的封装"></a>10. 工具类的封装</h4><ul><li><p>回看以上代码发现，很多代码都重复，可以把这些重复的代码抽取出来，封装到工具类中。</p></li><li><p>工具类包含以下三个功能</p><ol><li>把用到的字符串定义为常量：密码、账号、URL、驱动类</li><li>获取数据库的连接：getConnection</li><li>关闭资源：close(Connection conn,Statement stat),close(Connection conn,Statement stmt,ResultSet rs</li></ol></li><li><p>代码</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> top.tobing.util;</span><br><span class="line"><span class="keyword">import</span> java.sql.*;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">1. 把用到的字符串定义为常量：密码、账号、URL、驱动类</span></span><br><span class="line"><span class="comment">2. 获取数据库的连接：getConnection</span></span><br><span class="line"><span class="comment">3. 关闭资源：close(Connection conn,Statement stat),close(Connection conn,Statement stmt,ResultSet rs)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JdbcUtils</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String PASSWORD = <span class="string">&quot;root&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String USERNAME = <span class="string">&quot;root&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String URL = <span class="string">&quot;jdbc:mysql:///db8100&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String DRIVER = <span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Connection <span class="title">getConnection</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Connection conn = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            <span class="comment">//1.加载驱动</span></span><br><span class="line">            Class.forName(DRIVER);</span><br><span class="line">            <span class="comment">//2.获取连接</span></span><br><span class="line">            conn = DriverManager.getConnection(URL, USERNAME, PASSWORD);</span><br><span class="line">        &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> conn;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">close</span><span class="params">(Connection conn, Statement stat)</span></span>&#123;</span><br><span class="line">        close(conn,stat,<span class="keyword">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">close</span><span class="params">(Connection conn, Statement stat, ResultSet rs)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(stat!=<span class="keyword">null</span>)&#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                stat.close();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(conn!=<span class="keyword">null</span>)&#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                conn.close();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(rs!=<span class="keyword">null</span>)&#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                rs.close();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h4 id="11-PreparedStatement"><a href="#11-PreparedStatement" class="headerlink" title="11. PreparedStatement"></a>11. PreparedStatement</h4><ul><li><p>案例引入</p><ul><li><p>数据库：有一张表，里面包含几个用户。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">create table user(</span><br><span class="line">id int primary key auto_increment, -- 主键，自增长</span><br><span class="line">name varchar(20),  -- 用户名</span><br><span class="line">password varchar(20)    -- 密码</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">insert into user values(null,&#39;tobing&#39;,&#39;root&#39;),(null,&#39;rongon&#39;,&#39;root&#39;);</span><br></pre></td></tr></table></figure></li><li><p>查询用户用于登录</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">## 查询成功</span><br><span class="line">mysql&gt; select * from user where name &#x3D; &#39;tobing&#39; and password &#x3D; &#39;root&#39;;</span><br><span class="line">+----+--------+----------+</span><br><span class="line">| id | name   | password |</span><br><span class="line">+----+--------+----------+</span><br><span class="line">|  1 | tobing | root     |</span><br><span class="line">+----+--------+----------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line">## 查询失败</span><br><span class="line">mysql&gt; select * from user where name &#x3D; &#39;tobing&#39; and password &#x3D; &#39;rot&#39;;</span><br><span class="line">Empty set (0.00 sec)</span><br><span class="line"></span><br><span class="line">ERROR:</span><br><span class="line">No query specified</span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li><p>Jdbc实现以上登录功能</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> top.tobing.demo01;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> top.tobing.util.JdbcUtils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.sql.Connection;</span><br><span class="line"><span class="keyword">import</span> java.sql.DriverManager;</span><br><span class="line"><span class="keyword">import</span> java.sql.ResultSet;</span><br><span class="line"><span class="keyword">import</span> java.sql.Statement;</span><br><span class="line"><span class="keyword">import</span> java.util.Scanner;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JdbcDemo05Login</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Scanner sc = <span class="keyword">new</span> Scanner(System.in);</span><br><span class="line">        System.out.println(<span class="string">&quot;请输入用户名：&quot;</span>);</span><br><span class="line">        String username = sc.nextLine();</span><br><span class="line">        System.out.println(<span class="string">&quot;请输入密码：&quot;</span>);</span><br><span class="line">        String password = sc.nextLine();</span><br><span class="line">        login(username,password);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">login</span><span class="params">(String username,String password)</span></span>&#123;</span><br><span class="line">        Connection conn = <span class="keyword">null</span>;</span><br><span class="line">        Statement stat = <span class="keyword">null</span>;</span><br><span class="line">        ResultSet resultSet = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            conn = JdbcUtils.getConnection();</span><br><span class="line">            stat = conn.createStatement();</span><br><span class="line">            resultSet = stat.executeQuery(<span class="string">&quot;select * from user where name = &#x27;&quot;</span> + username + <span class="string">&quot;&#x27; and password = &#x27;&quot;</span> + password + <span class="string">&quot;&#x27;&quot;</span>);</span><br><span class="line">            <span class="keyword">if</span>(resultSet.next())&#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;登录成功，欢迎你：&quot;</span>+username);</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;登录失败！&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">catch</span>(Exception e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">            JdbcUtils.close(conn,stat,resultSet);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li><p>结果</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">请输入用户名：</span><br><span class="line">tobing</span><br><span class="line">请输入密码：</span><br><span class="line">roo</span><br><span class="line">登录失败！</span><br><span class="line">--------------------------------------------</span><br><span class="line">请输入用户名：</span><br><span class="line">tobing</span><br><span class="line">请输入密码：</span><br><span class="line">root</span><br><span class="line">登录成功，欢迎你：tobing</span><br></pre></td></tr></table></figure></li><li><p>分析</p><ul><li><p>从以上代码以及运行结果，咋一看觉得没有什么问题。但实际上以上查询存在SQL注入的安全问题。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">请输入用户名：</span><br><span class="line">tobing</span><br><span class="line">请输入密码：</span><br><span class="line">rot<span class="string">&#x27; or &#x27;</span>1<span class="string">&#x27; = &#x27;</span>1</span><br><span class="line">登录成功，欢迎你：tobing</span><br></pre></td></tr></table></figure></li><li><p>上面演示了，当我们输入了错误的密码的时候，依然可以成功登陆。</p></li><li><p>实际，以上代码在实际中是玩mysql查询了以下语句。这句语句只需要用户名存在即可成立！！！！</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from user where name &#x3D; &#39;tobing&#39; and password &#x3D; &#39;rot&#39; or &#39;1&#39; &#x3D; &#39;1&#39;</span><br></pre></td></tr></table></figure></li></ul></li></ul><h5 id="解决方案：PreparedStatement"><a href="#解决方案：PreparedStatement" class="headerlink" title="解决方案：PreparedStatement"></a>解决方案：PreparedStatement</h5><ul><li><p>PreparedStatement：An object that represents a precompiled SQL statement.</p><ul><li>翻译：预编译SQL Statement对象</li></ul></li><li><p>PreparedStatement是Statement接口的子接口，继承父类使用方法。</p></li><li><p>创建PreparedStatment</p><blockquote><ul><li>PreparedStatement prepareStatement(String sql,…) :<br>Creates a PreparedStatement object for sending parameterized SQL statements to the database. </li></ul></blockquote></li><li><p>PreparedStatement接口中的方法</p><blockquote><ul><li>int executeUpdate() :<br>Executes the SQL statement in this PreparedStatement object, which must be an SQL Data Manipulation Language (DML) statement, such as INSERT, UPDATE or DELETE; or an SQL statement that returns nothing, such as a DDL statement. </li><li>ResultSet executeQuery() :<br>Executes the SQL query in this PreparedStatement object and returns the ResultSet object generated by the query. </li></ul></blockquote></li></ul></li></ul><ul><li><p>PreparedStatement实现login</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> top.tobing.demo01;</span><br><span class="line"><span class="keyword">import</span> top.tobing.util.JdbcUtils;</span><br><span class="line"><span class="keyword">import</span> java.sql.*;</span><br><span class="line"><span class="keyword">import</span> java.util.Scanner;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">使用PreparedStatment修改</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JdbcDemo06Login</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">        Scanner sc = <span class="keyword">new</span> Scanner(System.in);</span><br><span class="line">        System.out.println(<span class="string">&quot;请输入用户名：&quot;</span>);</span><br><span class="line">        String username = sc.nextLine();</span><br><span class="line">        System.out.println(<span class="string">&quot;请输入密码：&quot;</span>);</span><br><span class="line">        String password = sc.nextLine();</span><br><span class="line">        login(username,password);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">login</span><span class="params">(String username,String password)</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">        Connection conn = JdbcUtils.getConnection();</span><br><span class="line">        <span class="comment">// 登录SQL语句，没使用单引号，用？充当占位符</span></span><br><span class="line">        String sql = <span class="string">&quot;select * from user where name = ? and password = ?&quot;</span>;</span><br><span class="line">        PreparedStatement ps = conn.prepareStatement(sql);</span><br><span class="line">        ps.setString(<span class="number">1</span>,username); <span class="comment">// 指定第一个参数为String，且是username的值</span></span><br><span class="line">        ps.setString(<span class="number">2</span>,password);</span><br><span class="line">        ResultSet rs = ps.executeQuery();</span><br><span class="line">        <span class="keyword">if</span>(rs.next())&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;登录成功，欢迎你：&quot;</span>+username);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;登录失败！&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>结果</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">请输入用户名：</span><br><span class="line">tobing</span><br><span class="line">请输入密码：</span><br><span class="line">root</span><br><span class="line">登录成功，欢迎你：tobing</span><br><span class="line">-------------------------------------------</span><br><span class="line">请输入用户名：</span><br><span class="line">tobing</span><br><span class="line">请输入密码：</span><br><span class="line">rot<span class="string">&#x27; or &#x27;</span>1<span class="string">&#x27; = &#x27;</span>1</span><br><span class="line">登录失败！</span><br></pre></td></tr></table></figure></li><li><p>PreparedStatement执行原理(不是很理解SQL底层预编译的原理)</p><p><img src="https://gitee.com/tobing/imagebed/raw/master/%E9%A2%84%E7%BC%96%E8%AF%91.png" class="lazyload" data-srcset="https://gitee.com/tobing/imagebed/raw/master/%E9%A2%84%E7%BC%96%E8%AF%91.png" srcset="data:image/png;base64,666" alt="预编译"></p></li><li><p>使用PreparedStatement的好处</p><blockquote><ol><li>prepareStatement()会先将 SQL 语句发送给数据库预编译。PreparedStatement 会引用着预编译后的结果。 可以多次传入不同的参数给 PreparedStatement 对象并执行。减少 SQL 编译次数，提高效率。 </li><li>安全性更高，没有 SQL 注入的隐患</li><li>使用？充当占位符，减少了字符串拼接，是程序可读性提高。</li></ol></blockquote></li></ul><ul><li><p>实际中使用PreparedStatement的步骤</p><blockquote><ol><li>编写SQL语句，使用？占位。</li><li>获取PreparedStatement对象</li><li>设置实际参数，setXxx（占位符位置，传入值）</li><li>执行SQL语句</li><li>关闭资源</li></ol></blockquote></li><li><ul><li><p>案例一：PreparedStatement的查询数据，并将其封装为学生对象案例</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> top.tobing.domain;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Student</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> gender;</span><br><span class="line">    <span class="keyword">private</span> Date birthday;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(<span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">// getter and setter .....</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;....&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> top.tobing.demo01;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> top.tobing.domain.Student;</span><br><span class="line"><span class="keyword">import</span> top.tobing.util.JdbcUtils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.sql.*;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">查询student，并将里面的数据封装为Student对象</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JdbcDemo07</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">        <span class="comment">// 创建学生对象</span></span><br><span class="line">        Student stu = <span class="keyword">new</span> Student();</span><br><span class="line">        <span class="comment">// 编写SQL语句，获取PreparedStatement对象</span></span><br><span class="line">        Connection conn = JdbcUtils.getConnection();</span><br><span class="line">        PreparedStatement pstat = conn.prepareStatement(<span class="string">&quot;select * from student where id = ?&quot;</span>);</span><br><span class="line">        <span class="comment">// 设置参数</span></span><br><span class="line">        pstat.setInt(<span class="number">1</span>,<span class="number">2</span>);</span><br><span class="line">        <span class="comment">// 执行SQL语句</span></span><br><span class="line">        ResultSet rs = pstat.executeQuery();</span><br><span class="line">        <span class="keyword">while</span>(rs.next())&#123;</span><br><span class="line">            <span class="comment">// 封装数据</span></span><br><span class="line">            <span class="keyword">int</span> id = rs.getInt(<span class="string">&quot;id&quot;</span>);</span><br><span class="line">            String name = rs.getString(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">            <span class="keyword">boolean</span> gender = rs.getBoolean(<span class="string">&quot;gender&quot;</span>);</span><br><span class="line">            Date birthday = rs.getDate(<span class="string">&quot;birthday&quot;</span>);</span><br><span class="line">            stu.setId(id);</span><br><span class="line">            stu.setName(name);</span><br><span class="line">            stu.setGender(gender);</span><br><span class="line">            stu.setBirthday(birthday);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 关闭资源</span></span><br><span class="line">        JdbcUtils.close(conn,pstat);</span><br><span class="line">        System.out.println(stu);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>案例二：查询学生表将所有学生数据封装为Student对象</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> top.tobing.demo01;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> top.tobing.domain.Student;</span><br><span class="line"><span class="keyword">import</span> top.tobing.util.JdbcUtils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> ....</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">将student中所有的学生信息封装到List中</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JdbcDemo08</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">        <span class="comment">// 创建List集合</span></span><br><span class="line">        List&lt;Student&gt; students = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        <span class="comment">// 编写SQL语句，获取预处理对象</span></span><br><span class="line">        Connection conn = JdbcUtils.getConnection();</span><br><span class="line">        PreparedStatement pstat = conn.prepareStatement(<span class="string">&quot;select * from student&quot;</span>);</span><br><span class="line">        <span class="comment">// 查询所有</span></span><br><span class="line">        ResultSet rs = pstat.executeQuery();</span><br><span class="line">        <span class="keyword">while</span> (rs.next())&#123;</span><br><span class="line">            <span class="comment">// 封装结果集</span></span><br><span class="line">            Student stu = <span class="keyword">new</span> Student();</span><br><span class="line">            stu.setBirthday(rs.getDate(<span class="string">&quot;birthday&quot;</span>));</span><br><span class="line">            stu.setGender(rs.getBoolean(<span class="string">&quot;gender&quot;</span>));</span><br><span class="line">            stu.setName(rs.getString(<span class="string">&quot;name&quot;</span>));</span><br><span class="line">            stu.setId(rs.getInt(<span class="string">&quot;id&quot;</span>));</span><br><span class="line">            students.add(stu);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 关闭资源</span></span><br><span class="line">        JdbcUtils.close(conn,pstat);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(Student stu : students)&#123;</span><br><span class="line">            System.out.println(stu);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>案例三：执行DML操作</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> top.tobing.demo01;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> top.tobing.util.JdbcUtils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.sql.Connection;</span><br><span class="line"><span class="keyword">import</span> java.sql.PreparedStatement;</span><br><span class="line"><span class="keyword">import</span> java.sql.SQLException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">PreparedStatement执行DML操作</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JdbcDemo09DML</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">        <span class="comment">// 插入</span></span><br><span class="line">        <span class="comment">//insert();</span></span><br><span class="line">        <span class="comment">// 更新</span></span><br><span class="line">        <span class="comment">//update();</span></span><br><span class="line">        <span class="comment">// 删除</span></span><br><span class="line">        delete();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 插入insert</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> SQLException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">insert</span><span class="params">()</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">        <span class="comment">// 编写SQL语句，获取preparedStatement对象</span></span><br><span class="line">        Connection conn = JdbcUtils.getConnection();</span><br><span class="line">        PreparedStatement pstat = conn.prepareStatement(<span class="string">&quot;insert into student values(null,?,?,?)&quot;</span>);</span><br><span class="line">        <span class="comment">// 设置参数</span></span><br><span class="line">        pstat.setString(<span class="number">1</span>,<span class="string">&quot;Tobing&quot;</span>);</span><br><span class="line">        pstat.setBoolean(<span class="number">2</span>,<span class="keyword">true</span>);</span><br><span class="line">        pstat.setDate(<span class="number">3</span>,java.sql.Date.valueOf(<span class="string">&quot;1999-05-03&quot;</span>));</span><br><span class="line">        <span class="comment">// 执行操作</span></span><br><span class="line">        <span class="keyword">int</span> row = pstat.executeUpdate();</span><br><span class="line">        System.out.println(<span class="string">&quot;插入了&quot;</span>+row+<span class="string">&quot;条记录&quot;</span>);</span><br><span class="line">        <span class="comment">// 关闭资源</span></span><br><span class="line">        JdbcUtils.close(conn,pstat);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 更新update</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> SQLException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">()</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">        <span class="comment">// 编写SQL语句，获取pstat对象</span></span><br><span class="line">        Connection conn = JdbcUtils.getConnection();</span><br><span class="line">        PreparedStatement pstat = conn.prepareStatement(<span class="string">&quot;update student set name = ?,birthday =? where id = ?&quot;</span>);</span><br><span class="line">        <span class="comment">// 设置参数</span></span><br><span class="line">        pstat.setString(<span class="number">1</span>,<span class="string">&quot;尼古拉斯&quot;</span>);</span><br><span class="line">        pstat.setDate(<span class="number">2</span>,java.sql.Date.valueOf(<span class="string">&quot;1999-06-16&quot;</span>));</span><br><span class="line">        pstat.setInt(<span class="number">3</span>,<span class="number">4</span>);</span><br><span class="line">        <span class="comment">// 执行操作</span></span><br><span class="line">        <span class="keyword">int</span> row = pstat.executeUpdate();</span><br><span class="line">        System.out.println(<span class="string">&quot;更新了&quot;</span>+row+<span class="string">&quot;条记录&quot;</span>);</span><br><span class="line">        <span class="comment">// 关闭资源</span></span><br><span class="line">        JdbcUtils.close(conn,pstat);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 删除delete</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> SQLException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">delete</span><span class="params">()</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">        <span class="comment">// 编写SQL，获取pstat</span></span><br><span class="line">        Connection conn = JdbcUtils.getConnection();</span><br><span class="line">        PreparedStatement pstat = conn.prepareStatement(<span class="string">&quot;delete from student where id = ? &quot;</span>);</span><br><span class="line">        <span class="comment">// 设置参数</span></span><br><span class="line">        pstat.setInt(<span class="number">1</span>,<span class="number">3</span>);</span><br><span class="line">        <span class="comment">// 执行操作</span></span><br><span class="line">        <span class="keyword">int</span> row = pstat.executeUpdate();</span><br><span class="line">        System.out.println(<span class="string">&quot;删除了&quot;</span>+row+<span class="string">&quot;条记录&quot;</span>);</span><br><span class="line">        <span class="comment">// 释放资源</span></span><br><span class="line">        JdbcUtils.close(conn,pstat);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li></ul></li></ul><h4 id="12-JDBC的事务处理"><a href="#12-JDBC的事务处理" class="headerlink" title="12. JDBC的事务处理"></a>12. JDBC的事务处理</h4><ul><li><p>Connection接口中与事务相关的API</p><blockquote><ul><li><p>void setAutoCommit(boolean autoCommit)：Sets this connection’s auto-commit mode to the given  state.</p></li><li><p>void commit()：Makes all changes made since the previous commit/rollback  permanent and releases any database locks currently held by this  <code>Connection</code> object.（提交事务）</p></li><li><p>void rollback()：Undoes all changes made in the current transaction and releases  any database locks currently held by this <code>Connection</code> object.（回滚事务）</p></li></ul></blockquote></li><li><p>开发步骤</p><blockquote><ol><li>获取连接</li><li>开启事务</li><li>获取pstat</li><li>使用pstat更新两次</li><li>正常情况下提交事务</li><li>出现异常回滚事务</li><li>关闭自愿</li></ol></blockquote></li><li><p>案例</p><ul><li>模拟：tobing给acto转账 200 </li></ul><table><thead><tr><th>字段</th><th>类型</th></tr></thead><tbody><tr><td>id</td><td>int</td></tr><tr><td>name</td><td>varchar(10)</td></tr><tr><td>balance</td><td>double</td></tr></tbody></table><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; create table accuont(</span><br><span class="line">    -&gt; id int primary key auto_increment, -- 主键，自增长</span><br><span class="line">    -&gt; name varchar(10), </span><br><span class="line">    -&gt; balance double</span><br><span class="line">    -&gt; );</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from account;</span><br><span class="line">+----+--------+---------+</span><br><span class="line">| id | name   | balance |</span><br><span class="line">+----+--------+---------+</span><br><span class="line">|  1 | tobing |  100000 |</span><br><span class="line">|  2 | acto   |  100000 |</span><br><span class="line">+----+--------+---------+</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> top.tobing.demo01;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> top.tobing.util.JdbcUtils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> ...</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 事务处理</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JdbcDemo10Transaction</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Connection conn = <span class="keyword">null</span>;</span><br><span class="line">        PreparedStatement pstat = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            <span class="comment">// 获取连接</span></span><br><span class="line">            conn = JdbcUtils.getConnection();</span><br><span class="line">            <span class="comment">// 开启事务</span></span><br><span class="line">            conn.setAutoCommit(<span class="keyword">false</span>);</span><br><span class="line">            <span class="comment">// 编写SQL，获取pstat</span></span><br><span class="line">            <span class="comment">// tobing - 200</span></span><br><span class="line">            pstat = conn.prepareStatement(<span class="string">&quot;update account set balance = balance - ? where name = ?&quot;</span>);</span><br><span class="line">            pstat.setDouble(<span class="number">1</span>,<span class="number">200</span>);</span><br><span class="line">            pstat.setString(<span class="number">2</span>,<span class="string">&quot;tobing&quot;</span>);</span><br><span class="line">            pstat.executeUpdate();</span><br><span class="line">            <span class="comment">// 模拟出现异常</span></span><br><span class="line">            System.out.println(<span class="number">100</span>/<span class="number">0</span>);</span><br><span class="line">            <span class="comment">// acto + 200</span></span><br><span class="line">            pstat = conn.prepareStatement(<span class="string">&quot;update account set balance = balance + ? where name = ?&quot;</span>);</span><br><span class="line">            pstat.setDouble(<span class="number">1</span>,<span class="number">200</span>);</span><br><span class="line">            pstat.setString(<span class="number">2</span>,<span class="string">&quot;acto&quot;</span>);</span><br><span class="line">            pstat.executeUpdate();</span><br><span class="line">            <span class="comment">// 提交事务</span></span><br><span class="line">            conn.commit();</span><br><span class="line">            System.out.println(<span class="string">&quot;转账成功！&quot;</span>);</span><br><span class="line">        &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">try</span>&#123;</span><br><span class="line">                <span class="comment">// 捕获到异常，回滚事务</span></span><br><span class="line">                conn.rollback();</span><br><span class="line">                System.out.println(<span class="string">&quot;转账失败！&quot;</span>);</span><br><span class="line">            &#125;<span class="keyword">catch</span> (SQLException e1)&#123;</span><br><span class="line">                e1.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="comment">// 关闭资源</span></span><br><span class="line">            JdbcUtils.close(conn,pstat);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#### 没有出现异常，把100/0 语句去除，能够正常转账</span></span><br><span class="line">mysql&gt; select * from account;</span><br><span class="line">+----+--------+---------+</span><br><span class="line">| id | name   | balance |</span><br><span class="line">+----+--------+---------+</span><br><span class="line">|  1 | tobing |   99600 |</span><br><span class="line">|  2 | acto   |  100400 |</span><br><span class="line">+----+--------+---------+</span><br><span class="line"></span><br><span class="line"><span class="comment">#### 出现异常 ：转账失败</span></span><br><span class="line">mysql&gt; select * from account;</span><br><span class="line">+----+--------+---------+</span><br><span class="line">| id | name   | balance |</span><br><span class="line">+----+--------+---------+</span><br><span class="line">|  1 | tobing |   99600 |</span><br><span class="line">|  2 | acto   |  100400 |</span><br><span class="line">+----+--------+---------+</span><br></pre></td></tr></table></figure><hr></li></ul>]]></content>
      
      
      <categories>
          
          <category> 理论学习 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JDBC </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>电信校园宽带安装路由器</title>
      <link href="2019/10/26/%E7%94%B5%E4%BF%A1%E6%A0%A1%E5%9B%AD%E5%AE%BD%E5%B8%A6%E5%AE%89%E8%A3%85%E8%B7%AF%E7%94%B1%E5%99%A8/"/>
      <url>2019/10/26/%E7%94%B5%E4%BF%A1%E6%A0%A1%E5%9B%AD%E5%AE%BD%E5%B8%A6%E5%AE%89%E8%A3%85%E8%B7%AF%E7%94%B1%E5%99%A8/</url>
      
        <content type="html"><![CDATA[<p>本文介绍本校电信校园网如何使用路由器拨号。</p><a id="more"></a><h1 id="电信校园宽带安装路由器（SWPU）"><a href="#电信校园宽带安装路由器（SWPU）" class="headerlink" title="电信校园宽带安装路由器（SWPU）"></a>电信校园宽带安装路由器（SWPU）</h1><h4 id="1-拿到电信号码，绑定学号"><a href="#1-拿到电信号码，绑定学号" class="headerlink" title="1. 拿到电信号码，绑定学号"></a>1. 拿到电信号码，绑定学号</h4><ol><li><p>连接<code>cmcc-edu</code></p><ol start="2"><li><p>自动弹出网页选<code>自服务</code></p><ol><li>密码：</li><li>多运营商绑定</li><li>绑定号码密码</li></ol></li><li><p>顺便在此界面下载拨号客户端</p></li></ol></li></ol><h4 id="2-打开拨号客户端"><a href="#2-打开拨号客户端" class="headerlink" title="2. 打开拨号客户端"></a>2. 打开拨号客户端</h4><ol><li>输入学号</li><li>密码</li><li>选择电信</li></ol><h4 id="3-打开事件管理器"><a href="#3-打开事件管理器" class="headerlink" title="3. 打开事件管理器"></a>3. 打开事件管理器</h4><ul><li>（win10搜索栏可以直接搜索）—-&gt;<code>windows 日志</code>—-&gt;<code>Rasman</code></li></ul><ol><li>双击<code>Rasman</code></li><li>拨号账号：<code>&#123;SRUN2&#125;645&lt;xxxxxxxxx@dx</code>（保存）</li><li>拔掉网线，把网线插到wan口，电脑连接路由器</li><li><code>cmd</code>–&gt;<code>ipconfig</code>-&gt;网关（此步的目的是找到登录路由器的网关，如果事先知道，可以省略）</li><li>浏览器中输入网关地址，登录路由器</li><li>在路由器中输入：之前<code>&#123;SRUN2&#125;645&lt;xxxxxxxxx@dx</code>作为账号，密码是拨号客户端拨号时使用的密码。</li></ol><h4 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h4><ul><li>1到2步在购买电信卡时候会有教程。</li><li>主要在第3步</li><li> rasman.exe是Windows电话拨号程序 </li></ul><hr><p>如果看了以上教程还不会安装，可以联系<code>QQ：652916578</code>有偿安装。</p>]]></content>
      
      
      <categories>
          
          <category> 工具使用 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 校园宽带 </tag>
            
            <tag> 路由器 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Mybatis-1-框架概述</title>
      <link href="2019/10/20/Mybatis-1-%E6%A1%86%E6%9E%B6%E6%A6%82%E8%BF%B0/"/>
      <url>2019/10/20/Mybatis-1-%E6%A1%86%E6%9E%B6%E6%A6%82%E8%BF%B0/</url>
      
        <content type="html"><![CDATA[<p>Mybatis是持久层框架，本文是学习过程中的笔记。</p><a id="more"></a><h1 id="Mybatis-1-框架概述"><a href="#Mybatis-1-框架概述" class="headerlink" title="Mybatis-1-框架概述"></a>Mybatis-1-框架概述</h1><h2 id="1-什么框架"><a href="#1-什么框架" class="headerlink" title="1. 什么框架"></a>1. 什么框架</h2><h3 id="1-什么是框架"><a href="#1-什么是框架" class="headerlink" title="1. 什么是框架"></a>1. 什么是框架</h3><h3 id="2-框架解决的问题"><a href="#2-框架解决的问题" class="headerlink" title="2. 框架解决的问题"></a>2. 框架解决的问题</h3><h3 id="3-软件开发中分层的重要性"><a href="#3-软件开发中分层的重要性" class="headerlink" title="3. 软件开发中分层的重要性"></a>3. 软件开发中分层的重要性</h3><h3 id="4-分层开发下的常见框架"><a href="#4-分层开发下的常见框架" class="headerlink" title="4.分层开发下的常见框架"></a>4.分层开发下的常见框架</h3><h3 id="5-Mybatis框架概述"><a href="#5-Mybatis框架概述" class="headerlink" title="5. Mybatis框架概述"></a>5. Mybatis框架概述</h3><h2 id="2-JDBC编程的分析"><a href="#2-JDBC编程的分析" class="headerlink" title="2. JDBC编程的分析"></a>2. JDBC编程的分析</h2><h3 id="1-JDBC开发回顾"><a href="#1-JDBC开发回顾" class="headerlink" title="1. JDBC开发回顾"></a>1. JDBC开发回顾</h3><ul><li><p>开发步骤</p><blockquote><ol><li>加载驱动</li><li>获取数据库连接对象Connection</li><li>定义SQL语句</li><li>获取preparedStatement对象</li><li>设置参数</li><li>执行查询</li><li>封装结果集</li></ol></blockquote></li></ul><h3 id="2-jdbc问题分析"><a href="#2-jdbc问题分析" class="headerlink" title="2.jdbc问题分析"></a>2.jdbc问题分析</h3><blockquote><ol><li>数据库链接创建、释放频繁造成系统资源浪费从而影响系统性能（线程池解决该问题）。</li><li>Sql 语句在代码中硬编码，造成代码不易维护，实际应用 sql 变化的可能较大，sql 变动需要改变 java 代码。</li><li>使用 preparedStatement 向占有位符号传参数存在硬编码，因为 sql 语句的 where 条件不一定，可能 多也可能少，修改 sql 还要修改代码，系统不易维护。 </li><li></li></ol></blockquote><h2 id="3-Mybatis框架快速入门"><a href="#3-Mybatis框架快速入门" class="headerlink" title="3. Mybatis框架快速入门"></a>3. Mybatis框架快速入门</h2><ul><li><p>开发步骤</p><blockquote><ol><li>下载Mybatis框架jar包、或者在maven工程中导入开发坐标</li><li>创建Maven工程，添加其他坐标</li><li>编写User实体类</li><li>编写持久层接口Dao</li><li>编写持久层接口的映射文件Dao.xml</li><li>编写SQLMapConfig.xml</li><li>编写测试类</li></ol><ul><li>注意：编写持久层映射文件也可以改为注解的方式，此时SqlMapConfig.xml的映射要改为该接口的全限定类名</li></ul></blockquote></li></ul><h2 id="4-自定义Mybatis框架"><a href="#4-自定义Mybatis框架" class="headerlink" title="4. 自定义Mybatis框架"></a>4. 自定义Mybatis框架</h2><ul><li><p>知识点提要</p><blockquote><p>工厂模式、构建者模式、代理模式，反射，自定义注解，注解的反射，xml解析，数据库元数据，元数据的反射等。</p></blockquote></li></ul><h3 id="1-流程分析"><a href="#1-流程分析" class="headerlink" title="1. 流程分析"></a>1. 流程分析</h3><ul><li><p>SqlMapConfig.xml</p><ol><li>连接数据库信息</li></ol><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--数据库连接信息--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">&quot;POOLED&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driver&quot;</span> <span class="attr">value</span>=<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;jdbc:mysql://localhost:3306/ee50&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;root&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;root&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>有以上信息，我们可以创建连接数据库的对象Connection。</p></blockquote><ol start="2"><li>映射配置文件</li></ol><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">class</span>=<span class="string">&quot;top.tobing.dao.UserDao&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mappers</span>&gt;</span>    </span><br><span class="line">    <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">&quot;top/tobing/dao/UserDao.xml&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>有以上信息，我们可以通过映射配置文件xml（或者注解的方式获取以下配置文件）</p></blockquote><ol start="3"><li>SQL语句以及封装的结果类型</li></ol><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.itheima.dao.IUserDao&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findAll&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.itheima.domain.User&quot;</span>&gt;</span></span><br><span class="line">        select * from user</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>有以上信息，我们可以得到执行的SQL语句，可以获取PreParedStatement对象，还得到了要返回封装结果类的全限定类名。</p></blockquote></li></ul><h3 id="2-前期准备"><a href="#2-前期准备" class="headerlink" title="2. 前期准备"></a>2. 前期准备</h3><blockquote><ol><li>创建Maven工程</li><li>引入相关坐标</li><li>导入工具类（用于XML解析）</li><li>编写SQLMapConfig.xml</li><li>编写读取配置文件类</li><li>编写Mapper</li><li>编写Configuration配置类</li><li>编写实体类User</li></ol></blockquote><h3 id="3-基于XML的自定义Mybatis框架"><a href="#3-基于XML的自定义Mybatis框架" class="headerlink" title="3. 基于XML的自定义Mybatis框架"></a>3. 基于XML的自定义Mybatis框架</h3>]]></content>
      
      
      <categories>
          
          <category> 理论学习 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Mybatis </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>效率使用win10</title>
      <link href="2019/10/20/%E6%95%88%E7%8E%87%E4%BD%BF%E7%94%A8win10/"/>
      <url>2019/10/20/%E6%95%88%E7%8E%87%E4%BD%BF%E7%94%A8win10/</url>
      
        <content type="html"><![CDATA[<p>电脑作为我们最常用的生产力工具，如何高效地使用它对提高工作和学习的效率非常重要。</p><a id="more"></a><h1 id="效率使用win10"><a href="#效率使用win10" class="headerlink" title="效率使用win10"></a>效率使用win10</h1><ul><li>电脑作为我们最常用的生产力工具，如何高效地使用它对提高工作和学习的效率非常重要。</li></ul><h4 id="1-桌面"><a href="#1-桌面" class="headerlink" title="1. 桌面"></a>1. 桌面</h4><ul><li><p>桌面是我们在使用电脑的时候最常接触的界面，我们各种软件的访问都通过桌面的快捷方式。如何快速高效的整理桌面尤其重要。</p></li><li><p>我习惯把桌面分为三大区域：<code>通用工具区</code>，<code>近期常用工具区</code>，<code>分类区</code>。</p><ul><li><code>通用工具区</code>：常用社交软件，娱乐软件等。</li><li><code>近期常用工具区</code>近期学习要用到的软件，目录快捷方式等。</li><li><code>分类区</code>：很少用到的软件，一些已经完成的文档等。</li></ul><p>以下便是我的桌面分类</p><p><img src="https://i.loli.net/2021/01/15/AkQtaYeuxoHd1Rf.png" class="lazyload" data-srcset="https://i.loli.net/2021/01/15/AkQtaYeuxoHd1Rf.png" srcset="data:image/png;base64,666" alt="桌面分区"></p></li></ul><h4 id="2-常用工具"><a href="#2-常用工具" class="headerlink" title="2. 常用工具"></a>2. 常用工具</h4><ul><li><p>使用软件是我们生产的根本，不同软件对提高我们使用效率尤为重要。</p></li><li><p>浏览器：</p><ul><li>Chrome：谷歌家，国产大部分浏览器的极速模式都使用了该浏览器内核。</li><li>Firefox：第二大浏览器，相对于谷歌浏览器，在本土化做的更好。</li><li>Edge Chrome：据说巨硬（微软）对其内存占用进行了优化</li><li>国产浏览器：我使用的是<code>搜狗浏览器</code>，虽然流氓，但是调教一番还是很方便，他的下载管理器尤其突出、通常结合迅雷使用。平时主要在切换极速模式和兼容模式（IE）的时候使用。</li><li>浏览器嫌配置麻烦，可以使用奔跑中的奶酪优化配置的。 <a href="https://www.runningcheese.com/">https://www.runningcheese.com/</a> </li></ul></li><li><p>浏览器插件：</p><ul><li>某歌访问助手：主要用于查询问题。给Chrome安装插件。<a href="https://github.com/haotian-wang/google-access-helper">github下载链接</a></li><li>Tampermonkey：为安装其他插件提供平台<ul><li>百度贴吧免登陆、网盘自动填写密码等等</li></ul></li><li>广告拦截</li><li>迅雷Chrome支持：结合迅雷极速版、替代默认下载器</li></ul></li><li><p>笔记软件</p><ul><li><p>OneNote：微软系列，没有使用Typora的时候使用，支持同步，非常方便，但是嵌入代码这些比较麻烦。推荐非编码人员使用。</p></li><li><p>Typora：使用Markdown编写笔记，但不支持同步，主要用于编写博客和总结。</p></li><li><p>有道云笔记：在线，支持markdown，思维导图等，但是我很少使用。</p></li><li><p>Markdown语法：markdown非常流行，语法简单。推荐教程：<a href="https://www.runoob.com/markdown/md-tutorial.html">https://www.runoob.com/markdown/md-tutorial.html</a></p></li><li><p>思维导图xmind：用于总结，理清学习框架非常有用。</p><p><img src="https://i.loli.net/2021/01/15/AkQtaYeuxoHd1Rf.png" class="lazyload" data-srcset="https://i.loli.net/2021/01/15/AkQtaYeuxoHd1Rf.png" srcset="data:image/png;base64,666" alt="笔记软件"></p></li></ul></li><li><p>开发常用</p><ul><li>SQLyog：Mysql管理</li><li>Navicat for Mysql：同上</li><li>Postman：模拟各种请求</li><li>Cisco Packet Tracker ：网络工程师必备</li></ul></li><li><p>其他常用软件</p><ul><li>TeamViewer：远程控制软件，win10之后QQ使用远程控制有问题。</li><li>磁盘助手：免费的分区助手，磁盘格式转换助手。</li><li>火柴：everything+spotlight好用就万事，双击ctrl即可弹出。</li><li>卡硬工具箱：硬件检测。</li><li>VM、VBox：虚拟机，VM好用、VBox小巧免费</li><li><code>NetSeedMonitor</code>：免费小巧的网速显示软件</li><li>Everything：本地搜索神器。</li><li>win10自带截图、画图：神器，非常好用。</li></ul></li></ul><h4 id="3-常用网站"><a href="#3-常用网站" class="headerlink" title="3. 常用网站"></a>3. 常用网站</h4><ul><li>编程学习：<ul><li>菜鸟教程</li><li>廖雪峰</li><li>W3C</li><li>牛客网：面经、刷题等</li><li>LeetCode：刷题</li></ul></li><li>导航：龙轩导航等</li><li>其他：<ul><li>黑苹果：<a href="https://blog.daliansky.net/">黑果小兵</a>，远景论坛</li><li>知名博主：<a href="https://www.sqlsec.com/">国光</a>、<a href="https://baideye.com/">白的夜</a>、<a href="%5Bhttps://www.runningcheese.com%5D(https://www.runningcheese.com/)">奔跑中的奶酪</a>、<a href="http://kyon945.ys168.com/">阿虚的储物间</a></li><li>在线电影：片库网</li><li>在线动漫：樱花</li></ul></li></ul><hr><h5 id="2020-3-29更新"><a href="#2020-3-29更新" class="headerlink" title="2020.3.29更新"></a>2020.3.29更新</h5>]]></content>
      
      
      <categories>
          
          <category> 工具使用 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Windows </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Java反射（Reflection）(三)</title>
      <link href="2019/10/19/Java%E5%8F%8D%E5%B0%84%EF%BC%88Reflection%EF%BC%89-%E4%B8%89/"/>
      <url>2019/10/19/Java%E5%8F%8D%E5%B0%84%EF%BC%88Reflection%EF%BC%89-%E4%B8%89/</url>
      
        <content type="html"><![CDATA[<p>反射第三弹。</p><a id="more"></a><h1 id="Java反射（Reflection）-三"><a href="#Java反射（Reflection）-三" class="headerlink" title="Java反射（Reflection）(三)"></a>Java反射（Reflection）(三)</h1><h4 id="1-通过Class获取Method的几个方法"><a href="#1-通过Class获取Method的几个方法" class="headerlink" title="1. 通过Class获取Method的几个方法"></a>1. 通过Class获取Method的几个方法</h4><ul><li><p>Method getDeclaredMethod(String name, Class&lt;?&gt;… parameterTypes) </p><pre><code>返回一个 Method 对象，该对象反映此 Class 对象所表示的类或接口的指定已声明方法。 </code></pre></li><li><p>Method[] getDeclaredMethods() </p><pre><code>返回 Method 对象的一个数组，这些对象反映此 Class 对象表示的类或接口声明的所有方法，包括公共、保护、默认（包）访问和私有方法，但`不包括继承`的方法。 </code></pre></li><li><p>Method getMethod(String name, Class&lt;?&gt;… parameterTypes) </p><pre><code>返回一个 Method 对象，它反映此 Class 对象所表示的类或接口的指定公共成员方法。 </code></pre></li><li><p>Method[] getMethods() </p><pre><code>返回一个包含某些 Method 对象的数组，这些对象反映此 Class 对象所表示的类或接口（`包括那些由该类或接口声明的以及从超类和超接口继承的那些的类或接口`）的公共 member 方法 </code></pre><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> top.tobing.reflection;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 反射之方法</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Tobing</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo05ReflectMethod1</span> </span>&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> NoSuchMethodException, SecurityException </span>&#123;</span><br><span class="line">Class cls = Boy.class;</span><br><span class="line"><span class="comment">//Method methodA = cls.getMethod(&quot;privateMethod&quot;);//  java.lang.NoSuchMethodException</span></span><br><span class="line"><span class="comment">//Method methodD = cls.getDeclaredMethod(&quot;eat&quot;);  // java.lang.NoSuchMethodException</span></span><br><span class="line">Method methodB = cls.getDeclaredMethod(<span class="string">&quot;privateMethod&quot;</span>);   <span class="comment">// 可以获取私有方法，但不可以获取父类方法</span></span><br><span class="line">Method methodC = cls.getDeclaredMethod(<span class="string">&quot;publicMethodA&quot;</span>);  </span><br><span class="line">Method methodE = cls.getMethod(<span class="string">&quot;eat&quot;</span>);<span class="comment">// 可以获取父类私有方法，但不可以获取私有方法</span></span><br><span class="line">System.out.println(methodB.getName());</span><br><span class="line">System.out.println(methodC.getName());</span><br><span class="line">System.out.println(methodE.getName());</span><br><span class="line">Method methods[] = cls.getMethods(); </span><br><span class="line"></span><br><span class="line">System.out.println(<span class="string">&quot;======================================&quot;</span>);</span><br><span class="line">System.out.println(<span class="string">&quot;Boy的所有方法(包含父类继承的)：&quot;</span>);</span><br><span class="line"><span class="keyword">for</span>(Method m:methods) &#123;</span><br><span class="line">System.out.println(<span class="string">&quot;getMethods:&quot;</span>+m.getName());</span><br><span class="line">&#125;</span><br><span class="line">System.out.println(<span class="string">&quot;======================================&quot;</span>);</span><br><span class="line">Method methods1[] = cls.getDeclaredMethods();</span><br><span class="line"><span class="keyword">for</span>(Method m:methods1) &#123;</span><br><span class="line">System.out.println(<span class="string">&quot;getDeclaredMethods:&quot;</span>+m.getName());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">Method getMethod(name, Class...)：获取某个public的Method（包括父类）</span></span><br><span class="line"><span class="comment">Method getDeclaredMethod(name, Class...)：获取当前类的某个Method（不包括父类）</span></span><br><span class="line"><span class="comment">Method[] getMethods()：获取所有public的Method（包括父类）</span></span><br><span class="line"><span class="comment">Method[] getDeclaredMethods()：获取当前类的所有Method（不包括父类）</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">P</span></span>&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">eat</span><span class="params">()</span></span>&#123;</span><br><span class="line">System.out.println(<span class="string">&quot;This is p&#x27;s eat!&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Boy</span> <span class="keyword">extends</span> <span class="title">P</span></span>&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">publicMethodA</span><span class="params">()</span> </span>&#123;</span><br><span class="line">System.out.println(<span class="string">&quot;This is a public method A !&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">publicMethodB</span><span class="params">()</span> </span>&#123;</span><br><span class="line">System.out.println(<span class="string">&quot;This is a public method B !&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">privateMethod</span><span class="params">()</span> </span>&#123;</span><br><span class="line">System.out.println(<span class="string">&quot;This is a privateMethod!&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>运行结果</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">privateMethod</span><br><span class="line">publicMethodA</span><br><span class="line">eat</span><br><span class="line">======================================</span><br><span class="line">Boy的所有方法(包含父类继承的)：</span><br><span class="line">getMethods:publicMethodB</span><br><span class="line">getMethods:publicMethodA</span><br><span class="line">getMethods:eat</span><br><span class="line">getMethods:<span class="built_in">wait</span></span><br><span class="line">getMethods:<span class="built_in">wait</span></span><br><span class="line">getMethods:<span class="built_in">wait</span></span><br><span class="line">getMethods:equals</span><br><span class="line">getMethods:toString</span><br><span class="line">getMethods:hashCode</span><br><span class="line">getMethods:getClass</span><br><span class="line">getMethods:notify</span><br><span class="line">getMethods:notifyAll</span><br><span class="line">======================================</span><br><span class="line">getDeclaredMethods:privateMethod</span><br><span class="line">getDeclaredMethods:publicMethodB</span><br><span class="line">getDeclaredMethods:publicMethodA</span><br><span class="line"></span><br></pre></td></tr></table></figure></li></ul><ul><li><p>执行指定对象的方法</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> top.tobing.reflection;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationTargetException;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 反射之方法</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Tobing</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo05ReflectMethod2</span> </span>&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> NoSuchMethodException, SecurityException, IllegalAccessException, IllegalArgumentException, InvocationTargetException </span>&#123;</span><br><span class="line">Class cls = Boy.class;</span><br><span class="line">Method methodB = cls.getDeclaredMethod(<span class="string">&quot;privateMethod&quot;</span>);   <span class="comment">// 可以获取私有方法，但不可以获取父类方法</span></span><br><span class="line">Method methodC = cls.getDeclaredMethod(<span class="string">&quot;publicMethodA&quot;</span>);  </span><br><span class="line">Method methodE = cls.getMethod(<span class="string">&quot;eat&quot;</span>); </span><br><span class="line">Boy b = <span class="keyword">new</span> Boy();</span><br><span class="line"><span class="comment">//methodB.invoke(b); // cannot access a member of class top.tobing.reflection.Boy with modifiers &quot;private&quot;</span></span><br><span class="line">methodE.invoke(b);</span><br><span class="line">methodC.invoke(b); </span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li><p>运行结果</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">This is p<span class="string">&#x27;s eat!</span></span><br><span class="line"><span class="string">This is a public method A !</span></span><br></pre></td></tr></table></figure></li><li><p>要想执行对象中的private方法，可以使用<code>methodObj.setAccessible(true);</code>来设置其是否可被访问</p></li><li><p>注意：<code>setAccessible(true)</code>可能会失败。如果JVM运行期存在<code>SecurityManager</code>，那么它会根据规则进行检查，有可能阻止<code>setAccessible(true)</code>。例如，某个<code>SecurityManager</code>可能不允许对<code>java</code>和<code>javax</code>开头的<code>package</code>的类调用<code>setAccessible(true)</code>，这样可以保证JVM核心库的安全。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">methodB.setAccessible(<span class="keyword">true</span>);  <span class="comment">// 设置private方法的访问属性</span></span><br><span class="line">methodB.invoke(b);  <span class="comment">// 执行方法</span></span><br></pre></td></tr></table></figure></li></ul><ul><li><p>使用invoke调用静态方法</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 使用invoke调用静态方法</span></span><br><span class="line"><span class="keyword">int</span> temp = Integer.parseInt(<span class="string">&quot;123&quot;</span>);<span class="comment">// 以下代码等同于这一句话</span></span><br><span class="line"><span class="comment">//1.获取Integer的字节码对象，通过字节码对象获取到方法 getMethod（方法名称，方法的参数列表）</span></span><br><span class="line">Method methodA = Integer.class.getMethod(<span class="string">&quot;parseInt&quot;</span>,String.class);</span><br><span class="line"><span class="comment">//2.通过invoke执行方法  invoke(执行方法所在的对象，执行方法需要的参数（不限个数）)</span></span><br><span class="line">Object obj = methodA.invoke(<span class="keyword">null</span>,<span class="string">&quot;123&quot;</span>);</span><br><span class="line">System.out.println(obj);</span><br></pre></td></tr></table></figure></li></ul><h4 id="2-调用构造方法（创建实例）"><a href="#2-调用构造方法（创建实例）" class="headerlink" title="2. 调用构造方法（创建实例）"></a>2. 调用构造方法（创建实例）</h4><ul><li><p>在Class类中提供了一个<code>newInstance</code>方法用来创建对象的实例</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Person p = <span class="keyword">new</span> Person();<span class="comment">// 这两件代码都可以用于新建对象实例</span></span><br><span class="line">Person p = Person.class.newInstance();</span><br></pre></td></tr></table></figure><ul><li>但是<code>newInstance</code>方法也有弊端：只能实例化带<code>public</code>修饰的空参数构造方法</li></ul></li><li><p>为了解决以上缺陷，java的reflect的API提供Constructor对象，包含了构造方法的所有信息，可用于创建实例。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> top.tobing.reflection;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Constructor;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationTargetException;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 反射之方法</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Tobing</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo06ReflectMethod4</span> </span>&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> NoSuchMethodException, SecurityException, IllegalAccessException, IllegalArgumentException, InvocationTargetException, InstantiationException </span>&#123;</span><br><span class="line"><span class="comment">// 方式一：使用newInstance()（不可以获取带参数）</span></span><br><span class="line">C c = C.class.newInstance();</span><br><span class="line"><span class="comment">// 方式二：获取Constructor类（可以获取带参数）</span></span><br><span class="line"><span class="comment">// 不可以获取到非public</span></span><br><span class="line">Constructor con1 = C.class.getConstructor();</span><br><span class="line">Constructor con2 = C.class.getConstructor(Integer.class);</span><br><span class="line"><span class="comment">// 可以获取到非public构造方法</span></span><br><span class="line">Constructor con3 = C.class.getDeclaredConstructor(String.class);</span><br><span class="line"><span class="comment">// 使用Constructor类的newInstance方法</span></span><br><span class="line">C c1= (C)con1.newInstance();<span class="comment">//调用空参数构造方法</span></span><br><span class="line">C c2 = (C)con2.newInstance(<span class="number">12</span>);<span class="comment">//低氧</span></span><br><span class="line">C c3 = (C)con3.newInstance(<span class="string">&quot;Tobing&quot;</span>);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C</span></span>&#123;</span><br><span class="line"><span class="keyword">private</span> String name;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">C</span><span class="params">()</span> </span>&#123;</span><br><span class="line">System.out.println(<span class="string">&quot;空参数public构造方法被调用了！！！&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">C</span><span class="params">(Integer id)</span> </span>&#123;</span><br><span class="line">System.out.println(<span class="string">&quot;带参数public构造方法被调用了！！！&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">C (String name)&#123;</span><br><span class="line"><span class="keyword">this</span>.name = name;</span><br><span class="line">System.out.println(<span class="string">&quot;带参数非public的构造方法执行了！！！&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>运行结果</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">空参数<span class="keyword">public</span>构造方法被调用了！！！</span><br><span class="line">空参数<span class="keyword">public</span>构造方法被调用了！！！</span><br><span class="line">带参数<span class="keyword">public</span>构造方法被调用了！！！</span><br><span class="line">带参数非<span class="keyword">public</span>的构造方法执行了！！！</span><br><span class="line"></span><br></pre></td></tr></table></figure></li></ul><h4 id="3-获取继承关系"><a href="#3-获取继承关系" class="headerlink" title="3. 获取继承关系"></a>3. 获取继承关系</h4><ol><li><p>获取父类Class</p></li><li><p>获取interface</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> top.tobing.reflection;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Constructor;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationTargetException;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 反射之方法</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Tobing</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo07ReflectInherit</span> </span>&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> NoSuchMethodException, SecurityException, IllegalAccessException, IllegalArgumentException, InvocationTargetException, InstantiationException </span>&#123;</span><br><span class="line">Class cls1 = Integer.class;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取相关父类</span></span><br><span class="line">Class cls2 = cls1.getSuperclass();</span><br><span class="line">Class cls3 = cls2.getSuperclass();</span><br><span class="line"></span><br><span class="line">System.out.println(<span class="string">&quot;Integer&#x27;s super  class is :&quot;</span>+cls2.getName());</span><br><span class="line">System.out.println(<span class="string">&quot;Number&#x27;s super  class is :&quot;</span>+cls3.getName());</span><br><span class="line">System.out.println(<span class="string">&quot;Object&#x27;s super class is :&quot;</span>+cls3.getSuperclass());</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取interface</span></span><br><span class="line">Class[] interfaces = cls1.getInterfaces();</span><br><span class="line"><span class="keyword">for</span>(Class c:interfaces) &#123;</span><br><span class="line">System.out.println(c.getName());</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><ul><li><p>输出</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Integer<span class="string">&#x27;s super  class is :java.lang.Number</span></span><br><span class="line"><span class="string">Number&#x27;</span>s super  class is :java.lang.Object</span><br><span class="line">Object<span class="string">&#x27;s super class is :null</span></span><br><span class="line"><span class="string">java.lang.Comparable</span></span><br><span class="line"><span class="string"></span></span><br></pre></td></tr></table></figure></li></ul><h4 id="4-动态代理"><a href="#4-动态代理" class="headerlink" title="4. 动态代理"></a>4. 动态代理</h4><ul><li><p>如果<strong>根据字节码的创建时机</strong>来分类，可以分为静态代理和动态代理：</p><ul><li>所谓<strong>静态</strong>也就是在<strong>程序运行前</strong>就已经存在代理类的<strong>字节码文件</strong>，代理类和真实主题角色的关系在运行前就确定了。</li><li>而动态代理的源码是在程序运行期间由<strong>JVM</strong>根据反射等机制<strong>动态的生成</strong>，所以在运行前并不存在代理类的字节码文件</li></ul></li><li><p>由于学识尚浅，未能详尽。</p><ul><li>详细请访问以下文章。：<a href="https://juejin.im/post/5c1ca8df6fb9a049b347f55c">https://juejin.im/post/5c1ca8df6fb9a049b347f55c</a></li></ul></li></ul>]]></content>
      
      
      <categories>
          
          <category> 理论学习 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> 反射 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>单片机实验</title>
      <link href="2019/10/19/%E5%8D%95%E7%89%87%E6%9C%BA%E5%AE%9E%E9%AA%8C/"/>
      <url>2019/10/19/%E5%8D%95%E7%89%87%E6%9C%BA%E5%AE%9E%E9%AA%8C/</url>
      
        <content type="html"><![CDATA[<p>单片机时的实验。</p><a id="more"></a><h1 id="单片机实验"><a href="#单片机实验" class="headerlink" title="单片机实验"></a>单片机实验</h1><h4 id="运行环境"><a href="#运行环境" class="headerlink" title="运行环境"></a>运行环境</h4><ul><li>单片机：STC89C52开发板，某宝有售</li><li>KEIL：用于编写程序</li><li>STC-ISP：程序写入</li></ul><h4 id="1-LED灯循环点亮"><a href="#1-LED灯循环点亮" class="headerlink" title="1. LED灯循环点亮"></a>1. LED灯循环点亮</h4><ul><li><p>实现LED灯循环点亮</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;reg52.h&quot;</span>   <span class="comment">// 导入C52库</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> uchar unsigned char</span></span><br><span class="line"><span class="comment">// 延时函数</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">delay</span><span class="params">()</span></span>&#123;</span><br><span class="line">uchar i,j;</span><br><span class="line"><span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;<span class="number">255</span>;i++)</span><br><span class="line"><span class="keyword">for</span>(j=<span class="number">0</span>;j&lt;<span class="number">255</span>;j++);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 主函数</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="comment">// 初始化</span></span><br><span class="line">uchar i,temp;</span><br><span class="line"><span class="comment">// 循环运行</span></span><br><span class="line"><span class="keyword">while</span>(<span class="number">1</span>)&#123;</span><br><span class="line"><span class="comment">// 循环前进移动</span></span><br><span class="line">temp = <span class="number">0x01</span>;</span><br><span class="line"><span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;<span class="number">8</span>;i++)&#123;</span><br><span class="line">P1 = ~temp;</span><br><span class="line">delay();</span><br><span class="line">temp = temp &lt;&lt;<span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 循环返回移动</span></span><br><span class="line">temp = <span class="number">0x80</span>;</span><br><span class="line"><span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;<span class="number">8</span>;i++)&#123;</span><br><span class="line">P1= ~temp;</span><br><span class="line">delay();</span><br><span class="line">temp =temp &gt;&gt;<span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h4 id="2-航标灯"><a href="#2-航标灯" class="headerlink" title="2. 航标灯"></a>2. 航标灯</h4><ul><li><p>模拟航标灯工作：在白天熄灭，在夜晚断续点亮，时间间隔2秒，即亮2秒，灭2秒，周期循环进行。（8个LED灯一起闪烁，用按键开关1模拟光线传感器，按下表示白天，松开表示夜晚）</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;reg52.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> uchar unsigned char</span></span><br><span class="line">sbit FLAG = P3^<span class="number">0</span>; <span class="comment">// 设置P3_0</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">delay</span><span class="params">()</span></span>&#123;<span class="comment">// 延时函数</span></span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">int</span> i,j; <span class="comment">// 此处由于超出255，不能再使用uchar</span></span><br><span class="line"><span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;<span class="number">2000</span>;i++)</span><br><span class="line"><span class="keyword">for</span>(j=<span class="number">0</span>;j&lt;<span class="number">110</span>;j++);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;<span class="comment">// 主函数</span></span><br><span class="line">uchar temp;</span><br><span class="line">temp = <span class="number">0x00</span>;</span><br><span class="line"><span class="keyword">while</span>(<span class="number">1</span>)&#123;</span><br><span class="line"><span class="keyword">if</span>(FLAG==<span class="number">0</span>)&#123;<span class="comment">// 白天</span></span><br><span class="line">P1 = <span class="number">0xff</span>;<span class="comment">// 无闪烁</span></span><br><span class="line">&#125;<span class="keyword">else</span>&#123;<span class="comment">// 晚上</span></span><br><span class="line">P1= ~temp;<span class="comment">// 不断闪烁</span></span><br><span class="line">temp = ~temp;</span><br><span class="line">delay();</span><br><span class="line">&#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h4 id="3-LED灯前进"><a href="#3-LED灯前进" class="headerlink" title="3. LED灯前进"></a>3. LED灯前进</h4><ul><li><p>上电时初始状态为LED灯D1亮其他熄灭，之后每按下一次S4按键，LED灯移动一位，每按下一次S5键，LED灯恢复到初始状态（注意在按键编程中加入去抖动延时及按键释放检测）</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;reg52.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> uchar unsigned char</span></span><br><span class="line">sbit S4 = P3^<span class="number">2</span>;</span><br><span class="line">sbit S5 = P3^<span class="number">3</span>; </span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">delay</span><span class="params">()</span></span>&#123;<span class="comment">// 延时</span></span><br><span class="line">uchar i,j;</span><br><span class="line"><span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;<span class="number">255</span>;i++)</span><br><span class="line"><span class="keyword">for</span>(j=<span class="number">0</span>;j&lt;<span class="number">255</span>;j++);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">delay10ms</span><span class="params">()</span></span>&#123;<span class="comment">// 延时</span></span><br><span class="line">uchar i,j;</span><br><span class="line"><span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;<span class="number">30</span>;i++)</span><br><span class="line"><span class="keyword">for</span>(j=<span class="number">0</span>;j&lt;<span class="number">110</span>;j++);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">uchar i,temp;</span><br><span class="line">i=<span class="number">1</span>;</span><br><span class="line">temp = <span class="number">0x01</span>;</span><br><span class="line">P1 = ~temp;</span><br><span class="line"><span class="keyword">while</span>(<span class="number">1</span>)&#123;</span><br><span class="line"><span class="keyword">if</span>(S4==<span class="number">0</span>)&#123;  <span class="comment">// 按下一次LED灯前进一位</span></span><br><span class="line">delay10ms(); <span class="comment">// 延时</span></span><br><span class="line"><span class="keyword">if</span>(S4==<span class="number">0</span>)&#123;</span><br><span class="line"><span class="keyword">while</span>(S4==<span class="number">0</span>); <span class="comment">// 按键释放检测</span></span><br><span class="line">temp = <span class="number">0x01</span>;</span><br><span class="line">temp = temp &lt;&lt;(i%<span class="number">8</span>);</span><br><span class="line">P1 = ~temp;</span><br><span class="line">delay();</span><br><span class="line">i++;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(S5==<span class="number">0</span>)&#123; <span class="comment">// 复位</span></span><br><span class="line">delay10ms();</span><br><span class="line"><span class="keyword">if</span>(S5==<span class="number">0</span>)&#123;</span><br><span class="line"><span class="keyword">while</span>(S5==<span class="number">0</span>);</span><br><span class="line">i=<span class="number">1</span>;</span><br><span class="line">P1 = ~(<span class="number">0x01</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h4 id="4-动态刷新-显示学号"><a href="#4-动态刷新-显示学号" class="headerlink" title="4. 动态刷新-显示学号"></a>4. 动态刷新-显示学号</h4><ul><li><p>动态刷新程序，让数码管显示学号后8位</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;reg52.h&quot;</span></span></span><br><span class="line">sbit WEI = P2^<span class="number">7</span>;</span><br><span class="line">sbit DUAN = P2^<span class="number">6</span>;</span><br><span class="line"><span class="comment">// 阴极0-9对应端码</span></span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">char</span> segment_code[] =&#123;<span class="number">0x3f</span>,<span class="number">0x06</span>,<span class="number">0x5b</span>,<span class="number">0x4f</span>,<span class="number">0x66</span>,<span class="number">0x6d</span>,<span class="number">0x7d</span>,<span class="number">0x07</span>,<span class="number">0x7f</span>,<span class="number">0x6f</span>&#125;;</span><br><span class="line"><span class="comment">// 要显示的数字</span></span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">char</span> stu_id[] = &#123;<span class="number">3</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">5</span>,<span class="number">4</span>,<span class="number">2</span>,<span class="number">0</span>,<span class="number">5</span>&#125;;</span><br><span class="line"><span class="comment">// 延时函数</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">delay</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">long</span> i = <span class="number">0x30</span>;</span><br><span class="line"><span class="keyword">while</span>(i--);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 主函数</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">long</span> i;</span><br><span class="line"><span class="keyword">while</span>(<span class="number">1</span>)&#123;</span><br><span class="line"><span class="keyword">long</span> i;<span class="comment">// 此处不能为unsigned</span></span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">long</span> temp;</span><br><span class="line"><span class="keyword">for</span>(i=<span class="number">7</span>;i&gt;=<span class="number">0</span>;i--)&#123;</span><br><span class="line">P0=~(<span class="number">0x01</span>&lt;&lt;i);<span class="comment">// 每次移动一位</span></span><br><span class="line">WEI=<span class="number">1</span>; WEI=<span class="number">0</span>;<span class="comment">// 打开位锁存</span></span><br><span class="line">P0 = segment_code[stu_id[i]]; <span class="comment">// 每次每一位学号</span></span><br><span class="line">DUAN=<span class="number">1</span>;DUAN=<span class="number">0</span>;<span class="comment">// 打开端锁存</span></span><br><span class="line">delay();<span class="comment">// 延时显示</span></span><br><span class="line">P0 = <span class="number">0x0</span>;<span class="comment">// 以下三句用于消隐</span></span><br><span class="line">DUAN = <span class="number">1</span>;</span><br><span class="line">DUAN=<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h4 id="5-动态显示000000001-gt-99999999"><a href="#5-动态显示000000001-gt-99999999" class="headerlink" title="5. 动态显示000000001-&gt;99999999"></a>5. 动态显示000000001-&gt;99999999</h4><ul><li><p>动态刷新程序封装为一个函数，由main函数调用，在此基础上，让数码管循环加1显示，从0000 0001开始，一直加到9999 9999<strong>（检查实验结果）</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;reg52.h&quot;</span></span></span><br><span class="line">sbit WEI = P2^<span class="number">7</span>;</span><br><span class="line">sbit DUAN = P2^<span class="number">6</span>;</span><br><span class="line"><span class="comment">// 阴极0-9对应端码</span></span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">char</span> segment_code[] =&#123;<span class="number">0x3f</span>,<span class="number">0x06</span>,<span class="number">0x5b</span>,<span class="number">0x4f</span>,<span class="number">0x66</span>,<span class="number">0x6d</span>,<span class="number">0x7d</span>,<span class="number">0x07</span>,<span class="number">0x7f</span>,<span class="number">0x6f</span>&#125;;</span><br><span class="line"><span class="comment">// 延时函数</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">delay</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">long</span> i = <span class="number">0x30</span>;</span><br><span class="line"><span class="keyword">while</span>(i--);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 动态刷新显示指定的数值</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">segDisplay</span><span class="params">(<span class="keyword">long</span> number)</span></span>&#123;</span><br><span class="line"><span class="keyword">long</span> i; <span class="comment">// 不能为unsigned</span></span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">long</span> temp;</span><br><span class="line"><span class="keyword">for</span>(i=<span class="number">7</span>;i&gt;=<span class="number">0</span>;i--)&#123;<span class="comment">// 遍历每一个LED</span></span><br><span class="line">P0=~(<span class="number">0x01</span>&lt;&lt;i);<span class="comment">// 每次访问一个LED</span></span><br><span class="line">WEI=<span class="number">1</span>; WEI=<span class="number">0</span>;</span><br><span class="line">temp=number%<span class="number">10</span>;<span class="comment">// 每次获取一个数字</span></span><br><span class="line">number/=<span class="number">10</span>;<span class="comment">// 砍掉获取到的数字</span></span><br><span class="line">P0 = segment_code[temp];<span class="comment">// 显示获取到的数字</span></span><br><span class="line">DUAN=<span class="number">1</span>;DUAN=<span class="number">0</span>;</span><br><span class="line">delay();<span class="comment">// 延时显示</span></span><br><span class="line">P0 = <span class="number">0x0</span>;<span class="comment">// 消隐</span></span><br><span class="line">DUAN = <span class="number">1</span>;</span><br><span class="line">DUAN=<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 主函数</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">long</span> i;</span><br><span class="line"><span class="keyword">while</span>(<span class="number">1</span>)&#123;</span><br><span class="line"><span class="keyword">for</span>(i=<span class="number">1</span>;i&lt;=<span class="number">99999999</span>;i++)&#123;</span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">long</span> k = <span class="number">5</span>;</span><br><span class="line"><span class="keyword">while</span>(k--)&#123; <span class="comment">// 此处为了防止过快显示</span></span><br><span class="line">segDisplay(i);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h4 id="6-矩阵键盘扫描"><a href="#6-矩阵键盘扫描" class="headerlink" title="6. 矩阵键盘扫描"></a>6. 矩阵键盘扫描</h4><ul><li><p>编写矩阵键盘扫描程序，扫描矩阵按键，每次按下按键后，用数码管显示矩阵键值。</p></li><li><p>原理</p><ul><li><p>原理：</p><ol><li><p>P3口高4位通高电，依次给P3低4位（每一行）通低电位。</p></li><li><p>通完电之后，读取P3口的高4位，如果通低电位的所在行，有按键被按下，则P3口的高4位必定有一位不是高电位。</p></li><li><p>假如S12被按下，则扫描到第三行的时候，读取P3口的高4位，则会读到：0xc0</p></li></ol></li></ul><p><img src="https://i.loli.net/2021/01/15/zYoPdJlfBIXvL6F.png" class="lazyload" data-srcset="https://i.loli.net/2021/01/15/zYoPdJlfBIXvL6F.png" srcset="data:image/png;base64,666" alt="20191025矩阵键盘扫描"></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;reg52.h&quot;</span></span></span><br><span class="line">sbit WEI = P2^<span class="number">7</span>;</span><br><span class="line">sbit DUAN = P2^<span class="number">6</span>;</span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">char</span> segment_code[] =&#123;<span class="number">0x3f</span>,<span class="number">0x06</span>,<span class="number">0x5b</span>,<span class="number">0x4f</span>,<span class="number">0x66</span>,<span class="number">0x6d</span>,<span class="number">0x7d</span>,<span class="number">0x07</span>,<span class="number">0x7f</span>,<span class="number">0x6f</span>&#125;;</span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">char</span> last_key = <span class="number">0</span>; <span class="comment">// 用于保存上一次按下的按键</span></span><br><span class="line"><span class="comment">// 延时</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">delay</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">long</span> i = <span class="number">0x10</span>;</span><br><span class="line">    <span class="keyword">while</span>(i--);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 延时10ms</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">delay10s</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">int</span> i = <span class="number">1</span>*<span class="number">110</span>;</span><br><span class="line">    <span class="keyword">while</span>(i--);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 显示传入参数函数</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">segDisplay</span><span class="params">(<span class="keyword">long</span> number)</span></span>&#123;</span><br><span class="line">    <span class="keyword">long</span> i;</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">long</span> temp;</span><br><span class="line">    <span class="keyword">for</span>(i=<span class="number">7</span>;i&gt;=<span class="number">0</span>;i--)&#123;</span><br><span class="line">        P0=~(<span class="number">0x01</span>&lt;&lt;i);</span><br><span class="line">        WEI=<span class="number">1</span>; WEI=<span class="number">0</span>;</span><br><span class="line">        temp=number%<span class="number">10</span>;</span><br><span class="line">        number/=<span class="number">10</span>;</span><br><span class="line">        P0 = segment_code[temp];</span><br><span class="line">        DUAN=<span class="number">1</span>;DUAN=<span class="number">0</span>;</span><br><span class="line">        delay();</span><br><span class="line">        P0 = <span class="number">0x0</span>;</span><br><span class="line">        DUAN = <span class="number">1</span>;</span><br><span class="line">        DUAN=<span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 扫描矩阵键盘，并返回指定的值。</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">getKey</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">char</span> temp;</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">char</span> key=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">char</span> l;</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">char</span> i;</span><br><span class="line">    <span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;<span class="number">4</span>;i++)&#123;  </span><br><span class="line">        P3 = ~(<span class="number">0x01</span>&lt;&lt;i);  <span class="comment">// 循环设置P3口低4位为低电平，同时给P3口高4位通电</span></span><br><span class="line">        temp = P3;<span class="comment">// 读取P3口</span></span><br><span class="line">        temp &amp;= <span class="number">0xf0</span>;<span class="comment">// 去除读取到的低4位</span></span><br><span class="line">        <span class="keyword">if</span>(temp!=<span class="number">0xf0</span>)&#123; <span class="comment">// 消除抖动判断是否有键被按下</span></span><br><span class="line">            delay10s();</span><br><span class="line">            <span class="keyword">if</span>(temp!=<span class="number">0xf0</span>)&#123;</span><br><span class="line">                <span class="keyword">switch</span>(temp)&#123;<span class="comment">// 依次判断按下的是&quot;那一列?&quot;</span></span><br><span class="line">                    <span class="keyword">case</span> <span class="number">0xe0</span>:</span><br><span class="line">                        key = <span class="number">4</span>*i+<span class="number">1</span>;</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    <span class="keyword">case</span> <span class="number">0xd0</span>:</span><br><span class="line">                        key = <span class="number">4</span>*i+<span class="number">2</span>;</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    <span class="keyword">case</span> <span class="number">0xb0</span>:</span><br><span class="line">                        key = <span class="number">4</span>*i+<span class="number">3</span>;</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    <span class="keyword">case</span> <span class="number">0x70</span>:</span><br><span class="line">                        key = <span class="number">4</span>*i+<span class="number">4</span>;</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(key!=<span class="number">0</span>)&#123;  <span class="comment">// 如果有键按下，更新矩阵按下的值last_key</span></span><br><span class="line">        last_key = key;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> last_key;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 主函数</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">char</span> key;</span><br><span class="line">    <span class="keyword">while</span>(<span class="number">1</span>)&#123;</span><br><span class="line">        key = getKey();</span><br><span class="line">        segDisplay(key);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h4 id="7-中断控制数码管计数"><a href="#7-中断控制数码管计数" class="headerlink" title="7. 中断控制数码管计数"></a>7. 中断控制数码管计数</h4><ul><li><p>用中断控制数码管计数，上电后数码管显示000000001，按下中断按键后数码管开始递增计时，再次按下时暂停计时，以此类推</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;reg52.h&quot;</span></span></span><br><span class="line">sbit WEI = P2^<span class="number">7</span>;</span><br><span class="line">sbit DUAN = P2^<span class="number">6</span>;</span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">char</span> segment_code[] =&#123;<span class="number">0x3f</span>,<span class="number">0x06</span>,<span class="number">0x5b</span>,<span class="number">0x4f</span>,<span class="number">0x66</span>,<span class="number">0x6d</span>,<span class="number">0x7d</span>,<span class="number">0x07</span>,<span class="number">0x7f</span>,<span class="number">0x6f</span>&#125;;</span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">long</span> num= <span class="number">1</span>;  <span class="comment">// 用于递增变量</span></span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">char</span> flag = <span class="number">0</span>;  <span class="comment">// 暂停还是递增的标志</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">delay</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">long</span> i = <span class="number">0x10</span>;</span><br><span class="line"><span class="keyword">while</span>(i--);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">segDisplay</span><span class="params">(<span class="keyword">long</span> number)</span></span>&#123;  <span class="comment">// 显示指定数值函数</span></span><br><span class="line"><span class="keyword">long</span> i;</span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">long</span> temp;</span><br><span class="line"><span class="keyword">for</span>(i=<span class="number">7</span>;i&gt;=<span class="number">0</span>;i--)&#123;</span><br><span class="line">P0=~(<span class="number">0x01</span>&lt;&lt;i);</span><br><span class="line">WEI=<span class="number">1</span>; WEI=<span class="number">0</span>;</span><br><span class="line">temp=number%<span class="number">10</span>;</span><br><span class="line">number/=<span class="number">10</span>;</span><br><span class="line">P0 = segment_code[temp];</span><br><span class="line">DUAN=<span class="number">1</span>;DUAN=<span class="number">0</span>;</span><br><span class="line">delay();</span><br><span class="line">P0 = <span class="number">0x0</span>;</span><br><span class="line">DUAN = <span class="number">1</span>;</span><br><span class="line">DUAN=<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 中断函数</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">intr</span><span class="params">()</span> interrupt 0 <span class="keyword">using</span> 0 </span>&#123;</span><br><span class="line"><span class="keyword">if</span>(flag==<span class="number">1</span>)&#123;<span class="comment">// 如果是递增，这将标志位设置为暂停</span></span><br><span class="line">flag=<span class="number">0</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;<span class="comment">// 如果是暂停，这将标志位设置为递增</span></span><br><span class="line">flag=<span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">EA= <span class="number">1</span>;   <span class="comment">// 总中断允许</span></span><br><span class="line">EX0=<span class="number">1</span>;   <span class="comment">// 允许外部中断0中断</span></span><br><span class="line">IT0=<span class="number">1</span>; <span class="comment">// 选择外部中断0为跳延触发方式</span></span><br><span class="line"><span class="keyword">while</span>(<span class="number">1</span>)&#123;</span><br><span class="line"><span class="keyword">if</span>(flag==<span class="number">0</span>)&#123; <span class="comment">// 暂停</span></span><br><span class="line">segDisplay(num);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123; <span class="comment">// 递增</span></span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">char</span> i = <span class="number">0x05</span>;</span><br><span class="line"><span class="keyword">while</span>(i--)&#123;  <span class="comment">// 此处减缓显示管的递增速度</span></span><br><span class="line">segDisplay(num);</span><br><span class="line">&#125;</span><br><span class="line">num++; <span class="comment">// 数字递增</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h4 id="8-蜂鸣器输出不同音调"><a href="#8-蜂鸣器输出不同音调" class="headerlink" title="8. 蜂鸣器输出不同音调"></a>8. 蜂鸣器输出不同音调</h4><ul><li><p>编写定时器程序，实现输出特定精确频率的方波给蜂鸣器，实现不同的音调</p><p><img src="https://i.loli.net/2021/01/15/Xm6EoafAZcUQyS2.jpg" class="lazyload" data-srcset="https://i.loli.net/2021/01/15/Xm6EoafAZcUQyS2.jpg" srcset="data:image/png;base64,666" alt="clip_image001"></p></li><li><p>步骤</p><ol><li>计算机器周期：（1/单片机频率）*12</li><li>计算次数：（需要时间/机器周期）</li></ol><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;reg52.h&quot;</span></span></span><br><span class="line">sbit beep = P2^<span class="number">3</span>; <span class="comment">// 蜂鸣器所在端口</span></span><br><span class="line"><span class="keyword">double</span> tones[] = &#123;<span class="number">523</span>,<span class="number">587</span>,<span class="number">659</span>,<span class="number">698</span>,<span class="number">783</span>,<span class="number">880</span>,<span class="number">987</span>&#125;; <span class="comment">// 中音的7个音调</span></span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">char</span> flag;   </span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">int</span> i;</span><br><span class="line"><span class="comment">// &quot;两个老虎&quot;的简单音谱</span></span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">int</span> tigers[] = &#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">1</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">4</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">7</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">4</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">7</span>,<span class="number">1</span>,<span class="number">5</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">5</span>,<span class="number">1</span>&#125;;</span><br><span class="line"><span class="comment">// 中断主程序</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">timer</span><span class="params">()</span> interrupt 1 </span>&#123;</span><br><span class="line">TH0 = (<span class="keyword">unsigned</span> <span class="keyword">int</span>)(<span class="number">65536</span><span class="number">-11059200</span>/tones[flag]/<span class="number">24</span>)/<span class="number">256</span>;</span><br><span class="line">TL0 = (<span class="keyword">unsigned</span> <span class="keyword">int</span>)(<span class="number">65536</span><span class="number">-11059200</span>/tones[flag]/<span class="number">24</span>)%<span class="number">256</span>;</span><br><span class="line"><span class="keyword">if</span>(i==<span class="number">34</span>)&#123; <span class="comment">// 循环一遍之后，将蜂鸣器置空一段时间</span></span><br><span class="line">beep = <span class="number">1</span>;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;  </span><br><span class="line">beep = ~beep;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 延时</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">delay</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">int</span> i;</span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">char</span> j;</span><br><span class="line"><span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;<span class="number">300</span>;i++)</span><br><span class="line"><span class="keyword">for</span>(j=<span class="number">0</span>;j&lt;<span class="number">110</span>;j++);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">char</span> k =<span class="number">5</span>;</span><br><span class="line">TMOD = <span class="number">0x01</span>;</span><br><span class="line">flag = <span class="number">0</span>;</span><br><span class="line">TH0 = (<span class="keyword">unsigned</span> <span class="keyword">int</span>)(<span class="number">65536</span><span class="number">-11059200</span>/tones[flag]/<span class="number">24</span>)/<span class="number">256</span>;</span><br><span class="line">TL0 = (<span class="keyword">unsigned</span> <span class="keyword">int</span>)(<span class="number">65536</span><span class="number">-11059200</span>/tones[flag]/<span class="number">24</span>)%<span class="number">256</span>;</span><br><span class="line">beep = <span class="number">0</span>;</span><br><span class="line">EA = <span class="number">1</span>;</span><br><span class="line">ET0 = <span class="number">1</span>;</span><br><span class="line">TR0 = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">while</span>(<span class="number">1</span>)&#123;</span><br><span class="line"><span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;<span class="number">34</span>;i++)&#123;  <span class="comment">// 遍历“两个老虎”音调谱</span></span><br><span class="line">flag = tigers[i]<span class="number">-1</span>;</span><br><span class="line">delay();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">while</span>(k--)&#123;</span><br><span class="line">delay();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li></ul><h4 id="9-串口编程入门"><a href="#9-串口编程入门" class="headerlink" title="9. 串口编程入门"></a>9. 串口编程入门</h4><ul><li><p>步骤</p><blockquote><ol><li>初始化<ol><li>串口初始化：SCON-&gt;REN</li><li>定时器初始化：PCON-&gt;TMOD</li><li>初始化初值：TMOD-&gt;比特率</li><li>启动定时器</li><li>开中断</li></ol></li><li>中断接收</li></ol></blockquote></li><li><p>SCON：串口控制寄存器</p><table><thead><tr><th>每个位</th><th>SM0</th><th>SM1</th><th>SM2</th><th>REN</th><th>TB8</th><th>RB8</th><th>TI</th><th align="center">RI</th></tr></thead><tbody><tr><td>功能</td><td>方式选择</td><td>方式选择</td><td>-</td><td>允许串行接收位</td><td>-</td><td>-</td><td>-</td><td align="center">-</td></tr><tr><td></td><td>0</td><td>1</td><td>0</td><td>1</td><td></td><td></td><td></td><td align="center"></td></tr></tbody></table><blockquote><ul><li>SM0、SM1（最常用）<ul><li>方式1：8位异步收发，波特率可变</li></ul></li><li>REN<ul><li>允许：1</li><li>禁止：0</li></ul></li><li>SCON常用赋值：0x50</li></ul></blockquote></li></ul><ul><li><p>PCON：特殊功能寄存器</p><table><thead><tr><th>SMOD</th><th>-</th><th>-</th><th>-</th><th>GF1</th><th>GF0</th><th>PD</th><th>IDL</th></tr></thead><tbody><tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr></tbody></table><blockquote><p>PCON仅有最高位与串行口相关，其余是电源相关，因此使用是需要谨慎。</p></blockquote></li></ul><blockquote><ul><li><p>PCON仅有最高位与串行口相关，其余是电源相关，因此使用是需要谨慎。</p></li><li><p>PCON最高位：波特率</p><ul><li>1比0翻倍。</li></ul></li><li><p>此处为了不干扰其他选项：PCOM|=（0x01&lt;&lt;7）;</p></li></ul></blockquote><ul><li><p>TMOD：定时、计数器寄存器</p><table><thead><tr><th>TMOD</th><th>GATE</th><th>C/T</th><th>M1</th><th>M0</th><th>GATE</th><th>C/T</th><th>M1</th><th>M0</th></tr></thead><tbody><tr><td></td><td>T1</td><td>T1</td><td>T1</td><td>T1</td><td>T0</td><td>T0</td><td>T0</td><td>T0</td></tr></tbody></table><blockquote><ul><li>GATE：门控位，是否计数</li><li>M1、M0工作方式：此处选择8位自动填装 M1= 1，M0=0，GATE</li><li>TMOD  = 0x20; </li></ul></blockquote></li><li><p>将以上初始化代码封装为函数</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span></span>&#123; <span class="comment">// 使用该函数的前提是导入了 reg52.h</span></span><br><span class="line">    SCON = <span class="number">0x40</span>;</span><br><span class="line">    PCON |= <span class="number">0x80</span>;</span><br><span class="line">    TMOD &amp;= <span class="number">0x0F</span>; <span class="comment">// 将高4位置0</span></span><br><span class="line">    TMOD |= <span class="number">0x10</span>;</span><br><span class="line">    <span class="comment">// 赋初值 19.2kbit</span></span><br><span class="line">    TH1 = <span class="number">0xFD</span>;</span><br><span class="line">    TL1 = <span class="number">0xFD</span>;</span><br><span class="line">    <span class="comment">// 启动定时器</span></span><br><span class="line">    TR1 = <span class="number">1</span>;</span><br><span class="line">    <span class="comment">// 开中断</span></span><br><span class="line">    EA = <span class="number">1</span>;</span><br><span class="line">    ES = <span class="number">1</span>;   </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>定义发送字符串函数</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">sendchar</span><span class="params">(<span class="keyword">char</span> data)</span></span>&#123;</span><br><span class="line">    <span class="comment">// 给发送缓冲区写值</span></span><br><span class="line">    SBUF = data;</span><br><span class="line">    <span class="comment">// 判断是否读取完毕</span></span><br><span class="line">    <span class="keyword">while</span>(TI==<span class="number">0</span>);</span><br><span class="line">    TI=<span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>定义中断的方式接收字符</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">getChar</span><span class="params">()</span> interrupt 4 </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(RI)&#123;</span><br><span class="line">        RI = <span class="number">0</span>;</span><br><span class="line">        ch = SBUF;</span><br><span class="line">       read_flag = <span class="number">1</span>; <span class="comment">// 读取一个字节的标志位（全局）    </span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h4 id="10-串口通信-发送与接收"><a href="#10-串口通信-发送与接收" class="headerlink" title="10.  串口通信-发送与接收"></a>10.  串口通信-发送与接收</h4><ul><li><p>在PC端通过串口工具发送字符，在单片机一侧实现接收字符，再把接收到的字符发送回PC</p></li><li><p>代码</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;reg52.h&quot;</span></span></span><br><span class="line">bit read_flag = <span class="number">0</span>;<span class="comment">// 读取的标志位</span></span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">char</span> ch;<span class="comment">// 存放读取到的字符</span></span><br><span class="line"><span class="comment">// 串口通信的初始化</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">init_serialcom</span><span class="params">( <span class="keyword">void</span> )</span> </span>&#123; </span><br><span class="line">     SCON = <span class="number">0x50</span> ;  <span class="comment">//SCON: serail mode 1, 8-bit UART, enable ucvr </span></span><br><span class="line">   TMOD |= <span class="number">0x20</span> ; <span class="comment">//TMOD: timer 1, mode 2, 8-bit reload </span></span><br><span class="line">   PCON |= <span class="number">0x80</span> ; <span class="comment">//SMOD=1; </span></span><br><span class="line">   TH1 = <span class="number">0xFA</span> ;   <span class="comment">//Baud:9600 fosc=11.0592MHz </span></span><br><span class="line">   IE |= <span class="number">0x90</span> ;   <span class="comment">//Enable Serial Interrupt </span></span><br><span class="line">   TR1 = <span class="number">1</span> ;     <span class="comment">// timer 1 run </span></span><br><span class="line">   TI=<span class="number">1</span>; </span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 发送字符</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">send_char_com</span><span class="params">( <span class="keyword">unsigned</span> <span class="keyword">char</span> ch)</span> </span>&#123; </span><br><span class="line">SBUF = ch; </span><br><span class="line"><span class="keyword">while</span> (TI== <span class="number">0</span>); </span><br><span class="line">TI= <span class="number">0</span> ; </span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 串口监听字符</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">serial</span> <span class="params">()</span> interrupt 4 <span class="keyword">using</span> 3 </span>&#123; </span><br><span class="line"><span class="keyword">if</span> (RI) &#123;  </span><br><span class="line">RI = <span class="number">0</span> ; </span><br><span class="line">ch=SBUF; </span><br><span class="line">read_flag= <span class="number">1</span> ;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">init_serialcom();</span><br><span class="line"><span class="keyword">while</span>(<span class="number">1</span>)&#123;</span><br><span class="line"><span class="keyword">if</span>(read_flag==<span class="number">1</span>)&#123;<span class="comment">// 判断是否读取到数据</span></span><br><span class="line">send_char_com(ch);<span class="comment">// 将读取到的数据发送出去</span></span><br><span class="line">read_flag=<span class="number">0</span>;<span class="comment">// 将读取标志清零</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h4 id="11-串口通信-pc控制单片机"><a href="#11-串口通信-pc控制单片机" class="headerlink" title="11. 串口通信-pc控制单片机"></a>11. 串口通信-pc控制单片机</h4><ul><li><p>PC端通过串口发送命令，控制单片机外设工作，如PC端用十六进制发送0x01，点亮单片机上第一个LED灯，发送0x02，点亮第二个LED，以此类推</p></li><li><p>代码</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;reg52.h&quot;</span></span></span><br><span class="line">bit read_flag = <span class="number">0</span>;<span class="comment">// 读取的标志位</span></span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">char</span> ch;<span class="comment">// 存放读取到的字符</span></span><br><span class="line"><span class="comment">// 串口通信的初始化</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">init_serialcom</span><span class="params">( <span class="keyword">void</span> )</span> </span></span><br><span class="line"><span class="function">   </span>&#123; </span><br><span class="line">     SCON = <span class="number">0x50</span> ;  <span class="comment">//SCON: serail mode 1, 8-bit UART, enable ucvr </span></span><br><span class="line">   TMOD |= <span class="number">0x20</span> ; <span class="comment">//TMOD: timer 1, mode 2, 8-bit reload </span></span><br><span class="line">   PCON |= <span class="number">0x80</span> ; <span class="comment">//SMOD=1; </span></span><br><span class="line">   TH1 = <span class="number">0xFA</span> ;   <span class="comment">//Baud:9600 fosc=11.0592MHz </span></span><br><span class="line">   IE |= <span class="number">0x90</span> ;   <span class="comment">//Enable Serial Interrupt </span></span><br><span class="line">   TR1 = <span class="number">1</span> ;     <span class="comment">// timer 1 run </span></span><br><span class="line">   TI=<span class="number">1</span>; </span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 发送字符</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">send_char_com</span><span class="params">( <span class="keyword">unsigned</span> <span class="keyword">char</span> ch)</span> </span>&#123; </span><br><span class="line">SBUF = ch; </span><br><span class="line"><span class="keyword">while</span> (TI== <span class="number">0</span>); </span><br><span class="line">TI= <span class="number">0</span> ; </span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 串口监听字符</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">serial</span> <span class="params">()</span> interrupt 4 <span class="keyword">using</span> 3 </span>&#123; </span><br><span class="line"><span class="keyword">if</span> (RI) &#123;  </span><br><span class="line">RI = <span class="number">0</span> ; </span><br><span class="line">ch=SBUF; </span><br><span class="line">read_flag= <span class="number">1</span> ;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">init_serialcom();</span><br><span class="line"><span class="keyword">while</span>(<span class="number">1</span>)&#123;</span><br><span class="line"><span class="keyword">if</span>(read_flag==<span class="number">1</span>)&#123;<span class="comment">// 判断是否读取到数据</span></span><br><span class="line"><span class="keyword">switch</span>(ch)&#123;</span><br><span class="line"><span class="keyword">case</span> <span class="number">0x01</span>:</span><br><span class="line">P1 = ~(<span class="number">0x01</span>);</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> <span class="number">0x02</span>:</span><br><span class="line">P1 = ~(<span class="number">0x01</span>&lt;&lt;<span class="number">1</span>);</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> <span class="number">0x03</span>:</span><br><span class="line">P1 = ~(<span class="number">0x01</span>&lt;&lt;<span class="number">2</span>);</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> <span class="number">0x04</span>:</span><br><span class="line">P1 = ~(<span class="number">0x01</span>&lt;&lt;<span class="number">3</span>);</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> <span class="number">0x05</span>:</span><br><span class="line">P1 = ~(<span class="number">0x01</span>&lt;&lt;<span class="number">4</span>);</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> <span class="number">0x06</span>:</span><br><span class="line">P1 = ~(<span class="number">0x01</span>&lt;&lt;<span class="number">5</span>);</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> <span class="number">0x07</span>:</span><br><span class="line">P1 = ~(<span class="number">0x01</span>&lt;&lt;<span class="number">6</span>);</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">default</span>:</span><br><span class="line">P1 = ~(<span class="number">0x01</span>&lt;&lt;<span class="number">7</span>);</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line">read_flag=<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h4 id="12-串口通信-多命令的读取与判断"><a href="#12-串口通信-多命令的读取与判断" class="headerlink" title="12. 串口通信-多命令的读取与判断"></a>12. 串口通信-多命令的读取与判断</h4><ul><li><p> 制定一个简单的串口通信协议，如下表，编写单片机的串口中断程序，解析以下命令并执行</p></li><li><table><thead><tr><th>第一个字节</th><th>第二个字节</th><th>第三个字节</th></tr></thead><tbody><tr><td>0xff：命令头部</td><td>0x01：点亮  0x02：熄灭</td><td>0x01：第一个LED  0x02：第二个LED  …</td></tr></tbody></table><blockquote><p>例如：当PC端向单片机发送0xff 0x01 0x02 命令 则点亮第二个LED</p><p>当PC端向单片机发送0xff 0x02 0x05 命令 则熄灭第五个LED</p></blockquote></li><li><p>代码</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;reg52.h&quot;</span></span></span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">char</span> read_flag;<span class="comment">// 命令标志位</span></span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">char</span> ch;<span class="comment">// 读取来自PC端的字符</span></span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">char</span> is_light;<span class="comment">// 灯亮标志位</span></span><br><span class="line"><span class="comment">// 串口通信的初始化</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">init_serialcom</span><span class="params">( <span class="keyword">void</span> )</span> </span>&#123; </span><br><span class="line"> SCON = <span class="number">0x50</span> ;  <span class="comment">//SCON: serail mode 1, 8-bit UART, enable ucvr </span></span><br><span class="line"> TMOD |= <span class="number">0x20</span> ; <span class="comment">//TMOD: timer 1, mode 2, 8-bit reload </span></span><br><span class="line"> PCON |= <span class="number">0x80</span> ; <span class="comment">//SMOD=1; </span></span><br><span class="line"> TH1 = <span class="number">0xFA</span> ;   <span class="comment">//Baud:9600 fosc=11.0592MHz </span></span><br><span class="line"> IE |= <span class="number">0x90</span> ;   <span class="comment">//Enable Serial Interrupt </span></span><br><span class="line"> TR1 = <span class="number">1</span> ;     <span class="comment">// timer 1 run </span></span><br><span class="line"> TI=<span class="number">1</span>; </span><br><span class="line">&#125; </span><br><span class="line"><span class="comment">// 监听中断</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">serial</span> <span class="params">()</span> interrupt 4 <span class="keyword">using</span> 3 </span>&#123; </span><br><span class="line"><span class="keyword">if</span> (RI)&#123; <span class="comment">// 每当RI读取1个字节，就会置1  。</span></span><br><span class="line">RI=<span class="number">0</span>;<span class="comment">// 读取标志位清零</span></span><br><span class="line">ch=SBUF;<span class="comment">// 从缓冲区获取数据</span></span><br><span class="line"><span class="keyword">if</span>(ch==<span class="number">0xff</span>)&#123;<span class="comment">// 读取到第一个命令（标志命令的开端）</span></span><br><span class="line">read_flag = <span class="number">1</span>;<span class="comment">// 判断读到第一个命令</span></span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line"><span class="keyword">if</span>(read_flag==<span class="number">1</span>)&#123;<span class="comment">// 读取到第2个命令（灯亮的标志位）</span></span><br><span class="line">read_flag=<span class="number">2</span>;<span class="comment">// 设置标志位为2</span></span><br><span class="line"><span class="keyword">if</span>(ch==<span class="number">0x01</span>)&#123;</span><br><span class="line">is_light = <span class="number">1</span>; <span class="comment">// 设置灯亮</span></span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(ch==<span class="number">0x02</span>)&#123;</span><br><span class="line">is_light = <span class="number">0</span>; <span class="comment">// 设置灯灭</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(read_flag==<span class="number">2</span>)&#123;<span class="comment">// 读取到第3个命令（灯控位）</span></span><br><span class="line">read_flag =<span class="number">0</span>; <span class="comment">// 将标志位清空</span></span><br><span class="line"><span class="keyword">if</span>(is_light)&#123;<span class="comment">// 灯亮(将该位，置0，其他位不变)</span></span><br><span class="line"><span class="keyword">switch</span>(ch)&#123;</span><br><span class="line"><span class="keyword">case</span> <span class="number">0x01</span>:</span><br><span class="line">P1 &amp;= ~(<span class="number">0x01</span>);</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> <span class="number">0x02</span>:</span><br><span class="line">P1 &amp;= ~(<span class="number">0x01</span>&lt;&lt;<span class="number">1</span>);</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> <span class="number">0x03</span>:</span><br><span class="line">P1 &amp;= ~(<span class="number">0x01</span>&lt;&lt;<span class="number">2</span>);</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> <span class="number">0x04</span>:</span><br><span class="line">P1 &amp;= ~(<span class="number">0x01</span>&lt;&lt;<span class="number">3</span>);</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> <span class="number">0x05</span>:</span><br><span class="line">P1 &amp;= ~(<span class="number">0x01</span>&lt;&lt;<span class="number">4</span>);</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> <span class="number">0x06</span>:</span><br><span class="line">P1 &amp;= ~(<span class="number">0x01</span>&lt;&lt;<span class="number">5</span>);</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> <span class="number">0x07</span>:</span><br><span class="line">P1 &amp;= ~(<span class="number">0x01</span>&lt;&lt;<span class="number">6</span>);</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> <span class="number">0x08</span>:</span><br><span class="line">P1 &amp;= ~(<span class="number">0x01</span>&lt;&lt;<span class="number">7</span>);</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;<span class="comment">// 灯灭(将该位，置1，其他位不变)</span></span><br><span class="line"><span class="keyword">switch</span>(ch)&#123;</span><br><span class="line"><span class="keyword">case</span> <span class="number">0x01</span>:</span><br><span class="line">P1 |= (<span class="number">0x01</span>);</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> <span class="number">0x02</span>:</span><br><span class="line">P1 |= (<span class="number">0x01</span>&lt;&lt;<span class="number">1</span>);</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> <span class="number">0x03</span>:</span><br><span class="line">P1 |= (<span class="number">0x01</span>&lt;&lt;<span class="number">2</span>);</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> <span class="number">0x04</span>:</span><br><span class="line">P1 |= (<span class="number">0x01</span>&lt;&lt;<span class="number">3</span>);</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> <span class="number">0x05</span>:</span><br><span class="line">P1 |= (<span class="number">0x01</span>&lt;&lt;<span class="number">4</span>);</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> <span class="number">0x06</span>:</span><br><span class="line">P1 |= (<span class="number">0x01</span>&lt;&lt;<span class="number">5</span>);</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> <span class="number">0x07</span>:</span><br><span class="line">P1 |= (<span class="number">0x01</span>&lt;&lt;<span class="number">6</span>);</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> <span class="number">0x08</span>:</span><br><span class="line">P1 |= (<span class="number">0x01</span>&lt;&lt;<span class="number">7</span>);</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">init_serialcom();<span class="comment">// 初始化参数</span></span><br><span class="line"><span class="keyword">while</span>(<span class="number">1</span>);<span class="comment">// 死循环等待读取完毕中断产生</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>注意：</p><ul><li>本题难点不在于代码逻辑的实现，而是在于通信之间数据的交互</li></ul></blockquote></li><li><p>串口助手</p><p><img src="https://i.loli.net/2021/01/15/f4m6djZ7lKPqDTt.png" class="lazyload" data-srcset="https://i.loli.net/2021/01/15/f4m6djZ7lKPqDTt.png" srcset="data:image/png;base64,666" alt="单片机-串口助手"></p><blockquote><p>注意：</p><ul><li><p>在使用该助手的时候，在PC发送数据给单片机的时候，在选择HEX模式（十六进制）的时候，发送数据时不要加0x前缀或者在前面补0，直接写对应的数值，例如：ff 2 5不要写成0xff 0x02 0x05或者ff 02 05。否则出现的逻辑错误调试调到怀疑人生</p></li><li><p>每次使用时记得打开串口，而且使用前，波特率记得要选对，串口在左上角串口号可以看到当前使用的是哪一个串口。</p></li></ul></blockquote></li></ul><hr><p>已经完结了！！！！发现有什么错误，欢迎留言指出。</p>]]></content>
      
      
      <categories>
          
          <category> 理论学习 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 物联网 </tag>
            
            <tag> 实验 </tag>
            
            <tag> 单片机 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Java+Mysql实现简略超市信息管理系统</title>
      <link href="2019/10/12/Java-Mysql%E5%AE%9E%E7%8E%B0%E7%AE%80%E7%95%A5%E8%B6%85%E5%B8%82%E4%BF%A1%E6%81%AF%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F/"/>
      <url>2019/10/12/Java-Mysql%E5%AE%9E%E7%8E%B0%E7%AE%80%E7%95%A5%E8%B6%85%E5%B8%82%E4%BF%A1%E6%81%AF%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F/</url>
      
        <content type="html"><![CDATA[<p>这以大一下程序设计题目为原型的系统，使用Java+JDBC+MySQL对C进行重写。</p><a id="more"></a><h1 id="JDBC-MySQL实现超市信息管理系统"><a href="#JDBC-MySQL实现超市信息管理系统" class="headerlink" title="JDBC+MySQL实现超市信息管理系统"></a>JDBC+MySQL实现超市信息管理系统</h1><h3 id="1-概述"><a href="#1-概述" class="headerlink" title="1. 概述"></a>1. 概述</h3><ul><li>超市商品管理系统用于管理员、销售员的登录。管理员和销售员查看数据。管理员可以进行入库。销售可以销售商品</li></ul><h3 id="2-需求分析"><a href="#2-需求分析" class="headerlink" title="2. 需求分析"></a>2. 需求分析</h3><ol><li>销售员，管理员登录</li><li>管理员添加商品信息，对商品信息修改</li><li>销售员可以对商品进行查询，出售等</li></ol><h3 id="3-程序设计"><a href="#3-程序设计" class="headerlink" title="3. 程序设计"></a>3. 程序设计</h3><ul><li><h5 id="实现方式："><a href="#实现方式：" class="headerlink" title="实现方式："></a>实现方式：</h5><ul><li>Java（JDBC）+MySQL</li></ul></li><li><h5 id="数据库表"><a href="#数据库表" class="headerlink" title="数据库表"></a>数据库表</h5><ul><li><p>用户表（User）</p><table><thead><tr><th>id</th><th>姓名</th><th>用户名</th><th>密码</th><th>类型</th></tr></thead><tbody><tr><td></td><td></td><td></td><td></td><td></td></tr></tbody></table></li><li><p>商品信息表（Good）</p><table><thead><tr><th>gid</th><th>商品名</th><th>品牌</th><th>进货时间</th><th>销售时间</th><th>进价</th><th>售价</th><th>剩余量</th><th>经办人</th></tr></thead><tbody><tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr></tbody></table></li></ul></li><li><h5 id="视图层"><a href="#视图层" class="headerlink" title="视图层"></a>视图层</h5><ul><li>登录界面</li><li>管理员菜单界面<ul><li>入库（新增或者添加）<ul><li>商品名、品牌、进货时间、进价、进货量、经办人</li></ul></li><li>查询<ul><li>进货时间、商品名、剩余量、经办人</li></ul></li></ul></li><li>销售员菜单界面<ul><li>销售（更新商品剩余量）<ul><li>商品名</li></ul></li><li>查询<ul><li>销售时间、商品名、品牌、售价、剩余量</li></ul></li></ul></li></ul></li><li><p>Dao层</p><ul><li>用户表</li><li>商品表</li></ul></li><li><p>流程图</p><p><img src="https://gitee.com/tobing/imagebed/raw/master/1570844735960.png" class="lazyload" data-srcset="https://gitee.com/tobing/imagebed/raw/master/1570844735960.png" srcset="data:image/png;base64,666" alt="1570844735960"></p></li></ul><h3 id="4-程序实现"><a href="#4-程序实现" class="headerlink" title="4. 程序实现"></a>4. 程序实现</h3><ul><li>工具<ul><li>idea2019</li><li>Mysql5.5</li><li>jdk9.0</li><li>mysql驱动jar</li></ul></li></ul><h5 id="1-准备工作"><a href="#1-准备工作" class="headerlink" title="1. 准备工作"></a>1. 准备工作</h5><ul><li><p>创建数据库</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">CREATE DATABASE &#96;test&#96; # 创建数据库</span><br><span class="line">USE &#96;test&#96;;# 使用该数据库</span><br><span class="line"></span><br><span class="line">DROP TABLE IF EXISTS &#96;good&#96;; </span><br><span class="line">CREATE TABLE &#96;good&#96; (  # 创建商品表表</span><br><span class="line">  &#96;gid&#96; int(11) NOT NULL AUTO_INCREMENT, </span><br><span class="line">  &#96;goodname&#96; varchar(20) NOT NULL, # 商品名</span><br><span class="line">  &#96;goodbrand&#96; varchar(20) NOT NULL,# 商品品牌</span><br><span class="line">  &#96;intime&#96; date DEFAULT NULL,      # 商品进货时间</span><br><span class="line">  &#96;saletime&#96; date DEFAULT NULL,    # 商品销售时间</span><br><span class="line">  &#96;inprice&#96; double DEFAULT NULL,   # 商品进价</span><br><span class="line">  &#96;saleprice&#96; double DEFAULT NULL, # 商品售价</span><br><span class="line">  &#96;stock&#96; int(11) DEFAULT NULL,    # 商品剩余量</span><br><span class="line">  &#96;agent&#96; varchar(20) DEFAULT NULL,# 商品经办人</span><br><span class="line">  PRIMARY KEY (&#96;gid&#96;)  # 主键</span><br><span class="line">) ENGINE&#x3D;InnoDB DEFAULT CHARSET&#x3D;utf8;</span><br><span class="line"></span><br><span class="line">DROP TABLE IF EXISTS &#96;user&#96;; </span><br><span class="line">CREATE TABLE &#96;user&#96; (  # 创建用户表</span><br><span class="line">  &#96;id&#96; int(11) NOT NULL,</span><br><span class="line">  &#96;username&#96; varchar(20) NOT NULL, # 用户名</span><br><span class="line">  &#96;password&#96; varchar(20) NOT NULL, # 密码</span><br><span class="line">  &#96;name&#96; varchar(20) NOT NULL,     </span><br><span class="line">  PRIMARY KEY (&#96;id&#96;)   # 主键</span><br><span class="line">) ENGINE&#x3D;InnoDB DEFAULT CHARSET&#x3D;utf8;</span><br></pre></td></tr></table></figure></li></ul><ul><li><p>下载驱动jar包</p><ul><li>到<code>Mysql</code>官网下载<code>mysql</code>驱动包<code>&lt;https://dev.mysql.com/downloads/connector/j/&gt;</code></li><li>Windows平台选择Platform Independent</li></ul></li><li><p>安装<code>Mysql</code>（省略，自行百度安装）</p></li><li><p>安装JDK（省略，自行百度安装）</p></li></ul><h5 id="2-项目创建"><a href="#2-项目创建" class="headerlink" title="2. 项目创建"></a>2. 项目创建</h5><ul><li><p>项目目录框架</p><p><img src="https://gitee.com/tobing/imagebed/raw/master/1570848487712.png" class="lazyload" data-srcset="https://gitee.com/tobing/imagebed/raw/master/1570848487712.png" srcset="data:image/png;base64,666" alt="1570848487712"></p></li><li><p>测试Mysql的连接情况</p><ul><li><p>测试代码</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> top.tobing.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.sql.Connection;</span><br><span class="line"><span class="keyword">import</span> java.sql.DriverManager;</span><br><span class="line"><span class="keyword">import</span> java.sql.ResultSet;</span><br><span class="line"><span class="keyword">import</span> java.sql.Statement;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConnTest</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">// 加载驱动</span></span><br><span class="line">        Class.forName(<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>);</span><br><span class="line">        <span class="comment">// 获取连接对象</span></span><br><span class="line">        Connection connection = DriverManager.getConnection(<span class="string">&quot;jdbc:mysql://localhost:3306/test&quot;</span>, <span class="string">&quot;root&quot;</span>, <span class="string">&quot;root&quot;</span>);</span><br><span class="line">        <span class="comment">// 定义sql 语句</span></span><br><span class="line">        String sql = <span class="string">&quot;select * from user&quot;</span>;</span><br><span class="line">        <span class="comment">// 创建执行对象</span></span><br><span class="line">        Statement statement = connection.createStatement();</span><br><span class="line">        <span class="comment">// 执行查询sql语句</span></span><br><span class="line">        ResultSet resultSet = statement.executeQuery(sql);</span><br><span class="line">        <span class="comment">// 输出结果集</span></span><br><span class="line">        System.out.println(resultSet);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>如果成功输出结果集的哈希地址，则说明成功连接上数据库</p></li></ul><h6 id="1-封装JDBC工具类：JDBCUtils"><a href="#1-封装JDBC工具类：JDBCUtils" class="headerlink" title="1. 封装JDBC工具类：JDBCUtils"></a>1. 封装JDBC工具类：JDBCUtils</h6><ul><li><p>目的，简化开发流程</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> top.tobing.utils;</span><br><span class="line"><span class="keyword">import</span> java.sql.*;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JDBCUtils</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Class.forName(<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 得到数据库的连接</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Connection <span class="title">getConnection</span><span class="params">()</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> DriverManager.getConnection(<span class="string">&quot;jdbc:mysql://localhost:3306/test?serverTimezone=UTC&quot;</span>, <span class="string">&quot;root&quot;</span>, <span class="string">&quot;root&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 关闭所有打开的资源</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">close</span><span class="params">(Connection conn, Statement stmt)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (stmt != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                stmt.close();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (conn != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                conn.close();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 关闭所有打开的资源</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">close</span><span class="params">(Connection conn, Statement stmt, ResultSet rs)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (rs != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                rs.close();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; close(conn, stmt);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul></li></ul><h6 id="2-编写JavaBean"><a href="#2-编写JavaBean" class="headerlink" title="2. 编写JavaBean"></a>2. 编写JavaBean</h6><ul><li><p>根据创建的数据库表，在domain包中创建对应的JavaBean类</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> top.tobing.domain;</span><br><span class="line"><span class="comment">// 对用用户表</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> isadmin;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isIsadmin</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> isadmin;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setIsadmin</span><span class="params">(<span class="keyword">boolean</span> isadmin)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.isadmin = isadmin;</span><br><span class="line">    &#125;</span><br><span class="line">...省略其他getter和setter方法</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 对用商品表</span></span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Good</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> gid;</span><br><span class="line">    <span class="keyword">private</span> String goodname;</span><br><span class="line">    <span class="keyword">private</span> String goodbrand;</span><br><span class="line">    <span class="keyword">private</span> Date intime;</span><br><span class="line">    <span class="keyword">private</span> Date saletime;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">double</span> inprice;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">double</span> saleprice;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> stock;</span><br><span class="line">    <span class="keyword">private</span> String agent;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getGid</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> gid;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setGid</span><span class="params">(<span class="keyword">int</span> gid)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.gid = gid;</span><br><span class="line">    &#125;</span><br><span class="line">...省略其他getter和setter方法</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h6 id="3-登录功能"><a href="#3-登录功能" class="headerlink" title="3. 登录功能"></a>3. 登录功能</h6></li><li><p>登录界面：可以获取用户名，密码。根据返回的用户类型调用创建<code>管理类</code>或者<code>销售类</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> top.tobing.view;</span><br><span class="line"><span class="keyword">import</span> top.tobing.dao.UserDao;</span><br><span class="line"><span class="keyword">import</span> top.tobing.domain.User;</span><br><span class="line"><span class="keyword">import</span> java.sql.SQLException;</span><br><span class="line"><span class="keyword">import</span> java.util.Scanner;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Login</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Login</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">while</span>(<span class="keyword">true</span>)&#123;</span><br><span class="line">            <span class="keyword">this</span>.show();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 数据库操作对象</span></span><br><span class="line">    UserDao userDao =<span class="keyword">new</span> UserDao();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">show</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 获取登录账号和密码</span></span><br><span class="line">        Scanner sc = <span class="keyword">new</span> Scanner(System.in);</span><br><span class="line">        System.out.println(<span class="string">&quot;------------超市商品管理系统------------&quot;</span>);</span><br><span class="line">        System.out.print(<span class="string">&quot;-1. 用户名：&quot;</span>);</span><br><span class="line">        String username = sc.next();</span><br><span class="line">        System.out.print(<span class="string">&quot;-2. 密  码：&quot;</span>);</span><br><span class="line">        String password = sc.next();</span><br><span class="line">        System.out.println(<span class="string">&quot;------------超市商品管理系统------------&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 根据登录用户名密码到数据库查询</span></span><br><span class="line">        User login = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            login = userDao.login(username, password);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(login!=<span class="keyword">null</span>)&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;登录成功！&quot;</span>);</span><br><span class="line">            <span class="keyword">if</span>(login.isIsadmin())&#123;</span><br><span class="line">                <span class="comment">//System.out.println(&quot;你好，管理员&quot;);</span></span><br><span class="line">                <span class="keyword">new</span> AdminMenu(login);</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="comment">//System.out.println(&quot;你好，销售员&quot;);</span></span><br><span class="line">                <span class="keyword">new</span> SaleMenu(login);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//System.out.println(login);</span></span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;Error！账号或密码有误，请重新输入！&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>根据用户名密码查询数据库</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserDao</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据用户名密码登录</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> username</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> password</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> SQLException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">login</span> <span class="params">(String username,String password)</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">        User user = <span class="keyword">null</span>;</span><br><span class="line">        Connection connection = JDBCUtils.getConnection();</span><br><span class="line">        Statement statement = connection.createStatement();</span><br><span class="line">        String sql = <span class="string">&quot;select * from user where username = &#x27;&quot;</span>+username+<span class="string">&quot;&#x27; and password = &#x27;&quot;</span>+password+<span class="string">&quot;&#x27;&quot;</span>;</span><br><span class="line">        <span class="comment">//System.out.println(&quot;sql=:&quot;+sql);</span></span><br><span class="line">        ResultSet resultSet = statement.executeQuery(sql);</span><br><span class="line">        <span class="keyword">if</span>(resultSet.next())&#123;</span><br><span class="line">            user = <span class="keyword">new</span> User();</span><br><span class="line">            <span class="keyword">int</span> id = resultSet.getInt(<span class="string">&quot;id&quot;</span>);</span><br><span class="line">            String username1 = resultSet.getString(<span class="string">&quot;username&quot;</span>);</span><br><span class="line">            String name = resultSet.getString(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">            String password1 = resultSet.getString(<span class="string">&quot;password&quot;</span>);</span><br><span class="line">            <span class="keyword">boolean</span> isadmin = resultSet.getBoolean(<span class="string">&quot;isadmin&quot;</span>);</span><br><span class="line">            user.setId(id);</span><br><span class="line">            user.setUsername(username);</span><br><span class="line">            user.setPassword(password);</span><br><span class="line">            user.setName(name);</span><br><span class="line">            user.setIsadmin(isadmin);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> user;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h6 id="4-公共管理界面"><a href="#4-公共管理界面" class="headerlink" title="4. 公共管理界面"></a>4. 公共管理界面</h6></li><li><p>公共菜单功能</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> top.tobing.view;</span><br><span class="line"><span class="keyword">import</span> top.tobing.dao.GoodDao;</span><br><span class="line"><span class="keyword">import</span> top.tobing.domain.Good;</span><br><span class="line"><span class="keyword">import</span> top.tobing.domain.User;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Scanner;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Menu</span> </span>&#123;</span><br><span class="line">    User user = <span class="keyword">null</span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Menu</span><span class="params">(User user)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.user = user;</span><br><span class="line">    &#125;</span><br><span class="line">    GoodDao goodDao = <span class="keyword">new</span> GoodDao();</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 通用商品查询</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">findGoods</span><span class="params">()</span></span>&#123;</span><br><span class="line">        Good g = <span class="keyword">new</span> Good();</span><br><span class="line">        <span class="keyword">while</span>(<span class="keyword">true</span>)&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;-----------商品查询-----------&quot;</span>);</span><br><span class="line">            System.out.println(<span class="string">&quot;-1. 根据商品名称&quot;</span>);</span><br><span class="line">            System.out.println(<span class="string">&quot;-2. 根据商品品牌&quot;</span>);</span><br><span class="line">            System.out.println(<span class="string">&quot;-3. 根据商品经办人&quot;</span>);</span><br><span class="line">            System.out.println(<span class="string">&quot;-0. 退出&quot;</span>);</span><br><span class="line">            System.out.print(<span class="string">&quot;-请输入你的选择：&quot;</span>);</span><br><span class="line">            Scanner sc = <span class="keyword">new</span> Scanner(System.in);</span><br><span class="line">            <span class="keyword">int</span> i = sc.nextInt();</span><br><span class="line">            List&lt;Good&gt; goods =<span class="keyword">null</span>;</span><br><span class="line">            <span class="keyword">switch</span> (i)&#123;</span><br><span class="line">                <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">                    System.out.print(<span class="string">&quot;请输入商品名称：&quot;</span>);</span><br><span class="line">                    String name = sc.next();</span><br><span class="line">                    goods = goodDao.findByName(name);</span><br><span class="line">                    System.out.println(<span class="string">&quot;--------------------------------------------&quot;</span>);</span><br><span class="line">                    System.out.println(<span class="string">&quot;商品名称\t\t商品品牌\t\t商品进价\t\t商品剩余\t\t商品经办人&quot;</span>);</span><br><span class="line">                    <span class="keyword">for</span> (Good good : goods) &#123;</span><br><span class="line">                        showGood(good);</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">                    System.out.print(<span class="string">&quot;请输入商品品牌：&quot;</span>);</span><br><span class="line">                    String brand = sc.next();</span><br><span class="line">                    goods = goodDao.findByBrand(brand);</span><br><span class="line">                    System.out.println(<span class="string">&quot;--------------------------------------------&quot;</span>);</span><br><span class="line">                    System.out.println(<span class="string">&quot;商品名称\t\t商品品牌\t\t商品进价\t\t商品剩余\t\t商品经办人&quot;</span>);</span><br><span class="line">                    <span class="keyword">for</span> (Good good : goods) &#123;</span><br><span class="line">                        showGood(good);</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">                    System.out.print(<span class="string">&quot;请输入商品经办人：&quot;</span>);</span><br><span class="line">                    String agent = sc.next();</span><br><span class="line">                    goods = goodDao.findByAgent(agent);</span><br><span class="line">                    System.out.println(<span class="string">&quot;--------------------------------------------&quot;</span>);</span><br><span class="line">                    System.out.println(<span class="string">&quot;商品名称\t\t商品品牌\t\t商品进价\t\t商品剩余\t\t商品经办人&quot;</span>);</span><br><span class="line">                    <span class="keyword">for</span> (Good good : goods) &#123;</span><br><span class="line">                        showGood(good);</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">                    System.out.println(<span class="string">&quot;退出&quot;</span>);</span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                <span class="keyword">default</span>:</span><br><span class="line">                    System.out.println(<span class="string">&quot;输入有误请重新输入&quot;</span>);</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 展示商品</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> good</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">showGood</span><span class="params">(Good good)</span></span>&#123;</span><br><span class="line">        System.out.println(good.getGoodname()+<span class="string">&quot;\t\t&quot;</span>+good.getGoodbrand()+<span class="string">&quot;\t\t&quot;</span>+good.getInprice()+<span class="string">&quot;\t\t&quot;</span>+good.getStock()+<span class="string">&quot;\t\t&quot;</span>+good.getAgent());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h6 id="5-管理员功能"><a href="#5-管理员功能" class="headerlink" title="5. 管理员功能"></a>5. 管理员功能</h6></li><li><p>管理员可以通过管理界面的选项选择对商品的操作</p></li><li><p>查看商品信息（基础自公共菜单）</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> top.tobing.view;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> top.tobing.dao.GoodDao;</span><br><span class="line"><span class="keyword">import</span> top.tobing.domain.Good;</span><br><span class="line"><span class="keyword">import</span> top.tobing.domain.User;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Scanner;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 管理员管理菜单</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AdminMenu</span> <span class="keyword">extends</span> <span class="title">Menu</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">AdminMenu</span><span class="params">(User user)</span></span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(user);</span><br><span class="line">        <span class="keyword">this</span>.show();</span><br><span class="line">    &#125;</span><br><span class="line">    GoodDao goodDao = <span class="keyword">new</span> GoodDao();</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">show</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">while</span>(<span class="keyword">true</span>)&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;------------欢迎光临!&quot;</span>+user.getUsername()+<span class="string">&quot;------------&quot;</span>);</span><br><span class="line">            System.out.println(<span class="string">&quot;-1. 商品入库&quot;</span>);</span><br><span class="line">            System.out.println(<span class="string">&quot;-2. 查看商品&quot;</span>);</span><br><span class="line">            System.out.println(<span class="string">&quot;-0. 退出&quot;</span>);</span><br><span class="line">            System.out.print(<span class="string">&quot;-请输入：&quot;</span>);</span><br><span class="line">            Scanner sc = <span class="keyword">new</span> Scanner(System.in);</span><br><span class="line">            <span class="keyword">int</span> i = sc.nextInt();</span><br><span class="line">            <span class="keyword">if</span>(i==<span class="number">1</span>)&#123;</span><br><span class="line">                newGoods(); <span class="comment">// 添加商品（商品入库）</span></span><br><span class="line">            &#125;<span class="keyword">else</span> <span class="keyword">if</span>(i==<span class="number">2</span>)&#123;</span><br><span class="line">                findGoods();<span class="comment">// 查找商品</span></span><br><span class="line">            &#125;<span class="keyword">else</span> <span class="keyword">if</span>(i==<span class="number">0</span>)&#123;</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;输入数字有误！&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 商品入库</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">newGoods</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">        Scanner sc = <span class="keyword">new</span> Scanner(System.in);</span><br><span class="line">        System.out.println(<span class="string">&quot;-----------商品进货-----------&quot;</span>);</span><br><span class="line">        System.out.print(<span class="string">&quot;-商品名称：&quot;</span>);</span><br><span class="line">        String name = sc.next();</span><br><span class="line">        System.out.print(<span class="string">&quot;-商品品牌：&quot;</span>);</span><br><span class="line">        String brand = sc.next();</span><br><span class="line">        System.out.print(<span class="string">&quot;-商品数量：&quot;</span>);</span><br><span class="line">        <span class="keyword">int</span> num = sc.nextInt();</span><br><span class="line">        System.out.print(<span class="string">&quot;-商品进价：&quot;</span>);</span><br><span class="line">        <span class="keyword">double</span> price = sc.nextDouble();</span><br><span class="line">        List&lt;Good&gt; list = goodDao.findByName(name);</span><br><span class="line">        <span class="keyword">if</span>(list!=<span class="keyword">null</span>&amp;&amp;(!list.isEmpty()))&#123;<span class="comment">// 已经存在商品</span></span><br><span class="line">            Good good = list.get(<span class="number">0</span>);</span><br><span class="line">            <span class="keyword">int</span> temp = good.getStock();</span><br><span class="line">            goodDao.updateByName(name,num+temp);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            Good g = <span class="keyword">new</span> Good();</span><br><span class="line">            g.setGoodname(name);</span><br><span class="line">            g.setGoodbrand(brand);</span><br><span class="line">            g.setStock(num);</span><br><span class="line">            g.setInprice(price);</span><br><span class="line">            g.setAgent(user.getName());</span><br><span class="line">            goodDao.addNewGoods(g);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><h6 id="6-销售员功能"><a href="#6-销售员功能" class="headerlink" title="6. 销售员功能"></a>6. 销售员功能</h6></li><li><p>销售员可以通过商品名称和商品数量销售商品</p></li><li><p>查看商品信息（继承自菜单父类）</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> top.tobing.view;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> top.tobing.dao.GoodDao;</span><br><span class="line"><span class="keyword">import</span> top.tobing.domain.Good;</span><br><span class="line"><span class="keyword">import</span> top.tobing.domain.User;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Scanner;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 销售人员管理菜单</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SaleMenu</span> <span class="keyword">extends</span> <span class="title">Menu</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SaleMenu</span><span class="params">(User user)</span></span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(user);</span><br><span class="line">        <span class="keyword">this</span>.show();</span><br><span class="line">    &#125;</span><br><span class="line">    GoodDao goodDao = <span class="keyword">new</span> GoodDao();</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">show</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">while</span>(<span class="keyword">true</span>)&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;------------欢迎光临!&quot;</span>+user.getUsername()+<span class="string">&quot;------------&quot;</span>);</span><br><span class="line">            System.out.println(<span class="string">&quot;-1. 销售商品&quot;</span>);</span><br><span class="line">            System.out.println(<span class="string">&quot;-2. 查看库存&quot;</span>);</span><br><span class="line">            System.out.println(<span class="string">&quot;-0. 退出&quot;</span>);</span><br><span class="line">            System.out.print(<span class="string">&quot;-请输入：&quot;</span>);</span><br><span class="line">            Scanner sc = <span class="keyword">new</span> Scanner(System.in);</span><br><span class="line">            <span class="keyword">int</span> i = sc.nextInt();</span><br><span class="line">            <span class="keyword">if</span>(i==<span class="number">1</span>)&#123;</span><br><span class="line">                <span class="comment">//System.out.println(&quot;商品销售&quot;);</span></span><br><span class="line">                saleGood();</span><br><span class="line">            &#125;<span class="keyword">else</span> <span class="keyword">if</span>(i==<span class="number">2</span>)&#123;</span><br><span class="line">                <span class="comment">//System.out.println(&quot;查看库存&quot;);</span></span><br><span class="line">                findGoods();</span><br><span class="line">            &#125;<span class="keyword">else</span> <span class="keyword">if</span>(i==<span class="number">0</span>)&#123;</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;输入数字有误！&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">saleGood</span><span class="params">()</span></span>&#123;</span><br><span class="line">        Scanner sc = <span class="keyword">new</span> Scanner(System.in);</span><br><span class="line">        System.out.print(<span class="string">&quot;请输入要销售的商品名称：&quot;</span>);</span><br><span class="line">        String name = sc.next();</span><br><span class="line">        System.out.print(<span class="string">&quot;请输入要销售数量：&quot;</span>);</span><br><span class="line">        <span class="keyword">int</span> num = sc.nextInt();</span><br><span class="line">        List&lt;Good&gt; list = goodDao.findByName(name);</span><br><span class="line">        <span class="keyword">if</span>(list!=<span class="keyword">null</span>&amp;&amp;(!list.isEmpty()))&#123;</span><br><span class="line">            Good good = list.get(<span class="number">0</span>);</span><br><span class="line">            <span class="keyword">if</span>(good.getStock()&lt;num)&#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;商品数量不足！！剩余：&quot;</span>+good.getStock());</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                goodDao.updateByName(name,good.getStock()-num);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;商品名不存在，请重新选择！！！！&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h6 id="6-商品Dao"><a href="#6-商品Dao" class="headerlink" title="6.商品Dao"></a>6.商品Dao</h6></li><li><p>用于对good表的增删改</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> top.tobing.dao;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> top.tobing.domain.Good;</span><br><span class="line"><span class="keyword">import</span> top.tobing.utils.GoodMapper;</span><br><span class="line"><span class="keyword">import</span> top.tobing.utils.JDBCUtils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.sql.*;</span><br><span class="line"><span class="keyword">import</span> java.text.SimpleDateFormat;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GoodDao</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据姓名查询商品</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> name</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Good&gt; <span class="title">findByName</span><span class="params">(String name)</span>  </span>&#123;</span><br><span class="line">        Connection connection = <span class="keyword">null</span>;</span><br><span class="line">        ResultSet resultSet =<span class="keyword">null</span>;</span><br><span class="line">        Statement statement = <span class="keyword">null</span>;</span><br><span class="line">        List&lt;Good&gt; list =<span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            connection = JDBCUtils.getConnection();</span><br><span class="line">            statement = connection.createStatement();</span><br><span class="line">            String sql = <span class="string">&quot;select * from good where goodname = &#x27;&quot;</span> + name + <span class="string">&quot;&#x27;&quot;</span>;</span><br><span class="line">            resultSet = statement.executeQuery(sql);</span><br><span class="line">            list = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">            <span class="keyword">while</span> (resultSet.next()) &#123;</span><br><span class="line">                Good good = GoodMapper.getObject(resultSet);</span><br><span class="line">                list.add(good);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> list;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据品牌查询</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> brand</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Good&gt; <span class="title">findByBrand</span><span class="params">(String brand)</span> </span>&#123;</span><br><span class="line">        Connection connection = <span class="keyword">null</span>;</span><br><span class="line">        ResultSet resultSet =<span class="keyword">null</span>;</span><br><span class="line">        Statement statement = <span class="keyword">null</span>;</span><br><span class="line">        List&lt;Good&gt; list =<span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            connection = JDBCUtils.getConnection();</span><br><span class="line">            statement = connection.createStatement();</span><br><span class="line">            String sql = <span class="string">&quot;select * from good where goodbrand = &#x27;&quot;</span> + brand + <span class="string">&quot;&#x27;&quot;</span>;</span><br><span class="line">            resultSet = statement.executeQuery(sql);</span><br><span class="line">            list = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">            <span class="keyword">while</span> (resultSet.next()) &#123;</span><br><span class="line">                Good good = GoodMapper.getObject(resultSet);</span><br><span class="line">                list.add(good);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> list;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据经办人查询</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> agent</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Good&gt; <span class="title">findByAgent</span><span class="params">(String agent)</span> </span>&#123;</span><br><span class="line">        Connection connection = <span class="keyword">null</span>;</span><br><span class="line">        ResultSet resultSet =<span class="keyword">null</span>;</span><br><span class="line">        Statement statement = <span class="keyword">null</span>;</span><br><span class="line">        List&lt;Good&gt; list =<span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            connection = JDBCUtils.getConnection();</span><br><span class="line">            statement = connection.createStatement();</span><br><span class="line">            String sql = <span class="string">&quot;select * from good where agent = &#x27;&quot;</span> + agent + <span class="string">&quot;&#x27;&quot;</span>;</span><br><span class="line">            resultSet = statement.executeQuery(sql);</span><br><span class="line">            list = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">            <span class="keyword">while</span> (resultSet.next()) &#123;</span><br><span class="line">                Good good = GoodMapper.getObject(resultSet);</span><br><span class="line">                list.add(good);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> list;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 添加新商品</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> good</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addNewGoods</span><span class="params">(Good good)</span></span>&#123;</span><br><span class="line">        Connection connection = <span class="keyword">null</span>;</span><br><span class="line">        ResultSet resultSet =<span class="keyword">null</span>;</span><br><span class="line">        Statement statement = <span class="keyword">null</span>;</span><br><span class="line">        List&lt;Good&gt; list =<span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            connection = JDBCUtils.getConnection();</span><br><span class="line">            statement = connection.createStatement();</span><br><span class="line">            String sql = <span class="string">&quot;insert into good(goodname,goodbrand,intime,inprice,stock,agent) &quot;</span> +</span><br><span class="line">                    <span class="string">&quot;values(&#x27;&quot;</span>+good.getGoodname()+<span class="string">&quot;&#x27;,&#x27;&quot;</span>+good.getGoodbrand()+<span class="string">&quot;&#x27;,&#x27;&quot;</span>+</span><br><span class="line">                    <span class="keyword">new</span> SimpleDateFormat(<span class="string">&quot;yyyy-MM-dd hh:mm:ss&quot;</span>).format(<span class="keyword">new</span> Date()) +</span><br><span class="line">                    <span class="string">&quot;&#x27;,&#x27;&quot;</span>+good.getInprice()+<span class="string">&quot;&#x27;,&#x27;&quot;</span>+good.getStock()+<span class="string">&quot;&#x27;,&#x27;&quot;</span>+good.getAgent()+<span class="string">&quot;&#x27;)&quot;</span> ;</span><br><span class="line">            statement.execute(sql);</span><br><span class="line">        &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 更新已经存在的商品数量</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> name</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> num</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updateByName</span><span class="params">(String name,<span class="keyword">int</span> num)</span> </span>&#123;</span><br><span class="line">        Connection connection = <span class="keyword">null</span>;</span><br><span class="line">        ResultSet resultSet =<span class="keyword">null</span>;</span><br><span class="line">        Statement statement = <span class="keyword">null</span>;</span><br><span class="line">        List&lt;Good&gt; list =<span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            connection = JDBCUtils.getConnection();</span><br><span class="line">            statement = connection.createStatement();</span><br><span class="line">            String sql = <span class="string">&quot;update good set stock = &quot;</span>+num+<span class="string">&quot; where goodname =&#x27;&quot;</span>+name+<span class="string">&quot;&#x27;&quot;</span>;</span><br><span class="line">            System.out.println(sql);</span><br><span class="line">            statement.execute(sql);</span><br><span class="line">        &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h6 id="7-额外的类"><a href="#7-额外的类" class="headerlink" title="7. 额外的类"></a>7. 额外的类</h6></li><li><p>封装结果集的GoodMapper类</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> top.tobing.utils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> top.tobing.domain.Good;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.sql.Date;</span><br><span class="line"><span class="keyword">import</span> java.sql.ResultSet;</span><br><span class="line"><span class="keyword">import</span> java.sql.SQLException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GoodMapper</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Good <span class="title">getObject</span><span class="params">(ResultSet resultSet)</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">        Good g = <span class="keyword">new</span> Good();</span><br><span class="line">        <span class="keyword">int</span> gid = resultSet.getInt(<span class="string">&quot;gid&quot;</span>);</span><br><span class="line">        String goodname = resultSet.getString(<span class="string">&quot;goodname&quot;</span>);</span><br><span class="line">        String goodbrand = resultSet.getString(<span class="string">&quot;goodbrand&quot;</span>);</span><br><span class="line">        Date intime = resultSet.getDate(<span class="string">&quot;intime&quot;</span>);</span><br><span class="line">        Date saletime = resultSet.getDate(<span class="string">&quot;saletime&quot;</span>);</span><br><span class="line">        <span class="keyword">double</span> inprice = resultSet.getDouble(<span class="string">&quot;inprice&quot;</span>);</span><br><span class="line">        <span class="keyword">double</span> saleprice = resultSet.getDouble(<span class="string">&quot;saleprice&quot;</span>);</span><br><span class="line">        <span class="keyword">int</span> stock = resultSet.getInt(<span class="string">&quot;stock&quot;</span>);</span><br><span class="line">        String agent = resultSet.getString(<span class="string">&quot;agent&quot;</span>);</span><br><span class="line">        g.setGid(gid);</span><br><span class="line">        g.setGoodbrand(goodbrand);</span><br><span class="line">        g.setGoodname(goodname);</span><br><span class="line">        g.setIntime(intime);</span><br><span class="line">        g.setSaleprice(saleprice);</span><br><span class="line">        g.setSaletime(saletime);</span><br><span class="line">        g.setInprice(inprice);</span><br><span class="line">        g.setStock(stock);</span><br><span class="line">        g.setAgent(agent);</span><br><span class="line">        <span class="keyword">return</span> g;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li><p>主程序类GoodsAdminSystem</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> top.tobing.test;</span><br><span class="line"><span class="keyword">import</span> top.tobing.view.Login;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GoodsAdminSystem</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Login login = <span class="keyword">new</span> Login();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li></ul><h5 id="3-项目回顾"><a href="#3-项目回顾" class="headerlink" title="3. 项目回顾"></a>3. 项目回顾</h5><ul><li><p>项目实际框架</p><p><img src="https://gitee.com/tobing/imagebed/raw/master/1570884396730.png" class="lazyload" data-srcset="https://gitee.com/tobing/imagebed/raw/master/1570884396730.png" srcset="data:image/png;base64,666" alt="1570884396730"></p></li></ul><h5 id="4-项目效果"><a href="#4-项目效果" class="headerlink" title="4. 项目效果"></a>4. 项目效果</h5><ul><li><p>大概执行效果</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">------------超市商品管理系统------------</span><br><span class="line">-1. 用户名：admin</span><br><span class="line">-2. 密  码：root</span><br><span class="line">------------欢迎光临!admin------------</span><br><span class="line">-1. 商品入库</span><br><span class="line">-2. 查看商品</span><br><span class="line">-0. 退出</span><br><span class="line">-请输入：2</span><br><span class="line">-----------商品查询-----------</span><br><span class="line">-1. 根据商品名称</span><br><span class="line">-2. 根据商品品牌</span><br><span class="line">-3. 根据商品经办人</span><br><span class="line">-0. 退出</span><br><span class="line">-请输入你的选择：3</span><br><span class="line">请输入商品经办人：tobing</span><br><span class="line">--------------------------------------------</span><br><span class="line">商品名称商品品牌商品进价商品剩余商品经办人</span><br><span class="line">华为Mate10华为1999.0299tobing</span><br><span class="line">华为P30华为3999.01324tobing</span><br><span class="line">魅族16魅族1999.0888tobing</span><br><span class="line">-----------商品查询-----------</span><br><span class="line">-1. 根据商品名称</span><br><span class="line">-2. 根据商品品牌</span><br><span class="line">-3. 根据商品经办人</span><br><span class="line">-0. 退出</span><br><span class="line">-请输入你的选择：0</span><br><span class="line">退出</span><br><span class="line">------------欢迎光临!admin------------</span><br><span class="line">-1. 商品入库</span><br><span class="line">-2. 查看商品</span><br><span class="line">-0. 退出</span><br><span class="line">-请输入：1</span><br><span class="line">-----------商品进货-----------</span><br><span class="line">-商品名称：华为Mate10</span><br><span class="line">-商品品牌：华为</span><br><span class="line">-商品数量：999</span><br><span class="line">-商品进价：1999</span><br><span class="line">------------欢迎光临!admin------------</span><br><span class="line">-1. 商品入库</span><br><span class="line">-2. 查看商品</span><br><span class="line">-0. 退出</span><br><span class="line">-请输入：0</span><br><span class="line">------------超市商品管理系统------------</span><br><span class="line">-1. 用户名：saler</span><br><span class="line">-2. 密  码：root</span><br><span class="line">------------欢迎光临!saler------------</span><br><span class="line">-1. 销售商品</span><br><span class="line">-2. 查看库存</span><br><span class="line">-0. 退出</span><br><span class="line">-请输入：1</span><br><span class="line">请输入要销售的商品名称：华为P30</span><br><span class="line">请输入要销售数量：100000</span><br><span class="line">商品数量不足！！剩余：1324</span><br><span class="line">------------欢迎光临!saler------------</span><br><span class="line">-1. 销售商品</span><br><span class="line">-2. 查看库存</span><br><span class="line">-0. 退出</span><br><span class="line">-请输入：0</span><br><span class="line"></span><br></pre></td></tr></table></figure></li></ul><h4 id="5-总结"><a href="#5-总结" class="headerlink" title="5. 总结"></a>5. 总结</h4><ul><li>本系统从构思到实现一共花费6hours</li><li>编写本系统主要熟悉一下开发流程</li><li>本系统任然存在很多缺陷<ul><li>没有使用数据库连接池</li><li>没有使用prepareStatement</li><li>没有对非法输入进行判断（负数，数据库注入等）</li><li>程序的功能非常简陋</li></ul></li><li>此程序的功能如有其它缺陷，请自行判断修改。本人不维护。</li></ul>]]></content>
      
      
      <categories>
          
          <category> 技术应用 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> JDBC </tag>
            
            <tag> MySQL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Java注解</title>
      <link href="2019/10/07/Java%E6%B3%A8%E8%A7%A3/"/>
      <url>2019/10/07/Java%E6%B3%A8%E8%A7%A3/</url>
      
        <content type="html"><![CDATA[<p>在框架的使用过程中，常用到注解，本文对注解进行简单介绍。</p><a id="more"></a><h1 id="注解"><a href="#注解" class="headerlink" title="注解"></a>注解</h1><ul><li>定义：注解（Annotation），也叫元数据。一种代码级别的说明。</li><li>它是<code>JDK1.5</code>及以后版本引入的一个特性，与类、接口、枚举是在同一个层次。它可以声明在包、类、字段、方法、局部变量、方法参数等的前面，用来对这些元素进行说明，注释。</li><li>作用分类：<ul><li>编写文档：通过代码里标识的元数据生成文档【生成文档doc文档】</li><li>代码分析：通过代码里标识的元数据对代码进行分析【使用反射】</li><li>编译检查：通过代码里标识的元数据让编译器能够实现基本的编译检查【Override】</li></ul></li><li>类比<ul><li>注释：给程序员看</li><li>注解：给计算机看</li></ul></li></ul><h3 id="1-编译检查"><a href="#1-编译检查" class="headerlink" title="1. 编译检查"></a>1. 编译检查</h3><ul><li>@Override：</li></ul><h3 id="2-编写文档"><a href="#2-编写文档" class="headerlink" title="2. 编写文档"></a>2. 编写文档</h3><ul><li>@author ：作者</li><li>@version：版本</li><li>@since：</li><li>@return：返回值</li></ul><h3 id="3-Java中预定义的注解"><a href="#3-Java中预定义的注解" class="headerlink" title="3. Java中预定义的注解"></a>3. Java中预定义的注解</h3><ul><li><p><code>@Override</code>：检测该被该注解标注的方法是否是继承自父类（接口）</p></li><li><p><code>@Deprecated</code>：表示该方法已经过时</p></li><li><p><code>@SuppressWarnings()</code>：压制警告</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> top.tobing.annotation;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Java内预定义的注解</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Tobing</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 1.5</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo01Annotation01</span> </span>&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">Cat cat = <span class="keyword">new</span> Cat();</span><br><span class="line">cat.run();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Animal</span></span>&#123;</span><br><span class="line"><span class="keyword">private</span> String name;</span><br><span class="line"><span class="function"><span class="keyword">public</span>  <span class="keyword">void</span> <span class="title">eat</span><span class="params">()</span> </span>&#123;</span><br><span class="line">System.out.println(<span class="string">&quot;吃吃吃！！！&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 压制所有的警告</span></span><br><span class="line"><span class="meta">@SuppressWarnings(&quot;all&quot;)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Cat</span> <span class="keyword">extends</span> <span class="title">Animal</span></span>&#123;</span><br><span class="line"><span class="comment">// 表示该方法是继承自父类的</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span>  <span class="keyword">void</span> <span class="title">eat</span><span class="params">()</span> </span>&#123;</span><br><span class="line">System.out.println(<span class="string">&quot;吃鱼！！！&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 表示该方法已经过时，不建议使用</span></span><br><span class="line"><span class="meta">@Deprecated</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">System.out.println(<span class="string">&quot;飞檐走壁！！！！&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h3 id="4-自定义注解"><a href="#4-自定义注解" class="headerlink" title="4. 自定义注解"></a>4. 自定义注解</h3><ul><li><p>如何自定义呢？<code>照葫芦画瓢</code>    — &gt; 查看@Deprecated源码</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Target(value=&#123;CONSTRUCTOR, FIELD, LOCAL_VARIABLE, METHOD, PACKAGE, MODULE, PARAMETER, TYPE&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Deprecated &#123;</span><br><span class="line">    ......</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>以下是自定义的注解：<code>MyAnno.java</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> top.tobing.annotation;</span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> MyAnno &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>对自定义的注解反编译</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">E:\Code&gt;javac MyAnno.java   <span class="comment"># 编译获取字节码文件</span></span><br><span class="line">E:\Code&gt;javap MyAnno<span class="comment"># 反编译字节码文件</span></span><br><span class="line">Compiled from <span class="string">&quot;MyAnno.java&quot;</span></span><br><span class="line"><span class="comment"># 反编译得到的代码</span></span><br><span class="line">public interface MyAnno extends java.lang.annotation.Annotation &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>从以上编译所的代码可以知道<code>注解的本质</code></p><ul><li><p>本质：注解本质上就是一个接口，该接口默认继承了Annotation接口</p><ul><li><code>public interface MyAnno extends java.lang.annotation.Annotation </code></li><li>Annotation：The common interface extended by all annotation types.</li><li>Annotation：所有注解类型拓展的公共接口。</li></ul></li><li><p>注解属性：接口的抽象方法</p><ul><li>要求：<ul><li>属性返回值类型<ul><li>基本数据类型</li><li>String</li><li>枚举</li><li>注解</li><li>以上类型的数值</li></ul></li><li>定义了属性，在使用时需要给属性赋值<ol><li>定义属性时，使用default关键字给定默认值，使用注解时可以不进行赋值</li><li>只有一个属性需要赋值，并且名称是value，可以value可以省略，直接赋值即可。</li><li>数值赋值是，值需要用{}包裹。如果数组中只有一个值则可以省略{}</li></ol></li></ul></li><li>以下是代码演示</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> top.tobing.annotation;</span><br><span class="line"><span class="comment">// 自定义注解Anno</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> MyAnno &#123;</span><br><span class="line"><span class="comment">//int show();// int</span></span><br><span class="line"><span class="comment">//String show2();// String</span></span><br><span class="line"><span class="comment">//MyAnno1 anno1();// 注解类型</span></span><br><span class="line"><span class="function">String <span class="title">name</span><span class="params">()</span></span>;</span><br><span class="line">String[] cats();</span><br><span class="line"><span class="keyword">int</span>[] ages();</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">age</span><span class="params">()</span> <span class="keyword">default</span> 10</span>;<span class="comment">// 赋值了默认，可以不需要数值</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 自定义注解</span></span><br><span class="line"><span class="meta">@interface</span> MyAnno1&#123;</span><br><span class="line"><span class="function">String <span class="title">value</span><span class="params">()</span></span>; <span class="comment">// 只有一个值，且值的名称为value</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//////////////使用注解//////////////////</span></span><br><span class="line"><span class="comment">// age由于定义了default，可以不赋值</span></span><br><span class="line"><span class="comment">// cats是数组，赋值多个的时候使用大括号包裹</span></span><br><span class="line"><span class="comment">// ages是数值，赋值一个的时候，可以省略大括号</span></span><br><span class="line"><span class="meta">@MyAnno(name=&quot;张三&quot;,cats= &#123;&quot;小王&quot;,&quot;小白&quot;&#125;,ages=10)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 省略了value=</span></span><br><span class="line"><span class="meta">@MyAnno1(&quot;Value&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo01Annotation2</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul></li><li><p>元注解</p><ul><li>用于描述注解的注解（可以体会到元意思）</li><li>@Target：描述注解的作用时机<ul><li><code>ElementType</code>取值<ul><li><code>ElementType.TYPE</code>：可以作用在类上</li><li><code>ElementType.METHOD</code>：可以作用在方法上</li><li><code>ElementType.FIELD</code>：可以作用在成员变量上</li></ul></li></ul></li><li>@Retention：描述注解被保留的阶段<ul><li>@Retention(保留阶段)</li><li><code>RetentionPolicy.RUNTIME</code>：保留到class字节码文件中，并且被JVM读取到（这个最常用）</li><li><code>RetentionPolicy.SOURCE</code>：略</li><li><code>RetentionPolicy.CLASS</code>：略</li></ul></li><li>@Documented：描述注解是否被抽取到api中</li><li>@Inherited：描述注解是否被子类继承</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 以下元注解表述了：注解保留到class字节码文件中，并且被JVM读取到（这个最常用）</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="comment">// 以下元注解表述了：注解可以被抽取到API中</span></span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="comment">// 以下元注解表述了：自定义注解可以被子类继承</span></span><br><span class="line"><span class="meta">@Inherited</span></span><br><span class="line"><span class="comment">// 以下元注解表述了：自定义注解可以被使用在类（TYPE）、方法（METHOD）、成员变量（FIELD）</span></span><br><span class="line"><span class="meta">@Target(&#123;ElementType.TYPE,ElementType.METHOD,ElementType.FIELD&#125;)</span></span><br><span class="line"><span class="meta">@interface</span> MyAnno2&#123;</span><br><span class="line"><span class="function">String <span class="title">value</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> top.tobing.annotation;</span><br><span class="line"><span class="meta">@MyAnno2(&quot;类&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo01Annotation3</span> </span>&#123;</span><br><span class="line"><span class="meta">@MyAnno2(&quot;成员变量&quot;)</span></span><br><span class="line"><span class="keyword">private</span> String name;</span><br><span class="line"><span class="meta">@MyAnno2(&quot;方法&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">show</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li></ul><h3 id="5-注解的应用"><a href="#5-注解的应用" class="headerlink" title="5. 注解的应用"></a>5. 注解的应用</h3><h5 id="1-代替xml配置文件"><a href="#1-代替xml配置文件" class="headerlink" title="1. 代替xml配置文件"></a>1. 代替xml配置文件</h5><ul><li><p>传统的获取全限定类名，方法名，需要定义xml配置文件中，利用文件流获取xml，并将其中内容读取。操作比较麻烦。</p></li><li><p>使用注解可以代替此功能</p><ul><li>自定义获取<code>className</code> <code>methodName</code>的注解:Load.java</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> top.tobing.annotation;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.ElementType;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Retention;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.RetentionPolicy;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Target;</span><br><span class="line"><span class="meta">@Target(ElementType.TYPE)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Load &#123;</span><br><span class="line"><span class="function">String <span class="title">className</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function">String <span class="title">methodName</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li>通过自定义注解获取<code>className</code>，<code>methodName</code>，利用反射执行该方法</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> top.tobing.annotation;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"><span class="meta">@Load(className=&quot;top.tobing.annotation.Demo&quot;,methodName=&quot;show&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo04AnnotationReflect</span> </span>&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"><span class="comment">// 获取本类字节码文件对象</span></span><br><span class="line">Class&lt;Demo04AnnotationReflect&gt; demoClass = Demo04AnnotationReflect.class;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> 此处本质上是获取了，内存中实现的Load接口的子类对象执行方法的返回值</span></span><br><span class="line"><span class="comment"> public class LoadImpl&#123;</span></span><br><span class="line"><span class="comment"> public String className()&#123;</span></span><br><span class="line"><span class="comment"> return &quot;top.tobing.annotation.Demo&quot;;</span></span><br><span class="line"><span class="comment"> &#125;</span></span><br><span class="line"><span class="comment">public String methodName()&#123;</span></span><br><span class="line"><span class="comment">return &quot;show&quot;;</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment"> &#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">// 获取注解对象 </span></span><br><span class="line">Load load = demoClass.getAnnotation(Load.class);</span><br><span class="line"><span class="comment">// 获取注解的内容</span></span><br><span class="line">String className = load.className();</span><br><span class="line">String methodName = load.methodName();</span><br><span class="line">System.out.println(className);</span><br><span class="line">System.out.println(methodName);</span><br><span class="line"><span class="comment">// 通过类名以及方法名称利用反射，执行方法</span></span><br><span class="line"><span class="comment">//3.加载该类进内存</span></span><br><span class="line">        Class cls = Class.forName(className);</span><br><span class="line">        <span class="comment">//4.创建对象</span></span><br><span class="line">        Object obj = cls.newInstance();</span><br><span class="line">        <span class="comment">//5.获取方法对象</span></span><br><span class="line">        Method method = cls.getMethod(methodName);</span><br><span class="line">        <span class="comment">//6.执行方法</span></span><br><span class="line">        method.invoke(obj);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li></ul><h5 id="2-自动以测试"><a href="#2-自动以测试" class="headerlink" title="2. 自动以测试"></a>2. 自动以测试</h5><ul><li><p>要测试的类</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> top.tobing.annotation.test;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Cal</span> </span>&#123;</span><br><span class="line">    <span class="comment">//加法</span></span><br><span class="line">    <span class="meta">@MyCheck</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">()</span></span>&#123;</span><br><span class="line">        String str = <span class="keyword">null</span>;</span><br><span class="line">        str.toString();</span><br><span class="line">        System.out.println(<span class="string">&quot;1 + 0 =&quot;</span> + (<span class="number">1</span> + <span class="number">0</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//减法</span></span><br><span class="line">    <span class="meta">@MyCheck</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sub</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;1 - 0 =&quot;</span> + (<span class="number">1</span> - <span class="number">0</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//乘法</span></span><br><span class="line">    <span class="meta">@MyCheck</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">mul</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;1 * 0 =&quot;</span> + (<span class="number">1</span> * <span class="number">0</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//除法</span></span><br><span class="line">    <span class="meta">@MyCheck</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">div</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;1 / 0 =&quot;</span> + (<span class="number">1</span> / <span class="number">0</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">show</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;永无bug...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>测试使用的注解</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> top.tobing.annotation.test;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.ElementType;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Retention;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.RetentionPolicy;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Target;</span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Target(ElementType.METHOD)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> MyCheck &#123;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>测试类</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> top.tobing.annotation.test;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CalTest</span> </span>&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"><span class="comment">//1. 创建计算器对象</span></span><br><span class="line">Cal c = <span class="keyword">new</span> Cal();</span><br><span class="line"><span class="comment">//2. 获取计算器字节码文件</span></span><br><span class="line">Class cls = c.getClass();</span><br><span class="line"><span class="comment">//3. 通过字节码文件获取使用方法</span></span><br><span class="line">Method[] methods = cls.getMethods();</span><br><span class="line"><span class="keyword">int</span> num = <span class="number">0</span>;<span class="comment">//记录异常出现的次数</span></span><br><span class="line"><span class="keyword">for</span>(Method m:methods) &#123;</span><br><span class="line"><span class="comment">// 判断方法上是否包含注解</span></span><br><span class="line"><span class="keyword">if</span>(m.isAnnotationPresent(MyCheck.class)) &#123;</span><br><span class="line"><span class="comment">// 包含，捕获异常</span></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">m.invoke(c);</span><br><span class="line">&#125;<span class="keyword">catch</span>(Exception e) &#123;</span><br><span class="line">num++;</span><br><span class="line">System.out.println(m.getName()+<span class="string">&quot;出现异常了&quot;</span>);</span><br><span class="line">System.out.println(<span class="string">&quot;异常名称为：&quot;</span>+e.getCause().getClass().getSimpleName());</span><br><span class="line">System.out.println(<span class="string">&quot;异常原因是：&quot;</span>+e.getCause().getMessage());</span><br><span class="line">System.out.println(<span class="string">&quot;----------------------&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">System.out.println(<span class="string">&quot;本次测试一共出现&quot;</span>+num+<span class="string">&quot;次异常&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li><p>运行结果</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">add出现异常了</span><br><span class="line">异常名称为：NullPointerException</span><br><span class="line">异常原因是：null</span><br><span class="line">----------------------</span><br><span class="line">1 - 0 =1</span><br><span class="line">div出现异常了</span><br><span class="line">异常名称为：ArithmeticException</span><br><span class="line">异常原因是：/ by zero</span><br><span class="line">----------------------</span><br><span class="line">1 * 0 =0</span><br><span class="line">本次测试一共出现2次异常</span><br><span class="line"></span><br></pre></td></tr></table></figure></li></ul><h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><ul><li>在实战开发中，我们通常是使用注解，而并不是定义注解</li><li>此处复习注解是为了更好地学习框架。</li></ul>]]></content>
      
      
      <categories>
          
          <category> 理论学习 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> 注解 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Java反射（Reflection）(二)</title>
      <link href="2019/10/05/Java%E5%8F%8D%E5%B0%84%EF%BC%88Reflection%EF%BC%89-%E4%BA%8C/"/>
      <url>2019/10/05/Java%E5%8F%8D%E5%B0%84%EF%BC%88Reflection%EF%BC%89-%E4%BA%8C/</url>
      
        <content type="html"><![CDATA[<p>反射介绍第二弹。</p><a id="more"></a><h1 id="Java反射（Reflection）-二"><a href="#Java反射（Reflection）-二" class="headerlink" title="Java反射（Reflection）(二)"></a>Java反射（Reflection）(二)</h1><ul><li>获取了某个Object实例对应的Class，我们就可以通过反射获取他的一切信息。</li></ul><h3 id="1-访问字段-Filed"><a href="#1-访问字段-Filed" class="headerlink" title="1. 访问字段(Filed)"></a>1. 访问字段(Filed)</h3><ul><li><h4 id="通过Class访问字段（Field）信息的几个方法"><a href="#通过Class访问字段（Field）信息的几个方法" class="headerlink" title="通过Class访问字段（Field）信息的几个方法"></a>通过Class访问字段（Field）信息的几个方法</h4><ul><li><p>Field getField(String name) ：获取指定名称的Field（包含父类，子类的public的Field）</p></li><li><p>Filed getDeclaredField(String name) ：获取指定名称的Filed（包含子类的所有Field）</p></li><li><p>Field[] getFields() ：获取所有Field（包含父类，子类的public的Field）</p></li><li><p>Filed[] getDeclaredFields() ：获取所有Filed（包含子类的所有Field）</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> top.tobing.reflection;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取实例的字段信息</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Tobing</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo02ReflectField</span> </span>&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> NoSuchFieldException, SecurityException </span>&#123;</span><br><span class="line">Student stu = <span class="keyword">new</span> Student();</span><br><span class="line"><span class="comment">// 获取Student名称为id的Field</span></span><br><span class="line">System.out.println(stu.getClass().getField(<span class="string">&quot;name&quot;</span>));</span><br><span class="line">System.out.println(stu.getClass().getField(<span class="string">&quot;id&quot;</span>));</span><br><span class="line">System.out.println(stu.getClass().getDeclaredField(<span class="string">&quot;score&quot;</span>));</span><br><span class="line"><span class="comment">// 以下语句会抛出:java.lang.NoSuchFieldException 该方法不能找到父类的public方法</span></span><br><span class="line"><span class="comment">//System.out.println(stu.getClass().getDeclaredField(&quot;name&quot;));</span></span><br><span class="line">Field[] fields1 = stu.getClass().getFields();<span class="comment">// 获取stu的使用public修饰的方法</span></span><br><span class="line">System.out.println(<span class="string">&quot;stu的public修饰Field（包含父类）：&quot;</span>);</span><br><span class="line"><span class="keyword">for</span>(Field f:fields1) &#123;</span><br><span class="line">System.out.println(f.getName());</span><br><span class="line">&#125;</span><br><span class="line">Field[] fields2 = stu.getClass().getDeclaredFields();</span><br><span class="line">System.out.println(<span class="string">&quot;本类中的所有属性（包含private）：&quot;</span>);</span><br><span class="line"><span class="keyword">for</span>(Field f:fields2) &#123;</span><br><span class="line">System.out.println(f.getName());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Human</span></span>&#123;</span><br><span class="line"><span class="keyword">public</span> String name;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span> <span class="keyword">extends</span> <span class="title">Human</span> </span>&#123;</span><br><span class="line"><span class="keyword">public</span> String id;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">double</span> score;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 输出结果</span></span><br><span class="line">public java.lang.String top.tobing.reflection.Human.name</span><br><span class="line">public java.lang.String top.tobing.reflection.Student.id</span><br><span class="line">private double top.tobing.reflection.Student.score</span><br><span class="line">stu的public修饰Field（包含父类）：</span><br><span class="line">id</span><br><span class="line">name</span><br><span class="line">本类中的所有属性（包含private）：</span><br><span class="line">id</span><br><span class="line">score</span><br></pre></td></tr></table></figure></li></ul></li></ul><ul><li><h4 id="Field的常用操作"><a href="#Field的常用操作" class="headerlink" title="Field的常用操作"></a>Field的常用操作</h4><ul><li>String getName() <pre><code>      返回此 Field 对象表示的字段的`名称 `</code></pre></li><li>Class&lt;?&gt; getType() <pre><code>      返回一个 Class 对象，它标识了此 Field 对象所表示字段的`声明类型`。 </code></pre></li><li>int getModifiers() <pre><code>      以整数形式返回由此 Field 对象表示的字段的` Java 语言修饰符`。 </code></pre></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> top.tobing.reflection;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Modifier;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 字段的常用方法</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Tobing</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo03ReflectField2</span> </span>&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> NoSuchFieldException, SecurityException </span>&#123;</span><br><span class="line">Teacher t = <span class="keyword">new</span> Teacher();</span><br><span class="line">Field f2 = t.getClass().getDeclaredField(<span class="string">&quot;age&quot;</span>);</span><br><span class="line">Field f1 = t.getClass().getDeclaredField(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">System.out.println(<span class="string">&quot;-----------------------------------------------------&quot;</span>);</span><br><span class="line">System.out.println(<span class="string">&quot;名称：&quot;</span>+f1.getName());</span><br><span class="line">System.out.println(<span class="string">&quot;返回值类型：&quot;</span>+f1.getType());</span><br><span class="line">System.out.println(<span class="string">&quot;Java语言修饰符int形式：&quot;</span>+f1.getModifiers());</span><br><span class="line">System.out.println(<span class="string">&quot;isPrivate：&quot;</span>+Modifier.isPrivate(f1.getModifiers()));</span><br><span class="line"></span><br><span class="line">System.out.println(<span class="string">&quot;-----------------------------------------------------&quot;</span>);</span><br><span class="line">System.out.println(<span class="string">&quot;名称：&quot;</span>+f2.getName());</span><br><span class="line">System.out.println(<span class="string">&quot;返回值类型：&quot;</span>+f2.getType());</span><br><span class="line">System.out.println(<span class="string">&quot;Java语言修饰符int形式：&quot;</span>+f2.getModifiers());</span><br><span class="line">System.out.println(<span class="string">&quot;isPublic：&quot;</span>+Modifier.isPublic(f2.getModifiers()));</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Teacher</span></span>&#123;</span><br><span class="line"><span class="keyword">private</span> String name;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">int</span> age;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 输出结果</span></span><br><span class="line">-----------------------------------------------------</span><br><span class="line">名称：name</span><br><span class="line">返回值类型：class java.lang.String</span><br><span class="line">Java语言修饰符int形式：2</span><br><span class="line">isPrivate：<span class="literal">true</span></span><br><span class="line">-----------------------------------------------------</span><br><span class="line">名称：age</span><br><span class="line">返回值类型：int</span><br><span class="line">Java语言修饰符int形式：1</span><br><span class="line">isPublic：<span class="literal">true</span></span><br></pre></td></tr></table></figure></li></ul><h3 id="2-访问字段的值"><a href="#2-访问字段的值" class="headerlink" title="2. 访问字段的值"></a>2. 访问字段的值</h3><ul><li><p>Object get(Object obj) ：返回指定实例对应字段的值</p><pre><code>Returns the value of the field represented by this Field, on the specified object. </code></pre></li><li><p>void setAccessible(boolean flag) ：设置是否可以范围（权限不够的时候）</p><p>​    Set the accessible flag for this object to the indicated boolean value. </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> top.tobing.reflection;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Modifier;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 字段的常用方法</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Tobing</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo03ReflectField3</span> </span>&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">People p = <span class="keyword">new</span> People();</span><br><span class="line">p.setName(<span class="string">&quot;张三丰&quot;</span>);</span><br><span class="line">Field f1 = p.getClass().getDeclaredField(<span class="string">&quot;name&quot;</span>);</span><br><span class="line"><span class="comment">// f1.get(p); //直接执行该语句会抛出异常java.lang.IllegalAccessException</span></span><br><span class="line"><span class="comment">// cannot access a member of class top.tobing.reflection.People with modifiers &quot;private&quot; </span></span><br><span class="line"><span class="comment">//不能访问修饰符为private的字段</span></span><br><span class="line"><span class="comment">// 暴力反射，忽略修饰符 // 通常情况下，如果修饰符权限不够就考虑使用该方法（反射是非常规的用法）</span></span><br><span class="line">f1.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">Object obj = f1.get(p);</span><br><span class="line">System.out.println(obj);  <span class="comment">// 输出： 张三丰</span></span><br><span class="line">f1.set(p,<span class="string">&quot;张无忌&quot;</span>);</span><br><span class="line">System.out.println(f1.get(p));<span class="comment">// 修改后输出 张无忌</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">People</span></span>&#123;</span><br><span class="line"><span class="keyword">private</span> String name;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">int</span> age;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.name = name;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><ul><li>理解还未深入，仍需学习。</li></ul>]]></content>
      
      
      <categories>
          
          <category> 理论学习 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> 反射 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Java反射（Reflection）(一)</title>
      <link href="2019/10/04/Java%E5%8F%8D%E5%B0%84%EF%BC%88Reflection%EF%BC%89-%E4%B8%80/"/>
      <url>2019/10/04/Java%E5%8F%8D%E5%B0%84%EF%BC%88Reflection%EF%BC%89-%E4%B8%80/</url>
      
        <content type="html"><![CDATA[<p>在Java常用的框架中，反射被频繁的使用，本文介绍反射的简单使用。</p><a id="more"></a><h1 id="Java反射（Reflection）-一"><a href="#Java反射（Reflection）-一" class="headerlink" title="Java反射（Reflection）(一)"></a>Java反射（Reflection）(一)</h1><h3 id="1-什么是反射"><a href="#1-什么是反射" class="headerlink" title="1. 什么是反射"></a>1. 什么是反射</h3><ul><li>通过<code>Class</code>实例获取<code>class</code>（包含类和接口）信息的方法称为反射（Reflection）。</li></ul><h3 id="2-Class类"><a href="#2-Class类" class="headerlink" title="2. Class类"></a>2. Class类</h3><ul><li>除了基本数据类型:<code>int double long</code>等之外，其他的类型都是<code>class</code>，包括了<code>interface</code></li><li>class 是由JVM动态加载的</li><li>每加载一种class，JVM就为其创建一个Class类型的实例，并关联起来。</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">Class</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Class</span><span class="params">()</span></span>&#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>以<code>String类</code>为例，当JVM加载<code>String类</code>时，它首先读取<code>String.class</code>文件到内存，然后为String类创建一个Class实例与之关联起来</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Class c1 = <span class="keyword">new</span> Class(String);</span><br></pre></td></tr></table></figure><ul><li><p>Class实例是JVM内部创建的，Class类的构造方法是private，<code>只能</code>由JVM能<code>创建Class实例</code>。</p><blockquote><ul><li>JVM拥有的每一个Class实例都关联了一个数据类型（class 或者 interface）</li><li>Class实例包含了class的所有信息：name，package，super，interface，field，method等</li><li>因此我们可以通过Class实例来获取对应class的所有信息</li></ul></blockquote></li><li><h5 id="如何获取到Class实例（三种方法）"><a href="#如何获取到Class实例（三种方法）" class="headerlink" title="如何获取到Class实例（三种方法）"></a>如何获取到Class实例（三种方法）</h5><ol><li><p>通过<code>类的静态变量</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Class strClass = String.class;</span><br></pre></td></tr></table></figure></li><li><p>通过类<code>实例</code>的<code>getClass()</code>方法</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Stirng s = <span class="string">&quot;Hello&quot;</span>;</span><br><span class="line">Class strClass = s.getClass()；</span><br></pre></td></tr></table></figure></li><li><p>通过<code>Class.forName(&quot;全限定类名&quot;)</code>获取</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Class strClass = Class.forName(<span class="string">&quot;java.lang.String&quot;</span>);</span><br></pre></td></tr></table></figure></li><li><h5 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h5><ul><li>因为Class实例在JVM中是唯一的，所以可以用<code>==</code>比较两个Class</li></ul></li></ol></li></ul><h3 id="3-反射的目的"><a href="#3-反射的目的" class="headerlink" title="3. 反射的目的"></a>3. 反射的目的</h3><h4 id="1-获取Class实例的全部信息"><a href="#1-获取Class实例的全部信息" class="headerlink" title="1. 获取Class实例的全部信息"></a>1. 获取Class实例的全部信息</h4><ul><li><p>运行实例</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> top.tobing.reflection;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">       * 通过反射获取类的全部信息</span></span><br><span class="line"><span class="comment">       * <span class="doctag">@author</span> Tobing</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo01Reflection</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        printClassINFO(<span class="string">&quot; &quot;</span>.getClass());</span><br><span class="line">        printClassINFO(Runnable.class);</span><br><span class="line">        printClassINFO(java.time.Year.class);</span><br><span class="line">        printClassINFO(String[].class);</span><br><span class="line">        printClassINFO(<span class="keyword">int</span>.class);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 打印传入Class的信息</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@param</span> c 传入的Class</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">printClassINFO</span><span class="params">(Class c)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;------------------------------------------&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;简单类名：&quot;</span>+c.getSimpleName());</span><br><span class="line">        System.out.println(<span class="string">&quot;全限定类名：&quot;</span>+c.getName());</span><br><span class="line">        <span class="keyword">if</span>(c.getPackage()!=<span class="keyword">null</span>) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;包名：&quot;</span>+c.getPackageName());</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;接口？：&quot;</span>+c.isInterface());</span><br><span class="line">        System.out.println(<span class="string">&quot;枚举？：&quot;</span>+c.isEnum());</span><br><span class="line">        System.out.println(<span class="string">&quot;数组？：&quot;</span>+c.isArray());</span><br><span class="line">        System.out.println(<span class="string">&quot;基本数据类型？：&quot;</span>+c.isPrimitive());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>运行结果</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">------------------------------------------</span><br><span class="line">简单类名：String</span><br><span class="line">全限定类名：java.lang.String</span><br><span class="line">包名：java.lang</span><br><span class="line">接口？：<span class="literal">false</span></span><br><span class="line">枚举？：<span class="literal">false</span></span><br><span class="line">数组？：<span class="literal">false</span></span><br><span class="line">基本数据类型？：<span class="literal">false</span></span><br><span class="line">------------------------------------------</span><br><span class="line">简单类名：Runnable</span><br><span class="line">全限定类名：java.lang.Runnable</span><br><span class="line">包名：java.lang</span><br><span class="line">接口？：<span class="literal">true</span></span><br><span class="line">枚举？：<span class="literal">false</span></span><br><span class="line">数组？：<span class="literal">false</span></span><br><span class="line">基本数据类型？：<span class="literal">false</span></span><br><span class="line">------------------------------------------</span><br><span class="line">简单类名：Year</span><br><span class="line">全限定类名：java.time.Year</span><br><span class="line">包名：java.time</span><br><span class="line">接口？：<span class="literal">false</span></span><br><span class="line">枚举？：<span class="literal">false</span></span><br><span class="line">数组？：<span class="literal">false</span></span><br><span class="line">基本数据类型？：<span class="literal">false</span></span><br><span class="line">------------------------------------------</span><br><span class="line">简单类名：String[]</span><br><span class="line">全限定类名：[Ljava.lang.String;</span><br><span class="line">接口？：<span class="literal">false</span></span><br><span class="line">枚举？：<span class="literal">false</span></span><br><span class="line">数组？：<span class="literal">true</span></span><br><span class="line">基本数据类型？：<span class="literal">false</span></span><br><span class="line">------------------------------------------</span><br><span class="line">简单类名：int</span><br><span class="line">全限定类名：int</span><br><span class="line">接口？：<span class="literal">false</span></span><br><span class="line">枚举？：<span class="literal">false</span></span><br><span class="line">数组？：<span class="literal">false</span></span><br><span class="line">基本数据类型？：<span class="literal">true</span></span><br></pre></td></tr></table></figure></li></ul><h4 id="2-通过Class实例来创建对应类型实例"><a href="#2-通过Class实例来创建对应类型实例" class="headerlink" title="2. 通过Class实例来创建对应类型实例"></a>2. 通过Class实例来创建对应类型实例</h4><ul><li><p>代码如下</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Class c = String.class;<span class="comment">//获取String Class的实例</span></span><br><span class="line">String s = (String)c.newInstance();<span class="comment">//通过实例创建String实例</span></span><br></pre></td></tr></table></figure></li><li><p>注意</p><ul><li><code>Class.newInstance()</code>方式创建类实例时，<code>只能</code>调用该类的<code>public无参数</code>构造方法</li></ul></li></ul><h3 id="4-反射的一些细节"><a href="#4-反射的一些细节" class="headerlink" title="4. 反射的一些细节"></a>4. 反射的一些细节</h3><h5 id="动态加载"><a href="#动态加载" class="headerlink" title="动态加载"></a>动态加载</h5><ul><li>JVM在执行Java程序的时候，并不是一次性把所有用到的class全部加载到内存，而是第一次需要用到class时才加载。</li><li>动态加载<code>class</code>的特性对于Java程序非常重要。利用此特性，我们才能在运行期根据条件加载不同的实现类。</li></ul><blockquote><p>例如，Commons Logging总是优先使用Log4j，只有当Log4j不存在时，才使用JDK的logging。利用JVM动态加载特性，大致的实现代码如下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; Commons Logging优先使用Log4j:</span><br><span class="line">LogFactory factory &#x3D; null;</span><br><span class="line">if (isClassPresent(&quot;org.apache.logging.log4j.Logger&quot;)) &#123;</span><br><span class="line"> factory &#x3D; createLog4j();</span><br><span class="line">&#125; else &#123;</span><br><span class="line"> factory &#x3D; createJdkLog();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">boolean isClassPresent(String name) &#123;</span><br><span class="line"> try &#123;</span><br><span class="line">     Class.forName(name);</span><br><span class="line">     return true;</span><br><span class="line"> &#125; catch (Exception e) &#123;</span><br><span class="line">     return false;</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>这就是为什么我们只需要把Log4j的jar包放到classpath中，Commons Logging就会自动使用Log4j的原因。</p></blockquote><h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><ul><li>JVM为每个加载的类（或者接口）创建了与之关联的Class实例</li><li>通过<code>Class</code>实例可以获取<code>class</code>全部信息，此过程称为反射（Reflection）。</li><li>JVM是动态加载class的</li></ul><hr><p>注意：本文章参考于廖雪峰，如要学习，请访问<a href="https://www.liaoxuefeng.com/wiki/1252599548343744/1264799402020448">廖雪峰网站</a></p><p>​    </p>]]></content>
      
      
      <categories>
          
          <category> 理论学习 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> 反射 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Idea:java 不支持发行版本5</title>
      <link href="2019/10/03/Idea-java-%E4%B8%8D%E6%94%AF%E6%8C%81%E5%8F%91%E8%A1%8C%E7%89%88%E6%9C%AC5/"/>
      <url>2019/10/03/Idea-java-%E4%B8%8D%E6%94%AF%E6%8C%81%E5%8F%91%E8%A1%8C%E7%89%88%E6%9C%AC5/</url>
      
        <content type="html"><![CDATA[<p>在使用Intellij idea构建Maven工程的时候，运行报错<code>Error : java 不支持发行版本5</code>。本文针对该问题提出了几个解决方法。</p><a id="more"></a><h1 id="Intellij-idea-java-不支持发行版本5"><a href="#Intellij-idea-java-不支持发行版本5" class="headerlink" title="Intellij idea : java 不支持发行版本5"></a>Intellij idea : java 不支持发行版本5</h1><h3 id="1-问题描述"><a href="#1-问题描述" class="headerlink" title="1. 问题描述"></a>1. 问题描述</h3><ul><li>在使用Intellij idea构建Maven工程的时候，运行报错<code>Error : java 不支持发行版本5</code>。</li></ul><h3 id="2-问题原因"><a href="#2-问题原因" class="headerlink" title="2. 问题原因"></a>2. 问题原因</h3><ul><li><del>Idea 中的java的编译器使用了1.5版本来编译，导致无法通过。</del>【不够严谨】</li><li>maven工程默认以JDK1.5作为编译运行的版本，但是1.5版本太低，不被idea支持。</li></ul><h3 id="3-解决办法"><a href="#3-解决办法" class="headerlink" title="3. 解决办法"></a>3. 解决办法</h3><ol><li><strong>方法一</strong></li></ol><ul><li>File—-&gt;ProjectStructure—–&gt;Module</li><li>File—-&gt;ProjectStructure—–&gt;Project </li><li>修改如下设置，使其为1.5以上</li></ul><p><img src="https://gitee.com/tobing/imagebed/raw/master/ideaError1_1.png" class="lazyload" data-srcset="https://gitee.com/tobing/imagebed/raw/master/ideaError1_1.png" srcset="data:image/png;base64,666" alt="ideaError1_1"></p><p><img src="https://gitee.com/tobing/imagebed/raw/master/ideaError1_2.png" class="lazyload" data-srcset="https://gitee.com/tobing/imagebed/raw/master/ideaError1_2.png" srcset="data:image/png;base64,666" alt="ideaError1_2"></p><ul><li>再到File—&gt;Settings—&gt;Build,Ex….—&gt;Java Compiler，将其内容修改问如下。</li></ul><p><img src="https://gitee.com/tobing/imagebed/raw/master/ideaError1_3.png" class="lazyload" data-srcset="https://gitee.com/tobing/imagebed/raw/master/ideaError1_3.png" srcset="data:image/png;base64,666" alt="ideaError1_3"></p><ol start="2"><li><p><strong>方法二</strong>【推荐】</p><p>在maven工程的pom文件中指定编译和运行的jdk版本</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>1.9<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>1.9<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>properties标签与dependencies同一级</p></blockquote></li></ol>]]></content>
      
      
      <categories>
          
          <category> 工具使用 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> Intellij idea </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>GithubPage绑定域名问题</title>
      <link href="2019/10/03/GithubPage%E7%BB%91%E5%AE%9A%E5%9F%9F%E5%90%8D%E9%97%AE%E9%A2%98/"/>
      <url>2019/10/03/GithubPage%E7%BB%91%E5%AE%9A%E5%9F%9F%E5%90%8D%E9%97%AE%E9%A2%98/</url>
      
        <content type="html"><![CDATA[<p>在每次使用<code>hexo d</code>推送文章到<code>githubPage</code>的时候，如果不配置，直接输入绑定的域名将无法访问，本文将介绍如何解决这个问题。</p><a id="more"></a><h3 id="1-问题描述"><a href="#1-问题描述" class="headerlink" title="1. 问题描述"></a>1. 问题描述</h3><ul><li>在每次使用<code>hexo d</code>推送文章到<code>githubPage</code>的时候，如果不配置，直接输入绑定的域名将无法访问。（404Error）</li></ul><h3 id="2-问题原因"><a href="#2-问题原因" class="headerlink" title="2. 问题原因"></a>2. 问题原因</h3><ul><li>在每次<code>hexo d</code> 推送文章的时候。<code>GithubPage</code>仓库的CNAME文件都会被刷掉，导致<code>githubpage</code>认不出指定域名，不允许访问。</li></ul><h3 id="3-解决办法"><a href="#3-解决办法" class="headerlink" title="3. 解决办法"></a>3. 解决办法</h3><ol><li>在本地的source目录中添加<code>CNAME</code>，并且在其中输入你的域名（例如本站域名是<code>tobing.top</code>），不需要添加http协议前缀。（推荐使用该方法，一劳永逸）</li><li>每次推送完毕之后，登录<code>github</code>到<code>githubpage仓库</code>的<code>Settings</code>中修改<code>Github Pages</code>的<code>Custom domain</code>为指定域名（格式同上）。（该方法每次推送都要设置，麻烦）</li></ol><hr><h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><ul><li>在<code>source</code>目录添加<code>CNAME</code>文件，注意无后缀。编辑其内容为你的域名。</li></ul>]]></content>
      
      
      <categories>
          
          <category> 杂七杂八 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Hexo </tag>
            
            <tag> GithubPage </tag>
            
            <tag> 域名绑定 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>git的常用命令</title>
      <link href="2019/10/02/git%E7%9A%84%E5%85%A5%E9%97%A8%E4%BD%BF%E7%94%A8/"/>
      <url>2019/10/02/git%E7%9A%84%E5%85%A5%E9%97%A8%E4%BD%BF%E7%94%A8/</url>
      
        <content type="html"><![CDATA[<p>git在日常开发必不可少，本文介绍了git常用命令。</p><a id="more"></a><h1 id="Git的常用命令"><a href="#Git的常用命令" class="headerlink" title="Git的常用命令"></a>Git的常用命令</h1><h3 id="1-初始化仓库"><a href="#1-初始化仓库" class="headerlink" title="1. 初始化仓库"></a>1. 初始化仓库</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git init <span class="comment"># 初始化仓库</span></span><br></pre></td></tr></table></figure><h3 id="2-添加修改到暂存区"><a href="#2-添加修改到暂存区" class="headerlink" title="2. 添加修改到暂存区"></a>2. 添加修改到暂存区</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git add [文件名] <span class="comment"># 添加指定文件到暂存区</span></span><br><span class="line">$ git add *       <span class="comment"># 添加所有文件到暂存区</span></span><br></pre></td></tr></table></figure><h3 id="3-添加修改到工作区"><a href="#3-添加修改到工作区" class="headerlink" title="3. 添加修改到工作区"></a>3. 添加修改到工作区</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git commit -m <span class="string">&quot;修改了什么&quot;</span>   <span class="comment"># 提交修改并指定修改说明</span></span><br></pre></td></tr></table></figure><h3 id="4-推送修改到远程服务器"><a href="#4-推送修改到远程服务器" class="headerlink" title="4. 推送修改到远程服务器"></a>4. 推送修改到远程服务器</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ git remote add [shortname] [url]</span><br><span class="line">$ git remote add origin git@github.com:[username]/[respName].git <span class="comment"># 添加指定仓库</span></span><br><span class="line">$ git push -u origin master            <span class="comment"># 推送修改</span></span><br></pre></td></tr></table></figure><ul><li><h4 id="可能存在的问题"><a href="#可能存在的问题" class="headerlink" title="可能存在的问题"></a>可能存在的问题</h4></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[UserName]@[UserName] MINGW64 /e/Code/JavaRe (master)</span><br><span class="line">$ git push -u origin master   <span class="comment"># 推送的时候出现了以下错误</span></span><br><span class="line">To github.com:[Username]/[respName].git</span><br><span class="line"> ! [rejected]        master -&gt; master (fetch first)</span><br><span class="line">error: failed to push some refs to <span class="string">&#x27;git@github.com:[Username]/[respName].git&#x27;</span></span><br><span class="line">hint: Updates were rejected because the remote contains work that you <span class="keyword">do</span></span><br><span class="line">hint: not have locally. This is usually caused by another repository pushing</span><br><span class="line">hint: to the same ref. You may want to first integrate the remote changes</span><br><span class="line">hint: (e.g., <span class="string">&#x27;git pull ...&#x27;</span>) before pushing again.</span><br><span class="line">hint: See the <span class="string">&#x27;Note about fast-forwards&#x27;</span> <span class="keyword">in</span> <span class="string">&#x27;git push --help&#x27;</span> <span class="keyword">for</span> details.</span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li><h4 id="问题根源：远程服务器仓库中的文件和本地的不一样。（之前直接在GitHub添加了readme文件）"><a href="#问题根源：远程服务器仓库中的文件和本地的不一样。（之前直接在GitHub添加了readme文件）" class="headerlink" title="问题根源：远程服务器仓库中的文件和本地的不一样。（之前直接在GitHub添加了readme文件）"></a>问题根源：远程服务器仓库中的文件和本地的不一样。（之前直接在GitHub添加了readme文件）</h4></li><li><h4 id="解决："><a href="#解决：" class="headerlink" title="解决："></a>解决：</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git pull --rebase origin<span class="comment"># 使用pull合并文件</span></span><br><span class="line">$ git push -u origin master     <span class="comment"># 合并完毕之后再更新</span></span><br></pre></td></tr></table></figure></li></ul><h3 id="5-克隆"><a href="#5-克隆" class="headerlink" title="5. 克隆"></a>5. 克隆</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">clone</span> [url]</span><br><span class="line">$ git <span class="built_in">clone</span> git@github.com:[username]/[respName].git <span class="comment"># 克隆远程服务器文件到本地中</span></span><br></pre></td></tr></table></figure><hr><h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><ul><li>对应git的命令仍然不够熟练</li><li>对于git的工作流程理解仍不够到位</li><li>对应github的使用欠缺</li><li>写此文件便于记忆</li></ul>]]></content>
      
      
      <categories>
          
          <category> 工具使用 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> git </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Java集合</title>
      <link href="2019/10/02/Java%E9%9B%86%E5%90%88/"/>
      <url>2019/10/02/Java%E9%9B%86%E5%90%88/</url>
      
        <content type="html"><![CDATA[<p>Java集合在Java语言生态的重要地位不可忽视，接下来让我们一探究竟。</p><a id="more"></a><h1 id="Java集合"><a href="#Java集合" class="headerlink" title="Java集合"></a>Java集合</h1><h3 id="1-背景"><a href="#1-背景" class="headerlink" title="1. 背景"></a>1. 背景</h3><ul><li>没有集合之前，Java已经可以存储对象，那就是<code>数组</code> 。数组既可以存基本数据类型，也可以存同一种引用数据类型。对数组查找是高效的，但是数组一旦定义长度就不可变，而且只能存放同一种类型。</li><li>在程序设计的过程中，我们经常用到：队列、链接表、树和散列表等数据结构。没有集合前，如果我们需要用的，必须每次都自己定义非常麻烦，因此Java设计者就将这些数据结构封装起来提供给程序员使用。</li></ul><h3 id="2-Java集合的特点"><a href="#2-Java集合的特点" class="headerlink" title="2. Java集合的特点"></a>2. Java集合的特点</h3><ul><li><code>高性能</code>。对于集合中的类，Java开发人员对其实现是高效的。一般很少人去改动这些已经很成熟其高效的API</li><li><code>抽象性</code>。集合类允许不同类型的集合以相同的方式和高度互操作方式工作；</li><li><code>扩展性</code>。集合类容易扩展和修改，程序员可以很容易地稍加改造就能满足自己的数据结构需求。</li></ul><h3 id="3-集合的好处"><a href="#3-集合的好处" class="headerlink" title="3. 集合的好处"></a>3. 集合的好处</h3><ul><li><code>降低了开发难度</code>。不必要再自己实现数据结构。</li><li><code>提高了运行速度</code>。集合类的内部实现是高效的</li><li><code>高抽象性</code>。借助泛型，只要了解了这些类的使用方法，就可以将它们应用到很多数据类型中。如果知道了<code>LinkedList&lt;String&gt;</code>的使用方法，也会知道<code>LinkedList&lt;Double&gt;</code>怎么用，则无需为每一种数据类型学习不同的API</li><li><code>高重用性</code>。借助泛型，就算对集合类中的元素类型进行了修改，集合类相关的代码也几乎不用修改。</li></ul><h3 id="4-Java集合框架"><a href="#4-Java集合框架" class="headerlink" title="4. Java集合框架"></a>4. Java集合框架</h3><p><img src="https://i.loli.net/2021/01/15/GWQp5yzrKbnvPIa.png" class="lazyload" data-srcset="https://i.loli.net/2021/01/15/GWQp5yzrKbnvPIa.png" srcset="data:image/png;base64,666" alt="Java集合框架图"></p><p><img src="https://i.loli.net/2021/01/15/Kt4gQNTYFHDXmei.png" class="lazyload" data-srcset="https://i.loli.net/2021/01/15/Kt4gQNTYFHDXmei.png" srcset="data:image/png;base64,666" alt="java-coll"></p><ul><li>Java集合框架包含两大类：集合（Collection）和图（Map）。</li><li>Collection存放一个元素集合；Map存放键值对映射</li></ul><p><img src="https://i.loli.net/2021/01/15/1TiP6cxBH9DhJSz.gif" class="lazyload" data-srcset="https://i.loli.net/2021/01/15/1TiP6cxBH9DhJSz.gif" srcset="data:image/png;base64,666" alt="java-coll2"></p><h4 id="1-Collection接口："><a href="#1-Collection接口：" class="headerlink" title="1. Collection接口："></a>1. Collection接口：</h4><ul><li>最基本的集合接口，存储一组不唯一，无序的对象。</li><li>Java不提供直接继承自Collection的类，只提供继承于的子接口(如List和set)。</li></ul><h4 id="2-List接口："><a href="#2-List接口：" class="headerlink" title="2. List接口："></a>2. List接口：</h4><ul><li>有序、可重复Collection，可控制插入位置。</li><li>可以通过下标访问</li></ul><h4 id="3-Set接口"><a href="#3-Set接口" class="headerlink" title="3. Set接口"></a>3. Set接口</h4><ul><li>一组无序、不可重复元素</li></ul><h4 id="4-SortedSet接口"><a href="#4-SortedSet接口" class="headerlink" title="4. SortedSet接口"></a>4. SortedSet接口</h4><ul><li>继承Set，保存有序</li></ul><h4 id="5-Map接口"><a href="#5-Map接口" class="headerlink" title="5. Map接口"></a>5. Map接口</h4><ul><li>存放一组<code>键值对</code>对象，提供key（键）到value（值）的映射。</li></ul><h4 id="6-Map-Entry"><a href="#6-Map-Entry" class="headerlink" title="6. Map.Entry"></a>6. Map.Entry</h4><ul><li>描述在一个Map中的一个元素（键/值对）。是一个Map的内部类。</li></ul><h4 id="7-SortedMap"><a href="#7-SortedMap" class="headerlink" title="7. SortedMap"></a>7. SortedMap</h4><ul><li>继承自Map，使<code>Key</code>保存在升序</li></ul><h4 id="8-Enumeration"><a href="#8-Enumeration" class="headerlink" title="8. Enumeration"></a>8. <del>Enumeration</del></h4><ul><li>可以枚举（一次获得一个）对象集合中的元素。</li><li>被迭代器取代</li></ul><h4 id="注意：Set和List区别"><a href="#注意：Set和List区别" class="headerlink" title="注意：Set和List区别"></a>注意：Set和List区别</h4><table><thead><tr><th>Set</th><th>List</th></tr></thead><tbody><tr><td>无序、不可重复</td><td>有序、可重复</td></tr><tr><td>查找效率低；删除和插入效率高</td><td>查找效率高。插入删除效率低</td></tr><tr><td>插入删除不会引起元素位置改变</td><td>动态增长。插入删除会引起元素位置改变</td></tr><tr><td>HashSet TreeSet</td><td>ArrayList LinkedList Vector</td></tr></tbody></table><h3 id="5-集合使用"><a href="#5-集合使用" class="headerlink" title="5. 集合使用"></a>5. 集合使用</h3><ul><li>ArrayList的遍历</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> top.tobing.collection;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.Iterator;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ArrayList的使用</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Tobing</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo01CollArrayList</span> </span>&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">List&lt;String&gt; list = <span class="keyword">new</span> ArrayList&lt;String&gt;();</span><br><span class="line">list.add(<span class="string">&quot;Hello&quot;</span>);</span><br><span class="line">list.add(<span class="string">&quot;World&quot;</span>);</span><br><span class="line">list.add(<span class="string">&quot;!&quot;</span>);</span><br><span class="line"><span class="comment">// 遍历一：增强for变量</span></span><br><span class="line"><span class="keyword">for</span>(String s:list) &#123;</span><br><span class="line">System.out.print(s+<span class="string">&quot; &quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">System.out.println();</span><br><span class="line"><span class="comment">// 遍历二：转为数组</span></span><br><span class="line">String[] strArr = <span class="keyword">new</span> String[list.size()];</span><br><span class="line">list.toArray(strArr);</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;strArr.length;i++) &#123;</span><br><span class="line">System.out.print(strArr[i]+<span class="string">&quot; &quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">System.out.println();</span><br><span class="line"><span class="comment">// 遍历三：迭代器</span></span><br><span class="line">Iterator&lt;String&gt; it = list.iterator();</span><br><span class="line"><span class="keyword">while</span>(it.hasNext()) &#123;</span><br><span class="line">System.out.print(it.next()+<span class="string">&quot; &quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>结果</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Hello World ! </span><br><span class="line">Hello World ! </span><br><span class="line">Hello World ! </span><br></pre></td></tr></table></figure><ul><li>Map的遍历</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> top.tobing.collection;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Iterator;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 变量Map</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Tobing</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo02CollMap</span> </span>&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">Map&lt;String,String&gt; map = <span class="keyword">new</span> HashMap&lt;String,String&gt;();</span><br><span class="line">map.put(<span class="string">&quot;1&quot;</span>,<span class="string">&quot;One&quot;</span>);</span><br><span class="line">map.put(<span class="string">&quot;2&quot;</span>,<span class="string">&quot;Two&quot;</span>);</span><br><span class="line">map.put(<span class="string">&quot;3&quot;</span>,<span class="string">&quot;Three&quot;</span>);</span><br><span class="line">map.put(<span class="string">&quot;4&quot;</span>,<span class="string">&quot;Four&quot;</span>);</span><br><span class="line"><span class="comment">// 遍历一：二次取值（常用）</span></span><br><span class="line"><span class="keyword">for</span>(String key:map.keySet()) &#123;</span><br><span class="line">System.out.print(key+<span class="string">&quot;:&quot;</span>+map.get(key)+<span class="string">&quot;\t&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">System.out.println();</span><br><span class="line"><span class="comment">// 遍历二：Map.entrySet使用迭代器</span></span><br><span class="line">Iterator&lt;Map.Entry&lt;String, String&gt;&gt; it = map.entrySet().iterator();</span><br><span class="line"><span class="keyword">while</span>(it.hasNext()) &#123;</span><br><span class="line">Map.Entry&lt;String, String&gt; entry = it.next();</span><br><span class="line">System.out.print(entry.getKey()+<span class="string">&quot;:&quot;</span>+entry.getValue()+<span class="string">&quot;\t&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">System.out.println();</span><br><span class="line"><span class="comment">// 遍历三：推荐，容量大的时候</span></span><br><span class="line"><span class="keyword">for</span>(Map.Entry&lt;String, String&gt; entry:map.entrySet()) &#123;</span><br><span class="line">System.out.print(entry.getKey()+<span class="string">&quot;:&quot;</span>+entry.getValue()+<span class="string">&quot;\t&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>结果</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1:One2:Two3:Three4:Four</span><br><span class="line">1:One2:Two3:Three4:Four</span><br><span class="line">1:One2:Two3:Three4:Four</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 理论学习 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> 集合 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>魅蓝Note5获取完整Root权限</title>
      <link href="2019/10/02/%E9%AD%85%E8%93%9DNote5%E8%8E%B7%E5%8F%96%E5%AE%8C%E6%95%B4Root%E6%9D%83%E9%99%90/"/>
      <url>2019/10/02/%E9%AD%85%E8%93%9DNote5%E8%8E%B7%E5%8F%96%E5%AE%8C%E6%95%B4Root%E6%9D%83%E9%99%90/</url>
      
        <content type="html"><![CDATA[<p>介绍如何获取魅蓝note5的root权限</p><a id="more"></a><h1 id="魅蓝note5获取完整root"><a href="#魅蓝note5获取完整root" class="headerlink" title="魅蓝note5获取完整root"></a>魅蓝note5获取完整root</h1><ol><li>确认手机的系统版本是否为<a href="https://www.flyme.cn/firmwarelist-99.html#3">6.7.7.1 beta</a>,如果不是则点击页面中链接下载。</li><li>备份数据，开始刷机</li><li>进入系统之后，联网登录账户，只有登录账户才可以打开root权限，其他东西先别动。</li><li>重启之后，安装<a href="https://pan.baidu.com/s/1iEzyP9avnDv7PhhlAOU5rA">supersu</a>，点击更新二进制文件，重启。 <br><br><strong>注意:版本一定要是这个本页面链接下的版本。</strong><br><strong>而且在软件获取root权限的时候，supersu是无法操作的，解决办法是直接进入supersu授权</strong></li><li>获取root权限可以干什么<ul><li>装框架</li><li>装<code>linux</code></li><li><code>linux</code>+内网穿透 = 服务器</li></ul></li></ol>]]></content>
      
      
      <categories>
          
          <category> 杂七杂八 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> root </tag>
            
            <tag> 魅蓝Note5 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CentOS的初步使用</title>
      <link href="2019/10/02/CentOS%E7%9A%84%E5%88%9D%E6%AD%A5%E4%BD%BF%E7%94%A8/"/>
      <url>2019/10/02/CentOS%E7%9A%84%E5%88%9D%E6%AD%A5%E4%BD%BF%E7%94%A8/</url>
      
        <content type="html"><![CDATA[<p>Linux最初是由芬兰赫尔辛基大学学生Linus Torvalds由于自己不满意教学中使用的MINIX操作系统， 所以在1990年底由于个人爱好设计出了LINUX系统核心。后来发布于芬兰最大的ftp服务器上，用户可以免费下载，所以它的周边的程序越来越多，Linux本身也逐渐发展壮大起来，之后Linux在不到三年的时间里成为了一个功能完善，稳定可靠的操作系统.</p><a id="more"></a><h1 id="CentOS学习"><a href="#CentOS学习" class="headerlink" title="CentOS学习"></a>CentOS学习</h1><hr><h3 id="1-背景历史"><a href="#1-背景历史" class="headerlink" title="1. 背景历史"></a>1. 背景历史</h3><p>​    Linux最初是由芬兰赫尔辛基大学学生Linus Torvalds由于自己不满意教学中使用的MINIX操作系统， 所以在1990年底由于个人爱好设计出了LINUX系统核心。后来发布于芬兰最大的ftp服务器上，用户可以免费下载，所以它的周边的程序越来越多，Linux本身也逐渐发展壮大起来，之后Linux在不到三年的时间里成为了一个功能完善，稳定可靠的操作系统.</p><h3 id="2-应用"><a href="#2-应用" class="headerlink" title="2. 应用"></a>2. 应用</h3><ul><li>服务器系统Web应用服务器、数据库服务器、接口服务器、DNS、FTP等等； </li><li>嵌入式系统路由器、防火墙、手机、PDA、IP 分享器、交换器、家电用品的微电脑控制器等等，</li><li>高性能运算、计算密集型应用Linux有强大的运算能力。</li><li>桌面应用系统</li><li>移动手持系统</li></ul><h3 id="3-版本"><a href="#3-版本" class="headerlink" title="3. 版本"></a>3. 版本</h3><ul><li>内核版本：Linus领导下的内核小组开发维护的系统内核的版本号</li><li>发行版本：</li></ul><h3 id="4-目录结构"><a href="#4-目录结构" class="headerlink" title="4.目录结构"></a>4.目录结构</h3><ul><li><p>/ ：根目录</p><table><thead><tr><th align="center">目录名称</th><th align="center">全名</th><th align="center">描述</th></tr></thead><tbody><tr><td align="center">bin</td><td align="center">binaries</td><td align="center">二进制可执行文件</td></tr><tr><td align="center">boot</td><td align="center"></td><td align="center">系统引导时使用的各种文件</td></tr><tr><td align="center">dev</td><td align="center">devices</td><td align="center">设备文件</td></tr><tr><td align="center">etc</td><td align="center">ectetera</td><td align="center">系统配置文件</td></tr><tr><td align="center">home</td><td align="center"></td><td align="center">用户文件根目录</td></tr><tr><td align="center">lib</td><td align="center">library</td><td align="center">跟文件系统中的程序运行需要的共享库以及内核模块</td></tr><tr><td align="center">sbin</td><td align="center">super user binaries</td><td align="center">root才能访问的二进制可执行文件</td></tr><tr><td align="center">usr</td><td align="center">Unix shared resources</td><td align="center">存放共享的系统资源</td></tr><tr><td align="center">var</td><td align="center">variable</td><td align="center">用于存放运行时需要改变数据的文件</td></tr></tbody></table><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">lrwxrwxrwx.  1 root root     7 Aug 18  2017 bin -&gt; usr/bin             <span class="comment"># bin目录</span></span><br><span class="line">dr-xr-xr-x.  4 root root  4096 Sep 12  2017 boot                       <span class="comment"># boot目录</span></span><br><span class="line">drwxr-xr-x  19 root root  2960 Sep 27 22:01 dev                        <span class="comment"># dev目录</span></span><br><span class="line">drwxr-xr-x. 82 root root  4096 Sep 28 06:01 etc                        <span class="comment"># etc目录</span></span><br><span class="line">drwxr-xr-x.  3 root root  4096 Sep 27 16:12 home                       <span class="comment"># home目录</span></span><br><span class="line">lrwxrwxrwx.  1 root root     7 Aug 18  2017 lib -&gt; usr/lib             <span class="comment"># lib目录</span></span><br><span class="line">lrwxrwxrwx.  1 root root     9 Aug 18  2017 lib64 -&gt; usr/lib64         <span class="comment"># lib64</span></span><br><span class="line">drwx------.  2 root root 16384 Aug 18  2017 lost+found           </span><br><span class="line">drwxr-xr-x.  2 root root  4096 Nov  5  2016 media </span><br><span class="line">drwxr-xr-x.  2 root root  4096 Nov  5  2016 mnt</span><br><span class="line">drwxr-xr-x.  2 root root  4096 Nov  5  2016 opt</span><br><span class="line">dr-xr-xr-x  74 root root     0 Sep 27 22:01 proc</span><br><span class="line">dr-xr-x---.  6 root root  4096 Sep  5  2017 root</span><br><span class="line">drwxr-xr-x  21 root root   580 Sep 27 22:01 run</span><br><span class="line">lrwxrwxrwx.  1 root root     8 Aug 18  2017 sbin -&gt; usr/sbin           <span class="comment"># root的bin目录</span></span><br><span class="line">drwxr-xr-x.  2 root root  4096 Nov  5  2016 srv </span><br><span class="line">dr-xr-xr-x  13 root root     0 Sep 28 06:01 sys</span><br><span class="line">drwxrwxrwt. 11 root root  4096 Sep 29 03:40 tmp                        <span class="comment"># 临时文件</span></span><br><span class="line">drwxr-xr-x. 13 root root  4096 Aug 18  2017 usr                        <span class="comment"># 存放共享的系统资源</span></span><br><span class="line">drwxr-xr-x. 19 root root  4096 Sep 28 06:01 var               <span class="comment"># 用于存放运行时需要改变数据的文件</span></span><br></pre></td></tr></table></figure></li></ul><h3 id="4-常用命令"><a href="#4-常用命令" class="headerlink" title="4. 常用命令"></a>4. 常用命令</h3><ol><li><p>切换命令：cd</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> .. <span class="comment"># 切换到上一层目录</span></span><br><span class="line"><span class="built_in">cd</span> ~  <span class="comment"># 切换到系统根目录</span></span><br></pre></td></tr></table></figure></li><li><p>列出文件列表:ls</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ls       <span class="comment"># 列出文件</span></span><br><span class="line">ls -a    <span class="comment"># 显示所有文件和目录（包含隐藏）</span></span><br><span class="line">ls -l    <span class="comment"># 缩写成ll</span></span><br></pre></td></tr></table></figure></li></ol><ol start="3"><li><p>创建目录（mkdir）和移除目录（rmdir）</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mkdir [dirname] <span class="comment"># 创建文件夹</span></span><br><span class="line">rmdir [dirname] <span class="comment"># 移除文件夹</span></span><br><span class="line">rmdir -p dir1/dir2 <span class="comment"># 移除两级文件夹</span></span><br></pre></td></tr></table></figure></li></ol><ol start="4"><li><p>浏览文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">cat  <span class="comment"># 用于显示文件的内容</span></span><br><span class="line">more <span class="comment"># 用于显示的内容超过一个画面长度的情况下使用。空格键显示下一个界面。回车显示下一行内容。</span></span><br><span class="line">less <span class="comment"># 和more类似，不同的是less可以通过PgUp、PgDn控制</span></span><br><span class="line"></span><br><span class="line">tail <span class="comment"># 显示文件后几行的内容</span></span><br><span class="line">tail -10 /etc/passwd  <span class="comment"># 查看后10行数据</span></span><br><span class="line">tail -f catalina.log  <span class="comment"># 动态查看日志</span></span><br><span class="line"></span><br><span class="line">ctrl + c <span class="comment"># 结束查看</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></li></ol><ol start="5"><li><p>文件操作</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">rm                  <span class="comment"># 删除文件</span></span><br><span class="line">rm a.txt            <span class="comment"># 删除a.txt 文件</span></span><br><span class="line">rm -f a.txt         <span class="comment"># 不询问直接删除</span></span><br><span class="line">rm -f a   <span class="comment"># 不询问，递归删除文件【慎用】</span></span><br><span class="line">rm -rf a            <span class="comment"># 不询问，递归删除文件夹</span></span><br><span class="line">rm -rf *            <span class="comment"># 删除所有文件</span></span><br><span class="line">rm -rf /*           <span class="comment"># 自杀</span></span><br><span class="line"></span><br><span class="line">cp a.txt b.txt      <span class="comment"># 将a.txt复制为b.txt文件</span></span><br><span class="line">cp a.txt ../        <span class="comment"># 将文件复制到上一级目录</span></span><br><span class="line"></span><br><span class="line">mv a.txt ../        <span class="comment"># 将a.txt文件移动到上一层目录中</span></span><br><span class="line">mv a.txt b.txt      <span class="comment"># 将a.txt重命名为b.txt</span></span><br><span class="line"></span><br><span class="line">tar <span class="comment"># 打包或解压</span></span><br><span class="line">tar -cvf xxx.tar ./*     <span class="comment"># 打包</span></span><br><span class="line">tar -zcvf xxx.tar.gz ./* <span class="comment"># 打包并且压缩</span></span><br><span class="line">tar -xvf xxx.tar         <span class="comment"># 解压</span></span><br><span class="line">tar -zxvf xxx.tar.gz -C /user/aaa <span class="comment"># 解压到指定目录</span></span><br><span class="line"></span><br><span class="line">find <span class="comment"># 查找符合条件的文件</span></span><br><span class="line">find / -name <span class="string">&quot;ins*&quot;</span>     <span class="comment"># 查找文件名称是以ins开头的文件</span></span><br><span class="line">find / -name <span class="string">&quot;ins*&quot;</span> -ls</span><br><span class="line">find / -user tobing -ls <span class="comment"># 查找用户itcast的目录</span></span><br><span class="line">find / -user tobing -<span class="built_in">type</span> d -ls <span class="comment"># 查找用户tobing的目录</span></span><br><span class="line">find / -prem -777 -<span class="built_in">type</span> d -ls   <span class="comment"># 查找权限为777的文件</span></span><br><span class="line"></span><br><span class="line">grep <span class="comment"># 查找文件【内】符合条件的字符串</span></span><br><span class="line">grep java anacoda-ks.cfg    <span class="comment"># 在文件中找java</span></span><br><span class="line">grep java anacoda-ks.cfg -color   <span class="comment"># 高亮显示</span></span><br></pre></td></tr></table></figure></li></ol><ol start="6"><li><p>其他常用命令</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">pwd</span>     <span class="comment"># 查看当前所在目录</span></span><br><span class="line">touch   <span class="comment"># 创建一个空文件</span></span><br><span class="line">clear   <span class="comment"># 清屏 ==&gt; crtl + L</span></span><br></pre></td></tr></table></figure></li></ol><h3 id="5-vi和vim"><a href="#5-vi和vim" class="headerlink" title="5.vi和vim"></a>5.vi和vim</h3><ol><li><p>三种模式</p><ul><li>命令模式：用户<code>刚刚启动 vi/vim</code>，便<code>进入了命令模式</code>。此时输入的字符会被当做命令执行</li><li>输入模式：和普通的windows平台的记事本一样编辑，按<code>Esc</code>可以退出该模式</li><li>底行模式（底线命令行模式）：<ul><li>q ：退出程序</li><li>w ：保存文件</li></ul></li><li>按ESC键可随时退出底线命令模式。</li></ul></li><li><p>变换</p><ul><li><p>切换到命令行：Esc</p></li><li><p>切换到插入模式：i、o、a键</p><table><thead><tr><th>字母</th><th>功能</th></tr></thead><tbody><tr><td>i(小写)</td><td>当前位置前插入</td></tr><tr><td>I(大写)</td><td>当前行首插入</td></tr><tr><td>a</td><td>当前位置插入</td></tr><tr><td>A</td><td>当前行尾插入</td></tr><tr><td>o</td><td>当前行之后插入一行</td></tr><tr><td>O</td><td>当前行之前插入一行</td></tr></tbody></table></li></ul><h4 id="vi的日常使用"><a href="#vi的日常使用" class="headerlink" title="vi的日常使用"></a>vi的日常使用</h4><ol><li>在命令行输入：<code>vi [要编辑文件名]</code>     进入命令模式</li><li>输入<code>i </code>进入插入模式，在此状态下可以像普通编辑器一样编辑</li><li>修改完毕之后，按<code>Esc</code>键,  退出输入模式，进入底行模式。</li><li>输入<code>:wq</code>保存退出</li></ol></li></ol><h3 id="6-重定向-gt-gt-和-gt"><a href="#6-重定向-gt-gt-和-gt" class="headerlink" title="6. 重定向 &gt;&gt; 和 &gt;"></a>6. 重定向 &gt;&gt; 和 &gt;</h3>   <figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">root</span> ~]<span class="comment"># echo Hello Linux &gt; a.txt   # 将echo输出的内容通到a.txt文件中</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">root</span> ~]<span class="comment"># cat a.txt  # 查看a.txt的内容</span></span><br><span class="line">Hello Linux</span><br><span class="line">[<span class="type">root</span>@<span class="type">root</span> ~]<span class="comment"># echo Hello Centos &gt; a.txt  # &gt; ： 输入的内容会覆盖之前存在的内容</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">root</span> ~]<span class="comment"># cat a.txt                  # 查看内容</span></span><br><span class="line">Hello Centos</span><br><span class="line">[<span class="type">root</span>@<span class="type">root</span> ~]<span class="comment"># ifconfig &gt;&gt; a.txt  # &gt;&gt; ： 追加模式</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">root</span> ~]<span class="comment"># cat a.txt                  # 查看内容</span></span><br><span class="line">Hello Centos</span><br><span class="line">eth1      Link encap:Ethernet  HWaddr <span class="number">00</span>:<span class="number">0</span>C:<span class="number">29</span>:D3:<span class="number">06</span>:<span class="number">82</span>  </span><br><span class="line">         </span><br><span class="line">          ....</span><br><span class="line"></span><br><span class="line">lo        Link encap:Local Loopback  </span><br><span class="line">          ....</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="7-进程管理：ps-和-kill"><a href="#7-进程管理：ps-和-kill" class="headerlink" title="7. 进程管理：ps 和 kill"></a>7. 进程管理：ps 和 kill</h3><ul><li><p>ps：查看进程</p></li><li><p>kill：杀死进程</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">root</span> /]<span class="comment"># ps -ef           # 查看所有的进程</span></span><br><span class="line">UID        PID  PPID  C STIME TTY          TIME CMD</span><br><span class="line">root         <span class="number">1</span>     <span class="number">0</span>  <span class="number">0</span> <span class="number">05</span>:<span class="number">53</span> ?        <span class="number">00</span>:<span class="number">00</span>:<span class="number">01</span> /sbin/init</span><br><span class="line">root         <span class="number">2</span>     <span class="number">0</span>  <span class="number">0</span> <span class="number">05</span>:<span class="number">53</span> ?        <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> [<span class="type">kthreadd</span>]</span><br><span class="line">root         <span class="number">3</span>     <span class="number">2</span>  <span class="number">0</span> <span class="number">05</span>:<span class="number">53</span> ?        <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> [<span class="type">migration</span>/<span class="number">0</span>]</span><br><span class="line">....</span><br><span class="line">[<span class="type">root</span>@<span class="type">root</span> /]<span class="comment"># kill -9 2868     # -9 :强制杀死指定PID进程</span></span><br></pre></td></tr></table></figure></li></ul><h3 id="8-管道"><a href="#8-管道" class="headerlink" title="8. 管道 |"></a>8. 管道 |</h3><ul><li><p>将一个命令的输出用作另一个命令的输入</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">root</span> /]<span class="comment"># ls -alh | more           # 将ls输出的内容用more的模式来展示</span></span><br><span class="line">total <span class="number">106</span>K</span><br><span class="line">dr<span class="literal">-xr</span><span class="literal">-xr</span><span class="literal">-x</span>.  <span class="number">24</span> root root <span class="number">4.0</span>K Oct  <span class="number">3</span> <span class="number">05</span>:<span class="number">53</span> .</span><br><span class="line">dr<span class="literal">-xr</span><span class="literal">-xr</span><span class="literal">-x</span>.  <span class="number">24</span> root root <span class="number">4.0</span>K Oct  <span class="number">3</span> <span class="number">05</span>:<span class="number">53</span> ..</span><br><span class="line"><span class="literal">-rw</span><span class="literal">-r</span>-<span class="literal">-r</span>--.   <span class="number">1</span> root root    <span class="number">0</span> Oct  <span class="number">3</span> <span class="number">05</span>:<span class="number">53</span> .autofsck</span><br><span class="line"> ......</span><br><span class="line"> [<span class="type">root</span>@<span class="type">root</span> /]<span class="comment"># ps -ef | grep bash      # 将ps输出的内容放到grep中搜索</span></span><br><span class="line">root      <span class="number">3665</span>  <span class="number">3663</span>  <span class="number">0</span> <span class="number">05</span>:<span class="number">58</span> pts/<span class="number">0</span>    <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> /bin/bash</span><br><span class="line">root      <span class="number">3729</span>  <span class="number">3724</span>  <span class="number">0</span> <span class="number">06</span>:<span class="number">01</span> pts/<span class="number">1</span>    <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> <span class="literal">-bash</span></span><br><span class="line">root      <span class="number">3842</span>  <span class="number">3729</span>  <span class="number">0</span> <span class="number">06</span>:<span class="number">16</span> pts/<span class="number">1</span>    <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> grep bash</span><br></pre></td></tr></table></figure><h3 id="9-Linux权限"><a href="#9-Linux权限" class="headerlink" title="9. Linux权限"></a>9. Linux权限</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">drwxr<span class="literal">-xr</span><span class="literal">-x</span>.   <span class="number">2</span> root root <span class="number">4.0</span>K Oct <span class="number">30</span>  <span class="number">2018</span> profile.d</span><br><span class="line"><span class="literal">-rw</span><span class="literal">-r</span>-<span class="literal">-r</span>--.   <span class="number">1</span> root root <span class="number">6.4</span>K Jan <span class="number">12</span>  <span class="number">2010</span> protocols</span><br><span class="line">lrwxrwxrwx.   <span class="number">1</span> root root    <span class="number">7</span> Oct <span class="number">30</span>  <span class="number">2018</span> rc -&gt; rc.d/rc</span><br><span class="line"><span class="comment"># xuuugggooo.</span></span><br><span class="line"><span class="comment"># 将a.txt的权限修改为用户可读可写可执行，组可读可执行，其他可执行</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">root</span> <span class="type">etc</span>]<span class="comment"># chmod u=rwx,g=rx,o=rx a.txt  </span></span><br><span class="line"><span class="comment"># 将b.txt的权限修饰为 u=rxw，g=rx,o=x</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">root</span> <span class="type">etc</span>]<span class="comment"># chmod 755 b.txt </span></span><br></pre></td></tr></table></figure></li><li><p>x：文件类型</p><ul><li>d：文件</li><li>-：文件夹</li><li>l：超链接</li></ul></li><li><p>u：用户权限</p></li><li><p>g：组权限</p></li><li><p>o：其他用户权限</p><ul><li>r：读权限               —- 4</li><li>w：写权限             —- 2</li><li>x：可执行权限      —- 1</li></ul><h3 id="10-网络相关"><a href="#10-网络相关" class="headerlink" title="10. 网络相关"></a>10. 网络相关</h3><h4 id="1-主机名配置"><a href="#1-主机名配置" class="headerlink" title="1. 主机名配置"></a>1. 主机名配置</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">root</span> /]<span class="comment"># hostname# 查看主机名</span></span><br><span class="line">tobing</span><br><span class="line">[<span class="type">root</span>@<span class="type">root</span> /]<span class="comment"># hostname admin    # 修改主机名为admin（临时修改）</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">root</span> /]<span class="comment"># hostname</span></span><br><span class="line">admin</span><br><span class="line">[<span class="type">root</span>@<span class="type">root</span> /]<span class="comment"># vi /etc/sysconfig/network    # 持久化修改主机名</span></span><br></pre></td></tr></table></figure></li></ul><h4 id="2-IP地址配置"><a href="#2-IP地址配置" class="headerlink" title="2.IP地址配置"></a>2.IP地址配置</h4>   <figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">root</span> /]<span class="comment"># ifconfig                     # 查看当前ip配置</span></span><br><span class="line">eth0: flags=<span class="number">4163</span>&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu <span class="number">1500</span></span><br><span class="line">        inet `[ip地址]`  netmask <span class="number">255.255</span>.<span class="number">192.0</span>  broadcast </span><br><span class="line">        ....</span><br><span class="line">lo: flags=<span class="number">73</span>&lt;UP,LOOPBACK,RUNNING&gt;  mtu <span class="number">65536</span></span><br><span class="line">        ....</span><br><span class="line">[<span class="type">root</span>@<span class="type">root</span> /]<span class="comment"># ifconfig eth0 192.168.1.133   # 修改IP地址</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">root</span> /]<span class="comment"># vi/etc/sysconfig/network-scripts/ifcfg-eth0   # 持久化修改ip相关配置</span></span><br><span class="line">DEVICE=eth0 <span class="comment">#网卡名称</span></span><br><span class="line">BOOTPROTO=<span class="keyword">static</span> <span class="comment">#获取ip的方式(static/dhcp/bootp/none)</span></span><br><span class="line">HWADDR=<span class="number">00</span>:<span class="number">0</span>C:<span class="number">29</span>:B5:B2:<span class="number">69</span> <span class="comment">#MAC地址</span></span><br><span class="line">IPADDR=<span class="number">12.168</span>.<span class="number">177.129</span>    <span class="comment">#IP地址</span></span><br><span class="line">NETMASK=<span class="number">255.255</span>.<span class="number">255.0</span>    <span class="comment">#子网掩码</span></span><br><span class="line">NETWORK=<span class="number">192.168</span>.<span class="number">177.0</span>    <span class="comment">#网络地址</span></span><br><span class="line">BROADCAST=<span class="number">192.168</span>.<span class="number">0.255</span>  <span class="comment">#广播地址</span></span><br><span class="line">NBOOT=yes  <span class="comment">#系统启动时是否设置此网络接口，设置为yes时，系统启动时激活此设备。</span></span><br></pre></td></tr></table></figure><h4 id="3-域名映射"><a href="#3-域名映射" class="headerlink" title="3. 域名映射"></a>3. 域名映射</h4>   <figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">root</span> /]<span class="comment"># vi /etc/hosts</span></span><br><span class="line"><span class="number">192.168</span>.<span class="number">1.123</span> tobing</span><br><span class="line">ping tobing == &gt; ping <span class="number">192.168</span>.<span class="number">1.123</span></span><br></pre></td></tr></table></figure><h4 id="4-网络服务管理"><a href="#4-网络服务管理" class="headerlink" title="4. 网络服务管理"></a>4. 网络服务管理</h4>   <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">service network status <span class="comment"># 查看指定服务的状态</span></span><br><span class="line">service network stop   <span class="comment"># 停止指定服务</span></span><br><span class="line">service network start  <span class="comment"># 启动指定服务</span></span><br><span class="line">service network restart<span class="comment"># 重启指定服务</span></span><br><span class="line"></span><br><span class="line">service --status–all   <span class="comment"># 查看系统中所有后台服务</span></span><br><span class="line">netstat –nltp          <span class="comment"># 查看系统中网络进程的端口监听情况</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 防火墙设置</span></span><br><span class="line"><span class="comment"># 防火墙根据配置文件/etc/sysconfig/iptables来控制本机的”出”、”入”网络访问行为。</span></span><br><span class="line">service iptables status <span class="comment"># 查看防火墙状态</span></span><br><span class="line">service iptables stop   <span class="comment"># 关闭防火墙</span></span><br><span class="line">service iptables start  <span class="comment"># 启动防火墙</span></span><br><span class="line">chkconfig  iptables off <span class="comment"># 禁止防火墙自启</span></span><br></pre></td></tr></table></figure><hr><h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><ul><li>对CentOS仍处于入门级别的使用</li><li>很多问题仍然需要百度</li><li>写此文章是为了记忆常用命令</li></ul>]]></content>
      
      
      <categories>
          
          <category> 理论学习 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> CentOS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Java常用数据结构</title>
      <link href="2019/10/02/Java%E5%B8%B8%E7%94%A8%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"/>
      <url>2019/10/02/Java%E5%B8%B8%E7%94%A8%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/</url>
      
        <content type="html"><![CDATA[<p>有人说：程序=算法+数据结构，接下来就让我们看一下Java中常用的数据结构吧。</p><a id="more"></a><h1 id="Java数据结构"><a href="#Java数据结构" class="headerlink" title="Java数据结构"></a>Java数据结构</h1><h3 id="1-枚举（Enumeration）"><a href="#1-枚举（Enumeration）" class="headerlink" title="1. 枚举（Enumeration）"></a>1. 枚举（Enumeration）</h3><ul><li>接口，本身不属于数据结构,但它在其他数据结构的范畴里应用很广。枚举（The Enumeration）接口定义了一种从数据结构中取回连续元素的方式。</li><li>注：此接口的功能与 Iterator 接口的功能是重复的。此外，Iterator 接口添加了一个可选的移除操作，并使用较短的方法名。新的实现应该优先考虑使用<br>Iterator 接口而不是 Enumeration 接口。</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">boolean</span> <span class="title">hasMoreElements</span><span class="params">()</span> <span class="comment">//测试此枚举是否包含更多的元素。 </span></span></span><br><span class="line"><span class="function">E <span class="title">nextElement</span><span class="params">()</span> <span class="comment">//如果此枚举对象至少还有一个可提供的元素，则返回此枚举的下一个元素。</span></span></span><br><span class="line"><span class="function">    </span></span><br><span class="line"><span class="function"><span class="keyword">package</span> top.tobing.datastruct</span>;</span><br><span class="line"><span class="keyword">import</span> java.util.Enumeration;</span><br><span class="line"><span class="keyword">import</span> java.util.Vector;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 枚举接口</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Tobing</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo02DSEnum</span> </span>&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">Vector&lt;String&gt; dayNums = <span class="keyword">new</span> Vector&lt;String&gt;();</span><br><span class="line">dayNums.add(<span class="string">&quot;Sunday&quot;</span>);</span><br><span class="line">dayNums.add(<span class="string">&quot;Monday&quot;</span>);</span><br><span class="line">dayNums.add(<span class="string">&quot;Tuesday&quot;</span>);</span><br><span class="line">dayNums.add(<span class="string">&quot;Wednesday&quot;</span>);</span><br><span class="line">dayNums.add(<span class="string">&quot;Thurday&quot;</span>);</span><br><span class="line">dayNums.add(<span class="string">&quot;Firday&quot;</span>);</span><br><span class="line">dayNums.add(<span class="string">&quot;Saturday&quot;</span>);</span><br><span class="line"><span class="comment">// 将向量dayNums中的元素放到days中，以方便变量（类似于Iterator接口）</span></span><br><span class="line">Enumeration&lt;String&gt; days;</span><br><span class="line">days = dayNums.elements();</span><br><span class="line"><span class="keyword">while</span>(days.hasMoreElements()) &#123;</span><br><span class="line">System.out.println(days.nextElement());</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="2-位集合（BitSet）-少用"><a href="#2-位集合（BitSet）-少用" class="headerlink" title="2. 位集合（BitSet） 少用"></a>2. 位集合（BitSet） 少用</h3><ul><li><p>位集合类实现了一组可以单独设置和清除的位或标志。</p><p>该类在处理一组布尔值的时候非常有用，你只需要给每个值赋值一”位”，然后对位进行适当的设置或清除，就可以对布尔值进行操作了。</p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> top.tobing.datastruct;</span><br><span class="line"><span class="keyword">import</span> java.util.BitSet;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * BitSet测速（源码摘自菜鸟教程）</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Tobing</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo03DSBitSet</span> </span>&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">BitSet bits1 = <span class="keyword">new</span> BitSet(<span class="number">16</span>);</span><br><span class="line">BitSet bits2 = <span class="keyword">new</span> BitSet(<span class="number">16</span>);</span><br><span class="line"><span class="comment">// 存储元素</span></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;<span class="number">16</span>; i++) &#123;</span><br><span class="line">   <span class="keyword">if</span>((i%<span class="number">2</span>) == <span class="number">0</span>) bits1.set(i);<span class="comment">// 存放偶数</span></span><br><span class="line">   <span class="keyword">if</span>((i%<span class="number">5</span>) != <span class="number">0</span>) bits2.set(i);<span class="comment">// 存放非5倍数</span></span><br><span class="line">&#125;</span><br><span class="line">System.out.println(<span class="string">&quot;bit1的内容是：&quot;</span>);</span><br><span class="line">System.out.println(bits1);</span><br><span class="line">System.out.println(<span class="string">&quot;bit2的内容是：&quot;</span>);</span><br><span class="line">System.out.println(bits2);</span><br><span class="line"><span class="comment">// AND bits</span></span><br><span class="line">bits2.and(bits1);</span><br><span class="line">System.out.println(<span class="string">&quot;\nbits2 AND bits1: &quot;</span>);</span><br><span class="line">System.out.println(bits2);</span><br><span class="line"><span class="comment">// OR bits</span></span><br><span class="line">bits2.or(bits1);</span><br><span class="line">System.out.println(<span class="string">&quot;\nbits2 OR bits1: &quot;</span>);</span><br><span class="line">System.out.println(bits2);</span><br><span class="line"><span class="comment">// XOR bits</span></span><br><span class="line">bits2.xor(bits1);</span><br><span class="line">System.out.println(<span class="string">&quot;\nbits2 XOR bits1: &quot;</span>);</span><br><span class="line">System.out.println(bits2);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="3-向量（Vector）"><a href="#3-向量（Vector）" class="headerlink" title="3. 向量（Vector）"></a>3. 向量（Vector）</h3><ul><li><p>向量（Vector）类和传统数组非常相似，但是Vector的大小能根据需要动态的变化。</p></li><li><pre><code class="java">java.lang.Object    // 继承关系- java.util.AbstractCollection&lt;E&gt;- - java.util.AbstractList&lt;E&gt;- - - java.util.Vector&lt;E&gt;<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&#96;&#96;&#96;java</span><br><span class="line">&#x2F;&#x2F; 字段列表</span><br><span class="line">protected  int capacityIncrement &#x2F;&#x2F;向量的大小大于其容量时，容量自动增加的量。 </span><br><span class="line">protected  int elementCount&#x2F;&#x2F;Vector 对象中的有效组件数。 </span><br><span class="line">protected  Object[] elementData &#x2F;&#x2F;存储向量组件的数组缓冲区。</span><br><span class="line">&#x2F;&#x2F; 使用演示</span><br><span class="line">package top.tobing.datastruct;</span><br><span class="line">import java.util.Enumeration;</span><br><span class="line">import java.util.Vector;</span><br><span class="line">&#x2F;**</span><br><span class="line"> * Vector</span><br><span class="line"> * @author Tobing</span><br><span class="line"> *&#x2F;</span><br><span class="line">public class Demo04DSVector &#123;</span><br><span class="line">public static void main(String[] args) &#123;</span><br><span class="line">&#x2F;&#x2F; 初始容量为3，增长长度为2</span><br><span class="line">Vector v &#x3D; new Vector(3,2);</span><br><span class="line">v.addElement(&quot;Hello&quot;);</span><br><span class="line">v.addElement(&quot; , &quot;);</span><br><span class="line">System.out.println(&quot;Size:&quot;+v.size());</span><br><span class="line">v.addElement(&quot;World！&quot;);</span><br><span class="line">v.addElement(&quot;!&quot;);</span><br><span class="line">System.out.println(&quot;Size:&quot;+v.size());&#x2F;&#x2F; 大小</span><br><span class="line">System.out.println(&quot;Cap:&quot;+v.capacity());&#x2F;&#x2F; 容量</span><br><span class="line">&#x2F;&#x2F; 遍历</span><br><span class="line">Enumeration enum1 &#x3D; v.elements();</span><br><span class="line">while(enum1.hasMoreElements()) &#123;</span><br><span class="line">System.out.print(enum1.nextElement());</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></code></pre></li></ul><h3 id="4-栈（Stack）"><a href="#4-栈（Stack）" class="headerlink" title="4. 栈（Stack）"></a>4. 栈（Stack）</h3><ul><li>栈（Stack）实现了一个后进先出（LIFO）的数据结构。</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 使用演示</span></span><br><span class="line"><span class="keyword">package</span> top.tobing.datastruct;</span><br><span class="line"><span class="keyword">import</span> java.util.Stack;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Stack是Vector的一个子类</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Tobing</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo04DSVector</span> </span>&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">Stack&lt;Integer&gt; st = <span class="keyword">new</span> Stack&lt;Integer&gt;();</span><br><span class="line"><span class="comment">// 压栈：把元素压入堆栈顶部</span></span><br><span class="line">st.push(<span class="number">100</span>);</span><br><span class="line">st.push(<span class="number">200</span>);</span><br><span class="line">st.push(<span class="number">300</span>);</span><br><span class="line">st.push(<span class="number">400</span>);</span><br><span class="line">System.out.println(<span class="string">&quot;Stack:&quot;</span>+st);</span><br><span class="line"><span class="comment">// 出栈：移除栈顶元素，并且返回</span></span><br><span class="line"><span class="keyword">int</span> n = st.pop();</span><br><span class="line">System.out.println(<span class="string">&quot;出栈的元素为：&quot;</span>+n);</span><br><span class="line">System.out.println(<span class="string">&quot;Stack:&quot;</span>+st);</span><br><span class="line"><span class="comment">// 查看栈顶元素，且不出栈</span></span><br><span class="line"><span class="keyword">int</span> top = st.peek();</span><br><span class="line">System.out.println(<span class="string">&quot;栈顶的元素为：&quot;</span>+top);</span><br><span class="line"><span class="comment">// 查找某个元素</span></span><br><span class="line"><span class="keyword">int</span> flag1 = st.search(<span class="number">200</span>);</span><br><span class="line"><span class="keyword">int</span> flag2 = st.search(<span class="number">555</span>);</span><br><span class="line">System.out.println(flag1);</span><br><span class="line">System.out.println(flag2);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="5-字典（Dictionary）"><a href="#5-字典（Dictionary）" class="headerlink" title="5. 字典（Dictionary）"></a>5. <del>字典（Dictionary）</del></h3><ul><li>Dictionary 类是一个抽象类，用来存储键/值对，作用和Map类相似。</li><li>Dictionary类已经过时了。在实际开发中，你可以<a href="https://www.runoob.com/java/java-map-interface.html">实现Map接口</a>来获取键/值的存储功能。</li></ul><h3 id="6-哈希表（HashTable）"><a href="#6-哈希表（HashTable）" class="headerlink" title="6. 哈希表（HashTable）"></a>6. 哈希表（HashTable）</h3><ul><li><p>Hashtable类提供了一种在用户定义键结构的基础上来组织数据的手段。</p></li><li><pre><code class="java">// 演示package top.tobing.datastruct;import java.util.Enumeration;import java.util.Hashtable;/** * 哈希表：无序的 * @author Tobing * */public class Demo06DSHashtable &#123;    public static void main(String[] args) &#123;        Hashtable score = new Hashtable();        // 存放值，包含自动装箱        score.put(&quot;Tobing&quot;, 99);        score.put(&quot;Zenyet&quot;,100);        score.put(&quot;Rongon&quot;,100);        score.put(&quot;Acto&quot;,100);        // 遍历（返回key的枚举）        Enumeration enum1 = score.keys();        while(enum1.hasMoreElements()) &#123;            String key = (String)enum1.nextElement();            System.out.println(key+&quot;:&quot;+score.get(key));        &#125;    &#125;&#125;<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- 运行结果</span><br><span class="line"></span><br><span class="line">  &#96;&#96;&#96;bash</span><br><span class="line">  Acto:100</span><br><span class="line">  Tobing:99</span><br><span class="line">  Zenyet:100</span><br><span class="line">  Rongon:100</span><br></pre></td></tr></table></figure></code></pre></li></ul><h3 id="7-属性（Properties）"><a href="#7-属性（Properties）" class="headerlink" title="7. 属性（Properties）"></a>7. 属性（Properties）</h3><ul><li><p>Properties 继承于 Hashtable.Properties 类表示了一个持久的属性集.属性列表中每个键及其对应值都是一个字符串。</p></li><li><p><code>Properties</code> 可保存在流中或从流中加载。属性列表中每个键及其对应值都是一个字符串。 </p></li><li><pre><code class="java">package top.tobing.datastruct;import java.util.Iterator;import java.util.Properties;import java.util.Set;/** * Properties * @author Tobing * */public class Demo07DSProperties &#123;    public static void main(String[] args) &#123;        Properties pro = new Properties();        pro.put(&quot;Tobing&quot;,&quot;Dell&quot;);        pro.put(&quot;Acto&quot;,&quot;Dell&quot;);        pro.put(&quot;Zenyet&quot;,&quot;HuaWei&quot;);        pro.put(&quot;Rongon&quot;,&quot;Lenove&quot;);        Set proSet = pro.keySet();        Iterator it = proSet.iterator();        while(it.hasNext()) &#123;            String name = (String)it.next();            System.out.println(name+&quot;:&quot;+pro.get(name));        &#125;    &#125;&#125;</code></pre></li></ul>]]></content>
      
      
      <categories>
          
          <category> 理论学习 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> 数据结构 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hello! Hexo</title>
      <link href="2019/10/02/Hello/"/>
      <url>2019/10/02/Hello/</url>
      
        <content type="html"><![CDATA[<h3 id="你好Hexo"><a href="#你好Hexo" class="headerlink" title="你好Hexo"></a>你好Hexo</h3><hr><h4 id="多读书，多看报"><a href="#多读书，多看报" class="headerlink" title="多读书，多看报 :)"></a>多读书，多看报 :)</h4><a id="more"></a>]]></content>
      
      
      <categories>
          
          <category> 技术应用 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Hexo </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
