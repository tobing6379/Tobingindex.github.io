<!DOCTYPE html>
<html lang="zh-Hans,zh-CN,en,zh-HK,zh-TW,default">
<head hexo-theme='https://github.com/volantis-x/hexo-theme-volantis/tree/4.2.0'>
  <meta charset="utf-8">
  <!-- SEO相关 -->
  
    
  
  <!-- 渲染优化 -->
  <meta http-equiv='x-dns-prefetch-control' content='on' />
  <link rel='dns-prefetch' href='https://cdn.jsdelivr.net'>
  <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
  <meta name="renderer" content="webkit">
  <meta name="force-rendering" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
  <meta name="HandheldFriendly" content="True" >
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <!-- 页面元数据 -->
  
  <title>JDBC复习 - tobing</title>
  
    <meta name="keywords" content="jdbc">
  

  
    <meta name="description" content="JDBC复习1. 引入
回顾操作数据库（MySQL）的常用方式
第三方客户端：SQLyog等
MySQL自带命令行
Java访问（JDBC）



2. JDBC
JDBC（ Java Database Connectivity ）： 是Java语言中用来规范客户端程序如何来访问数据库的应用程序接口，提供了诸如查...">
  

  <!-- feed -->
  

  <!-- import meta -->
  

  <!-- link -->
  
    <link rel="shortcut icon" type='image/x-icon' href="https://cdn.jsdelivr.net/gh/xaoxuu/assets@master/favicon/favicon.ico">
  

  <!-- import link -->
  

  
    
<link rel="stylesheet" href="/css/first.css">

  

  
  <link rel="stylesheet" href="/css/style.css" media="print" onload="this.media='all';this.onload=null">
  <noscript><link rel="stylesheet" href="/css/style.css"></noscript>
  

  <script id="loadcss"></script>

</head>

<body>
  

<header id="l_header" class="l_header auto shadow blur show" style='opacity: 0' >
  <div class='container'>
  <div id='wrapper'>
    <div class='nav-sub'>
      <p class="title"></p>
      <ul class='switcher nav-list-h m-phone' id="pjax-header-nav-list">
        <li><a id="s-comment" class="fas fa-comments fa-fw" target="_self" href='javascript:void(0)'></a></li>
        
          <li><a id="s-toc" class="s-toc fas fa-list fa-fw" target="_self" href='javascript:void(0)'></a></li>
        
      </ul>
    </div>
		<div class="nav-main">
      
        
        <a class="title flat-box" target="_self" href='/'>
          
          
            <i class='https://portrait.gitee.com/uploads/avatars/user/1875/5627411_tobing_1599371351.png'></i>
          
          
            tobing's blog
          
        </a>
      

			<div class='menu navigation'>
				<ul class='nav-list-h m-pc'>
          
          
          
            
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href=/
                  
                  
                  
                    id="home"
                  >
                  <i class='fas fa-rss fa-fw'></i>博客
                </a>
                
              </li>
            
          
          
            
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href=/categories/
                  
                  
                  
                    id="categories"
                  >
                  <i class='fas fa-folder-open fa-fw'></i>分类
                </a>
                
              </li>
            
          
          
            
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href=/tags/
                  
                  
                  
                    id="tags"
                  >
                  <i class='fas fa-tags fa-fw'></i>标签
                </a>
                
              </li>
            
          
          
            
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href=/archives/
                  
                  
                  
                    id="archives"
                  >
                  <i class='fas fa-archive fa-fw'></i>归档
                </a>
                
              </li>
            
          
          
            
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href=/friends/
                  
                  
                  
                    id="friends"
                  >
                  <i class='fas fa-link fa-fw'></i>友链
                </a>
                
              </li>
            
          
          
            
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href=/about/
                  
                  
                  
                    id="about"
                  >
                  <i class='fas fa-info-circle fa-fw'></i>关于
                </a>
                
              </li>
            
          
          
				</ul>
			</div>

      <div class="m_search">
        <form name="searchform" class="form u-search-form">
          <i class="icon fas fa-search fa-fw"></i>
          <input type="text" class="input u-search-input" placeholder="Search..." />
        </form>
      </div>

			<ul class='switcher nav-list-h m-phone'>
				
					<li><a class="s-search fas fa-search fa-fw" target="_self" href='javascript:void(0)'></a></li>
				
				<li>
          <a class="s-menu fas fa-bars fa-fw" target="_self" href='javascript:void(0)'></a>
          <ul class="menu-phone list-v navigation white-box">
            
              
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href=/
                  
                  
                  
                    id="home"
                  >
                  <i class='fas fa-rss fa-fw'></i>博客
                </a>
                
              </li>
            
          
            
              
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href=/categories/
                  
                  
                  
                    id="categories"
                  >
                  <i class='fas fa-folder-open fa-fw'></i>分类
                </a>
                
              </li>
            
          
            
              
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href=/tags/
                  
                  
                  
                    id="tags"
                  >
                  <i class='fas fa-tags fa-fw'></i>标签
                </a>
                
              </li>
            
          
            
              
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href=/archives/
                  
                  
                  
                    id="archives"
                  >
                  <i class='fas fa-archive fa-fw'></i>归档
                </a>
                
              </li>
            
          
            
              
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href=/friends/
                  
                  
                  
                    id="friends"
                  >
                  <i class='fas fa-link fa-fw'></i>友链
                </a>
                
              </li>
            
          
            
              
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href=/about/
                  
                  
                  
                    id="about"
                  >
                  <i class='fas fa-info-circle fa-fw'></i>关于
                </a>
                
              </li>
            
          
            
          </ul>
        </li>
			</ul>
		</div>
	</div>
  </div>
</header>

  <div id="l_body">
    <div id="l_cover">
  
    
        <div id="full" class='cover-wrapper post search' style="display: none;">
          
            <div class='cover-bg lazyload placeholder' data-bg="https://cdn.jsdelivr.net/gh/volantis-x/cdn-wallpaper-minimalist/2020/033.jpg"></div>
          
          <div class='cover-body'>
  <div class='top'>
    
    
      <p class="title">Welcome !</p>
    
    
  </div>
  <div class='bottom'>
    
      <div class="m_search">
        <form name="searchform" class="form u-search-form">
          <input type="text" class="input u-search-input" placeholder="Search..." />
          <i class="icon fas fa-search fa-fw"></i>
        </form>
      </div>
    
    <div class='menu navigation'>
      <div class='list-h'>
        
      </div>
    </div>
  </div>
</div>

          <div id="scroll-down" style="display: none;"><i class="fa fa-chevron-down scroll-down-effects"></i></div>
        </div>
    
  
  </div>

    <div id='safearea'>
      <div class='body-wrapper' id="pjax-container">
        

<div class='l_main'>
  <article class="article post white-box reveal md shadow article-type-post" id="post" itemscope itemprop="blogPost">
  


  
  <div class="article-meta" id="top">
    
    
    
      <h1 class="title">
        JDBC复习
      </h1>
      <div class='new-meta-box'>
        
          
            
<div class='new-meta-item author'>
  <a class='author' href="/" rel="nofollow">
    <img no-lazy src="">
    <p>请设置文章作者</p>
  </a>
</div>

          
        
          
            
  <div class='new-meta-item category'>
    <a class='notlink'>
      <i class="fas fa-folder-open fa-fw" aria-hidden="true"></i>
      <a class="category-link" href="/categories/Java/">Java</a>
    </a>
  </div>


          
        
          
            <div class="new-meta-item date">
  <a class='notlink'>
    <i class="fas fa-calendar-alt fa-fw" aria-hidden="true"></i>
    <p>发布于：Nov 2, 2019</p>
  </a>
</div>

          
        
          
            
  <div class="new-meta-item browse leancloud">
    <a class='notlink'>
      
      <div id="lc-pv" data-title="JDBC复习" data-path="/2019/11/02/JDBC%E5%A4%8D%E4%B9%A0/">
        <i class="fas fa-eye fa-fw" aria-hidden="true"></i>
        <span id='number'><i class="fas fa-circle-notch fa-spin fa-fw" aria-hidden="true"></i></span>
        次浏览
      </div>
    </a>
  </div>


          
        
      </div>
    
  </div>


  
  <h1 id="JDBC复习"><a href="#JDBC复习" class="headerlink" title="JDBC复习"></a>JDBC复习</h1><h4 id="1-引入"><a href="#1-引入" class="headerlink" title="1. 引入"></a>1. 引入</h4><ul>
<li>回顾操作数据库（MySQL）的常用方式<ul>
<li>第三方客户端：SQLyog等</li>
<li>MySQL自带命令行</li>
<li>Java访问（JDBC）</li>
</ul>
</li>
</ul>
<h4 id="2-JDBC"><a href="#2-JDBC" class="headerlink" title="2. JDBC"></a>2. JDBC</h4><ul>
<li><p>JDBC（ Java Database Connectivity ）： 是Java语言中用来规范客户端程序如何来访问数据库的应用程序接口，提供了诸如查询和更新数据库中数据的方法。 每个<code> 数据库厂商</code>根据自家数据库的通信格式编写好自己数据库的驱动。所以我们只需要会调用 <code>JDBC 接口中的方法</code>即可，<code>数据库驱动由数据库厂商提供</code>。 </p>
</li>
<li><p>JDBC的好处：</p>
<ol>
<li><p>开发访问数据库的程序，只需要会调用 JDBC 接口中的方法即可，不用关注类是如何实现的。</p>
</li>
<li><p>用同一套 Java 代码，进行少量的修改就可以访问其他 JDBC 支持的数据库 </p>
<p><img src="/images/JDBC%E6%8E%A5%E5%8F%A3.png" class="lazyload" data-srcset="/images/JDBC%E6%8E%A5%E5%8F%A3.png" srcset="data:image/png;base64,666" alt="JDBC接口"></p>
</li>
</ol>
</li>
<li><p>JDBC常用的的包</p>
<ul>
<li><code>java.sql</code>：所有与JDBC访问数据相关的接口和类</li>
<li><code>javax.sql</code>：数据库拓展包，提供数据库额外功。比如：连接池</li>
<li><code>数据库驱动jar</code>：数据库厂商基于JDBC接口的实现类。使用哪个就下载哪个。</li>
</ul>
</li>
<li><p>JDBC核心API</p>
<ul>
<li>DriverManager：The basic service for managing a set of JDBC drivers.<ul>
<li>管理和注册数据库驱动</li>
<li>得到数据库连接对象</li>
</ul>
</li>
<li>Connection接口：A connection (session) with a specific database.<ul>
<li>一个连接对象，可以用于创建Statement和PrepareStatement对象</li>
</ul>
</li>
<li>Statement接口：The object used for executing a static SQL statement and  returning the results it produces.</li>
<li>PreparedStatement接口：An object that represents a precompiled SQL statement.</li>
<li>ResultSet接口：A table of data representing a database result set, which is  usually generated by executing a statement that queries the database.</li>
</ul>
</li>
</ul>
<h4 id="3-Connection接口"><a href="#3-Connection接口" class="headerlink" title="3. Connection接口"></a>3. Connection接口</h4><ul>
<li><p>Connection 接口，具体的实现类由数据库的厂商实现，代表一个连接对象。</p>
</li>
<li><p>提供了获取Statement的方法</p>
<blockquote>
<ul>
<li>Statement createStatement()：Creates a Statement object for sending SQL statements to the database.</li>
</ul>
</blockquote>
</li>
</ul>
<h4 id="4-Statement接口"><a href="#4-Statement接口" class="headerlink" title="4. Statement接口"></a>4. Statement接口</h4><ul>
<li><p>Statement接口，The object used for executing a static SQL statement and  returning the results it produces.</p>
<blockquote>
<ul>
<li>int executeUpdate(String sql)  ：Executes the given SQL statement, which may be an INSERT, UPDATE, or DELETE statement or an SQL statement that returns nothing, such as an SQL DDL statement.</li>
</ul>
<ul>
<li>ResultSet executeQuery(String sql)  ：Executes the given SQL statement, which returns a single ResultSet object.</li>
</ul>
</blockquote>
</li>
</ul>
<h4 id="5-ResultSet接口"><a href="#5-ResultSet接口" class="headerlink" title="5. ResultSet接口"></a>5. ResultSet接口</h4><ul>
<li><p>ResultSet接口，封装数据库查询的结果集，对结果集进行下半年了，读取每一条记录。</p>
</li>
<li><p>A table of data representing a database result set, which is usually generated  by executing a statement that queries the database.</p>
<blockquote>
<ul>
<li><p>boolean next()：Moves the cursor forward one row from its current  position.</p>
</li>
<li><p>数据类型 getXxx()：</p>
</li>
<li><p>通过字段名，参数是String类型，返回不同类型</p>
</li>
<li><p>通过列号，参数是整数，从1开始，返回不同类型</p>
</li>
</ul>
</blockquote>
</li>
<li><p>常用数据类型转换表</p>
<table>
<thead>
<tr>
<th>SQL 类型</th>
<th>Jdbc对应方法</th>
<th>返回类型</th>
</tr>
</thead>
<tbody><tr>
<td>BIT(1) bit(n)</td>
<td>getBoolean()</td>
<td>boolean</td>
</tr>
<tr>
<td>TINYINT</td>
<td>getByte()</td>
<td>byte</td>
</tr>
<tr>
<td>SMALLINT</td>
<td>getShort()</td>
<td>short</td>
</tr>
<tr>
<td>INT</td>
<td>getInt()</td>
<td>int</td>
</tr>
<tr>
<td>BIGINT</td>
<td>getLong()</td>
<td>long</td>
</tr>
<tr>
<td>CHAR,VARCHAR</td>
<td>getString()</td>
<td>String</td>
</tr>
<tr>
<td>Text(Clob) Blob</td>
<td>getClob getBlob()</td>
<td>Clob Blob</td>
</tr>
<tr>
<td>DATE</td>
<td>getDate()</td>
<td>java.sql.Date</td>
</tr>
<tr>
<td>TIME</td>
<td>getTime()</td>
<td>java.sql.Time</td>
</tr>
<tr>
<td>TIMESTAMP</td>
<td>getTimestamp()</td>
<td>java.sql.Timestamp</td>
</tr>
</tbody></table>
<blockquote>
<p>java.sql.Date、Time、Timestamp，三个共同父类是：java.util.Date</p>
</blockquote>
</li>
</ul>
<h4 id="6-获取Statement"><a href="#6-获取Statement" class="headerlink" title="6. 获取Statement"></a>6. 获取Statement</h4><ul>
<li>下载MySQL驱动jar包</li>
<li>创建工程，导入驱动jar包</li>
<li>编写业务逻辑</li>
</ul>
<ol>
<li><p>下载MySQL驱动jar包</p>
<ul>
<li>解压下载的<code>mysql-connector-java-5.1.48.zip</code>，把其中的jar包导入项目中</li>
</ul>
</li>
<li><p>创建工程，导入驱动jar包。</p>
<ol>
<li><p>创建Java项目</p>
</li>
<li><p>导入jar</p>
<p><img src="/images/image-20191101220159197.png" class="lazyload" data-srcset="/images/image-20191101220159197.png" srcset="data:image/png;base64,666" alt="image-20191101220159197"></p>
</li>
</ol>
</li>
<li><p>创建测试类<code>JDBCDemo01.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> top.tobing.demo01;</span><br><span class="line"><span class="keyword">import</span> ...</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JDBCDemo01</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ClassNotFoundException, SQLException </span>&#123;</span><br><span class="line">        <span class="comment">// 加载驱动</span></span><br><span class="line">        Class.forName(<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>);</span><br><span class="line">        <span class="comment">// 得到MySQL数据库的连接对象</span></span><br><span class="line">        String url = <span class="string">&quot;jdbc:mysql://localhost:3306/db8100&quot;</span>;</span><br><span class="line">        <span class="comment">// 通过数据库地址、用户名、密码得到一个连接</span></span><br><span class="line">        Connection connection = DriverManager.getConnection(url, <span class="string">&quot;root&quot;</span>, <span class="string">&quot;root&quot;</span>);</span><br><span class="line">        <span class="comment">// 输出连接</span></span><br><span class="line">        System.out.println(connection); <span class="comment">// com.mysql.jdbc.JDBC4Connection@42d8062c</span></span><br><span class="line">        <span class="comment">// 获取Statement</span></span><br><span class="line">        Statement statement = connection.createStatement();</span><br><span class="line">        <span class="comment">// 输出Statement</span></span><br><span class="line">        System.out.println(statement); <span class="comment">// com.mysql.jdbc.StatementImpl@6043cd28</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<ol>
<li><p>Class.forName(数据库驱动实现类) :加载和注册数据库驱动，数据库驱动由 mysql 厂商 “com.mysql.jdbc.Driver” </p>
</li>
<li><p>连接数据库的4个参数：用户名、密码、url、驱动类全限定类名。</p>
</li>
<li><p>连接数据库URL：协议名:子协议://IP地址:端口号?参数=参数值</p>
<ul>
<li>jdbc:mysql://localhost:3306/test ?characterEncdoing = utf-8</li>
</ul>
</li>
</ol>
</blockquote>
</li>
</ol>
<h4 id="7-执行DDL操作"><a href="#7-执行DDL操作" class="headerlink" title="7. 执行DDL操作"></a>7. 执行DDL操作</h4><ul>
<li><p>访问数据库通用步骤</p>
<p><img src="/images/db.png" class="lazyload" data-srcset="/images/db.png" srcset="data:image/png;base64,666" alt="db"></p>
</li>
<li><p>要创建的表</p>
<table>
<thead>
<tr>
<th>字段</th>
<th>类型</th>
</tr>
</thead>
<tbody><tr>
<td>id</td>
<td>int</td>
</tr>
<tr>
<td>name</td>
<td>varchar(20)</td>
</tr>
<tr>
<td>gender</td>
<td>tinyint(1)</td>
</tr>
<tr>
<td>birthday</td>
<td>date</td>
</tr>
</tbody></table>
</li>
<li><p>详细代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> top.tobing.demo01;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.sql.Connection;</span><br><span class="line"><span class="keyword">import</span> java.sql.DriverManager;</span><br><span class="line"><span class="keyword">import</span> java.sql.SQLException;</span><br><span class="line"><span class="keyword">import</span> java.sql.Statement;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JDBCDemo2</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Connection conn = <span class="keyword">null</span>;</span><br><span class="line">        Statement stat = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            <span class="comment">// 获取数据库连接对象</span></span><br><span class="line">            conn = DriverManager.getConnection(<span class="string">&quot;jdbc:mysql:///db8100&quot;</span>,<span class="string">&quot;root&quot;</span>,<span class="string">&quot;root&quot;</span>);</span><br><span class="line">            <span class="comment">// 通过连接对象获取执行SQL语句的Statement对象</span></span><br><span class="line">            stat = conn.createStatement();</span><br><span class="line">            <span class="comment">// Statement对象执行语句</span></span><br><span class="line">            stat.executeUpdate(<span class="string">&quot;create table student (id int PRIMARY key auto_increment, name varchar(20) not null &quot;</span> +</span><br><span class="line">                    <span class="string">&quot;,gender boolean,birthday date )&quot;</span>);</span><br><span class="line">            <span class="comment">// 执行完毕</span></span><br><span class="line">            System.out.println(<span class="string">&quot;执行完毕&quot;</span>);</span><br><span class="line">        &#125;<span class="keyword">catch</span>(Exception e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="comment">// 关闭资源</span></span><br><span class="line">            <span class="keyword">if</span>(stat!=<span class="keyword">null</span>)&#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    stat.close();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(conn!=<span class="keyword">null</span>)&#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    conn.close();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h4 id="8-执行DML操作"><a href="#8-执行DML操作" class="headerlink" title="8. 执行DML操作"></a>8. 执行DML操作</h4><ul>
<li><p>向student表中添加4条记录</p>
<table>
<thead>
<tr>
<th>id</th>
<th>name</th>
<th>gender</th>
<th>birthday</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>张无忌</td>
<td>1</td>
<td>1993-03-24</td>
</tr>
<tr>
<td>2</td>
<td>张三丰</td>
<td>1</td>
<td>1993-03-24</td>
</tr>
<tr>
<td>3</td>
<td>张翠山</td>
<td>0</td>
<td>1993-03-24</td>
</tr>
<tr>
<td>4</td>
<td>赵四</td>
<td>1</td>
<td>1993-03-24</td>
</tr>
</tbody></table>
</li>
<li><p>步骤：</p>
<ol>
<li>创建连接对象</li>
<li>创建Statement语句对象</li>
<li>执行SQL查询语句：</li>
<li>返回影响行数</li>
<li>释放资源</li>
</ol>
</li>
<li><p>代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> top.tobing.demo01;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> ...</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JDBCDemo03</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">        <span class="comment">//1. 创建连接对象</span></span><br><span class="line">        Connection conn = DriverManager.getConnection(<span class="string">&quot;jdbc:mysql:///db8100&quot;</span>, <span class="string">&quot;root&quot;</span>, <span class="string">&quot;root&quot;</span>);</span><br><span class="line">        <span class="comment">//2. 创建Statement语句对象</span></span><br><span class="line">        Statement stat = conn.createStatement();</span><br><span class="line">        <span class="comment">//3. 执行SQL查询语句：</span></span><br><span class="line">        <span class="comment">//4. 返回影响行数</span></span><br><span class="line">        <span class="keyword">int</span> count = <span class="number">0</span>; <span class="comment">// 记录改变的行数</span></span><br><span class="line">        count += stat.executeUpdate(<span class="string">&quot;insert into student values (null,&#x27;张三丰&#x27;,1,&#x27;1993-03-24&#x27;)&quot;</span>);</span><br><span class="line">        count += stat.executeUpdate(<span class="string">&quot;insert into student values (null,&#x27;张无忌&#x27;,1,&#x27;1993-03-24&#x27;)&quot;</span>);</span><br><span class="line">        count += stat.executeUpdate(<span class="string">&quot;insert into student values (null,&#x27;张翠山&#x27;,1,&#x27;1993-03-24&#x27;)&quot;</span>);</span><br><span class="line">        count += stat.executeUpdate(<span class="string">&quot;insert into student values (null,&#x27;张敏&#x27;,0,&#x27;1993-03-24&#x27;)&quot;</span>);</span><br><span class="line">        <span class="comment">//5. 释放资源</span></span><br><span class="line">        rs.close()</span><br><span class="line">        stat.close();</span><br><span class="line">        conn.close();</span><br><span class="line">        System.out.println(<span class="string">&quot;一个影响了&quot;</span>+count+<span class="string">&quot;行&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>使用完毕以后要关闭结果集 ResultSet，再关闭 Statement，再关闭 Connection </p>
</blockquote>
</li>
</ul>
<h4 id="9-执行DQL语句"><a href="#9-执行DQL语句" class="headerlink" title="9. 执行DQL语句"></a>9. 执行DQL语句</h4><ul>
<li><p>查询student表中的数据</p>
</li>
<li><p>步骤：</p>
<ol>
<li>得到连接对象</li>
<li>得到执行Statement对象</li>
<li>执行查询操作得到结果集ResultSet</li>
<li>变量结果集内容</li>
<li>输出内容</li>
<li>关闭资源</li>
</ol>
</li>
<li><p>代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> top.tobing.demo01;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.sql.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JDBCDemo04</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">        <span class="comment">//1. 得到连接对象</span></span><br><span class="line">        Connection conn = DriverManager.getConnection(<span class="string">&quot;jdbc:mysql:///db8100&quot;</span>, <span class="string">&quot;root&quot;</span>, <span class="string">&quot;root&quot;</span>);</span><br><span class="line">        <span class="comment">//2. 得到执行Statement对象</span></span><br><span class="line">        Statement stat = conn.createStatement();</span><br><span class="line">        <span class="comment">//3. 执行查询操作得到结果集ResultSet</span></span><br><span class="line">        ResultSet rs = stat.executeQuery(<span class="string">&quot;select * from student&quot;</span>);</span><br><span class="line">        <span class="comment">//4. 变量结果集内容</span></span><br><span class="line">        <span class="comment">//5. 输出内容</span></span><br><span class="line">        <span class="keyword">while</span>(rs.next())&#123;</span><br><span class="line">            <span class="keyword">int</span> id = rs.getInt(<span class="string">&quot;id&quot;</span>);</span><br><span class="line">            String name = rs.getString(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">            <span class="keyword">boolean</span> gender = rs.getBoolean(<span class="string">&quot;gender&quot;</span>);</span><br><span class="line">            Date birthday = rs.getDate(<span class="string">&quot;birthday&quot;</span>);</span><br><span class="line">            System.out.println(<span class="string">&quot;编号：&quot;</span>+id+<span class="string">&quot;\t姓名：&quot;</span>+name+<span class="string">&quot;\t性别：&quot;</span>+gender+<span class="string">&quot;\t生日：&quot;</span>+birthday);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//6. 关闭资源</span></span><br><span class="line">        stat.close();</span><br><span class="line">        conn.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</li>
<li><p>输出结果</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">编号：1	姓名：张三丰	性别：<span class="literal">true</span>		生日：1993-03-24</span><br><span class="line">编号：2	姓名：张无忌	性别：<span class="literal">true</span>		生日：1993-03-24</span><br><span class="line">编号：3	姓名：张翠山	性别：<span class="literal">true</span>		生日：1993-03-24</span><br><span class="line">编号：4	姓名：张敏	性别：<span class="literal">false</span>	生日：1993-03-24</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h4 id="10-工具类的封装"><a href="#10-工具类的封装" class="headerlink" title="10. 工具类的封装"></a>10. 工具类的封装</h4><ul>
<li><p>回看以上代码发现，很多代码都重复，可以把这些重复的代码抽取出来，封装到工具类中。</p>
</li>
<li><p>工具类包含以下三个功能</p>
<ol>
<li>把用到的字符串定义为常量：密码、账号、URL、驱动类</li>
<li>获取数据库的连接：getConnection</li>
<li>关闭资源：close(Connection conn,Statement stat),close(Connection conn,Statement stmt,ResultSet rs</li>
</ol>
</li>
<li><p>代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> top.tobing.util;</span><br><span class="line"><span class="keyword">import</span> java.sql.*;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">1. 把用到的字符串定义为常量：密码、账号、URL、驱动类</span></span><br><span class="line"><span class="comment">2. 获取数据库的连接：getConnection</span></span><br><span class="line"><span class="comment">3. 关闭资源：close(Connection conn,Statement stat),close(Connection conn,Statement stmt,ResultSet rs)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JdbcUtils</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String PASSWORD = <span class="string">&quot;root&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String USERNAME = <span class="string">&quot;root&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String URL = <span class="string">&quot;jdbc:mysql:///db8100&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String DRIVER = <span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Connection <span class="title">getConnection</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Connection conn = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            <span class="comment">//1.加载驱动</span></span><br><span class="line">            Class.forName(DRIVER);</span><br><span class="line">            <span class="comment">//2.获取连接</span></span><br><span class="line">            conn = DriverManager.getConnection(URL, USERNAME, PASSWORD);</span><br><span class="line">        &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> conn;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">close</span><span class="params">(Connection conn, Statement stat)</span></span>&#123;</span><br><span class="line">        close(conn,stat,<span class="keyword">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">close</span><span class="params">(Connection conn, Statement stat, ResultSet rs)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(stat!=<span class="keyword">null</span>)&#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                stat.close();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(conn!=<span class="keyword">null</span>)&#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                conn.close();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(rs!=<span class="keyword">null</span>)&#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                rs.close();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



</li>
</ul>
<h4 id="11-PreparedStatement"><a href="#11-PreparedStatement" class="headerlink" title="11. PreparedStatement"></a>11. PreparedStatement</h4><ul>
<li><p>案例引入</p>
<ul>
<li><p>数据库：有一张表，里面包含几个用户。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">create table user(</span><br><span class="line">	id int primary key auto_increment, -- 主键，自增长</span><br><span class="line">	name varchar(20),  		-- 用户名</span><br><span class="line">	password varchar(20)    -- 密码</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">insert into user values(null,&#39;tobing&#39;,&#39;root&#39;),(null,&#39;rongon&#39;,&#39;root&#39;);</span><br></pre></td></tr></table></figure>
</li>
<li><p>查询用户用于登录</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">## 查询成功</span><br><span class="line">mysql&gt; select * from user where name &#x3D; &#39;tobing&#39; and password &#x3D; &#39;root&#39;;</span><br><span class="line">+----+--------+----------+</span><br><span class="line">| id | name   | password |</span><br><span class="line">+----+--------+----------+</span><br><span class="line">|  1 | tobing | root     |</span><br><span class="line">+----+--------+----------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line">## 查询失败</span><br><span class="line">mysql&gt; select * from user where name &#x3D; &#39;tobing&#39; and password &#x3D; &#39;rot&#39;;</span><br><span class="line">Empty set (0.00 sec)</span><br><span class="line"></span><br><span class="line">ERROR:</span><br><span class="line">No query specified</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</li>
<li><p>Jdbc实现以上登录功能</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> top.tobing.demo01;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> top.tobing.util.JdbcUtils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.sql.Connection;</span><br><span class="line"><span class="keyword">import</span> java.sql.DriverManager;</span><br><span class="line"><span class="keyword">import</span> java.sql.ResultSet;</span><br><span class="line"><span class="keyword">import</span> java.sql.Statement;</span><br><span class="line"><span class="keyword">import</span> java.util.Scanner;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JdbcDemo05Login</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Scanner sc = <span class="keyword">new</span> Scanner(System.in);</span><br><span class="line">        System.out.println(<span class="string">&quot;请输入用户名：&quot;</span>);</span><br><span class="line">        String username = sc.nextLine();</span><br><span class="line">        System.out.println(<span class="string">&quot;请输入密码：&quot;</span>);</span><br><span class="line">        String password = sc.nextLine();</span><br><span class="line">        login(username,password);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">login</span><span class="params">(String username,String password)</span></span>&#123;</span><br><span class="line">        Connection conn = <span class="keyword">null</span>;</span><br><span class="line">        Statement stat = <span class="keyword">null</span>;</span><br><span class="line">        ResultSet resultSet = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            conn = JdbcUtils.getConnection();</span><br><span class="line">            stat = conn.createStatement();</span><br><span class="line">            resultSet = stat.executeQuery(<span class="string">&quot;select * from user where name = &#x27;&quot;</span> + username + <span class="string">&quot;&#x27; and password = &#x27;&quot;</span> + password + <span class="string">&quot;&#x27;&quot;</span>);</span><br><span class="line">            <span class="keyword">if</span>(resultSet.next())&#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;登录成功，欢迎你：&quot;</span>+username);</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;登录失败！&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">catch</span>(Exception e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">            JdbcUtils.close(conn,stat,resultSet);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</li>
<li><p>结果</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">请输入用户名：</span><br><span class="line">tobing</span><br><span class="line">请输入密码：</span><br><span class="line">roo</span><br><span class="line">登录失败！</span><br><span class="line">--------------------------------------------</span><br><span class="line">请输入用户名：</span><br><span class="line">tobing</span><br><span class="line">请输入密码：</span><br><span class="line">root</span><br><span class="line">登录成功，欢迎你：tobing</span><br></pre></td></tr></table></figure>
</li>
<li><p>分析</p>
<ul>
<li><p>从以上代码以及运行结果，咋一看觉得没有什么问题。但实际上以上查询存在SQL注入的安全问题。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">请输入用户名：</span><br><span class="line">tobing</span><br><span class="line">请输入密码：</span><br><span class="line">rot<span class="string">&#x27; or &#x27;</span>1<span class="string">&#x27; = &#x27;</span>1</span><br><span class="line">登录成功，欢迎你：tobing</span><br></pre></td></tr></table></figure>
</li>
<li><p>上面演示了，当我们输入了错误的密码的时候，依然可以成功登陆。</p>
</li>
<li><p>实际，以上代码在实际中是玩mysql查询了以下语句。这句语句只需要用户名存在即可成立！！！！</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from user where name &#x3D; &#39;tobing&#39; and password &#x3D; &#39;rot&#39; or &#39;1&#39; &#x3D; &#39;1&#39;</span><br></pre></td></tr></table></figure>

</li>
</ul>
</li>
</ul>
<h5 id="解决方案：PreparedStatement"><a href="#解决方案：PreparedStatement" class="headerlink" title="解决方案：PreparedStatement"></a>解决方案：PreparedStatement</h5><ul>
<li><p>PreparedStatement：An object that represents a precompiled SQL statement.</p>
<ul>
<li>翻译：预编译SQL Statement对象</li>
</ul>
</li>
<li><p>PreparedStatement是Statement接口的子接口，继承父类使用方法。</p>
</li>
<li><p>创建PreparedStatment</p>
<blockquote>
<ul>
<li>PreparedStatement prepareStatement(String sql,…) :<br>Creates a PreparedStatement object for sending parameterized SQL statements to the database. </li>
</ul>
</blockquote>
</li>
<li><p>PreparedStatement接口中的方法</p>
<blockquote>
<ul>
<li>int executeUpdate() :<br>Executes the SQL statement in this PreparedStatement object, which must be an SQL Data Manipulation Language (DML) statement, such as INSERT, UPDATE or DELETE; or an SQL statement that returns nothing, such as a DDL statement. </li>
<li>ResultSet executeQuery() :<br>Executes the SQL query in this PreparedStatement object and returns the ResultSet object generated by the query. </li>
</ul>
</blockquote>
</li>
</ul>
</li>
</ul>
<ul>
<li><p>PreparedStatement实现login</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> top.tobing.demo01;</span><br><span class="line"><span class="keyword">import</span> top.tobing.util.JdbcUtils;</span><br><span class="line"><span class="keyword">import</span> java.sql.*;</span><br><span class="line"><span class="keyword">import</span> java.util.Scanner;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">使用PreparedStatment修改</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JdbcDemo06Login</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">        Scanner sc = <span class="keyword">new</span> Scanner(System.in);</span><br><span class="line">        System.out.println(<span class="string">&quot;请输入用户名：&quot;</span>);</span><br><span class="line">        String username = sc.nextLine();</span><br><span class="line">        System.out.println(<span class="string">&quot;请输入密码：&quot;</span>);</span><br><span class="line">        String password = sc.nextLine();</span><br><span class="line">        login(username,password);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">login</span><span class="params">(String username,String password)</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">        Connection conn = JdbcUtils.getConnection();</span><br><span class="line">        <span class="comment">// 登录SQL语句，没使用单引号，用？充当占位符</span></span><br><span class="line">        String sql = <span class="string">&quot;select * from user where name = ? and password = ?&quot;</span>;</span><br><span class="line">        PreparedStatement ps = conn.prepareStatement(sql);</span><br><span class="line">        ps.setString(<span class="number">1</span>,username); <span class="comment">// 指定第一个参数为String，且是username的值</span></span><br><span class="line">        ps.setString(<span class="number">2</span>,password);</span><br><span class="line">        ResultSet rs = ps.executeQuery();</span><br><span class="line">        <span class="keyword">if</span>(rs.next())&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;登录成功，欢迎你：&quot;</span>+username);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;登录失败！&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>结果</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">请输入用户名：</span><br><span class="line">tobing</span><br><span class="line">请输入密码：</span><br><span class="line">root</span><br><span class="line">登录成功，欢迎你：tobing</span><br><span class="line">-------------------------------------------</span><br><span class="line">请输入用户名：</span><br><span class="line">tobing</span><br><span class="line">请输入密码：</span><br><span class="line">rot<span class="string">&#x27; or &#x27;</span>1<span class="string">&#x27; = &#x27;</span>1</span><br><span class="line">登录失败！</span><br></pre></td></tr></table></figure>
</li>
<li><p>PreparedStatement执行原理(不是很理解SQL底层预编译的原理)</p>
<p><img src="/images/%E9%A2%84%E7%BC%96%E8%AF%91.png" class="lazyload" data-srcset="/images/%E9%A2%84%E7%BC%96%E8%AF%91.png" srcset="data:image/png;base64,666" alt="预编译"></p>
</li>
<li><p>使用PreparedStatement的好处</p>
<blockquote>
<ol>
<li>prepareStatement()会先将 SQL 语句发送给数据库预编译。PreparedStatement 会引用着预编译后的结果。 可以多次传入不同的参数给 PreparedStatement 对象并执行。减少 SQL 编译次数，提高效率。 </li>
<li>安全性更高，没有 SQL 注入的隐患</li>
<li>使用？充当占位符，减少了字符串拼接，是程序可读性提高。</li>
</ol>
</blockquote>
</li>
</ul>
<ul>
<li><p>实际中使用PreparedStatement的步骤</p>
<blockquote>
<ol>
<li>编写SQL语句，使用？占位。</li>
<li>获取PreparedStatement对象</li>
<li>设置实际参数，setXxx（占位符位置，传入值）</li>
<li>执行SQL语句</li>
<li>关闭资源</li>
</ol>
</blockquote>
</li>
<li><ul>
<li><p>案例一：PreparedStatement的查询数据，并将其封装为学生对象案例</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> top.tobing.domain;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Student</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> gender;</span><br><span class="line">    <span class="keyword">private</span> Date birthday;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(<span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line">	<span class="comment">// getter and setter .....</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;....&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> top.tobing.demo01;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> top.tobing.domain.Student;</span><br><span class="line"><span class="keyword">import</span> top.tobing.util.JdbcUtils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.sql.*;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">查询student，并将里面的数据封装为Student对象</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JdbcDemo07</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">        <span class="comment">// 创建学生对象</span></span><br><span class="line">        Student stu = <span class="keyword">new</span> Student();</span><br><span class="line">        <span class="comment">// 编写SQL语句，获取PreparedStatement对象</span></span><br><span class="line">        Connection conn = JdbcUtils.getConnection();</span><br><span class="line">        PreparedStatement pstat = conn.prepareStatement(<span class="string">&quot;select * from student where id = ?&quot;</span>);</span><br><span class="line">        <span class="comment">// 设置参数</span></span><br><span class="line">        pstat.setInt(<span class="number">1</span>,<span class="number">2</span>);</span><br><span class="line">        <span class="comment">// 执行SQL语句</span></span><br><span class="line">        ResultSet rs = pstat.executeQuery();</span><br><span class="line">        <span class="keyword">while</span>(rs.next())&#123;</span><br><span class="line">            <span class="comment">// 封装数据</span></span><br><span class="line">            <span class="keyword">int</span> id = rs.getInt(<span class="string">&quot;id&quot;</span>);</span><br><span class="line">            String name = rs.getString(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">            <span class="keyword">boolean</span> gender = rs.getBoolean(<span class="string">&quot;gender&quot;</span>);</span><br><span class="line">            Date birthday = rs.getDate(<span class="string">&quot;birthday&quot;</span>);</span><br><span class="line">            stu.setId(id);</span><br><span class="line">            stu.setName(name);</span><br><span class="line">            stu.setGender(gender);</span><br><span class="line">            stu.setBirthday(birthday);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 关闭资源</span></span><br><span class="line">        JdbcUtils.close(conn,pstat);</span><br><span class="line">        System.out.println(stu);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>案例二：查询学生表将所有学生数据封装为Student对象</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> top.tobing.demo01;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> top.tobing.domain.Student;</span><br><span class="line"><span class="keyword">import</span> top.tobing.util.JdbcUtils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> ....</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">将student中所有的学生信息封装到List中</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JdbcDemo08</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">        <span class="comment">// 创建List集合</span></span><br><span class="line">        List&lt;Student&gt; students = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        <span class="comment">// 编写SQL语句，获取预处理对象</span></span><br><span class="line">        Connection conn = JdbcUtils.getConnection();</span><br><span class="line">        PreparedStatement pstat = conn.prepareStatement(<span class="string">&quot;select * from student&quot;</span>);</span><br><span class="line">        <span class="comment">// 查询所有</span></span><br><span class="line">        ResultSet rs = pstat.executeQuery();</span><br><span class="line">        <span class="keyword">while</span> (rs.next())&#123;</span><br><span class="line">            <span class="comment">// 封装结果集</span></span><br><span class="line">            Student stu = <span class="keyword">new</span> Student();</span><br><span class="line">            stu.setBirthday(rs.getDate(<span class="string">&quot;birthday&quot;</span>));</span><br><span class="line">            stu.setGender(rs.getBoolean(<span class="string">&quot;gender&quot;</span>));</span><br><span class="line">            stu.setName(rs.getString(<span class="string">&quot;name&quot;</span>));</span><br><span class="line">            stu.setId(rs.getInt(<span class="string">&quot;id&quot;</span>));</span><br><span class="line">            students.add(stu);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 关闭资源</span></span><br><span class="line">        JdbcUtils.close(conn,pstat);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(Student stu : students)&#123;</span><br><span class="line">            System.out.println(stu);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>案例三：执行DML操作</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> top.tobing.demo01;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> top.tobing.util.JdbcUtils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.sql.Connection;</span><br><span class="line"><span class="keyword">import</span> java.sql.PreparedStatement;</span><br><span class="line"><span class="keyword">import</span> java.sql.SQLException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">PreparedStatement执行DML操作</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JdbcDemo09DML</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">        <span class="comment">// 插入</span></span><br><span class="line">        <span class="comment">//insert();</span></span><br><span class="line">        <span class="comment">// 更新</span></span><br><span class="line">        <span class="comment">//update();</span></span><br><span class="line">        <span class="comment">// 删除</span></span><br><span class="line">        delete();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 插入insert</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> SQLException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">insert</span><span class="params">()</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">        <span class="comment">// 编写SQL语句，获取preparedStatement对象</span></span><br><span class="line">        Connection conn = JdbcUtils.getConnection();</span><br><span class="line">        PreparedStatement pstat = conn.prepareStatement(<span class="string">&quot;insert into student values(null,?,?,?)&quot;</span>);</span><br><span class="line">        <span class="comment">// 设置参数</span></span><br><span class="line">        pstat.setString(<span class="number">1</span>,<span class="string">&quot;Tobing&quot;</span>);</span><br><span class="line">        pstat.setBoolean(<span class="number">2</span>,<span class="keyword">true</span>);</span><br><span class="line">        pstat.setDate(<span class="number">3</span>,java.sql.Date.valueOf(<span class="string">&quot;1999-05-03&quot;</span>));</span><br><span class="line">        <span class="comment">// 执行操作</span></span><br><span class="line">        <span class="keyword">int</span> row = pstat.executeUpdate();</span><br><span class="line">        System.out.println(<span class="string">&quot;插入了&quot;</span>+row+<span class="string">&quot;条记录&quot;</span>);</span><br><span class="line">        <span class="comment">// 关闭资源</span></span><br><span class="line">        JdbcUtils.close(conn,pstat);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 更新update</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> SQLException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">()</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">        <span class="comment">// 编写SQL语句，获取pstat对象</span></span><br><span class="line">        Connection conn = JdbcUtils.getConnection();</span><br><span class="line">        PreparedStatement pstat = conn.prepareStatement(<span class="string">&quot;update student set name = ?,birthday =? where id = ?&quot;</span>);</span><br><span class="line">        <span class="comment">// 设置参数</span></span><br><span class="line">        pstat.setString(<span class="number">1</span>,<span class="string">&quot;尼古拉斯&quot;</span>);</span><br><span class="line">        pstat.setDate(<span class="number">2</span>,java.sql.Date.valueOf(<span class="string">&quot;1999-06-16&quot;</span>));</span><br><span class="line">        pstat.setInt(<span class="number">3</span>,<span class="number">4</span>);</span><br><span class="line">        <span class="comment">// 执行操作</span></span><br><span class="line">        <span class="keyword">int</span> row = pstat.executeUpdate();</span><br><span class="line">        System.out.println(<span class="string">&quot;更新了&quot;</span>+row+<span class="string">&quot;条记录&quot;</span>);</span><br><span class="line">        <span class="comment">// 关闭资源</span></span><br><span class="line">        JdbcUtils.close(conn,pstat);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 删除delete</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> SQLException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">delete</span><span class="params">()</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">        <span class="comment">// 编写SQL，获取pstat</span></span><br><span class="line">        Connection conn = JdbcUtils.getConnection();</span><br><span class="line">        PreparedStatement pstat = conn.prepareStatement(<span class="string">&quot;delete from student where id = ? &quot;</span>);</span><br><span class="line">        <span class="comment">// 设置参数</span></span><br><span class="line">        pstat.setInt(<span class="number">1</span>,<span class="number">3</span>);</span><br><span class="line">        <span class="comment">// 执行操作</span></span><br><span class="line">        <span class="keyword">int</span> row = pstat.executeUpdate();</span><br><span class="line">        System.out.println(<span class="string">&quot;删除了&quot;</span>+row+<span class="string">&quot;条记录&quot;</span>);</span><br><span class="line">        <span class="comment">// 释放资源</span></span><br><span class="line">        JdbcUtils.close(conn,pstat);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

</li>
</ul>
</li>
</ul>
<h4 id="12-JDBC的事务处理"><a href="#12-JDBC的事务处理" class="headerlink" title="12. JDBC的事务处理"></a>12. JDBC的事务处理</h4><ul>
<li><p>Connection接口中与事务相关的API</p>
<blockquote>
<ul>
<li><p>void setAutoCommit(boolean autoCommit)：Sets this connection’s auto-commit mode to the given  state.</p>
</li>
<li><p>void commit()：Makes all changes made since the previous commit/rollback  permanent and releases any database locks currently held by this  <code>Connection</code> object.（提交事务）</p>
</li>
<li><p>void rollback()：Undoes all changes made in the current transaction and releases  any database locks currently held by this <code>Connection</code> object.（回滚事务）</p>
</li>
</ul>
</blockquote>
</li>
<li><p>开发步骤</p>
<blockquote>
<ol>
<li>获取连接</li>
<li>开启事务</li>
<li>获取pstat</li>
<li>使用pstat更新两次</li>
<li>正常情况下提交事务</li>
<li>出现异常回滚事务</li>
<li>关闭自愿</li>
</ol>
</blockquote>
</li>
<li><p>案例</p>
<ul>
<li>模拟：tobing给acto转账 200 </li>
</ul>
<table>
<thead>
<tr>
<th>字段</th>
<th>类型</th>
</tr>
</thead>
<tbody><tr>
<td>id</td>
<td>int</td>
</tr>
<tr>
<td>name</td>
<td>varchar(10)</td>
</tr>
<tr>
<td>balance</td>
<td>double</td>
</tr>
</tbody></table>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; create table accuont(</span><br><span class="line">    -&gt; id int primary key auto_increment, -- 主键，自增长</span><br><span class="line">    -&gt; name varchar(10), </span><br><span class="line">    -&gt; balance double</span><br><span class="line">    -&gt; );</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from account;</span><br><span class="line">+----+--------+---------+</span><br><span class="line">| id | name   | balance |</span><br><span class="line">+----+--------+---------+</span><br><span class="line">|  1 | tobing |  100000 |</span><br><span class="line">|  2 | acto   |  100000 |</span><br><span class="line">+----+--------+---------+</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> top.tobing.demo01;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> top.tobing.util.JdbcUtils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> ...</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 事务处理</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JdbcDemo10Transaction</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Connection conn = <span class="keyword">null</span>;</span><br><span class="line">        PreparedStatement pstat = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            <span class="comment">// 获取连接</span></span><br><span class="line">            conn = JdbcUtils.getConnection();</span><br><span class="line">            <span class="comment">// 开启事务</span></span><br><span class="line">            conn.setAutoCommit(<span class="keyword">false</span>);</span><br><span class="line">            <span class="comment">// 编写SQL，获取pstat</span></span><br><span class="line">            <span class="comment">// tobing - 200</span></span><br><span class="line">            pstat = conn.prepareStatement(<span class="string">&quot;update account set balance = balance - ? where name = ?&quot;</span>);</span><br><span class="line">            pstat.setDouble(<span class="number">1</span>,<span class="number">200</span>);</span><br><span class="line">            pstat.setString(<span class="number">2</span>,<span class="string">&quot;tobing&quot;</span>);</span><br><span class="line">            pstat.executeUpdate();</span><br><span class="line">            <span class="comment">// 模拟出现异常</span></span><br><span class="line">            System.out.println(<span class="number">100</span>/<span class="number">0</span>);</span><br><span class="line">            <span class="comment">// acto + 200</span></span><br><span class="line">            pstat = conn.prepareStatement(<span class="string">&quot;update account set balance = balance + ? where name = ?&quot;</span>);</span><br><span class="line">            pstat.setDouble(<span class="number">1</span>,<span class="number">200</span>);</span><br><span class="line">            pstat.setString(<span class="number">2</span>,<span class="string">&quot;acto&quot;</span>);</span><br><span class="line">            pstat.executeUpdate();</span><br><span class="line">            <span class="comment">// 提交事务</span></span><br><span class="line">            conn.commit();</span><br><span class="line">            System.out.println(<span class="string">&quot;转账成功！&quot;</span>);</span><br><span class="line">        &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">try</span>&#123;</span><br><span class="line">                <span class="comment">// 捕获到异常，回滚事务</span></span><br><span class="line">                conn.rollback();</span><br><span class="line">                System.out.println(<span class="string">&quot;转账失败！&quot;</span>);</span><br><span class="line">            &#125;<span class="keyword">catch</span> (SQLException e1)&#123;</span><br><span class="line">                e1.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="comment">// 关闭资源</span></span><br><span class="line">            JdbcUtils.close(conn,pstat);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#### 没有出现异常，把100/0 语句去除，能够正常转账</span></span><br><span class="line">mysql&gt; select * from account;</span><br><span class="line">+----+--------+---------+</span><br><span class="line">| id | name   | balance |</span><br><span class="line">+----+--------+---------+</span><br><span class="line">|  1 | tobing |   99600 |</span><br><span class="line">|  2 | acto   |  100400 |</span><br><span class="line">+----+--------+---------+</span><br><span class="line"></span><br><span class="line"><span class="comment">#### 出现异常 ：转账失败</span></span><br><span class="line">mysql&gt; select * from account;</span><br><span class="line">+----+--------+---------+</span><br><span class="line">| id | name   | balance |</span><br><span class="line">+----+--------+---------+</span><br><span class="line">|  1 | tobing |   99600 |</span><br><span class="line">|  2 | acto   |  100400 |</span><br><span class="line">+----+--------+---------+</span><br></pre></td></tr></table></figure>

<hr>
</li>
</ul>

  
  
    
    <div class='footer'>
      
      
      
        <div class='copyright'>
          <blockquote>
            
              
                <p>博客内容遵循 署名-非商业性使用-相同方式共享 4.0 国际 (CC BY-NC-SA 4.0) 协议</p>

              
            
              
                <p>本文永久链接是：<a href=https://tobing.top/2019/11/02/JDBC%E5%A4%8D%E4%B9%A0/>https://tobing.top/2019/11/02/JDBC%E5%A4%8D%E4%B9%A0/</a></p>
              
            
          </blockquote>
        </div>
      
      
    </div>
  
  
    


  <div class='article-meta' id="bottom">
    <div class='new-meta-box'>
      
        
          <div class="new-meta-item date" itemprop="dateUpdated" datetime="2019-11-04T11:15:10+08:00">
  <a class='notlink'>
    <i class="fas fa-edit fa-fw" aria-hidden="true"></i>
    <p>更新于：Nov 4, 2019</p>
  </a>
</div>

        
      
        
          
  
  <div class="new-meta-item meta-tags"><a class="tag" href="/tags/jdbc/" rel="nofollow"><i class="fas fa-hashtag fa-fw" aria-hidden="true"></i><p>jdbc</p></a></div>


        
      
        
          
  <div class="new-meta-item share -mob-share-list">
  <div class="-mob-share-list share-body">
    
      
        <a class="-mob-share-qq" title="" rel="external nofollow noopener noreferrer noopener"
          
          target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://tobing.top/2019/11/02/JDBC%E5%A4%8D%E4%B9%A0/&title=JDBC复习 - tobing&summary=JDBC复习1. 引入
回顾操作数据库（MySQL）的常用方式
第三方客户端：SQLyog等
MySQL自带命令行
Java访问（JDBC）



2. JDBC
JDBC（ Java Database Connectivity ）： 是Java语言中用来规范客户端程序如何来访问数据库的应用程序接口，提供了诸如查询和更新数据库中数据的方法。 每个 数据库厂商根据自家数据库的通信格式编写好自己数据库的驱动。所以我们只需要会调用 JDBC 接口中的方法即可，数据库驱动由数据库厂商提供。 

JDBC的好处：

开发访问数据库的程序，只需要会调用 JDBC 接口中的方法即可，不用关注类是如何实现的。

用同一套 Java 代码，进行少量的修改就可以访问其他 JDBC 支持的数据库 




JDBC常用的的包

java.sql：所有与JDBC访问数据相关的接口和类
javax.sql：数据库拓展包，提供数据库额外功。比如：连接池
数据库驱动jar：数据库厂商基于JDBC接口的实现类。使用哪个就下载哪个。


JDBC核心API

DriverManager：The basic service for managing a set of JDBC drivers.
管理和注册数据库驱动
得到数据库连接对象


Connection接口：A connection (session) with a specific database.
一个连接对象，可以用于创建Statement和PrepareStatement对象


Statement接口：The object used for executing a static SQL statement and  returning the results it produces.
PreparedStatement接口：An object that represents a precompiled SQL statement.
ResultSet接口：A table of data representing a database result set, which is  usually generated by executing a statement that queries the database.



3. Connection接口
Connection 接口，具体的实现类由数据库的厂商实现，代表一个连接对象。

提供了获取Statement的方法


Statement createStatement()：Creates a Statement object for sending SQL statements to the database.




4. Statement接口
Statement接口，The object used for executing a static SQL statement and  returning the results it produces.


int executeUpdate(String sql)  ：Executes the given SQL statement, which may be an INSERT, UPDATE, or DELETE statement or an SQL statement that returns nothing, such as an SQL DDL statement.


ResultSet executeQuery(String sql)  ：Executes the given SQL statement, which returns a single ResultSet object.




5. ResultSet接口"
          
          >
          
            <img src="https://cdn.jsdelivr.net/gh/volantis-x/cdn-org/logo/128/qq.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/volantis-x/cdn-org/logo/128/qq.png" srcset="data:image/png;base64,666">
          
        </a>
      
    
      
        <a class="-mob-share-qzone" title="" rel="external nofollow noopener noreferrer noopener"
          
          target="_blank" href="https://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url=https://tobing.top/2019/11/02/JDBC%E5%A4%8D%E4%B9%A0/&title=JDBC复习 - tobing&summary=JDBC复习1. 引入
回顾操作数据库（MySQL）的常用方式
第三方客户端：SQLyog等
MySQL自带命令行
Java访问（JDBC）



2. JDBC
JDBC（ Java Database Connectivity ）： 是Java语言中用来规范客户端程序如何来访问数据库的应用程序接口，提供了诸如查询和更新数据库中数据的方法。 每个 数据库厂商根据自家数据库的通信格式编写好自己数据库的驱动。所以我们只需要会调用 JDBC 接口中的方法即可，数据库驱动由数据库厂商提供。 

JDBC的好处：

开发访问数据库的程序，只需要会调用 JDBC 接口中的方法即可，不用关注类是如何实现的。

用同一套 Java 代码，进行少量的修改就可以访问其他 JDBC 支持的数据库 




JDBC常用的的包

java.sql：所有与JDBC访问数据相关的接口和类
javax.sql：数据库拓展包，提供数据库额外功。比如：连接池
数据库驱动jar：数据库厂商基于JDBC接口的实现类。使用哪个就下载哪个。


JDBC核心API

DriverManager：The basic service for managing a set of JDBC drivers.
管理和注册数据库驱动
得到数据库连接对象


Connection接口：A connection (session) with a specific database.
一个连接对象，可以用于创建Statement和PrepareStatement对象


Statement接口：The object used for executing a static SQL statement and  returning the results it produces.
PreparedStatement接口：An object that represents a precompiled SQL statement.
ResultSet接口：A table of data representing a database result set, which is  usually generated by executing a statement that queries the database.



3. Connection接口
Connection 接口，具体的实现类由数据库的厂商实现，代表一个连接对象。

提供了获取Statement的方法


Statement createStatement()：Creates a Statement object for sending SQL statements to the database.




4. Statement接口
Statement接口，The object used for executing a static SQL statement and  returning the results it produces.


int executeUpdate(String sql)  ：Executes the given SQL statement, which may be an INSERT, UPDATE, or DELETE statement or an SQL statement that returns nothing, such as an SQL DDL statement.


ResultSet executeQuery(String sql)  ：Executes the given SQL statement, which returns a single ResultSet object.




5. ResultSet接口"
          
          >
          
            <img src="https://cdn.jsdelivr.net/gh/volantis-x/cdn-org/logo/128/qzone.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/volantis-x/cdn-org/logo/128/qzone.png" srcset="data:image/png;base64,666">
          
        </a>
      
    
      
        <a class="-mob-share-weibo" title="" rel="external nofollow noopener noreferrer noopener"
          
          target="_blank" href="http://service.weibo.com/share/share.php?url=https://tobing.top/2019/11/02/JDBC%E5%A4%8D%E4%B9%A0/&title=JDBC复习 - tobing&summary=JDBC复习1. 引入
回顾操作数据库（MySQL）的常用方式
第三方客户端：SQLyog等
MySQL自带命令行
Java访问（JDBC）



2. JDBC
JDBC（ Java Database Connectivity ）： 是Java语言中用来规范客户端程序如何来访问数据库的应用程序接口，提供了诸如查询和更新数据库中数据的方法。 每个 数据库厂商根据自家数据库的通信格式编写好自己数据库的驱动。所以我们只需要会调用 JDBC 接口中的方法即可，数据库驱动由数据库厂商提供。 

JDBC的好处：

开发访问数据库的程序，只需要会调用 JDBC 接口中的方法即可，不用关注类是如何实现的。

用同一套 Java 代码，进行少量的修改就可以访问其他 JDBC 支持的数据库 




JDBC常用的的包

java.sql：所有与JDBC访问数据相关的接口和类
javax.sql：数据库拓展包，提供数据库额外功。比如：连接池
数据库驱动jar：数据库厂商基于JDBC接口的实现类。使用哪个就下载哪个。


JDBC核心API

DriverManager：The basic service for managing a set of JDBC drivers.
管理和注册数据库驱动
得到数据库连接对象


Connection接口：A connection (session) with a specific database.
一个连接对象，可以用于创建Statement和PrepareStatement对象


Statement接口：The object used for executing a static SQL statement and  returning the results it produces.
PreparedStatement接口：An object that represents a precompiled SQL statement.
ResultSet接口：A table of data representing a database result set, which is  usually generated by executing a statement that queries the database.



3. Connection接口
Connection 接口，具体的实现类由数据库的厂商实现，代表一个连接对象。

提供了获取Statement的方法


Statement createStatement()：Creates a Statement object for sending SQL statements to the database.




4. Statement接口
Statement接口，The object used for executing a static SQL statement and  returning the results it produces.


int executeUpdate(String sql)  ：Executes the given SQL statement, which may be an INSERT, UPDATE, or DELETE statement or an SQL statement that returns nothing, such as an SQL DDL statement.


ResultSet executeQuery(String sql)  ：Executes the given SQL statement, which returns a single ResultSet object.




5. ResultSet接口"
          
          >
          
            <img src="https://cdn.jsdelivr.net/gh/volantis-x/cdn-org/logo/128/weibo.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/volantis-x/cdn-org/logo/128/weibo.png" srcset="data:image/png;base64,666">
          
        </a>
      
    
      
    
      
    
  </div>
</div>



        
      
    </div>
  </div>


  
  

  
    <div class="prev-next">
      
        <a class='prev' href='/2019/11/04/%E6%95%B0%E6%8D%AE%E5%BA%93%E8%BF%9E%E6%8E%A5%E6%B1%A0%E6%8A%80%E6%9C%AF/'>
          <p class='title'><i class="fas fa-chevron-left" aria-hidden="true"></i>数据库连接池技术</p>
          <p class='content'>数据库连接池技术1. 引入
在对数据库进行操作的时候，每次执行不同操作，都要去申请连接对象，这样频繁地向系统申请资源会花费大量时间。因此人们引入了池子的概念：一开始就申请多个连接对象，并把这些连...</p>
        </a>
      
      
        <a class='next' href='/2019/10/26/%E7%94%B5%E4%BF%A1%E6%A0%A1%E5%9B%AD%E5%AE%BD%E5%B8%A6%E5%AE%89%E8%A3%85%E8%B7%AF%E7%94%B1%E5%99%A8/'>
          <p class='title'>电信校园宽带安装路由器<i class="fas fa-chevron-right" aria-hidden="true"></i></p>
          <p class='content'>电信校园宽带安装路由器（SWPU）1. 拿到电信号码，绑定学号
连接cmcc-edu

自动弹出网页选自服务

密码：
多运营商绑定
绑定号码密码


顺便在此界面下载拨号客户端




2. ...</p>
        </a>
      
    </div>
  
</article>


  

  <article class="post white-box reveal shadow" id="comments">
    <p ct><i class='fas fa-comments'></i> 评论</p>
    
    <div id="valine_container" class="valine_thread">
  <i class="fas fa-cog fa-spin fa-fw fa-2x"></i>
</div>

  </article>






</div>
<aside class='l_side'>
  
  
    
    



  <section class="widget toc-wrapper shadow desktop mobile" id="toc-div" >
    
  <header>
    
      <i class="fas fa-list fa-fw" aria-hidden="true"></i><span class='name'>本文目录</span>
    
  </header>


    <div class='content'>
        <ol class="toc"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E5%BC%95%E5%85%A5"><span class="toc-text">1. 引入</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-JDBC"><span class="toc-text">2. JDBC</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-Connection%E6%8E%A5%E5%8F%A3"><span class="toc-text">3. Connection接口</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-Statement%E6%8E%A5%E5%8F%A3"><span class="toc-text">4. Statement接口</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-ResultSet%E6%8E%A5%E5%8F%A3"><span class="toc-text">5. ResultSet接口</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-%E8%8E%B7%E5%8F%96Statement"><span class="toc-text">6. 获取Statement</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-%E6%89%A7%E8%A1%8CDDL%E6%93%8D%E4%BD%9C"><span class="toc-text">7. 执行DDL操作</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-%E6%89%A7%E8%A1%8CDML%E6%93%8D%E4%BD%9C"><span class="toc-text">8. 执行DML操作</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-%E6%89%A7%E8%A1%8CDQL%E8%AF%AD%E5%8F%A5"><span class="toc-text">9. 执行DQL语句</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#10-%E5%B7%A5%E5%85%B7%E7%B1%BB%E7%9A%84%E5%B0%81%E8%A3%85"><span class="toc-text">10. 工具类的封装</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#11-PreparedStatement"><span class="toc-text">11. PreparedStatement</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88%EF%BC%9APreparedStatement"><span class="toc-text">解决方案：PreparedStatement</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#12-JDBC%E7%9A%84%E4%BA%8B%E5%8A%A1%E5%A4%84%E7%90%86"><span class="toc-text">12. JDBC的事务处理</span></a></li></ol>
    </div>
  </section>


  


</aside>



        
        
          <!--此文件用来存放一些不方便取值的变量-->
<!--思路大概是将值藏到重加载的区域内-->

<script>
  window.pdata={}
  pdata.ispage=true;
  pdata.postTitle="JDBC复习";
  pdata.commentPath="";
  pdata.commentPlaceholder="";

  var l_header=document.getElementById("l_header");
  
  l_header.classList.add("show");
  
</script>

        
      </div>
      
  
  <footer class="footer clearfix">
    <br><br>
    
      
        <div class="aplayer-container">
          


        </div>
      
    
      
        
          <div><p>时不待我，舍我其谁</p>
</div>
        
      
    
      
        
          <div><br></div>
        
      
    
      
        
          <div><p><span id="lc-sv">本站总访问量为 <span id='number'><i class="fas fa-circle-notch fa-spin fa-fw" aria-hidden="true"></i></span> 次</span> <span id="lc-uv">访客数为 <span id='number'><i class="fas fa-circle-notch fa-spin fa-fw" aria-hidden="true"></i></span> 人</span></p>
</div>
        
      
    
      
        <div class='copyright'>
        <p><a target="_blank" rel="noopener" href="https://gitee.com/tobing">Copyright © 2017-2020 Tobing</a></p>

        </div>
      
    
  </footer>


      <a id="s-top" class="fas fa-arrow-up fa-fw" href='javascript:void(0)'></a>
    </div>
  </div>
  <div>
    <script>
window.volantis={};
window.volantis.loadcss=document.getElementById("loadcss");
/********************脚本懒加载函数********************************/
function loadScript(src, cb) {
var HEAD = document.getElementsByTagName('head')[0] || document.documentElement;
var script = document.createElement('script');
script.setAttribute('type','text/javascript');
if (cb) script.onload = cb;
script.setAttribute('src', src);
HEAD.appendChild(script);
}
//https://github.com/filamentgroup/loadCSS
var loadCSS = function( href, before, media, attributes ){
	var doc = window.document;
	var ss = doc.createElement( "link" );
	var ref;
	if( before ){
		ref = before;
	}
	else {
		var refs = ( doc.body || doc.getElementsByTagName( "head" )[ 0 ] ).childNodes;
		ref = refs[ refs.length - 1];
	}
	var sheets = doc.styleSheets;
	if( attributes ){
		for( var attributeName in attributes ){
			if( attributes.hasOwnProperty( attributeName ) ){
				ss.setAttribute( attributeName, attributes[attributeName] );
			}
		}
	}
	ss.rel = "stylesheet";
	ss.href = href;
	ss.media = "only x";
	function ready( cb ){
		if( doc.body ){
			return cb();
		}
		setTimeout(function(){
			ready( cb );
		});
	}
	ready( function(){
		ref.parentNode.insertBefore( ss, ( before ? ref : ref.nextSibling ) );
	});
	var onloadcssdefined = function( cb ){
		var resolvedHref = ss.href;
		var i = sheets.length;
		while( i-- ){
			if( sheets[ i ].href === resolvedHref ){
				return cb();
			}
		}
		setTimeout(function() {
			onloadcssdefined( cb );
		});
	};
	function loadCB(){
		if( ss.addEventListener ){
			ss.removeEventListener( "load", loadCB );
		}
		ss.media = media || "all";
	}
	if( ss.addEventListener ){
		ss.addEventListener( "load", loadCB);
	}
	ss.onloadcssdefined = onloadcssdefined;
	onloadcssdefined( loadCB );
	return ss;
};
</script>
<script>
  
  loadCSS("https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.14/css/all.min.css", window.volantis.loadcss);
  
  
  
  
</script>
<!-- required -->

<script src="https://cdn.jsdelivr.net/npm/jquery@3.5/dist/jquery.min.js"></script>

<script>
  function pjax_fancybox() {
    $(".md .gallery").find("img").each(function () { //渲染 fancybox
      var element = document.createElement("a"); // a 标签
      $(element).attr("class", "fancybox");
      $(element).attr("pjax-fancybox", "");  // 过滤 pjax
      $(element).attr("href", $(this).attr("src"));
      if ($(this).attr("data-original")) {
        $(element).attr("href", $(this).attr("data-original"));
      }
      $(element).attr("data-fancybox", "images");
      var caption = "";   // 描述信息
      if ($(this).attr('alt')) {  // 判断当前页面是否存在描述信息
        $(element).attr('data-caption', $(this).attr('alt'));
        caption = $(this).attr('alt');
      }
      var div = document.createElement("div");
      $(div).addClass("fancybox");
      $(this).wrap(div); // 最外层套 div ，其实主要作用还是 class 样式
      var span = document.createElement("span");
      $(span).addClass("image-caption");
      $(span).text(caption); // 加描述
      $(this).after(span);  // 再套一层描述
      $(this).wrap(element);  // 最后套 a 标签
    })
    $(".md .gallery").find("img").fancybox({
      selector: '[data-fancybox="images"]',
      hash: false,
      loop: false,
      closeClick: true,
      helpers: {
        overlay: {closeClick: true}
      },
      buttons: [
        "zoom",
        "close"
      ]
    });
  };
  function SCload_fancybox() {
    if ($(".md .gallery").find("img").length == 0) return;
    loadCSS("https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css", document.getElementById("loadcss"));
    setTimeout(function() {
      loadScript('https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js', pjax_fancybox)
    }, 1);
  };
  $(function () {
    SCload_fancybox();
  });
</script>


<!-- internal -->







  <script defer src="https://cdn.jsdelivr.net/npm/vanilla-lazyload@17.1.0/dist/lazyload.min.js"></script>
<script>
  // https://www.npmjs.com/package/vanilla-lazyload
  // Set the options globally
  // to make LazyLoad self-initialize
  window.lazyLoadOptions = {
    elements_selector: ".lazyload",
    threshold: 0
  };
  // Listen to the initialization event
  // and get the instance of LazyLoad
  window.addEventListener(
    "LazyLoad::Initialized",
    function (event) {
      window.lazyLoadInstance = event.detail.instance;
    },
    false
  );
  document.addEventListener('DOMContentLoaded', function () {
    lazyLoadInstance.update();
  });
  document.addEventListener('pjax:complete', function () {
    lazyLoadInstance.update();
  });
</script>




  
  
    <script>
      window.FPConfig = {
        delay: 0,
        ignoreKeywords: [],
        maxRPS: 5,
        hoverDelay: 25
      };
    </script>
    <script defer src="https://cdn.jsdelivr.net/gh/gijo-varghese/flying-pages@2.1.2/flying-pages.min.js"></script>
  










  
  
<script src="/js/valine.js"></script>


<script>
  var GUEST_INFO = ['nick', 'mail', 'link'];
  var meta = 'nick,mail,link'.split(',').filter(function (item) {
    return GUEST_INFO.indexOf(item) > -1
  });
  var REQUIRED_FIELDS = ['nick', 'mail', 'link'];
  var requiredFields = 'nick,mail'.split(',').filter(function (item) {
    return REQUIRED_FIELDS.indexOf(item) > -1
  });

  function emoji(path, idx, ext) {
    return path + "/" + path + "-" + idx + "." + ext;
  }

  var emojiMaps = {};
  for (var i = 1; i <= 54; i++) {
    emojiMaps['tieba-' + i] = emoji('tieba', i, 'png');
  }
  for (var i = 1; i <= 101; i++) {
    emojiMaps['qq-' + i] = emoji('qq', i, 'gif');
  }
  for (var i = 1; i <= 116; i++) {
    emojiMaps['aru-' + i] = emoji('aru', i, 'gif');
  }
  for (var i = 1; i <= 125; i++) {
    emojiMaps['twemoji-' + i] = emoji('twemoji', i, 'png');
  }
  for (var i = 1; i <= 4; i++) {
    emojiMaps['weibo-' + i] = emoji('weibo', i, 'png');
  }

  function pjax_valine() {
    if(!document.querySelectorAll("#valine_container")[0])return;

    let pagePlaceholder = pdata.commentPlaceholder || "快来评论吧:)~";

    let path = pdata.commentPath;
    if (path.length == 0) {
      let defaultPath = '';
      path = defaultPath || decodeURI(window.location.pathname);
    }

    var valine = new Valine();
    valine.init({
      el: '#valine_container',
      meta: meta,
      placeholder: pagePlaceholder,
      path: path,
      appId: "Vy5O9liYY1EruxX5WAaSWiFU-gzGzoHsz",
      appKey: "LkbvdUheh7noXFlcQzKXf4hV",
      pageSize: '10',
      avatar: 'robohash',
      lang: 'zh-cn',
      visitor: 'true',
      highlight: 'true',
      mathJax: 'false',
      enableQQ: 'true',
      recordIP: 'false',
      requiredFields: requiredFields,
      emojiCDN: 'https://cdn.jsdelivr.net/gh/volantis-x/cdn-emoji/valine/',
      emojiMaps: emojiMaps
    })
  }

  $(function () {
    pjax_valine();
  });
</script>





  
<script src="/js/app.js"></script>



<!-- optional -->

  <script>
const SearchServiceimagePath="https://cdn.jsdelivr.net/gh/volantis-x/cdn-volantis@master/img/";
const ROOT =  ("/" || "/").endsWith('/') ? ("/" || "/") : ("//" || "/" );

$('.input.u-search-input').one('focus',function(){
	
		loadScript('https://cdn.jsdelivr.net/gh/volantis-x/cdn-volantis@2.6.4/js/search.js',setSearchService);
	
})

function listenSearch(){
  
    customSearch = new HexoSearch({
      imagePath: SearchServiceimagePath
    });
  
}
function setSearchService() {
	listenSearch();
	
		document.addEventListener("pjax:success", listenSearch);
	
}
</script>











  <script defer>

  const LCCounter = {
    app_id: 'u9j57bwJod4EDmXWdxrwuqQT-MdYXbMMI',
    app_key: 'jfHtEKVE24j0IVCGHbvuFClp',
    custom_api_server: '',

    // 查询存储的记录
    getRecord(Counter, url, title) {
      return new Promise(function (resolve, reject) {
        Counter('get', '/classes/Counter?where=' + encodeURIComponent(JSON.stringify({url})))
          .then(resp => resp.json())
          .then(({results, code, error}) => {
            if (code === 401) {
              throw error;
            }
            if (results && results.length > 0) {
              var record = results[0];
              resolve(record);
            } else {
              Counter('post', '/classes/Counter', {url, title: title, times: 0})
                .then(resp => resp.json())
                .then((record, error) => {
                  if (error) {
                    throw error;
                  }
                  resolve(record);
                }).catch(error => {
                console.error('Failed to create', error);
                reject(error);
              });
            }
          }).catch((error) => {
          console.error('LeanCloud Counter Error:', error);
          reject(error);
        });
      })
    },

    // 发起自增请求
    increment(Counter, incrArr) {
      return new Promise(function (resolve, reject) {
        Counter('post', '/batch', {
          "requests": incrArr
        }).then((res) => {
          res = res.json();
          if (res.error) {
            throw res.error;
          }
          resolve(res);
        }).catch((error) => {
          console.error('Failed to save visitor count', error);
          reject(error);
        });
      });
    },

    // 构建自增请求体
    buildIncrement(objectId) {
      return {
        "method": "PUT",
        "path": `/1.1/classes/Counter/${ objectId }`,
        "body": {
          "times": {
            '__op': 'Increment',
            'amount': 1
          }
        }
      }
    },

    // 校验是否为有效的 UV
    validUV() {
      var key = 'LeanCloudUVTimestamp';
      var flag = localStorage.getItem(key);
      if (flag) {
        // 距离标记小于 24 小时则不计为 UV
        if (new Date().getTime() - parseInt(flag) <= 86400000) {
          return false;
        }
      }
      localStorage.setItem(key, new Date().getTime().toString());
      return true;
    },

    addCount(Counter) {
      var enableIncr = '' === 'true' && window.location.hostname !== 'localhost';
      enableIncr = true;
      var getterArr = [];
      var incrArr = [];
      // 请求 PV 并自增
      var pvCtn = document.querySelector('#lc-sv');
      if (pvCtn || enableIncr) {
        var pvGetter = this.getRecord(Counter, 'https://tobing.top' + '/#lc-sv', 'Visits').then((record) => {
          incrArr.push(this.buildIncrement(record.objectId))
          var eles = document.querySelectorAll('#lc-sv #number');
          if (eles.length > 0) {
            eles.forEach((el,index,array)=>{
              el.innerText = record.times + 1;
              if (pvCtn) {
                pvCtn.style.display = 'inline';
              }
            })
          }
        });
        getterArr.push(pvGetter);
      }

      // 请求 UV 并自增
      var uvCtn = document.querySelector('#lc-uv');
      if (uvCtn || enableIncr) {
        var uvGetter = this.getRecord(Counter, 'https://tobing.top' + '/#lc-uv', 'Visitors').then((record) => {
          var vuv = this.validUV();
          vuv && incrArr.push(this.buildIncrement(record.objectId))
          var eles = document.querySelectorAll('#lc-uv #number');
          if (eles.length > 0) {
            eles.forEach((el,index,array)=>{
              el.innerText = record.times + (vuv ? 1 : 0);
              if (uvCtn) {
                uvCtn.style.display = 'inline';
              }
            })
          }
        });
        getterArr.push(uvGetter);
      }

      // 请求文章的浏览数，如果是当前页面就自增
      var allPV = document.querySelectorAll('#lc-pv');
      if (allPV.length > 0 || enableIncr) {
        for (i = 0; i < allPV.length; i++) {
          let pv = allPV[i];
          let title = pv.getAttribute('data-title');
          var url = 'https://tobing.top' + pv.getAttribute('data-path');
          if (url) {
            var viewGetter = this.getRecord(Counter, url, title).then((record) => {
              // 是当前页面就自增
              let curPath = window.location.pathname;
              if (curPath.includes('index.html')) {
                curPath = curPath.substring(0, curPath.lastIndexOf('index.html'));
              }
              if (pv.getAttribute('data-path') == curPath) {
                incrArr.push(this.buildIncrement(record.objectId));
              }
              if (pv) {
                var ele = pv.querySelector('#lc-pv #number');
                if (ele) {
                  if (pv.getAttribute('data-path') == curPath) {
                    ele.innerText = (record.times || 0) + 1;
                  } else {
                    ele.innerText = record.times || 0;
                  }
                  pv.style.display = 'inline';
                }
              }
            });
            getterArr.push(viewGetter);
          }
        }
      }

      // 如果启动计数自增，批量发起自增请求
      if (enableIncr) {
        Promise.all(getterArr).then(() => {
          incrArr.length > 0 && this.increment(Counter, incrArr);
        })
      }

    },


    fetchData(api_server) {
      var Counter = (method, url, data) => {
        return fetch(`${ api_server }/1.1${ url }`, {
          method,
          headers: {
            'X-LC-Id': this.app_id,
            'X-LC-Key': this.app_key,
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(data)
        });
      };
      this.addCount(Counter);
    },

    refreshCounter() {
      var api_server = this.app_id.slice(-9) !== '-MdYXbMMI' ? this.custom_api_server : `https://${ this.app_id.slice(0, 8).toLowerCase() }.api.lncldglobal.com`;
      if (api_server) {
        this.fetchData(api_server);
      } else {
        fetch('https://app-router.leancloud.cn/2/route?appId=' + this.app_id)
          .then(resp => resp.json())
          .then(({api_server}) => {
            this.fetchData('https://' + api_server);
          });
      }
    }

  };

  LCCounter.refreshCounter();

  document.addEventListener('pjax:complete', function () {
    LCCounter.refreshCounter();
  });
</script>








<script>
function listennSidebarTOC() {
  const navItems = document.querySelectorAll(".toc li");
  if (!navItems.length) return;
  const sections = [...navItems].map((element) => {
    const link = element.querySelector(".toc-link");
    const target = document.getElementById(
      decodeURI(link.getAttribute("href")).replace("#", "")
    );
    link.addEventListener("click", (event) => {
      event.preventDefault();
      window.scrollTo({
		top: target.offsetTop + 100,
		
		behavior: "smooth"
		
	  });
    });
    return target;
  });

  function activateNavByIndex(target) {
    if (target.classList.contains("active-current")) return;

    document.querySelectorAll(".toc .active").forEach((element) => {
      element.classList.remove("active", "active-current");
    });
    target.classList.add("active", "active-current");
    let parent = target.parentNode;
    while (!parent.matches(".toc")) {
      if (parent.matches("li")) parent.classList.add("active");
      parent = parent.parentNode;
    }
  }

  function findIndex(entries) {
    let index = 0;
    let entry = entries[index];
    if (entry.boundingClientRect.top > 0) {
      index = sections.indexOf(entry.target);
      return index === 0 ? 0 : index - 1;
    }
    for (; index < entries.length; index++) {
      if (entries[index].boundingClientRect.top <= 0) {
        entry = entries[index];
      } else {
        return sections.indexOf(entry.target);
      }
    }
    return sections.indexOf(entry.target);
  }

  function createIntersectionObserver(marginTop) {
    marginTop = Math.floor(marginTop + 10000);
    let intersectionObserver = new IntersectionObserver(
      (entries, observe) => {
        let scrollHeight = document.documentElement.scrollHeight + 100;
        if (scrollHeight > marginTop) {
          observe.disconnect();
          createIntersectionObserver(scrollHeight);
          return;
        }
        let index = findIndex(entries);
        activateNavByIndex(navItems[index]);
      },
      {
        rootMargin: marginTop + "px 0px -100% 0px",
        threshold: 0,
      }
    );
    sections.forEach((element) => {
      element && intersectionObserver.observe(element);
    });
  }
  createIntersectionObserver(document.documentElement.scrollHeight);
}

document.addEventListener("DOMContentLoaded", listennSidebarTOC);
document.addEventListener("pjax:success", listennSidebarTOC);
</script>

<!-- more -->




    
      


<script src="https://cdn.jsdelivr.net/npm/pjax@0.2.8/pjax.min.js"></script>


<script>
    var pjax;
    document.addEventListener('DOMContentLoaded', function () {
      pjax = new Pjax({
        elements: 'a[href]:not([href^="#"]):not([href="javascript:void(0)"]):not([pjax-fancybox])',
        selectors: [
          "title",
          "#l_cover",
          "#pjax-container",
          "#pjax-header-nav-list"
        ],
        cacheBust: false,   // url 地址追加时间戳，用以避免浏览器缓存
        timeout: 5000
      });
    });

    document.addEventListener('pjax:send', function (e) {
      //window.stop(); // 相当于点击了浏览器的停止按钮

      try {
        var currentUrl = window.location.pathname;
        var targetUrl = e.triggerElement.href;
        var banUrl = [""];
        if (banUrl[0] != "") {
          banUrl.forEach(item => {
            if(currentUrl.indexOf(item) != -1 || targetUrl.indexOf(item) != -1) {
              window.location.href = targetUrl;
            }
          });
        }
      } catch (error) {}

      window.subData = null; // 移除标题（用于一二级导航栏切换处）
      if (typeof $.fancybox != "undefined") {
        $.fancybox.close();    // 关闭弹窗
      }
      volantis.$switcher.removeClass('active'); // 关闭移动端激活的搜索框
      volantis.$header.removeClass('z_search-open'); // 关闭移动端激活的搜索框
      volantis.$wrapper.removeClass('sub'); // 跳转页面时关闭二级导航

      // 解绑事件 避免重复监听
      volantis.$topBtn.unbind('click');
      $('.menu a').unbind('click');
      $(window).unbind('resize');
      $(window).unbind('scroll');
      $(document).unbind('scroll');
      $(document).unbind('click');
      $('body').unbind('click');
	  
    });

    document.addEventListener('pjax:complete', function () {
      // 关于百度统计对 SPA 页面的处理：
      // 方案一：百度统计>管理>单页应用设置中，打开开启按钮即可对SPA进行统计。 https://tongji.baidu.com/web/help/article?id=324
      // 方案二：取消注释下列代码。 https://tongji.baidu.com/web/help/article?id=235
       

      // 关于谷歌统计对 SPA 页面的处理：
      // 当应用以动态方式加载内容并更新地址栏中的网址时，也应该更新通过 gtag.js 存储的网页网址。
      // https://developers.google.cn/analytics/devguides/collection/gtagjs/single-page-applications?hl=zh-cn
      
	 

      $('.nav-main').find('.list-v').not('.menu-phone').removeAttr("style",""); // 移除小尾巴的移除
      $('.menu-phone.list-v').removeAttr("style",""); // 移除小尾巴的移除
      $('script[data-pjax], .pjax-reload script').each(function () {
        $(this).parent().append($(this).remove());
      });
      try{
          if (typeof $.fancybox == "undefined") {
            SCload_fancybox();
          } else {
            pjax_fancybox();
          }
        
        
        
        
        
        
          pjax_valine();
        
        
        
        
        
      } catch (e) {
        console.log(e);
      }
	  
    });

    document.addEventListener('pjax:error', function (e) {
	  
      window.location.href = e.triggerElement.href;
    });
</script>

    
  </div>
</body>
</html>
